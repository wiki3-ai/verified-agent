<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>stobj-preservation - ACL2 Book</title>
  <meta property="name" content="stobj-preservation">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">stobj-preservation</h1>
    <div class="path"><a href="stobj-preservation.lisp" class="source-link">books/clause-processors/stobj-preservation</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="../xdoc/top.html" title="xdoc/top">top</a>
      <a class="include-link" href="just-expand.html" title="just-expand">just-expand</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../xdoc/top.html" title="Open xdoc/top">"xdoc/top"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="just-expand.html" title="Open just-expand">"just-expand"</a>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc preservation-thms
  <span class="keyword">:parents</span> (stobj)
  <span class="keyword">:short</span> <span class="string">"Automation for proving that stobj-modifying functions preserve
certain properties"</span>
  <span class="keyword">:long</span> <span class="string">"
&lt;p&gt;A major pain when programming in logic mode with stobjs is maintaining
all the invariants necessary to prove guards.  We provide utilities to define a
set of theorem templates and to prove those theorems of a function.&lt;/p&gt;

&lt;p&gt;Usage:
@({
 (def-stobj-preservation-thms fnname
    :stobjname my-stobj
    :templates my-stobj-pres-templates
    :omit (my-thm-template-x my-thm-template-y)
    :history my-stobj-pres-history) })
tries to prove a set of preservation theorems as stored in the table
&lt;tt&gt;my-st-pres-templates&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To add a new preservation theorem to the existing set, use, for example,
@({
  (add-stobj-preservation-thm
   nth-of-field-preserved
   :vars (id)
   :body `(implies (&lt; id (my-index ,orig-stobj))
                   (equal (nth id (nth &#39;,*fieldi* ,new-stobj))
                          (nth id (nth &#39;,*fieldi* ,orig-stobj))))
   :hints `(,@expand/induct-hints
            (and stable-under-simplificationp
                 &#39;(:in-theory (enable my-index))))
   :enable &#39;(my-rule my-ruleset)
   :disable &#39;(bad-rule other-rules)
   :rule-classes `(:rewrite (:linear :trigger-terms (,new-stobj)))
   :templates my-stobj-pres-templates
   :history my-stobj-pres-history)})
Certain placeholder variables can be used in the body, hints, enable, disable,
and rule-classes fields:
&lt;ul&gt;
&lt;li&gt;&lt;tt&gt;orig-stobj&lt;/tt&gt; is the variable denoting the original stobj before modification&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;new-stobj&lt;/tt&gt; is the term giving the modified stobj after the function
call: for example, @(&#39;(mv-nth 1 (modify-my-stobj my-stobj))&#39;)&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;call&lt;/tt&gt; is the call of the function without the possible
&lt;tt&gt;mv-nth&lt;/tt&gt;, for example, @(&#39;(modify-my-stobj my-stobj)&#39;)&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;expand/induct-hints&lt;/tt&gt; are a generated set of hints specific to each
function for which the preservation theorem is to be proved, which expand and
 (if recursive) induct on that function&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;fn&lt;/tt&gt; is the function being worked on&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;fn$&lt;/tt&gt; is the @(&#39;deref-macro-name&#39;) of that function,
e.g. &lt;tt&gt;binary-logior&lt;/tt&gt; if the &lt;tt&gt;fn&lt;/tt&gt; were &lt;tt&gt;logior&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;formals&lt;/tt&gt; is the formals of the function, possibly with some
modification to the names, but the same ones used in &lt;tt&gt;call&lt;/tt&gt; and
&lt;tt&gt;new-stobj&lt;/tt&gt;.&lt;/li&gt;&lt;/ul&gt;
The &lt;tt&gt;:vars&lt;/tt&gt; argument should be a list containing all of the variable
names used in the theorem body; if the formals of the function contain any of
these variables, we will use a modified list of formals that avoids them.&lt;/p&gt;

&lt;p&gt;One additional keyword argument, &lt;tt&gt;:deps&lt;/tt&gt;, is allowed; if provided,
this should be a list of stobj-preservation-thm template names such as
&lt;tt&gt;nth-node-preserved&lt;/tt&gt; above.  This signifies that this theorem should
only be proved of functions for which the dependencies were also proved.&lt;/p&gt;

&lt;p&gt;Two additional macros, @(&#39;retroactive-add-stobj-preservation-thm&#39;) and
@(&#39;retroactive-add-stobj-preservation-thm-local&#39;) are similar to
@(&#39;add-stobj-preservation-thm&#39;) but additionally prove the new theorem for all
existing functions for which other stobj-preservation-thms have already been
proved, modulo the dependencies of the new theorem. The &lt;tt&gt;-local&lt;/tt&gt; version
makes the addition of the new theorem local to the current book or encapsulate,
so that nonlocal calls of &lt;tt&gt;def-stobj-preservation-thms&lt;/tt&gt; won&#39;t include
it.&lt;/p&gt;

&lt;p&gt;All of these macros take keyword arguments &lt;tt&gt;templates&lt;/tt&gt; and
&lt;tt&gt;history&lt;/tt&gt;, which should be symbols.  These symbols are the ACL2 table
names in which the templates and usage history are stored.  (The history is
used mainly for checking dependencies).  In order to simplify the usage of this
utility, we supply a macro-generating macro:
@({
 (def-stobj-preservation-macros :name hello
                                :default-stobjname my-stobj
                                :templates my-templates-table
                                :history my-history-table)})
which defines simple wrapper macros
@({
 (def-hello-preservation-thms ...)
 (add-hello-preservation-thm ...)
 (retroactive-add-hello-preservation-thm ...)
 (retroactive-add-hello-preservation-thm-local ...)})
that behave the same as the ones above, execpt that they don&#39;t take the
&lt;tt&gt;:templates&lt;/tt&gt; or &lt;tt&gt;:history&lt;/tt&gt; arguments and they use
&lt;tt&gt;my-stobj&lt;/tt&gt; by default for &lt;tt&gt;:stobjname&lt;/tt&gt;.&lt;/p&gt;
"</span>)</pre>
  </div>

<div class="form-block function" id="def-fix-formals-for-vars" data-defines="FIX-FORMALS-FOR-VARS" data-references="CDR,SYMBOL-NAME,GENVAR,UPDATE-NTH,CAR,POSITION,POS,LET*,ATOM,IF,XARGS,DECLARE,FORMALS,VARS,DEFUN" data-used-by="MK-STOBJ-PRESERVATION-THM" data-part-name="FIX-FORMALS-FOR-VARS" data-part-args="FORMALS,VARS" data-part-declare="XARGS,DECLARE" data-part-body="CDR,FIX-FORMALS-FOR-VARS,SYMBOL-NAME,GENVAR,UPDATE-NTH,CAR,POSITION,POS,LET*,FORMALS,VARS,ATOM,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="FIX-FORMALS-FOR-VARS">fix-formals-for-vars</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-fix-formals-for-vars" data-sym="FIX-FORMALS-FOR-VARS" title="(defun fix-formals-for-vars (vars formals)
  (declare (xargs :mode :program))
  (if (atom vars)
      formals
      (let* ((pos (position (car vars) formals))
...">fix-formals-for-vars</a>
  (vars <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span>))
  (if (<a class="sym-link system" href="../../axioms.html#def-atom" data-sym="ATOM">atom</a> vars)
    <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>
    (<a class="sym-link system" href="../../axioms.html#def-let_2A" data-sym="LET*">let*</a> ((pos (<a class="sym-link system" href="../../axioms.html#def-position" data-sym="POSITION">position</a> (car vars) <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>)) (<a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> (if pos
            (<a class="sym-link system" href="../../axioms.html#def-update-nth" data-sym="UPDATE-NTH">update-nth</a> pos
              (<a class="sym-link system" href="../../basis-b.html#def-genvar" data-sym="GENVAR">genvar</a> (car vars) (symbol-name (car vars)) <span class="number">0</span> <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
              <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
            <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>)))
      (<a class="sym-link local-def" href="#def-fix-formals-for-vars" data-sym="FIX-FORMALS-FOR-VARS" title="(defun fix-formals-for-vars (vars formals)
  (declare (xargs :mode :program))
  (if (atom vars)
      formals
      (let* ((pos (position (car vars) formals))
...">fix-formals-for-vars</a> (cdr vars) <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>))))</pre>
  </div>

<div class="form-block macro" id="def-add-stobj-preservation-record" data-defines="ADD-STOBJ-PRESERVATION-RECORD" data-references="WORLD,TABLE-ALIST,ASSOC-EQUAL,CDR,QUOTE,TABLE,QUASIQUOTE,CONS,PAIR,LET,HISTTABLE,TMPNAME,STOBJNAME,FN,DEFMACRO" data-used-by="MK-STOBJ-PRESERVATION-THM" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="ADD-STOBJ-PRESERVATION-RECORD">add-stobj-preservation-record</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-add-stobj-preservation-record" data-sym="ADD-STOBJ-PRESERVATION-RECORD" title="(defmacro add-stobj-preservation-record (fn stobjname tmpname histtable)
  (let ((pair (cons fn stobjname)))
    `(table ,histtable &#39;,pair
            (cons &#39;,tmpname
                  (cdr (assoc-equal &#39;,pair (table-alist &#39;,histtable world)))))))">add-stobj-preservation-record</a>
  (fn stobjname tmpname histtable)
  (let ((pair (cons fn stobjname)))
    `(<a class="sym-link system" href="../../axioms.html#def-table" data-sym="TABLE">table</a> ,HISTTABLE
      ',PAIR
      (cons ',TMPNAME
        (cdr (<a class="sym-link system" href="../../axioms.html#def-assoc-equal" data-sym="ASSOC-EQUAL">assoc-equal</a> ',PAIR (<a class="sym-link system" href="../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> ',HISTTABLE world)))))))</pre>
  </div>

<div class="form-block function" id="def-check-deps-satisfied" data-defines="CHECK-DEPS-SATISFIED" data-references="W,TABLE-ALIST,CONS,ASSOC-EQUAL,CDR,SUBSETP-EQ,XARGS,DECLARE,STATE,HISTTABLE,STOBJNAME,FN,DEPS,DEFUN" data-used-by="MK-STOBJ-PRESERVATION-THM" data-part-name="CHECK-DEPS-SATISFIED" data-part-args="STATE,HISTTABLE,STOBJNAME,FN,DEPS" data-part-declare="STATE,XARGS,DECLARE" data-part-body="STATE,W,HISTTABLE,TABLE-ALIST,STOBJNAME,FN,CONS,ASSOC-EQUAL,CDR,DEPS,SUBSETP-EQ" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CHECK-DEPS-SATISFIED">check-deps-satisfied</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-check-deps-satisfied" data-sym="CHECK-DEPS-SATISFIED" title="(defun check-deps-satisfied (deps fn stobjname histtable state)
  (declare (xargs :mode :program :stobjs state))
  (subsetp-eq deps
              (cdr
               (assoc-equal (cons fn stobjname)">check-deps-satisfied</a>
  (deps fn stobjname histtable state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state))
  (<a class="sym-link system" href="../../axioms.html#def-subsetp-eq" data-sym="SUBSETP-EQ">subsetp-eq</a> deps
    (cdr (<a class="sym-link system" href="../../axioms.html#def-assoc-equal" data-sym="ASSOC-EQUAL">assoc-equal</a> (cons fn stobjname)
        (<a class="sym-link system" href="../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> histtable (<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state))))))</pre>
  </div>

<div class="form-block function" id="def-mk-stobj-preservation-thm" data-defines="MK-STOBJ-PRESERVATION-THM" data-references="ADD-STOBJ-PRESERVATION-RECORD,DEFTHM,E/D*,IN-THEORY,LOCAL,ENCAPSULATE,VALUE-TRIPLE,CHECK-DEPS-SATISFIED,UNLESS,MAKE-EVENT,JUST-INDUCT-AND-EXPAND,NOT,AND,EXPAND/INDUCT-HINTS,T,RECURSIVEP,RECP,MV-NTH,QUASIQUOTE,CDR,IF,NEW-STOBJ,CONS,CALL,SYMBOL-NAME,STRING,QUOTE,CONCATENATE,INTERN-IN-PACKAGE-OF-SYMBOL,THMNAME,STOBJS-OUT,FIX-FORMALS-FOR-VARS,FORMALS,MACRO-ALIASES,DEREF-MACRO-NAME,FN$,W,WORLD,RULE-CLASSES,DISABLE,ENABLE,DEPS,RULESET,HINTS,BODY,VARS,NAME,NTHS,B*,XARGS,DECLARE,STATE,HISTTABLE,TEMPLATE,STOBJNAME,FN,DEFUN" data-used-by="MK-STOBJ-PRESERVATION-THMS" data-part-name="MK-STOBJ-PRESERVATION-THM" data-part-args="STATE,HISTTABLE,TEMPLATE,STOBJNAME,FN" data-part-declare="STATE,XARGS,DECLARE" data-part-body="ADD-STOBJ-PRESERVATION-RECORD,DEFTHM,E/D*,IN-THEORY,LOCAL,ENCAPSULATE,VALUE-TRIPLE,CHECK-DEPS-SATISFIED,UNLESS,MAKE-EVENT,JUST-INDUCT-AND-EXPAND,NOT,AND,EXPAND/INDUCT-HINTS,T,RECURSIVEP,RECP,MV-NTH,QUASIQUOTE,CDR,IF,NEW-STOBJ,CONS,CALL,SYMBOL-NAME,STRING,QUOTE,CONCATENATE,INTERN-IN-PACKAGE-OF-SYMBOL,THMNAME,STOBJS-OUT,FIX-FORMALS-FOR-VARS,FORMALS,MACRO-ALIASES,FN,DEREF-MACRO-NAME,FN$,STATE,W,WORLD,TEMPLATE,RULE-CLASSES,DISABLE,ENABLE,DEPS,RULESET,HINTS,BODY,VARS,NAME,NTHS,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MK-STOBJ-PRESERVATION-THM">mk-stobj-preservation-thm</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mk-stobj-preservation-thm" data-sym="MK-STOBJ-PRESERVATION-THM" title="(defun mk-stobj-preservation-thm (fn stobjname template histtable state)
  (declare (xargs :mode :program :stobjs state))
  (b*
   (((nths name vars body hints ruleset deps enable disable rule-classes)
     template)
...">mk-stobj-preservation-thm</a>
  (fn stobjname template histtable state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state))
  (b* (((nths name
        vars
        <a class="sym-link system" href="../../basis-b.html#def-body" data-sym="BODY">body</a>
        hints
        ruleset
        deps
        enable
        disable
        rule-classes) template) (world (<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state))
      (fn$ (<a class="sym-link system" href="../../axioms.html#def-deref-macro-name" data-sym="DEREF-MACRO-NAME">deref-macro-name</a> fn (<a class="sym-link system" href="../../axioms.html#def-macro-aliases" data-sym="MACRO-ALIASES">macro-aliases</a> world)))
      (<a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link local-def" href="#def-fix-formals-for-vars" data-sym="FIX-FORMALS-FOR-VARS" title="(defun fix-formals-for-vars (vars formals)
  (declare (xargs :mode :program))
  (if (atom vars)
      formals
      (let* ((pos (position (car vars) formals))
...">fix-formals-for-vars</a> vars (<a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> fn$ world)))
      (<a class="sym-link system" href="../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> (<a class="sym-link system" href="../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> fn$ world))
      (thmname (intern-in-package-of-symbol (<a class="sym-link system" href="../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../axioms.html#def-string" data-sym="STRING">string</a>
            (symbol-name name)
            <span class="string">"-OF-"</span>
            (symbol-name fn))
          fn))
      (call (cons fn <a class="sym-link system" href="../../basis-b.html#def-formals" data-sym="FORMALS">formals</a>))
      (new-stobj (if (cdr <a class="sym-link system" href="../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)
          `(<a class="sym-link system" href="../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> ,(POSITION STOBJNAME STOBJS-OUT) ,CALL)
          call))
      (recp (recursivep fn$ <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> world))
      (expand/induct-hints (if (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> recp (<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> (cdr recp)))
          `((<a class="sym-link external" href="just-expand.html#def-just-induct-and-expand" data-sym="JUST-INDUCT-AND-EXPAND">just-induct-and-expand</a> ,CALL))
          `((<span class="string">"Goal"</span> . ,(APPEND &#39;(:DO-NOT-INDUCT T) `(:IN-THEORY (DISABLE (:DEFINITION ,FN$)))
         (IF (AND RECP (NOT (CDR RECP)))
             NIL
             `(:EXPAND (,CALL)))))))))
    `(<a class="sym-link system" href="../../axioms.html#def-make-event" data-sym="MAKE-EVENT">make-event</a> (b* (((unless (<a class="sym-link local-def" href="#def-check-deps-satisfied" data-sym="CHECK-DEPS-SATISFIED" title="(defun check-deps-satisfied (deps fn stobjname histtable state)
  (declare (xargs :mode :program :stobjs state))
  (subsetp-eq deps
              (cdr
               (assoc-equal (cons fn stobjname)">check-deps-satisfied</a> ',DEPS
              ',FN
              ',STOBJNAME
              ',HISTTABLE
              state)) '(<a class="sym-link system" href="../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:skipped</span>)) (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?EXPAND/INDUCT-HINTS) HISTTABLE) ',EXPAND/INDUCT-HINTS)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?NEW-STOBJ) HISTTABLE) ',NEW-STOBJ)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?CALL) HISTTABLE) ',CALL)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?FN) HISTTABLE) ',FN)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?FN$) HISTTABLE) ',FN$)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?ORIG-STOBJ) HISTTABLE) ',STOBJNAME)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?FORMALS) HISTTABLE) ',FORMALS)
          (,(INTERN-IN-PACKAGE-OF-SYMBOL (SYMBOL-NAME &#39;?STOBJS-OUT) HISTTABLE) ',STOBJS-OUT))
        `(<a class="sym-link system" href="../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
          (<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (e/d* ,,ENABLE ,,DISABLE)))
          (<a class="sym-link system" href="../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ,&#39;,THMNAME
            ,,BODY
            <span class="keyword">:hints</span> ,,HINTS
            <span class="keyword">:rule-classes</span> ,,RULE-CLASSES)
          ,@&#39;,(AND RULESET `((ADD-TO-RULESET ,RULESET ,THMNAME)))
          (<a class="sym-link local-def" href="#def-add-stobj-preservation-record" data-sym="ADD-STOBJ-PRESERVATION-RECORD" title="(defmacro add-stobj-preservation-record (fn stobjname tmpname histtable)
  (let ((pair (cons fn stobjname)))
    `(table ,histtable &#39;,pair
            (cons &#39;,tmpname
                  (cdr (assoc-equal &#39;,pair (table-alist &#39;,histtable world)))))))">add-stobj-preservation-record</a> ,&#39;,FN
            ,&#39;,STOBJNAME
            ,&#39;,NAME
            ,&#39;,HISTTABLE))))))</pre>
  </div>

<div class="form-block function" id="def-mk-stobj-preservation-thms" data-defines="MK-STOBJ-PRESERVATION-THMS" data-references="CDR,CAR,MK-STOBJ-PRESERVATION-THM,CONS,CAAR,MEMBER,NOT,CDAR,AND,ATOM,IF,XARGS,DECLARE,STATE,HISTTABLE,TEMPLATES,OMIT,STOBJNAME,FN,DEFUN" data-used-by="DEF-STOBJ-PRESERVATION-THMS-FN" data-part-name="MK-STOBJ-PRESERVATION-THMS" data-part-args="STATE,HISTTABLE,TEMPLATES,OMIT,STOBJNAME,FN" data-part-declare="STATE,XARGS,DECLARE" data-part-body="CDR,MK-STOBJ-PRESERVATION-THMS,STATE,HISTTABLE,CAR,STOBJNAME,FN,MK-STOBJ-PRESERVATION-THM,CONS,OMIT,CAAR,MEMBER,NOT,CDAR,AND,TEMPLATES,ATOM,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MK-STOBJ-PRESERVATION-THMS">mk-stobj-preservation-thms</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mk-stobj-preservation-thms" data-sym="MK-STOBJ-PRESERVATION-THMS" title="(defun mk-stobj-preservation-thms (fn stobjname omit templates histtable state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom templates)
      nil
      (if (and (cdar templates) (not (member (caar templates) omit)))
...">mk-stobj-preservation-thms</a>
  (fn stobjname omit templates histtable state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state))
  (if (<a class="sym-link system" href="../../axioms.html#def-atom" data-sym="ATOM">atom</a> templates)
    nil
    (if (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../axioms.html#def-cdar" data-sym="CDAR">cdar</a> templates) (<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../axioms.html#def-member" data-sym="MEMBER">member</a> (<a class="sym-link system" href="../../axioms.html#def-caar" data-sym="CAAR">caar</a> templates) omit)))
      (cons (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thm" data-sym="MK-STOBJ-PRESERVATION-THM" title="(defun mk-stobj-preservation-thm (fn stobjname template histtable state)
  (declare (xargs :mode :program :stobjs state))
  (b*
   (((nths name vars body hints ruleset deps enable disable rule-classes)
     template)
...">mk-stobj-preservation-thm</a> fn
          stobjname
          (car templates)
          histtable
          state)
        (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thms" data-sym="MK-STOBJ-PRESERVATION-THMS" title="(defun mk-stobj-preservation-thms (fn stobjname omit templates histtable state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom templates)
      nil
      (if (and (cdar templates) (not (member (caar templates) omit)))
...">mk-stobj-preservation-thms</a> fn
          stobjname
          omit
          (cdr templates)
          histtable
          state))
      (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thms" data-sym="MK-STOBJ-PRESERVATION-THMS" title="(defun mk-stobj-preservation-thms (fn stobjname omit templates histtable state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom templates)
      nil
      (if (and (cdar templates) (not (member (caar templates) omit)))
...">mk-stobj-preservation-thms</a> fn
        stobjname
        omit
        (cdr templates)
        histtable
        state))))</pre>
  </div>

<div class="form-block function" id="def-def-stobj-preservation-thms-fn" data-defines="DEF-STOBJ-PRESERVATION-THMS-FN" data-references="W,TABLE-ALIST,REVERSE,MK-STOBJ-PRESERVATION-THMS,PROGN,QUOTE,LIST*,XARGS,DECLARE,STATE,HISTTABLE,TEMPLATE-TABLE,OMIT,STOBJNAME,FN,DEFUN" data-used-by="DEF-STOBJ-PRESERVATION-THMS" data-part-name="DEF-STOBJ-PRESERVATION-THMS-FN" data-part-args="STATE,HISTTABLE,TEMPLATE-TABLE,OMIT,STOBJNAME,FN" data-part-declare="STATE,XARGS,DECLARE" data-part-body="HISTTABLE,STATE,W,TEMPLATE-TABLE,TABLE-ALIST,REVERSE,OMIT,STOBJNAME,FN,MK-STOBJ-PRESERVATION-THMS,PROGN,QUOTE,LIST*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="DEF-STOBJ-PRESERVATION-THMS-FN">def-stobj-preservation-thms-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-def-stobj-preservation-thms-fn" data-sym="DEF-STOBJ-PRESERVATION-THMS-FN" title="(defun def-stobj-preservation-thms-fn
       (fn stobjname omit template-table histtable state)
  (declare (xargs :mode :program :stobjs state))
  (list* &#39;progn
         (mk-stobj-preservation-thms fn stobjname omit">def-stobj-preservation-thms-fn</a>
  (fn stobjname omit template-table histtable state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state))
  (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> '<a class="sym-link system" href="../../axioms.html#def-progn" data-sym="PROGN">progn</a>
    (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thms" data-sym="MK-STOBJ-PRESERVATION-THMS" title="(defun mk-stobj-preservation-thms (fn stobjname omit templates histtable state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom templates)
      nil
      (if (and (cdar templates) (not (member (caar templates) omit)))
...">mk-stobj-preservation-thms</a> fn
      stobjname
      omit
      (<a class="sym-link system" href="../../axioms.html#def-reverse" data-sym="REVERSE">reverse</a> (<a class="sym-link system" href="../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> template-table (<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
      histtable
      state)))</pre>
  </div>

<div class="form-block macro" id="def-def-stobj-preservation-thms" data-defines="DEF-STOBJ-PRESERVATION-THMS" data-references="STATE,DEF-STOBJ-PRESERVATION-THMS-FN,MAKE-EVENT,QUASIQUOTE,HISTORY,TEMPLATES,OMIT,STOBJ,QUOTE,STOBJNAME,&KEY,FN,DEFMACRO" data-used-by="DEF-STOBJ-PRESERVATION-MACROS-FN,MK-STOBJ-PRESERVATION-THMS-EACH-FN" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="DEF-STOBJ-PRESERVATION-THMS">def-stobj-preservation-thms</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-def-stobj-preservation-thms" data-sym="DEF-STOBJ-PRESERVATION-THMS" title="(defmacro def-stobj-preservation-thms
          (fn &amp;key (stobjname &#39;stobj) (omit &#39;nil) templates history)
  `(make-event
    (def-stobj-preservation-thms-fn &#39;,fn &#39;,stobjname &#39;,omit &#39;,templates
     &#39;,history state)))">def-stobj-preservation-thms</a>
  (fn &amp;key (stobjname 'stobj) (omit 'nil) templates history)
  `(<a class="sym-link system" href="../../axioms.html#def-make-event" data-sym="MAKE-EVENT">make-event</a> (<a class="sym-link local-def" href="#def-def-stobj-preservation-thms-fn" data-sym="DEF-STOBJ-PRESERVATION-THMS-FN" title="(defun def-stobj-preservation-thms-fn
       (fn stobjname omit template-table histtable state)
  (declare (xargs :mode :program :stobjs state))
  (list* &#39;progn
         (mk-stobj-preservation-thms fn stobjname omit">def-stobj-preservation-thms-fn</a> ',FN
      ',STOBJNAME
      ',OMIT
      ',TEMPLATES
      ',HISTORY
      state)))</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-def-stobj-preservation-thms" data-sym="DEF-STOBJ-PRESERVATION-THMS" title="(defmacro def-stobj-preservation-thms
          (fn &amp;key (stobjname &#39;stobj) (omit &#39;nil) templates history)
  `(make-event
    (def-stobj-preservation-thms-fn &#39;,fn &#39;,stobjname &#39;,omit &#39;,templates
     &#39;,history state)))">def-stobj-preservation-thms</a>
  <span class="keyword">:parents</span> (preservation-thms)
  <span class="keyword">:short</span> <span class="string">"Prove the existing set of aigstobj preservation theorems for a given function"</span>
  <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)</pre>
  </div>

<div class="form-block function" id="def-mk-stobj-preservation-thms-each-fn" data-defines="MK-STOBJ-PRESERVATION-THMS-EACH-FN" data-references="CDR,DEF-STOBJ-PRESERVATION-THMS,QUASIQUOTE,CONS,ATOM,IF,XARGS,DECLARE,STATE,HISTORY,TEMPLATES,RECORDS,DEFUN" data-used-by="DO-STOBJ-PRESERVATION-THMS-FN" data-part-name="MK-STOBJ-PRESERVATION-THMS-EACH-FN" data-part-args="STATE,HISTORY,TEMPLATES,RECORDS" data-part-declare="STATE,XARGS,DECLARE" data-part-body="STATE,HISTORY,TEMPLATES,CDR,MK-STOBJ-PRESERVATION-THMS-EACH-FN,DEF-STOBJ-PRESERVATION-THMS,QUASIQUOTE,CONS,RECORDS,ATOM,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MK-STOBJ-PRESERVATION-THMS-EACH-FN">mk-stobj-preservation-thms-each-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mk-stobj-preservation-thms-each-fn" data-sym="MK-STOBJ-PRESERVATION-THMS-EACH-FN" title="(defun mk-stobj-preservation-thms-each-fn (records templates history state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom records)
      nil
      (cons
...">mk-stobj-preservation-thms-each-fn</a>
  (records templates history state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state))
  (if (<a class="sym-link system" href="../../axioms.html#def-atom" data-sym="ATOM">atom</a> records)
    nil
    (cons `(<a class="sym-link local-def" href="#def-def-stobj-preservation-thms" data-sym="DEF-STOBJ-PRESERVATION-THMS" title="(defmacro def-stobj-preservation-thms
          (fn &amp;key (stobjname &#39;stobj) (omit &#39;nil) templates history)
  `(make-event
    (def-stobj-preservation-thms-fn &#39;,fn &#39;,stobjname &#39;,omit &#39;,templates
     &#39;,history state)))">def-stobj-preservation-thms</a> ,(CAAAR RECORDS)
        <span class="keyword">:stobjname</span> ,(CDAAR RECORDS)
        <span class="keyword">:templates</span> ,TEMPLATES
        <span class="keyword">:history</span> ,HISTORY)
      (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thms-each-fn" data-sym="MK-STOBJ-PRESERVATION-THMS-EACH-FN" title="(defun mk-stobj-preservation-thms-each-fn (records templates history state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom records)
      nil
      (cons
...">mk-stobj-preservation-thms-each-fn</a> (cdr records)
        templates
        history
        state))))</pre>
  </div>

<div class="form-block function" id="def-do-stobj-preservation-thms-fn" data-defines="DO-STOBJ-PRESERVATION-THMS-FN" data-references="W,TABLE-ALIST,REVERSE,MK-STOBJ-PRESERVATION-THMS-EACH-FN,PROGN,QUOTE,CONS,IGNORE,XARGS,DECLARE,STATE,HISTORY,TEMPLATES,UNIQUE-NAME,DEFUN" data-used-by="DO-STOBJ-PRESERVATION-THMS" data-part-name="DO-STOBJ-PRESERVATION-THMS-FN" data-part-args="STATE,HISTORY,TEMPLATES,UNIQUE-NAME" data-part-declare="UNIQUE-NAME,IGNORE,STATE,XARGS,DECLARE" data-part-body="TEMPLATES,STATE,W,HISTORY,TABLE-ALIST,REVERSE,MK-STOBJ-PRESERVATION-THMS-EACH-FN,PROGN,QUOTE,CONS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="DO-STOBJ-PRESERVATION-THMS-FN">do-stobj-preservation-thms-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-do-stobj-preservation-thms-fn" data-sym="DO-STOBJ-PRESERVATION-THMS-FN" title="(defun do-stobj-preservation-thms-fn (unique-name templates history state)
  (declare (xargs :mode :program :stobjs state)
           (ignore unique-name))
  (cons &#39;progn
        (mk-stobj-preservation-thms-each-fn">do-stobj-preservation-thms-fn</a>
  (unique-name templates history state)
  (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:stobjs</span> state)
    (ignore unique-name))
  (cons '<a class="sym-link system" href="../../axioms.html#def-progn" data-sym="PROGN">progn</a>
    (<a class="sym-link local-def" href="#def-mk-stobj-preservation-thms-each-fn" data-sym="MK-STOBJ-PRESERVATION-THMS-EACH-FN" title="(defun mk-stobj-preservation-thms-each-fn (records templates history state)
  (declare (xargs :mode :program :stobjs state))
  (if (atom records)
      nil
      (cons
...">mk-stobj-preservation-thms-each-fn</a> (<a class="sym-link system" href="../../axioms.html#def-reverse" data-sym="REVERSE">reverse</a> (<a class="sym-link system" href="../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> history (<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
      templates
      history
      state)))</pre>
  </div>

<div class="form-block macro" id="def-do-stobj-preservation-thms" data-defines="DO-STOBJ-PRESERVATION-THMS" data-references="STATE,QUOTE,DO-STOBJ-PRESERVATION-THMS-FN,MAKE-EVENT,QUASIQUOTE,HISTORY,TEMPLATES,&KEY,UNIQUE-NAME,DEFMACRO" data-used-by="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL,RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="DO-STOBJ-PRESERVATION-THMS">do-stobj-preservation-thms</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-do-stobj-preservation-thms" data-sym="DO-STOBJ-PRESERVATION-THMS" title="(defmacro do-stobj-preservation-thms (unique-name &amp;key templates history)
  `(make-event
    (do-stobj-preservation-thms-fn &#39;,unique-name &#39;,templates &#39;,history state)))">do-stobj-preservation-thms</a>
  (unique-name &amp;key templates history)
  `(<a class="sym-link system" href="../../axioms.html#def-make-event" data-sym="MAKE-EVENT">make-event</a> (<a class="sym-link local-def" href="#def-do-stobj-preservation-thms-fn" data-sym="DO-STOBJ-PRESERVATION-THMS-FN" title="(defun do-stobj-preservation-thms-fn (unique-name templates history state)
  (declare (xargs :mode :program :stobjs state)
           (ignore unique-name))
  (cons &#39;progn
        (mk-stobj-preservation-thms-each-fn">do-stobj-preservation-thms-fn</a> ',UNIQUE-NAME
      ',TEMPLATES
      ',HISTORY
      state)))</pre>
  </div>

<div class="form-block function" id="def-add-stobj-preservation-thm-fn" data-defines="ADD-STOBJ-PRESERVATION-THM-FN" data-references="QUOTE,TABLE,PROGN,QUASIQUOTE,IGNORABLE,DECLARE,RULE-CLASSES,DISABLE,ENABLE,DEPS,HISTORY,TEMPLATES,RULESET,HINTS,BODY,VARS,NAME,DEFUN" data-used-by="ADD-STOBJ-PRESERVATION-THM" data-part-name="ADD-STOBJ-PRESERVATION-THM-FN" data-part-args="RULE-CLASSES,DISABLE,ENABLE,DEPS,HISTORY,TEMPLATES,RULESET,HINTS,BODY,VARS,NAME" data-part-declare="HISTORY,IGNORABLE,DECLARE" data-part-body="QUOTE,TABLE,PROGN,QUASIQUOTE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="ADD-STOBJ-PRESERVATION-THM-FN">add-stobj-preservation-thm-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-add-stobj-preservation-thm-fn" data-sym="ADD-STOBJ-PRESERVATION-THM-FN" title="(defun add-stobj-preservation-thm-fn
       (name vars body hints ruleset templates history deps enable disable
        rule-classes)
  (declare (ignorable history))
  `(progn
...">add-stobj-preservation-thm-fn</a>
  (name vars
    <a class="sym-link system" href="../../basis-b.html#def-body" data-sym="BODY">body</a>
    hints
    ruleset
    templates
    history
    deps
    enable
    disable
    rule-classes)
  (declare (ignorable history))
  `(<a class="sym-link system" href="../../axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link system" href="../../axioms.html#def-table" data-sym="TABLE">table</a> ,TEMPLATES
      ',NAME
      ',(LIST VARS BODY HINTS RULESET DEPS ENABLE DISABLE RULE-CLASSES)) . ,(AND RULESET `((DEF-RULESET! ,RULESET NIL)))))</pre>
  </div>

<div class="form-block macro" id="def-add-stobj-preservation-thm" data-defines="ADD-STOBJ-PRESERVATION-THM" data-references="ADD-STOBJ-PRESERVATION-THM-FN,QUOTE,RULE-CLASSES,DISABLE,ENABLE,DEPS,HISTORY,TEMPLATES,RULESET,HINTS,BODY,VARS,&KEY,NAME,DEFMACRO" data-used-by="DEF-STOBJ-PRESERVATION-MACROS-FN,RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL,RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="ADD-STOBJ-PRESERVATION-THM">add-stobj-preservation-thm</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a>
  (name &amp;key
    vars
    <a class="sym-link system" href="../../basis-b.html#def-body" data-sym="BODY">body</a>
    hints
    ruleset
    templates
    history
    deps
    enable
    disable
    (rule-classes '<span class="keyword">:rewrite</span>))
  (<a class="sym-link local-def" href="#def-add-stobj-preservation-thm-fn" data-sym="ADD-STOBJ-PRESERVATION-THM-FN" title="(defun add-stobj-preservation-thm-fn
       (name vars body hints ruleset templates history deps enable disable
        rule-classes)
  (declare (ignorable history))
  `(progn
...">add-stobj-preservation-thm-fn</a> name
    vars
    <a class="sym-link system" href="../../basis-b.html#def-body" data-sym="BODY">body</a>
    hints
    ruleset
    templates
    history
    deps
    enable
    disable
    rule-classes))</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a>
  <span class="keyword">:parents</span> (preservation-thms)
  <span class="keyword">:short</span> <span class="string">"Add a theorem template to the def-stobj-preservation-thms database"</span>
  <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)</pre>
  </div>

<div class="form-block macro" id="def-retroactive-add-stobj-preservation-thm" data-defines="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" data-references="DO-STOBJ-PRESERVATION-THMS,ADD-STOBJ-PRESERVATION-THM,TABLE,LOCAL,ENCAPSULATE,QUASIQUOTE,&ALLOW-OTHER-KEYS,HISTORY,TEMPLATES,&KEY,ARGS,&REST,NAME,DEFMACRO" data-used-by="DEF-STOBJ-PRESERVATION-MACROS-FN" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM">retroactive-add-stobj-preservation-thm</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" title="(defmacro retroactive-add-stobj-preservation-thm
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(encapsulate nil (local (table ,templates nil nil :clear))
                (add-stobj-preservation-thm ,name . ,args)
                (do-stobj-preservation-thms ,name :templates ,templates">retroactive-add-stobj-preservation-thm</a>
  (name &amp;rest <a class="sym-link system" href="../../defuns.html#def-args" data-sym="ARGS">args</a> &amp;key templates history &amp;allow-other-keys)
  `(<a class="sym-link system" href="../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../axioms.html#def-table" data-sym="TABLE">table</a> ,TEMPLATES nil nil <span class="keyword">:clear</span>))
    (<a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a> ,NAME . ,ARGS)
    (<a class="sym-link local-def" href="#def-do-stobj-preservation-thms" data-sym="DO-STOBJ-PRESERVATION-THMS" title="(defmacro do-stobj-preservation-thms (unique-name &amp;key templates history)
  `(make-event
    (do-stobj-preservation-thms-fn &#39;,unique-name &#39;,templates &#39;,history state)))">do-stobj-preservation-thms</a> ,NAME
      <span class="keyword">:templates</span> ,TEMPLATES
      <span class="keyword">:history</span> ,HISTORY)))</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" title="(defmacro retroactive-add-stobj-preservation-thm
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(encapsulate nil (local (table ,templates nil nil :clear))
                (add-stobj-preservation-thm ,name . ,args)
                (do-stobj-preservation-thms ,name :templates ,templates">retroactive-add-stobj-preservation-thm</a>
  <span class="keyword">:parents</span> (preservation-thms)
  <span class="keyword">:short</span> <span class="string">"Add a theorem template to the def-stobj-preservation-thms database
and prove it about existing functions"</span>
  <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)</pre>
  </div>

<div class="form-block macro" id="def-retroactive-add-stobj-preservation-thm-local" data-defines="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL" data-references="DO-STOBJ-PRESERVATION-THMS,ADD-STOBJ-PRESERVATION-THM,TABLE,LOCAL,ENCAPSULATE,PROGN,QUASIQUOTE,&ALLOW-OTHER-KEYS,HISTORY,TEMPLATES,&KEY,ARGS,&REST,NAME,DEFMACRO" data-used-by="DEF-STOBJ-PRESERVATION-MACROS-FN" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL">retroactive-add-stobj-preservation-thm-local</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm-local" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL" title="(defmacro retroactive-add-stobj-preservation-thm-local
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(progn
    (encapsulate nil (local (table ,templates nil nil :clear))
                 (local (add-stobj-preservation-thm ,name . ,args))
...">retroactive-add-stobj-preservation-thm-local</a>
  (name &amp;rest <a class="sym-link system" href="../../defuns.html#def-args" data-sym="ARGS">args</a> &amp;key templates history &amp;allow-other-keys)
  `(<a class="sym-link system" href="../../axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link system" href="../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
      (<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../axioms.html#def-table" data-sym="TABLE">table</a> ,TEMPLATES nil nil <span class="keyword">:clear</span>))
      (<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a> ,NAME . ,ARGS))
      (<a class="sym-link local-def" href="#def-do-stobj-preservation-thms" data-sym="DO-STOBJ-PRESERVATION-THMS" title="(defmacro do-stobj-preservation-thms (unique-name &amp;key templates history)
  `(make-event
    (do-stobj-preservation-thms-fn &#39;,unique-name &#39;,templates &#39;,history state)))">do-stobj-preservation-thms</a> ,NAME
        <span class="keyword">:templates</span> ,TEMPLATES
        <span class="keyword">:history</span> ,HISTORY))
    (<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a> ,NAME . ,ARGS))))</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm-local" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL" title="(defmacro retroactive-add-stobj-preservation-thm-local
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(progn
    (encapsulate nil (local (table ,templates nil nil :clear))
                 (local (add-stobj-preservation-thm ,name . ,args))
...">retroactive-add-stobj-preservation-thm-local</a>
  <span class="keyword">:parents</span> (preservation-thms)
  <span class="keyword">:short</span> <span class="string">"Localy add a theorem template to the def-stobj-preservation-thms database
and (nonlocally) prove it about existing functions"</span>
  <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)</pre>
  </div>

<div class="form-block function" id="def-def-stobj-preservation-macros-fn" data-defines="DEF-STOBJ-PRESERVATION-MACROS-FN" data-references="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL,RETROACTIVE-ADD-STOBJ-PRESERVATION-THM,ARGS,&REST,ADD-STOBJ-PRESERVATION-THM,RULE-CLASSES,DISABLE,ENABLE,DEPS,RULESET,HINTS,BODY,VARS,PRESERVATION-THMS,DEFXDOC,DEF-STOBJ-PRESERVATION-THMS,OMIT,STOBJNAME,&KEY,FN,DEFMACRO,PROGN,QUASIQUOTE,RETRO-LOCAL-NAME,RETRO-NAME,ADD-NAME,SYMBOL-NAME,STRING,QUOTE,CONCATENATE,INTERN-IN-PACKAGE-OF-SYMBOL,DEFTHMS-NAME,B*,HISTORY,TEMPLATES,DEFAULT-STOBJNAME,NAME,DEFUN" data-used-by="DEF-STOBJ-PRESERVATION-MACROS" data-part-name="DEF-STOBJ-PRESERVATION-MACROS-FN" data-part-args="HISTORY,TEMPLATES,DEFAULT-STOBJNAME,NAME" data-part-body="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL,RETROACTIVE-ADD-STOBJ-PRESERVATION-THM,ARGS,&REST,ADD-STOBJ-PRESERVATION-THM,RULE-CLASSES,DISABLE,ENABLE,DEPS,RULESET,HINTS,BODY,VARS,PRESERVATION-THMS,DEFXDOC,DEF-STOBJ-PRESERVATION-THMS,OMIT,STOBJNAME,&KEY,FN,DEFMACRO,PROGN,QUASIQUOTE,RETRO-LOCAL-NAME,RETRO-NAME,ADD-NAME,NAME,SYMBOL-NAME,STRING,QUOTE,CONCATENATE,INTERN-IN-PACKAGE-OF-SYMBOL,DEFTHMS-NAME,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="DEF-STOBJ-PRESERVATION-MACROS-FN">def-stobj-preservation-macros-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-def-stobj-preservation-macros-fn" data-sym="DEF-STOBJ-PRESERVATION-MACROS-FN" title="(defun def-stobj-preservation-macros-fn
       (name default-stobjname templates history)
  (b*
   ((defthms-name
     (intern-in-package-of-symbol
...">def-stobj-preservation-macros-fn</a>
  (name default-stobjname templates history)
  (b* ((defthms-name (intern-in-package-of-symbol (<a class="sym-link system" href="../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../axioms.html#def-string" data-sym="STRING">string</a>
           <span class="string">"DEF-"</span>
           (symbol-name name)
           <span class="string">"-PRESERVATION-THMS"</span>)
         name)) (add-name (intern-in-package-of-symbol (<a class="sym-link system" href="../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../axioms.html#def-string" data-sym="STRING">string</a>
            <span class="string">"ADD-"</span>
            (symbol-name name)
            <span class="string">"-PRESERVATION-THM"</span>)
          name))
      (retro-name (intern-in-package-of-symbol (<a class="sym-link system" href="../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../axioms.html#def-string" data-sym="STRING">string</a>
            <span class="string">"RETROACTIVE-ADD-"</span>
            (symbol-name name)
            <span class="string">"-PRESERVATION-THM"</span>)
          name))
      (retro-local-name (intern-in-package-of-symbol (<a class="sym-link system" href="../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../axioms.html#def-string" data-sym="STRING">string</a>
            <span class="string">"RETROACTIVE-ADD-"</span>
            (symbol-name name)
            <span class="string">"-PRESERVATION-THM-LOCAL"</span>)
          name)))
    `(<a class="sym-link system" href="../../axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> ,DEFTHMS-NAME
        (fn &amp;key (stobjname ',DEFAULT-STOBJNAME) omit)
        `(<a class="sym-link local-def" href="#def-def-stobj-preservation-thms" data-sym="DEF-STOBJ-PRESERVATION-THMS" title="(defmacro def-stobj-preservation-thms
          (fn &amp;key (stobjname &#39;stobj) (omit &#39;nil) templates history)
  `(make-event
    (def-stobj-preservation-thms-fn &#39;,fn &#39;,stobjname &#39;,omit &#39;,templates
     &#39;,history state)))">def-stobj-preservation-thms</a> ,FN
          <span class="keyword">:stobjname</span> ,STOBJNAME
          <span class="keyword">:omit</span> ,OMIT
          <span class="keyword">:templates</span> ,&#39;,TEMPLATES
          <span class="keyword">:history</span> ,&#39;,HISTORY))
      (defxdoc ,DEFTHMS-NAME
        <span class="keyword">:parents</span> (preservation-thms)
        <span class="keyword">:short</span> <span class="string">"Generated by def-stobj-preservation-macros."</span>
        <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)
      (<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> ,ADD-NAME
        (name &amp;key
          vars
          <a class="sym-link system" href="../../basis-b.html#def-body" data-sym="BODY">body</a>
          hints
          ruleset
          deps
          enable
          disable
          (rule-classes '<span class="keyword">:rewrite</span>))
        `(<a class="sym-link local-def" href="#def-add-stobj-preservation-thm" data-sym="ADD-STOBJ-PRESERVATION-THM" title="(defmacro add-stobj-preservation-thm
          (name
           &amp;key vars body hints ruleset templates history deps enable disable
           (rule-classes &#39;:rewrite))
  (add-stobj-preservation-thm-fn name vars body hints ruleset templates history">add-stobj-preservation-thm</a> ,NAME
          <span class="keyword">:vars</span> ,VARS
          <span class="keyword">:body</span> ,BODY
          <span class="keyword">:hints</span> ,HINTS
          <span class="keyword">:deps</span> ,DEPS
          <span class="keyword">:ruleset</span> ,RULESET
          <span class="keyword">:templates</span> ,&#39;,TEMPLATES
          <span class="keyword">:history</span> ,&#39;,HISTORY
          <span class="keyword">:enable</span> ,ENABLE
          <span class="keyword">:disable</span> ,DISABLE
          <span class="keyword">:rule-classes</span> ,RULE-CLASSES))
      (defxdoc ,ADD-NAME
        <span class="keyword">:parents</span> (preservation-thms)
        <span class="keyword">:short</span> <span class="string">"Generated by def-stobj-preservation-macros."</span>
        <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)
      (<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> ,RETRO-NAME
        (name &amp;rest <a class="sym-link system" href="../../defuns.html#def-args" data-sym="ARGS">args</a>)
        `(<a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM" title="(defmacro retroactive-add-stobj-preservation-thm
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(encapsulate nil (local (table ,templates nil nil :clear))
                (add-stobj-preservation-thm ,name . ,args)
                (do-stobj-preservation-thms ,name :templates ,templates">retroactive-add-stobj-preservation-thm</a> ,NAME
          ,@ARGS
          <span class="keyword">:templates</span> ,&#39;,TEMPLATES
          <span class="keyword">:history</span> ,&#39;,HISTORY))
      (defxdoc ,RETRO-NAME
        <span class="keyword">:parents</span> (preservation-thms)
        <span class="keyword">:short</span> <span class="string">"Generated by def-stobj-preservation-macros."</span>
        <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>)
      (<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> ,RETRO-LOCAL-NAME
        (name &amp;rest <a class="sym-link system" href="../../defuns.html#def-args" data-sym="ARGS">args</a>)
        `(<a class="sym-link local-def" href="#def-retroactive-add-stobj-preservation-thm-local" data-sym="RETROACTIVE-ADD-STOBJ-PRESERVATION-THM-LOCAL" title="(defmacro retroactive-add-stobj-preservation-thm-local
          (name &amp;rest args &amp;key templates history &amp;allow-other-keys)
  `(progn
    (encapsulate nil (local (table ,templates nil nil :clear))
                 (local (add-stobj-preservation-thm ,name . ,args))
...">retroactive-add-stobj-preservation-thm-local</a> ,NAME
          ,@ARGS
          <span class="keyword">:templates</span> ,&#39;,TEMPLATES
          <span class="keyword">:history</span> ,&#39;,HISTORY))
      (defxdoc ,RETRO-LOCAL-NAME
        <span class="keyword">:parents</span> (preservation-thms)
        <span class="keyword">:short</span> <span class="string">"Generated by def-stobj-preservation-macros."</span>
        <span class="keyword">:long</span> <span class="string">"See @(see acl2::preservation-thms) for complete documentation."</span>))))</pre>
  </div>

<div class="form-block macro" id="def-def-stobj-preservation-macros" data-defines="DEF-STOBJ-PRESERVATION-MACROS" data-references="DEF-STOBJ-PRESERVATION-MACROS-FN,HISTORY,TEMPLATES,DEFAULT-STOBJNAME,NAME,&KEY,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="DEF-STOBJ-PRESERVATION-MACROS">def-stobj-preservation-macros</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-def-stobj-preservation-macros" data-sym="DEF-STOBJ-PRESERVATION-MACROS" title="(defmacro def-stobj-preservation-macros
          (&amp;key name default-stobjname templates history)
  (def-stobj-preservation-macros-fn name default-stobjname templates history))">def-stobj-preservation-macros</a>
  (&amp;key name default-stobjname templates history)
  (<a class="sym-link local-def" href="#def-def-stobj-preservation-macros-fn" data-sym="DEF-STOBJ-PRESERVATION-MACROS-FN" title="(defun def-stobj-preservation-macros-fn
       (name default-stobjname templates history)
  (b*
   ((defthms-name
     (intern-in-package-of-symbol
...">def-stobj-preservation-macros-fn</a> name
    default-stobjname
    templates
    history))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>