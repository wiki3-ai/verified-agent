<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rewrite-dollar - ACL2 Book</title>
  <meta property="name" content="rewrite-dollar">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">rewrite-dollar</h1>
    <div class="path"><a href="rewrite-dollar.lisp" class="source-link">books/tools/rewrite-dollar</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="../std/util/bstar.html" title="std/util/bstar">bstar</a>
      <a class="include-link" href="../xdoc/top.html" title="xdoc/top">top</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../std/util/bstar.html" title="Open std/util/bstar">"std/util/bstar"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../xdoc/top.html" title="Open xdoc/top">"xdoc/top"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-program" data-sym="PROGRAM">program</a>)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-set-state-ok" data-sym="SET-STATE-OK">set-state-ok</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-rewrite_24" data-sym="REWRITE$" title="(defmacro rewrite$
          (term
           &amp;key alist (ctx &#39;&#39;rewrite$) hyps equiv geneqv backchain-limit-rw
           expand hands-off in-theory no-thanks nonlinearp restrict
           rw-cache-state (default-hints-p &#39;t) (prove-forced-assumptions &#39;t)
...">rewrite$</a>
  <span class="keyword">:parents</span> (proof-automation)
  <span class="keyword">:short</span> <span class="string">"Rewrite a term"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(&#39;Rewrite$&#39;) is a macro that provides a convenient and flexible
 interface to the ACL2 @(see rewrite)r, which can be called programmatically.
 The documentation below is divided into the following sections.&lt;/p&gt;

 &lt;ul&gt;

 &lt;li&gt;An introductory example&lt;/li&gt;
 &lt;li&gt;Return values&lt;/li&gt;
 &lt;li&gt;General Form&lt;/li&gt;
 &lt;li&gt;Basic options&lt;/li&gt;
 &lt;li&gt;Hint options, each with default @(&#39;nil&#39;)&lt;/li&gt;
 &lt;li&gt;Advanced options&lt;/li&gt;
 &lt;li&gt;Summary of algorithm&lt;/li&gt;
 &lt;li&gt;Related tools&lt;/li&gt;

 &lt;/ul&gt;

 &lt;h3&gt;An introductory example&lt;/h3&gt;

 &lt;p&gt;We begin with the following example of a call of @(&#39;rewrite$&#39;).  The
 keyword option @(&#39;:translate t&#39;) is used because the first argument is not a
 translated @(see term), due to the call of the macro, @(tsee append).  We see
 that the call of @(&#39;rewrite$&#39;) produces a 2-element list consisting of the
 result, @(&#39;X&#39;), of rewriting the input term, together with a list of @(see
 rune)s justifying that rewrite.&lt;/p&gt;

 @({
 ACL2 !&gt;(rewrite$ &#39;(car (append (cons x y) z)) :translate t)
  (X ((:DEFINITION BINARY-APPEND)
      (:REWRITE CDR-CONS)
      (:REWRITE CAR-CONS)
      (:FAKE-RUNE-FOR-TYPE-SET NIL)))
 ACL2 !&gt;
 })

 &lt;p&gt;Notice the ``fake rune&#39;&#39; that is returned.  Fake runes are easy to remove;
 see for example the constant @(&#39;*fake-rune-alist*&#39;) in the ACL2 sources or
 function @(&#39;drop-fake-runes&#39;) defined in community book
 @(&#39;kestrel/utilities/runes.lisp&#39;).&lt;/p&gt;

 &lt;p&gt;Other simple examples may be found in community book
 @(&#39;books/demos/rewrite-dollar-input.lsp&#39;).&lt;/p&gt;

 &lt;h3&gt;Return values&lt;/h3&gt;

 &lt;p&gt;A call @(&#39;(rewrite$ term ...)&#39;) returns an @(see error-triple), @(&#39;(mv erp
 val state)&#39;).  @(&#39;Erp&#39;) is non-@(&#39;nil&#39;) when an error has occurred.  Otherwise
 @(&#39;val&#39;) is of the form @(&#39;(rewritten-term runes . pairs)&#39;) where @(&#39;pairs&#39;)
 is typically @(&#39;nil&#39;) (as discussed further below) and:&lt;/p&gt;

 &lt;ul&gt;

 &lt;li&gt;@(&#39;rewritten-term&#39;) is the result of rewriting @(&#39;term&#39;) as directed by
 the other inputs; and&lt;/li&gt;

 &lt;li&gt;@(&#39;runes&#39;) is a list containing the @(see rune)s that participated in the
 rewriting of @(&#39;term&#39;) to @(&#39;rewritten-term&#39;).&lt;/li&gt;

 &lt;/ul&gt;

 &lt;p&gt;Because of forcing (see @(see force)), rewriting of the input term may
 generate goals to be proved later, based on the forced hypotheses encountered
 during rewriting that were not relieved at that time.  We call these ``forced
 assumptions&#39;&#39;.  If there are forced assumptions, then they are conjoined into
 a single goal, which by default is the target of a separate call to the
 prover, much like a call of @(tsee thm).  The return value @(&#39;pairs&#39;),
 mentioned above, is @(&#39;nil&#39;) exactly when there are no forced assumptions.  We
 say no more here about @(&#39;pairs&#39;), as it will suffice for most users to view
 them solely as an indicator of forced assumptions.  (Technical note for
 advanced users: these are the pairs returned by ACL2 source function
 @(&#39;extract-and-clausify-assumptions&#39;).)&lt;/p&gt;

 &lt;p&gt;There are many keyword arguments that control the rewriting process.  One
 of particular importance semantically is @(&#39;:alist&#39;).  When this argument is
 @(&#39;nil&#39;) then the resulting rewritten term is provably equivalent (with
 respect to the current ACL2 @(see world)) to the input term.  Otherwise the
 rewritten term is provably equivalent to the result of substituting the
 specified alist into the input term.  Another important keyword argument is
 @(&#39;:hyps&#39;), which provides hypotheses under which the given term is to be
 rewritten.  The hypotheses themselves may be rewritten, using keyword argument
 @(&#39;:rewrite-hyps&#39;).  All keywords are documented below.&lt;/p&gt;

 &lt;h3&gt;General Form&lt;/h3&gt;

 &lt;p&gt;All arguments of @(&#39;rewrite$&#39;) except the first are keyword arguments,
 hence are optional, with appropriate defaults.  All are evaluated.&lt;/p&gt;

 @({
 (rewrite$ term

; Basic options (in alphabetical order):

           :alist                    ; default nil
           :ctx                      ; default &#39;rewrite$
           :default-hints-p          ; default t
           :equiv                    ; default nil
           :geneqv                   ; default nil
           :hyps                     ; default nil
           :must-rewrite             ; default nil
           :prove-forced-assumptions ; default t
           :repeat                   ; default 1
           :translate                ; default nil
           :untranslate              ; default nil

; Hint options (in alphabetical order), each with default nil:

           :backchain-limit-rw :expand :hands-off :in-theory
           :no-thanks :nonlinearp :restrict :rw-cache-state

; Advanced options (in alphabetical order):

           :obj        ; default &#39;?
           :rrec       ; default nil
           :wrld       ; default (w state)
           )
 })

 &lt;p&gt;@(&#39;Term&#39;) should evaluate to a translated or untranslated term (see @(see
 term)) according to whether the value of @(&#39;:translate&#39;) is @(&#39;nil&#39;) or
 non-@(&#39;nil&#39;), respectively.  If @(&#39;:translate&#39;) is @(&#39;nil&#39;) (the default),
 @(&#39;term&#39;) should already be in translated form; otherwise @(&#39;term&#39;) will be
 translated.&lt;/p&gt;

 &lt;p&gt;IMPORTANT: The keyword options, discussed below according to the groups
 above, are all evaluated.  So for example:&lt;/p&gt;

 @({
 ; Correct
 (rewrite$ &#39;(cons a (cdr x)) :alist &#39;((a . (car x))) :hyps &#39;((consp x)))

 ; WRONG!
 (rewrite$ &#39;(cons a (cdr x)) :alist ((a . (car x))) :hyps ((consp x)))
 })

 &lt;h3&gt;Basic options&lt;/h3&gt;

 &lt;ul&gt;

 &lt;li&gt;@(&#39;:alist&#39;) (default @(&#39;nil&#39;))&lt;br/&gt;
 is an association list mapping variables to terms, where each term is already
 translated or else is untranslated according to whether the value of
 @(&#39;:translate&#39;) is @(&#39;nil&#39;) or non-@(&#39;nil&#39;), respectively.&lt;/li&gt;

 &lt;li&gt;@(&#39;:ctx&#39;) (default @(&#39;&#39;rewrite$&#39;))&lt;br/&gt;
 is a ``context&#39;&#39;, such as the @(&#39;ctx&#39;) argument of @(tsee er).&lt;/li&gt;

 &lt;li&gt;@(&#39;:default-hints-p&#39;) (default @(&#39;t&#39;))&lt;br/&gt; is non-@(&#39;nil&#39;) when the
 construction of hints for the rewriter call is to take into account the @(see
 default-hints) in the current @(see world).&lt;/li&gt;

 &lt;li&gt;@(&#39;:equiv&#39;) and @(&#39;:geneqv&#39;) (both with default @(&#39;nil&#39;))&lt;br/&gt;
 specify the equivalence relation(s) to be preserved by (@(see
 congruence)-based) rewriting.  It is illegal to specify a non-@(&#39;nil&#39;) value
 for more than one of these.  Most users will prefer to use @(&#39;:equiv&#39;), which
 should be a function symbol that is a known (to ACL2) equivalence relation.
 The keyword option @(&#39;:geneqv&#39;) is really only for those who know how
 generated equivalence relations are represented in the ACL2 system.&lt;/li&gt;

 &lt;li&gt;@(&#39;:hyps&#39;) (default @(&#39;nil&#39;))&lt;br/&gt;
 is a non-empty list of hypotheses under which rewriting takes place.  Each
 hypothesis is already translated or is untranslated according to whether the
 value of @(&#39;:translate&#39;) is @(&#39;nil&#39;) or non-@(&#39;nil&#39;), respectively.&lt;/li&gt;

 &lt;li&gt;@(&#39;:must-rewrite&#39;) (default @(&#39;nil&#39;))&lt;br/&gt; indicates, when its value is
 non-@(&#39;nil&#39;), that the rewritten term must not be equal to the input term.  It
 is illegal to supply non-@(&#39;nil&#39;) values for both @(&#39;:alist&#39;) and
 @(&#39;:must-rewrite&#39;), since it&#39;s usually not a sensible combination since at the
 least, the alist will be substituted into the term.&lt;/li&gt;

 &lt;li&gt;@(&#39;:prove-forced-assumptions&#39;) (default @(&#39;t&#39;))&lt;br/&gt; affects the proof of
 the forced assumptions.  It has the following legal values.

 &lt;ul&gt;

 &lt;li&gt;@(&#39;t&#39;): prove the forced assumptions as mentioned above: a single prover
 call to prove their conjunction.&lt;/li&gt;

 &lt;li&gt;@(&#39;:same-hints&#39;): same as @(&#39;t&#39;), except generate the same @(&#39;:hints&#39;) for
 the prover call as are generated for the rewriting (from the eight hint
 options discussed below).&lt;/li&gt;

 &lt;li&gt;@(&#39;nil&#39;): do not attempt a proof of the forced assumptions, instead
 returning a non-@(&#39;nil&#39;) `@(&#39;pairs&#39;)&#39; value as discussed above.&lt;/li&gt;

 &lt;li&gt;@(&#39;:none-forced&#39;): cause an error if there are any forced
 assumptions.&lt;/li&gt;

 &lt;li&gt;Otherwise, the value of @(&#39;:prove-forced-assumptions&#39;) should be of the
 form expected for the value of @(&#39;:hints&#39;) supplied to @(tsee defthm).  For
 example, the following might follow @(&#39;:prove-forced-assumptions&#39;) in a call
 of @(&#39;rewrite$&#39;): @(&#39;&#39;((&quot;Goal&quot; :in-theory (enable reverse)))&#39;).&lt;/li&gt;

 &lt;/ul&gt;&lt;/li&gt;

 &lt;li&gt;@(&#39;:repeat&#39;) (default @(&#39;1&#39;))&lt;br/&gt;
 indicates how many times to call the rewriter.  The value should be a positive
 integer.  If the value of @(&#39;:repeat&#39;) is greater than 1, then the term
 resulting from the first call is the input term for the second call, whose
 result (if the value of @(&#39;:repeat&#39;) is greater than 2) is the input term for
 the third call, and so on.  Note that the value of @(&#39;:alist&#39;) is @(&#39;nil&#39;) for
 all calls after the first.&lt;/li&gt;

 &lt;li&gt;@(&#39;:translate&#39;) (default @(&#39;nil&#39;))&lt;br/&gt;
 indicates whether or not terms in the input are to be translated or not (see
 @(see term) for a discussed of ``translate&#39;&#39;).  If the value is @(&#39;nil&#39;) then
 translation will not take place, so the given terms &amp;mdash; not only the input
 term, but also terms in the @(&#39;cdr&#39;) positions of the @(&#39;:alist&#39;) and terms in
 the @(&#39;:hyps&#39;) &amp;mdash; should already be in translated form.  But if the value
 is not @(&#39;nil&#39;), then all of these will be translated.&lt;/li&gt;

 &lt;li&gt;@(&#39;:untranslate&#39;) (default @(&#39;nil&#39;))&lt;br/&gt;
 indicates whether the rewritten term will be given in translated or
 untranslated form.  It also specifies, when not @(&#39;nil&#39;), that certain error
 messages display terms in untranslated form.&lt;/li&gt;

 &lt;/ul&gt;

 &lt;h3&gt;Hint options, each with default @(&#39;nil&#39;)&lt;/h3&gt;

 &lt;p&gt;The eight hint options displayed above are the same as discussed in the
 documentation topic, @(see hints).  These are the only legal hint keywords for
 @(&#39;rewrite$&#39;).&lt;/p&gt;

 &lt;h3&gt;Advanced options&lt;/h3&gt;

 &lt;p&gt;The ``advanced options&#39;&#39; @(&#39;:obj&#39;), @(&#39;:wrld&#39;), and @(&#39;:rrec&#39;) can
 generally be ignored, so we say little about them here.  @(&#39;:Obj&#39;) is the
 ``obj&#39;&#39; argument of the rewriter, typically the symbol `@(&#39;?&#39;)&#39; but @(&#39;t&#39;)
 when backchaining.  See @(see rewrite$-hyps) and its use in community book
 @(&#39;books/kestrel/apt/simplify-defun-impl.lisp&#39;) for how @(&#39;:rrec&#39;) can avoid
 repeating some computations.  @(&#39;:Wrld&#39;) should probably be left as its
 default, which is the current ACL2 logical @(see world).&lt;/p&gt;

 &lt;h3&gt;Summary of algorithm&lt;/h3&gt;

 &lt;p&gt;Here we provide a brief summary of the algorithm used by @(&#39;rewrite$&#39;).
 Most users can probably skip this section.&lt;/p&gt;

 &lt;p&gt;Not surprisingly, the primary simplification technique used by
 @(&#39;rewrite$&#39;) is rewriting.  However, @(see forward-chaining) and @(see
 linear-arithmetic) are also used, as follows.&lt;/p&gt;

 &lt;p&gt;Initially, a function called @(&#39;rewrite$-setup&#39;) is invoked on the given
 @(&#39;:hyps&#39;) to produce data structures that record facts from forward-chaining
 &amp;mdash; a so-called @(&#39;fc-pair-lst&#39;) data structure &amp;mdash; and linear
 arithmetic &amp;mdash; a so-called @(&#39;pot-lst&#39;) data structure.  (Exception: this
 step is skipped if @(&#39;:rrec&#39;) is supplied, since the value of that option
 already contains such information.)  Then we loop through @(&#39;:repeat&#39;)
 iterations, where each iteration proceeds according the the following
 pseudocode.  Note that the initial alist is given by @(&#39;:alist&#39;), but
 subsequent alists are all @(&#39;nil&#39;).&lt;/p&gt;

 @({
 Replace term with its rewrite with respect to the alist, hyps, fc-pair-lst,
   and pot-lst.
 If the alist is empty and the term didn&#39;t change, exit the loop.
 })

 &lt;h3&gt;Related tools&lt;/h3&gt;

 &lt;p&gt;See @(see rewrite$-hyps) for a tool that rewrites a list of hypotheses.
 That tool does more than just apply rewriting directly to each hypothesis: it
 also uses @(see forward-chaining) and @(see linear-arithmetic) derived from
 the hypotheses.  A related tool @(see rewrite$-context), is similar but takes
 an ``@(&#39;rrec&#39;)&#39;&#39; input that already contains any @(see forward-chaining) and
 @(see linear-arithmetic) information.&lt;/p&gt;

 &lt;p&gt;For related tools see @(see expander) and @(see easy-simplify-term).  In
 particular, code from the expander function @(&#39;tool2-fn&#39;) served as a guide to
 the coding of @(&#39;rewrite$&#39;); see @(see community-book)
 @(&#39;books/misc/expander.lisp&#39;).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-rewrite_24-hyps" data-sym="REWRITE$-HYPS" title="(defmacro rewrite$-hyps
          (hyps
           &amp;key thints backchain-limit-rw expand hands-off in-theory no-thanks
           nonlinearp restrict rw-cache-state
           (default-hints-p &#39;t default-hints-p-p) (update-rrec &#39;t)
...">rewrite$-hyps</a>
  <span class="keyword">:parents</span> (proof-automation)
  <span class="keyword">:short</span> <span class="string">"Rewrite a list of hypotheses"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;See @(see rewrite$) for relevant background.&lt;/p&gt;

 &lt;p&gt;Roughly speaking, @(&#39;rewrite$-hyps&#39;) applies rewriting to each term in a
 given list.  However, it treats that input as a list of hypotheses: each term
 in the list is rewritten under the assumption that the other terms in the list
 are true.  Both @(see forward-chaining) and @(see linear-arithmetic) are
 used.&lt;/p&gt;

 &lt;h3&gt;General Form&lt;/h3&gt;

 &lt;p&gt;All arguments of @(&#39;rewrite$-hyps&#39;) except the first are keyword arguments,
 hence are optional, with appropriate defaults.  All are evaluated.&lt;/p&gt;

 @({
 (rewrite$-hyps hyps
                &amp;key

 ; Hint options:

                thints ; must be nil if any other hint options are supplied
                backchain-limit-rw expand hands-off in-theory
                no-thanks nonlinearp restrict rw-cache-state
                default-hints-p           ; default t

 ; Other options:

                ctx                       ; default &#39;rewrite$-hyps
                prove-forced-assumptions  ; default t
                repeat                    ; default 1
                translate                 ; default nil
                untranslate               ; default nil
                update-rrec               ; default t
                wrld                      ; default (w state)
                )
 })

 &lt;p&gt;This macro returns an @(see error-triple) whose non-erroneous value is a
 list of the form @(&#39;(rewritten-hyps rrec ttree . pairs)&#39;).  Here,
 @(&#39;rewritten-hyps&#39;) is (of course) the result of rewriting the input,
 @(&#39;hyps&#39;); @(&#39;rrec&#39;) is a so-called ``@(&#39;rewrite$-record&#39;)&#39;&#39; that can be
 passed as the @(&#39;:rrec&#39;) input of @(tsee rewrite$); @(&#39;ttree&#39;) is the @(see
 tag-tree) that records information from the rewriting, including the @(see
 rune)s used; and @(&#39;pairs&#39;) is @(&#39;nil&#39;) unless there are @(see force)d
 assumptions, which should never happen if input @(&#39;:prove-forced-assumptions&#39;)
 has its default value of @(&#39;t&#39;).&lt;/p&gt;

 &lt;p&gt;Additional documentation may be provided here if desired.  It may suffice
 to see community book @(&#39;books/kestrel/apt/simplify-defun-impl.lisp&#39;) for an
 illustration of how @(see rewrite$-hyps) may be used.  The key idea there is
 for @(&#39;rewrite$-hyps&#39;) to produce the @(&#39;:rrec&#39;) input of @(tsee rewrite$)
 when there are repeated calls of @(&#39;rewrite$&#39;) under the same @(&#39;:hyps&#39;), and
 especially when you want first to simplify those hypotheses (perhaps together
 with subterm governors).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc <a class="sym-link local-def" href="#def-rewrite_24-context" data-sym="REWRITE$-CONTEXT" title="(defmacro rewrite$-context
          (lst rrec
           &amp;key contradiction-ok (prove-forced-assumptions &#39;t) translate
           untranslate (repeat &#39;1) (ctx &#39;&#39;rewrite$-context) (wrld &#39;(w state)))
  `(rewrite$-context-main ,lst ,rrec ,contradiction-ok">rewrite$-context</a>
  <span class="keyword">:parents</span> (proof-automation)
  <span class="keyword">:short</span> <span class="string">"Rewrite a list of contextual assumptions"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;See @(see rewrite$) for relevant background.  The macro
 @(&#39;rewrite$-context&#39;) is similar to @(see rewrite$-hyps), but it takes a
 @(&#39;rewrite$-record&#39;) (``@(&#39;rrec&#39;)&#39;&#39;) as an input to provide any @(see
 forward-chaining) and @(see linear-arithmetic) assumptions.&lt;/p&gt;

 &lt;p&gt;Additional documentation may be provided here if requested by someone who
 is considering use of this utility.  As of its initial introduction, it is not
 used in any of the @(see community-books)&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block constant" id="def-_2Asimplify_24-hyps-contradiction-string_2A" data-defines="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" data-references="DEFCONST" data-used-by="REWRITE$-CONTEXT*,REWRITE$-CLAUSE*,REWRITE$-SETUP" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*">*simplify$-hyps-contradiction-string*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
  <span class="string">"An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)"</span>)</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../basis-a.html#def-defrec" data-sym="DEFREC">defrec</a> rewrite$-record
  ((saved-pspv rcnst . type-alist) gstack
    fc-pair-lst . pot-lst)
  nil)</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-clause-type-alist" data-defines="REWRITE$-CLAUSE-TYPE-ALIST" data-references="REWRITE-CONSTANT,ACCESS,TYPE-ALIST-CLAUSE,TTREE,TYPE-ALIST,CONTRADICTIONP,LEN,MAKE-LIST-AC,APPEND,MV,CURRENT-TTREE-LST,CURRENT-CLAUSE,SELECT-FORWARD-CHAINED-CONCLS-AND-TTREES,TTREE-LST,LITS,MV-LET,POT-LST,WRLD,RCNST,FC-PAIR-LST,CLAUSE,DEFUN" data-used-by="REWRITE$-SETUP" data-part-name="REWRITE$-CLAUSE-TYPE-ALIST" data-part-args="POT-LST,WRLD,RCNST,FC-PAIR-LST,CLAUSE" data-part-body="POT-LST,WRLD,RCNST,REWRITE-CONSTANT,ACCESS,TYPE-ALIST-CLAUSE,TTREE,TYPE-ALIST,CONTRADICTIONP,LEN,MAKE-LIST-AC,CLAUSE,APPEND,MV,CURRENT-TTREE-LST,CURRENT-CLAUSE,FC-PAIR-LST,SELECT-FORWARD-CHAINED-CONCLS-AND-TTREES,TTREE-LST,LITS,MV-LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CLAUSE-TYPE-ALIST">rewrite$-clause-type-alist</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-clause-type-alist" data-sym="REWRITE$-CLAUSE-TYPE-ALIST" title="(defun rewrite$-clause-type-alist (clause fc-pair-lst rcnst wrld pot-lst)
  (mv-let (lits ttree-lst)
          (select-forward-chained-concls-and-ttrees fc-pair-lst nil nil nil)
          (mv-let (current-clause current-ttree-lst)
                  (mv (append clause lits)
...">rewrite$-clause-type-alist</a>
  (clause fc-pair-lst rcnst wrld pot-lst)
  (<a class="sym-link system" href="../../axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (lits ttree-lst)
    (select-forward-chained-concls-and-ttrees fc-pair-lst
      nil
      nil
      nil)
    (<a class="sym-link system" href="../../axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (current-clause current-ttree-lst)
      (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../axioms.html#def-append" data-sym="APPEND">append</a> clause lits)
        (<a class="sym-link system" href="../../axioms.html#def-make-list-ac" data-sym="MAKE-LIST-AC">make-list-ac</a> (<a class="sym-link system" href="../../axioms.html#def-len" data-sym="LEN">len</a> clause) nil ttree-lst))
      (<a class="sym-link system" href="../../axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (contradictionp type-alist ttree)
        (type-alist-clause current-clause
          current-ttree-lst
          nil
          nil
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>)
          wrld
          pot-lst
          nil)
        (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> contradictionp type-alist ttree)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-setup" data-defines="REWRITE$-SETUP" data-references="REWRITE$-CLAUSE-TYPE-ALIST,?TTREE,*DEFAULT-STEP-LIMIT*,PTS-TO-TTREE-LST,SETUP-SIMPLIFY-CLAUSE-POT-LST,POT-LST,?STEP-LIMIT,T,UNTRANSLATE-LST,IF,DUMB-NEGATE-LIT-LST,X,LET,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,SOFT,ER,REWRITE-CONSTANT,ACCESS,REWRITE$,QUOTE,FORWARD-CHAIN-TOP,FC-PAIR-LST,TYPE-ALIST,CONTRADICTIONP,MV,ENUMERATE-ELEMENTS,PTS,LIST*,VALUE,NULL,WHEN,B*,STATE,WRLD,CTX,UNTRANSLATE,RCNST,HYPS-CLAUSE,DEFUN" data-used-by="UPDATE-RREC,REWRITE$-CLAUSE*,MAKE-RREC" data-part-name="REWRITE$-SETUP" data-part-args="STATE,WRLD,CTX,UNTRANSLATE,RCNST,HYPS-CLAUSE" data-part-body="REWRITE$-CLAUSE-TYPE-ALIST,?TTREE,*DEFAULT-STEP-LIMIT*,PTS-TO-TTREE-LST,SETUP-SIMPLIFY-CLAUSE-POT-LST,POT-LST,?STEP-LIMIT,T,UNTRANSLATE-LST,UNTRANSLATE,IF,DUMB-NEGATE-LIT-LST,X,LET,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,CTX,SOFT,ER,STATE,WRLD,RCNST,REWRITE-CONSTANT,ACCESS,REWRITE$,QUOTE,FORWARD-CHAIN-TOP,FC-PAIR-LST,TYPE-ALIST,CONTRADICTIONP,MV,ENUMERATE-ELEMENTS,PTS,LIST*,VALUE,HYPS-CLAUSE,NULL,WHEN,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-SETUP">rewrite$-setup</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-setup" data-sym="REWRITE$-SETUP" title="(defun rewrite$-setup (hyps-clause rcnst untranslate ctx wrld state)
  (b*
   (((when (null hyps-clause)) (value (list* nil nil)))
    (pts (enumerate-elements hyps-clause 0))
    ((mv contradictionp type-alist fc-pair-lst)
...">rewrite$-setup</a>
  (hyps-clause rcnst untranslate ctx wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((when (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> hyps-clause)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> nil nil))) (pts (enumerate-elements hyps-clause <span class="number">0</span>))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> contradictionp type-alist fc-pair-lst) (forward-chain-top '<a class="sym-link local-def" href="#def-rewrite_24" data-sym="REWRITE$" title="(defmacro rewrite$
          (term
           &amp;key alist (ctx &#39;&#39;rewrite$) hyps equiv geneqv backchain-limit-rw
           expand hands-off in-theory no-thanks nonlinearp restrict
           rw-cache-state (default-hints-p &#39;t) (prove-forced-assumptions &#39;t)
...">rewrite$</a>
          hyps-clause
          pts
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:force-info</span>)
          nil
          wrld
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>)
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:oncep-override</span>)
          state))
      ((when contradictionp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
          (let ((x (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> hyps-clause)))
            (if untranslate
              (untranslate-lst x <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> wrld)
              x))
          <span class="string">"using type-set reasoning, based perhaps on forward chaining"</span>))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit contradictionp pot-lst) (setup-simplify-clause-pot-lst hyps-clause
          (pts-to-ttree-lst pts)
          fc-pair-lst
          type-alist
          rcnst
          wrld
          state
          <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>))
      ((when contradictionp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
          (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> hyps-clause)
          <span class="string">"using linear arithmetic reasoning"</span>))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> contradictionp type-alist ?ttree) (<a class="sym-link local-def" href="#def-rewrite_24-clause-type-alist" data-sym="REWRITE$-CLAUSE-TYPE-ALIST" title="(defun rewrite$-clause-type-alist (clause fc-pair-lst rcnst wrld pot-lst)
  (mv-let (lits ttree-lst)
          (select-forward-chained-concls-and-ttrees fc-pair-lst nil nil nil)
          (mv-let (current-clause current-ttree-lst)
                  (mv (append clause lits)
...">rewrite$-clause-type-alist</a> hyps-clause
          fc-pair-lst
          rcnst
          wrld
          pot-lst))
      ((when contradictionp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
          (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> hyps-clause)
          <span class="string">"using type-set reasoning (after forward chaining and linear ~
             arithmetic)"</span>)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> type-alist pot-lst fc-pair-lst))))</pre>
  </div>

<div class="form-block other" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../basis-b.html#def-defstub" data-sym="DEFSTUB">defstub</a> rewrite$-last-literal-fn nil <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block constant" id="def-_2Arewrite_24-last-literal_2A" data-defines="*REWRITE$-LAST-LITERAL*" data-references="REWRITE$-LAST-LITERAL-FN,QUOTE,FCONS-TERM*,DEFCONST" data-used-by="UPDATE-RREC,MAKE-RREC,REWRITE$-RCNST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*REWRITE$-LAST-LITERAL*">*rewrite$-last-literal*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-last-literal_2A" data-sym="*REWRITE$-LAST-LITERAL*" title="(defconst *rewrite$-last-literal* (fcons-term* &#39;rewrite$-last-literal-fn))">*rewrite$-last-literal*</a>
  (<a class="sym-link system" href="../../axioms.html#def-fcons-term_2A" data-sym="FCONS-TERM*">fcons-term*</a> 'rewrite$-last-literal-fn))</pre>
  </div>

<div class="form-block constant" id="def-_2Arewrite_24-note-msg_2A" data-defines="*REWRITE$-NOTE-MSG*" data-references="DEFCONST" data-used-by="REWRITE$-MAIN,REWRITE$-PROCESS-ASSUMPTIONS-MSG,REWRITE$*" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*REWRITE$-NOTE-MSG*">*rewrite$-note-msg*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-note-msg_2A" data-sym="*REWRITE$-NOTE-MSG*" title="(defconst *rewrite$-note-msg* &quot;&lt;&lt;Rewrite$ NOTE:&gt;&gt;~|&quot;)">*rewrite$-note-msg*</a> <span class="string">"&lt;&lt;Rewrite$ NOTE:&gt;&gt;~|"</span>)</pre>
  </div>

<div class="form-block function" id="def-rewrite_24_2A" data-defines="REWRITE$*" data-references="SOFT,ER,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,PROOFS-CO,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,PROVE,IO?,INT=,T,LIST*,VALUE,EQUAL,NULL,AND,WHEN,1+,REWRITE-CONSTANT,ACCESS,*DEFAULT-STEP-LIMIT*,REWRITE,REWRITE-ENTRY,NEW-TTREE,VAL,?STEP-LIMIT,MV,B*,STATE,WRLD,CTX,REWRITE-STACK-LIMIT,TTREE,GSTACK,RCNST,POT-LST,GENEQV,OBJ,TYPE-ALIST,COMPLETED-ITERS,REPEAT-LIMIT,BKPTR,ALIST,TERM,DEFUN" data-used-by="REWRITE$-MAIN" data-part-name="REWRITE$*" data-part-args="STATE,WRLD,CTX,REWRITE-STACK-LIMIT,TTREE,GSTACK,RCNST,POT-LST,GENEQV,OBJ,TYPE-ALIST,COMPLETED-ITERS,REPEAT-LIMIT,BKPTR,ALIST,TERM" data-part-body="GENEQV,OBJ,TYPE-ALIST,REWRITE$*,CTX,SOFT,ER,WRLD,GSTACK,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,PROOFS-CO,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,PROVE,IO?,STATE,REPEAT-LIMIT,INT=,TTREE,T,LIST*,VALUE,EQUAL,NULL,AND,WHEN,1+,COMPLETED-ITERS,POT-LST,RCNST,REWRITE-CONSTANT,ACCESS,*DEFAULT-STEP-LIMIT*,REWRITE-STACK-LIMIT,BKPTR,ALIST,TERM,REWRITE,REWRITE-ENTRY,NEW-TTREE,VAL,?STEP-LIMIT,MV,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$*">rewrite$*</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24_2A" data-sym="REWRITE$*" title="(defun rewrite$*
       (term alist bkptr repeat-limit completed-iters type-alist obj geneqv
        pot-lst rcnst gstack ttree rewrite-stack-limit ctx wrld state)
  (b*
   (((mv ?step-limit val new-ttree)
...">rewrite$*</a>
  (term alist
    bkptr
    repeat-limit
    completed-iters
    type-alist
    obj
    geneqv
    pot-lst
    rcnst
    gstack
    ttree
    <a class="sym-link system" href="../../axioms.html#def-rewrite-stack-limit" data-sym="REWRITE-STACK-LIMIT">rewrite-stack-limit</a>
    ctx
    wrld
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit val new-ttree) (<a class="sym-link system" href="../../rewrite.html#def-rewrite-entry" data-sym="REWRITE-ENTRY">rewrite-entry</a> (<a class="sym-link system" href="../../rewrite.html#def-rewrite" data-sym="REWRITE">rewrite</a> term alist bkptr)
         <span class="keyword">:rdepth</span> <a class="sym-link system" href="../../axioms.html#def-rewrite-stack-limit" data-sym="REWRITE-STACK-LIMIT">rewrite-stack-limit</a>
         <span class="keyword">:step-limit</span> <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>
         <span class="keyword">:pequiv-info</span> nil
         <span class="keyword">:fnstack</span> nil
         <span class="keyword">:ancestors</span> nil
         <span class="keyword">:backchain-limit</span> (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:backchain-limit-rw</span>)
         <span class="keyword">:simplify-clause-pot-lst</span> pot-lst)) (completed-iters (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))
      ((when (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> alist) (equal val term))) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> term ttree)))
      ((when (<a class="sym-link system" href="../../axioms.html#def-int_3D" data-sym="INT=">int=</a> repeat-limit completed-iters)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> nil val new-ttree)))
      (state (<a class="sym-link system" href="../../basis-a.html#def-io_3F" data-sym="IO?">io?</a> <a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a>
          nil
          state
          (completed-iters)
          (<a class="sym-link system" href="../../basis-a.html#def-fms" data-sym="FMS">fms</a> <span class="string">"~@0Starting ~n1 call of the rewriter.~%"</span>
            (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (cons #\0 <a class="sym-link local-def" href="#def-_2Arewrite_24-note-msg_2A" data-sym="*REWRITE$-NOTE-MSG*" title="(defconst *rewrite$-note-msg* &quot;&lt;&lt;Rewrite$ NOTE:&gt;&gt;~|&quot;)">*rewrite$-note-msg*</a>)
              (cons #\1 (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))))
            (<a class="sym-link system" href="../../basis-b.html#def-proofs-co" data-sym="PROOFS-CO">proofs-co</a> state)
            state
            nil)))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit bad-ass new-ttree) (resume-suspended-assumption-rewriting new-ttree
          nil
          gstack
          pot-lst
          rcnst
          wrld
          state
          <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>))
      ((when bad-ass) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"Generated false assumption (from force or case-split):~|~x0"</span>
          bad-ass)))
    (<a class="sym-link local-def" href="#def-rewrite_24_2A" data-sym="REWRITE$*" title="(defun rewrite$*
       (term alist bkptr repeat-limit completed-iters type-alist obj geneqv
        pot-lst rcnst gstack ttree rewrite-stack-limit ctx wrld state)
  (b*
   (((mv ?step-limit val new-ttree)
...">rewrite$*</a> val
      nil
      bkptr
      repeat-limit
      completed-iters
      type-alist
      obj
      geneqv
      pot-lst
      rcnst
      gstack
      new-ttree
      <a class="sym-link system" href="../../axioms.html#def-rewrite-stack-limit" data-sym="REWRITE-STACK-LIMIT">rewrite-stack-limit</a>
      ctx
      wrld
      state)))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-return" data-defines="REWRITE$-RETURN" data-references="ALL-RUNES-IN-TTREE,LIST*,VALUE,IF,NEW-TERM,B*,STATE,WRLD,UNTRANSLATE,PAIRS,TTREE,REWRITTEN-TERM,DEFUN" data-used-by="REWRITE$-MAIN" data-part-name="REWRITE$-RETURN" data-part-args="STATE,WRLD,UNTRANSLATE,PAIRS,TTREE,REWRITTEN-TERM" data-part-body="PAIRS,TTREE,ALL-RUNES-IN-TTREE,LIST*,VALUE,WRLD,REWRITTEN-TERM,UNTRANSLATE,IF,NEW-TERM,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-RETURN">rewrite$-return</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-return" data-sym="REWRITE$-RETURN" title="(defun rewrite$-return (rewritten-term ttree pairs untranslate wrld state)
  (b*
   ((new-term
     (if untranslate
         (untranslate rewritten-term nil wrld)
...">rewrite$-return</a>
  (rewritten-term ttree pairs untranslate wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((new-term (if untranslate
         (untranslate rewritten-term nil wrld)
         rewritten-term)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> new-term (all-runes-in-ttree ttree nil) pairs))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-process-assumptions-msg" data-defines="REWRITE$-PROCESS-ASSUMPTIONS-MSG" data-references="PROOFS-CO,LET*-ABSTRACTIONP,PRETTYIFY-CLAUSE-SET,CDR,IF,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,PROVE,IO?,STATE,WRLD,FORCED-GOAL,CLAUSE-SET,UNTRANSLATE,PAIRS,N0,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN,REWRITE$-HYPS-MAIN,REWRITE$-MAIN" data-part-name="REWRITE$-PROCESS-ASSUMPTIONS-MSG" data-part-args="STATE,WRLD,FORCED-GOAL,CLAUSE-SET,UNTRANSLATE,PAIRS,N0" data-part-body="PROOFS-CO,LET*-ABSTRACTIONP,PRETTYIFY-CLAUSE-SET,CDR,IF,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,WRLD,FORCED-GOAL,CLAUSE-SET,UNTRANSLATE,PAIRS,N0,STATE,PROVE,IO?" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-PROCESS-ASSUMPTIONS-MSG">rewrite$-process-assumptions-msg</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-process-assumptions-msg" data-sym="REWRITE$-PROCESS-ASSUMPTIONS-MSG" title="(defun rewrite$-process-assumptions-msg
       (n0 pairs untranslate clause-set forced-goal wrld state)
  (io? prove nil state (n0 pairs untranslate clause-set forced-goal wrld)
       (fms &quot;~@0Rewriting is complete for the input term, but ~
             it remains to prove the goal generated by cleaning up ~n1 forced ~
...">rewrite$-process-assumptions-msg</a>
  (n0 pairs untranslate clause-set forced-goal wrld state)
  (<a class="sym-link system" href="../../basis-a.html#def-io_3F" data-sym="IO?">io?</a> <a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a>
    nil
    state
    (n0 pairs untranslate clause-set forced-goal wrld)
    (<a class="sym-link system" href="../../basis-a.html#def-fms" data-sym="FMS">fms</a> <span class="string">"~@0Rewriting is complete for the input term, but ~
             it remains to prove the goal generated by cleaning up ~n1 forced ~
             ~#2~[hypothesis~/hypotheses (and conjoining into a single ~
             term)~], as follows:~|~%~x3~|~%"</span>
      (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (cons #\0 <a class="sym-link local-def" href="#def-_2Arewrite_24-note-msg_2A" data-sym="*REWRITE$-NOTE-MSG*" title="(defconst *rewrite$-note-msg* &quot;&lt;&lt;Rewrite$ NOTE:&gt;&gt;~|&quot;)">*rewrite$-note-msg*</a>)
        (cons #\1 n0)
        (cons #\2
          (if (cdr pairs)
            <span class="number">1</span>
            <span class="number">0</span>))
        (cons #\3
          (if untranslate
            (prettyify-clause-set clause-set
              (<a class="sym-link system" href="../../axioms.html#def-let_2A-abstractionp" data-sym="LET*-ABSTRACTIONP">let*-abstractionp</a> state)
              wrld)
            forced-goal)))
      (<a class="sym-link system" href="../../basis-b.html#def-proofs-co" data-sym="PROOFS-CO">proofs-co</a> state)
      state
      nil)))</pre>
  </div>

<div class="form-block constant" id="def-_2Arewrite_24-hint-keywords_2A" data-defines="*REWRITE$-HINT-KEYWORDS*" data-references="QUOTE,DEFCONST" data-used-by="REWRITE$-RCNST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*REWRITE$-HINT-KEYWORDS*">*rewrite$-hint-keywords*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-hint-keywords_2A" data-sym="*REWRITE$-HINT-KEYWORDS*" title="(defconst *rewrite$-hint-keywords*
          &#39;(:backchain-limit-rw :expand :hands-off :in-theory :no-thanks
            :nonlinearp :restrict :rw-cache-state))">*rewrite$-hint-keywords*</a>
  '(<span class="keyword">:backchain-limit-rw</span> <span class="keyword">:expand</span> <span class="keyword">:hands-off</span> <span class="keyword">:in-theory</span> <span class="keyword">:no-thanks</span> <span class="keyword">:nonlinearp</span> <span class="keyword">:restrict</span> <span class="keyword">:rw-cache-state</span>))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-main" data-defines="REWRITE$-MAIN" data-references="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,PROVE-SPEC-VAR,CHANGE,VAL,ERP,PROOFS-CO,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,PROVE,IO?,EQ,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,REWRITE$-RETURN,NOT,OR,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,SOFT,EQUAL,NULL,INT=,IF,AND,WHEN,REWRITE-STACK-LIMIT,REWRITE$*,TTREE,REWRITTEN-TERM,FLG,LIST*,ER,BKPTR,POT-LST,GSTACK,TYPE-ALIST,REWRITE$-RECORD,ACCESS,RCNST,B*,STATE,WRLD,CTX,RREC,REPEAT,MUST-REWRITE,UNTRANSLATE,FORCED-ASSUMPTIONS-HINTS,PROVE-FORCED-ASSUMPTIONS,OBJ,GENEQV,ALIST,TERM,DEFUN" data-used-by="REWRITE$-FN" data-part-name="REWRITE$-MAIN" data-part-args="STATE,WRLD,CTX,RREC,REPEAT,MUST-REWRITE,UNTRANSLATE,FORCED-ASSUMPTIONS-HINTS,PROVE-FORCED-ASSUMPTIONS,OBJ,GENEQV,ALIST,TERM" data-part-body="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,FORCED-ASSUMPTIONS-HINTS,PROVE-SPEC-VAR,CHANGE,VAL,ERP,PROOFS-CO,*REWRITE$-NOTE-MSG*,CONS,LIST,FMS,PROVE,IO?,EQ,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,REWRITE$-RETURN,PROVE-FORCED-ASSUMPTIONS,NOT,OR,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,UNTRANSLATE,SOFT,EQUAL,NULL,INT=,IF,MUST-REWRITE,AND,WHEN,STATE,CTX,WRLD,REWRITE-STACK-LIMIT,GENEQV,OBJ,REPEAT,ALIST,TERM,REWRITE$*,TTREE,REWRITTEN-TERM,FLG,LIST*,ER,BKPTR,POT-LST,GSTACK,TYPE-ALIST,RREC,REWRITE$-RECORD,ACCESS,RCNST,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-MAIN">rewrite$-main</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-main" data-sym="REWRITE$-MAIN" title="(defun rewrite$-main
       (term alist geneqv obj prove-forced-assumptions forced-assumptions-hints
        untranslate must-rewrite repeat rrec ctx wrld state)
  (b*
   ((rcnst (access rewrite$-record rrec :rcnst))
...">rewrite$-main</a>
  (term alist
    geneqv
    obj
    prove-forced-assumptions
    forced-assumptions-hints
    untranslate
    must-rewrite
    repeat
    rrec
    ctx
    wrld
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((rcnst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>)) (type-alist (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:type-alist</span>))
      (gstack (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:gstack</span>))
      (pot-lst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:pot-lst</span>))
      (bkptr <span class="number">0</span>)
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> flg rewritten-term ttree)) (<a class="sym-link local-def" href="#def-rewrite_24_2A" data-sym="REWRITE$*" title="(defun rewrite$*
       (term alist bkptr repeat-limit completed-iters type-alist obj geneqv
        pot-lst rcnst gstack ttree rewrite-stack-limit ctx wrld state)
  (b*
   (((mv ?step-limit val new-ttree)
...">rewrite$*</a> term
          alist
          bkptr
          repeat
          <span class="number">0</span>
          type-alist
          obj
          geneqv
          pot-lst
          rcnst
          gstack
          nil
          (<a class="sym-link system" href="../../axioms.html#def-rewrite-stack-limit" data-sym="REWRITE-STACK-LIMIT">rewrite-stack-limit</a> wrld)
          ctx
          wrld
          state))
      ((when (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> must-rewrite
           (if (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../axioms.html#def-int_3D" data-sym="INT=">int=</a> repeat <span class="number">1</span>) (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> alist))
             flg
             (equal term rewritten-term)))) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The term~|  ~x0~|failed to rewrite to a new term."</span>
          (if untranslate
            (untranslate term nil wrld)
            term)))
      (ttree (<a class="sym-link system" href="../../prove.html#def-set-cl-ids-of-assumptions" data-sym="SET-CL-IDS-OF-ASSUMPTIONS">set-cl-ids-of-assumptions</a> ttree *initial-clause-id*))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> n0 assns pairs ttree) (<a class="sym-link system" href="../../prove.html#def-extract-and-clausify-assumptions" data-sym="EXTRACT-AND-CLAUSIFY-ASSUMPTIONS">extract-and-clausify-assumptions</a> nil
          ttree
          nil
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>)
          wrld
          (<a class="sym-link system" href="../../prove.html#def-splitter-output" data-sym="SPLITTER-OUTPUT">splitter-output</a>)))
      ((when (<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> pairs) (<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> prove-forced-assumptions))) (<a class="sym-link local-def" href="#def-rewrite_24-return" data-sym="REWRITE$-RETURN" title="(defun rewrite$-return (rewritten-term ttree pairs untranslate wrld state)
  (b*
   ((new-term
     (if untranslate
         (untranslate rewritten-term nil wrld)
...">rewrite$-return</a> rewritten-term
          ttree
          pairs
          untranslate
          wrld
          state))
      (clause-set (<a class="sym-link system" href="../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> pairs))
      (forced-goal (termify-clause-set clause-set))
      (state (<a class="sym-link local-def" href="#def-rewrite_24-process-assumptions-msg" data-sym="REWRITE$-PROCESS-ASSUMPTIONS-MSG" title="(defun rewrite$-process-assumptions-msg
       (n0 pairs untranslate clause-set forced-goal wrld state)
  (io? prove nil state (n0 pairs untranslate clause-set forced-goal wrld)
       (fms &quot;~@0Rewriting is complete for the input term, but ~
             it remains to prove the goal generated by cleaning up ~n1 forced ~
...">rewrite$-process-assumptions-msg</a> n0
          pairs
          untranslate
          clause-set
          forced-goal
          wrld
          state))
      ((when (<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> prove-forced-assumptions <span class="keyword">:none-forced</span>)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The call of rewrite$ has failed because there were forced ~
             assumptions and keyword option :PROVE-FORCED-ASSUMPTIONS ~
             :NONE-FORCED was supplied."</span>))
      (state (<a class="sym-link system" href="../../basis-a.html#def-io_3F" data-sym="IO?">io?</a> <a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a>
          nil
          state
          nil
          (<a class="sym-link system" href="../../basis-a.html#def-fms" data-sym="FMS">fms</a> <span class="string">"~@0Beginning forcing round.~|"</span>
            (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (cons #\0 <a class="sym-link local-def" href="#def-_2Arewrite_24-note-msg_2A" data-sym="*REWRITE$-NOTE-MSG*" title="(defconst *rewrite$-note-msg* &quot;&lt;&lt;Rewrite$ NOTE:&gt;&gt;~|&quot;)">*rewrite$-note-msg*</a>))
            (<a class="sym-link system" href="../../basis-b.html#def-proofs-co" data-sym="PROOFS-CO">proofs-co</a> state)
            state
            nil)))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> erp val state) (<a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a> forced-goal
          (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> prove-spec-var
            (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>)
            <span class="keyword">:user-supplied-term</span> forced-goal)
          forced-assumptions-hints
          (ens state)
          wrld
          ctx
          state))
      ((when erp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"Rewriting has failed because of failure to prove all of the ~
             assumptions forced during rewriting.  Either disable forcing ~
             (see :DOC disable-forcing) or, if you are willing to ignore the ~
             forced assumptions, specify option :PROVE-FORCED-ASSUMPTIONS NIL ~
             for rewrite$."</span>))
      (ttree (<a class="sym-link system" href="../../prove.html#def-process-assumptions-ttree" data-sym="PROCESS-ASSUMPTIONS-TTREE">process-assumptions-ttree</a> assns ttree)))
    (<a class="sym-link local-def" href="#def-rewrite_24-return" data-sym="REWRITE$-RETURN" title="(defun rewrite$-return (rewritten-term ttree pairs untranslate wrld state)
  (b*
   ((new-term
     (if untranslate
         (untranslate rewritten-term nil wrld)
...">rewrite$-return</a> rewritten-term
      (cons-tag-trees val ttree)
      nil
      untranslate
      wrld
      state)))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-pspv" data-defines="REWRITE$-PSPV" data-references="ENS,MAKE-PSPV,STATE,WRLD,THINTS,DEFUN" data-used-by="MAKE-RREC" data-part-name="REWRITE$-PSPV" data-part-args="STATE,WRLD,THINTS" data-part-body="THINTS,WRLD,STATE,ENS,MAKE-PSPV" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-PSPV">rewrite$-pspv</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-pspv" data-sym="REWRITE$-PSPV" title="(defun rewrite$-pspv (thints wrld state)
  (make-pspv (ens state) wrld state :orig-hints thints))">rewrite$-pspv</a>
  (thints wrld state)
  (<a class="sym-link system" href="../../prove.html#def-make-pspv" data-sym="MAKE-PSPV">make-pspv</a> (ens state) wrld state <span class="keyword">:orig-hints</span> thints))</pre>
  </div>

<div class="form-block function" id="def-weak-type-alistp" data-defines="WEAK-TYPE-ALISTP" data-references="INTEGER-LISTP,TERM-LISTP,STRIP-CDRS,D,STRIP-CARS,A,LET,ALISTP,AND,WRLD,X,DEFUN" data-used-by="CHK-RREC-P" data-part-name="WEAK-TYPE-ALISTP" data-part-args="WRLD,X" data-part-body="INTEGER-LISTP,WRLD,TERM-LISTP,STRIP-CDRS,D,STRIP-CARS,A,LET,X,ALISTP,AND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="WEAK-TYPE-ALISTP">weak-type-alistp</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-weak-type-alistp" data-sym="WEAK-TYPE-ALISTP" title="(defun weak-type-alistp (x wrld)
  (and (alistp x)
       (let ((a (strip-cars x)) (d (strip-cdrs x)))
         (and (term-listp a wrld) (alistp d) (integer-listp (strip-cars d))))))">weak-type-alistp</a>
  (x wrld)
  (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../axioms.html#def-alistp" data-sym="ALISTP">alistp</a> x)
    (let ((a (<a class="sym-link system" href="../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> x)) (d (<a class="sym-link system" href="../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> x)))
      (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> (term-listp a wrld)
        (<a class="sym-link system" href="../../axioms.html#def-alistp" data-sym="ALISTP">alistp</a> d)
        (<a class="sym-link system" href="../../axioms.html#def-integer-listp" data-sym="INTEGER-LISTP">integer-listp</a> (<a class="sym-link system" href="../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> d))))))</pre>
  </div>

<div class="form-block function" id="def-chk-rrec-p" data-defines="CHK-RREC-P" data-references="VALUE,WEAK-TYPE-ALISTP,WEAK-PROVE-SPEC-VAR-P,REWRITE$-RECORD,ACCESS,WEAK-REWRITE-CONSTANT-P,QUOTE,SOFT,ER,WEAK-REWRITE$-RECORD-P,UNLESS,B*,STATE,WRLD,CTX,RREC,DEFUN" data-used-by="REWRITE$-CHECK-ARGS" data-part-name="CHK-RREC-P" data-part-args="STATE,WRLD,CTX,RREC" data-part-body="VALUE,WRLD,WEAK-TYPE-ALISTP,WEAK-PROVE-SPEC-VAR-P,REWRITE$-RECORD,ACCESS,WEAK-REWRITE-CONSTANT-P,QUOTE,CTX,SOFT,ER,RREC,WEAK-REWRITE$-RECORD-P,UNLESS,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CHK-RREC-P">chk-rrec-p</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-chk-rrec-p" data-sym="CHK-RREC-P" title="(defun chk-rrec-p (rrec ctx wrld state)
  (b*
   (((unless (weak-rewrite$-record-p rrec))
     (er soft ctx
         &quot;The value of :RREC in a call of rewrite$ must have the shape of ~
...">chk-rrec-p</a>
  (rrec ctx wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((unless (weak-rewrite$-record-p rrec)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
         ctx
         <span class="string">"The value of :RREC in a call of rewrite$ must have the shape of ~
             a rewrite$-record record, but that value has been supplied as ~
             ~x0, which fails to satisfy the predicate ~x1."</span>
         rrec
         'weak-rewrite$-record-p)) ((unless (weak-rewrite-constant-p (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>))) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The value of :RREC in a call of rewrite$ must have an :RCNST ~
             field that is the shape of a rewrite-constant record.  But that ~
             field has been supplied as ~x0, which fails to satisfy the ~
             predicate ~x1."</span>
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>)
          'weak-rewrite-constant-p))
      ((unless (weak-prove-spec-var-p (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>))) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The value of :RREC in a call of rewrite$ must have a :SAVED-PSPV ~
             field that is the shape of a prove-spec-var record.  But that ~
             field has been supplied as ~x0, which fails to satisfy the ~
             predicate ~x1."</span>
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>)
          'weak-prove-spec-var-p))
      ((unless (<a class="sym-link local-def" href="#def-weak-type-alistp" data-sym="WEAK-TYPE-ALISTP" title="(defun weak-type-alistp (x wrld)
  (and (alistp x)
       (let ((a (strip-cars x)) (d (strip-cdrs x)))
         (and (term-listp a wrld) (alistp d) (integer-listp (strip-cars d))))))">weak-type-alistp</a> (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:type-alist</span>)
           wrld)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The value of :RREC in a call of rewrite$ must have a :TYPE-ALIST ~
             field that is a type-alist.  But that field has been supplied as ~
             ~x0, which fails to satisfy the predicate ~x1."</span>
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:type-alist</span>)
          '<a class="sym-link local-def" href="#def-weak-type-alistp" data-sym="WEAK-TYPE-ALISTP" title="(defun weak-type-alistp (x wrld)
  (and (alistp x)
       (let ((a (strip-cars x)) (d (strip-cdrs x)))
         (and (term-listp a wrld) (alistp d) (integer-listp (strip-cars d))))))">weak-type-alistp</a>)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))</pre>
  </div>

<div class="form-block function" id="def-chk-repeat" data-defines="CHK-REPEAT" data-references="SOFT,ER,T,VALUE,POSP,COND,STATE,CTX,REPEAT,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN,REWRITE$-HYPS-MAIN,REWRITE$-CHECK-ARGS" data-part-name="CHK-REPEAT" data-part-args="STATE,CTX,REPEAT" data-part-body="CTX,SOFT,ER,T,VALUE,REPEAT,POSP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CHK-REPEAT">chk-repeat</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-chk-repeat" data-sym="CHK-REPEAT" title="(defun chk-repeat (repeat ctx state)
  (cond ((posp repeat) (value nil))
        (t
         (er soft ctx
             &quot;The :REPEAT argument must be a positive integer; ~x0 is thus ~
...">chk-repeat</a>
  (repeat ctx state)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-posp" data-sym="POSP">posp</a> repeat) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
        ctx
        <span class="string">"The :REPEAT argument must be a positive integer; ~x0 is thus ~
                 illegal."</span>
        repeat))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-check-args" data-defines="REWRITE$-CHECK-ARGS" data-references="CHK-RREC-P,QUASIQUOTE,OR,NULL,CHK-REPEAT,VALUE,T,SOFT,ER,AND,COND,ER-PROGN,STATE,WRLD,CTX,RREC,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,HYPS,REPEAT,MUST-REWRITE,ALIST,DEFUN" data-used-by="REWRITE$-FN" data-part-name="REWRITE$-CHECK-ARGS" data-part-args="STATE,WRLD,CTX,RREC,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,HYPS,REPEAT,MUST-REWRITE,ALIST" data-part-body="WRLD,CHK-RREC-P,QUASIQUOTE,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,HYPS,OR,RREC,NULL,STATE,REPEAT,CHK-REPEAT,VALUE,T,CTX,SOFT,ER,ALIST,MUST-REWRITE,AND,COND,ER-PROGN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CHECK-ARGS">rewrite$-check-args</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-check-args" data-sym="REWRITE$-CHECK-ARGS" title="(defun rewrite$-check-args
       (alist must-rewrite repeat hyps backchain-limit-rw expand hands-off
        in-theory no-thanks nonlinearp restrict rw-cache-state rrec ctx wrld
        state)
  (er-progn
...">rewrite$-check-args</a>
  (alist must-rewrite
    repeat
    hyps
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    rrec
    ctx
    wrld
    state)
  (<a class="sym-link system" href="../../axioms.html#def-er-progn" data-sym="ER-PROGN">er-progn</a> (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> must-rewrite alist) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"It is illegal for rewrite$ to specify non-nil values for both ~
               :ALIST and :MUST-REWRITE."</span>))
      (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))
    (<a class="sym-link local-def" href="#def-chk-repeat" data-sym="CHK-REPEAT" title="(defun chk-repeat (repeat ctx state)
  (cond ((posp repeat) (value nil))
        (t
         (er soft ctx
             &quot;The :REPEAT argument must be a positive integer; ~x0 is thus ~
...">chk-repeat</a> repeat ctx state)
    (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> rrec) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
      ((<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> hyps
         backchain-limit-rw
         expand
         hands-off
         <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
         no-thanks
         nonlinearp
         restrict
         rw-cache-state) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"It is illegal for a call of rewrite$ to supply values both to ~
               :RREC and to ~v0."</span>
          `(,@(AND BACKCHAIN-LIMIT-RW &#39;(:BACKCHAIN-LIMIT-RW)) ,@(AND EXPAND &#39;(:EXPAND))
            ,@(AND HANDS-OFF &#39;(:HANDS-OFF))
            ,@(AND IN-THEORY &#39;(:IN-THEORY))
            ,@(AND NO-THANKS &#39;(:NO-THANKS))
            ,@(AND NONLINEARP &#39;(:NONLINEARP))
            ,@(AND RESTRICT &#39;(:RESTRICT))
            ,@(AND RW-CACHE-STATE &#39;(:RW-CACHE-STATE)))))
      (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-chk-rrec-p" data-sym="CHK-RREC-P" title="(defun chk-rrec-p (rrec ctx wrld state)
  (b*
   (((unless (weak-rewrite$-record-p rrec))
     (er soft ctx
         &quot;The value of :RREC in a call of rewrite$ must have the shape of ~
...">chk-rrec-p</a> rrec ctx wrld state)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-rcnst" data-defines="REWRITE$-RCNST" data-references="*REWRITE$-LAST-LITERAL*,CURRENT-LITERAL,MAKE,REWRITE-CONSTANT,CHANGE,VALUE,PROVE-SPEC-VAR,ACCESS,LOAD-HINT-SETTINGS-INTO-RCNST,RCNST,THANKS-FOR-THE-HINT,T,NULL,COND,MV,SOFT,WHEN,*REWRITE$-HINT-KEYWORDS*,STRIP-CARS,SET-DIFFERENCE-EQ,BAD-KEYWORDS,CAR,HINT-SETTINGS,*INITIAL-CLAUSE-ID*,FIND-APPLICABLE-HINT-SETTINGS,PAIR,ER,B*,STATE,WRLD,CTX,HINTS,SAVED-PSPV,CLAUSE,DEFUN" data-used-by="MAKE-RREC" data-part-name="REWRITE$-RCNST" data-part-args="STATE,WRLD,CTX,HINTS,SAVED-PSPV,CLAUSE" data-part-body="*REWRITE$-LAST-LITERAL*,CURRENT-LITERAL,MAKE,REWRITE-CONSTANT,CHANGE,VALUE,PROVE-SPEC-VAR,ACCESS,LOAD-HINT-SETTINGS-INTO-RCNST,RCNST,THANKS-FOR-THE-HINT,T,NULL,COND,MV,SOFT,WHEN,*REWRITE$-HINT-KEYWORDS*,STRIP-CARS,SET-DIFFERENCE-EQ,BAD-KEYWORDS,CAR,HINT-SETTINGS,STATE,WRLD,HINTS,CTX,SAVED-PSPV,CLAUSE,*INITIAL-CLAUSE-ID*,FIND-APPLICABLE-HINT-SETTINGS,PAIR,ER,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-RCNST">rewrite$-rcnst</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-rcnst" data-sym="REWRITE$-RCNST" title="(defun rewrite$-rcnst (clause saved-pspv hints ctx wrld state)
  (b*
   (((er pair)
     (find-applicable-hint-settings *initial-clause-id* clause nil saved-pspv
                                    ctx hints wrld nil state))
...">rewrite$-rcnst</a>
  (clause saved-pspv hints ctx wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> pair) (find-applicable-hint-settings *initial-clause-id*
         clause
         nil
         saved-pspv
         ctx
         hints
         wrld
         nil
         state)) (hint-settings (car pair))
      (bad-keywords (<a class="sym-link system" href="../../axioms.html#def-set-difference-eq" data-sym="SET-DIFFERENCE-EQ">set-difference-eq</a> (<a class="sym-link system" href="../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> hint-settings)
          <a class="sym-link local-def" href="#def-_2Arewrite_24-hint-keywords_2A" data-sym="*REWRITE$-HINT-KEYWORDS*" title="(defconst *rewrite$-hint-keywords*
          &#39;(:backchain-limit-rw :expand :hands-off :in-theory :no-thanks
            :nonlinearp :restrict :rw-cache-state))">*rewrite$-hint-keywords*</a>))
      ((when bad-keywords) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
          ctx
          <span class="string">"The hints keyword~#0~[ ~&amp;0 is~/s ~&amp;0 are~] illegal for rewrite$."</span>
          bad-keywords))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> hint-settings state) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> hint-settings) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> nil state))
          (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (thanks-for-the-hint nil hint-settings nil state))))
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> rcnst) (load-hint-settings-into-rcnst hint-settings
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> prove-spec-var saved-pspv <span class="keyword">:rewrite-constant</span>)
          *initial-clause-id*
          wrld
          ctx
          state)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite-constant
        rcnst
        <span class="keyword">:current-clause</span> clause
        <span class="keyword">:current-literal</span> (<a class="sym-link system" href="../../basis-a.html#def-make" data-sym="MAKE">make</a> current-literal
          <span class="keyword">:not-flg</span> nil
          <span class="keyword">:atm</span> <a class="sym-link local-def" href="#def-_2Arewrite_24-last-literal_2A" data-sym="*REWRITE$-LAST-LITERAL*" title="(defconst *rewrite$-last-literal* (fcons-term* &#39;rewrite$-last-literal-fn))">*rewrite$-last-literal*</a>)
        <span class="keyword">:force-info</span> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>))))</pre>
  </div>

<div class="form-block function" id="def-make-rrec" data-defines="MAKE-RREC" data-references="REWRITE$-RECORD,MAKE,VALUE,REWRITE$-SETUP,FC-PAIR-LST,POT-LST,TYPE-ALIST,LIST*,SIMPLIFY-CLAUSE,QUOTE,INITIAL-GSTACK,GSTACK,REWRITE$-RCNST,RCNST,ER,T,*REWRITE$-LAST-LITERAL*,ADD-LITERAL,CLAUSE,DUMB-NEGATE-LIT-LST,HYPS-CLAUSE,REWRITE$-PSPV,SAVED-PSPV,B*,STATE,WRLD,CTX,UNTRANSLATE,THINTS,THYPS,DEFUN" data-used-by="REWRITE$-HYPS-MAIN,REWRITE$-FN" data-part-name="MAKE-RREC" data-part-args="STATE,WRLD,CTX,UNTRANSLATE,THINTS,THYPS" data-part-body="REWRITE$-RECORD,MAKE,VALUE,UNTRANSLATE,REWRITE$-SETUP,FC-PAIR-LST,POT-LST,TYPE-ALIST,LIST*,SIMPLIFY-CLAUSE,QUOTE,INITIAL-GSTACK,GSTACK,CTX,REWRITE$-RCNST,RCNST,ER,T,*REWRITE$-LAST-LITERAL*,ADD-LITERAL,CLAUSE,THYPS,DUMB-NEGATE-LIT-LST,HYPS-CLAUSE,STATE,WRLD,THINTS,REWRITE$-PSPV,SAVED-PSPV,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MAKE-RREC">make-rrec</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-make-rrec" data-sym="MAKE-RREC" title="(defun make-rrec (thyps thints untranslate ctx wrld state)
  (b*
   ((saved-pspv (rewrite$-pspv thints wrld state))
    (hyps-clause (dumb-negate-lit-lst thyps))
    (clause (add-literal *rewrite$-last-literal* hyps-clause t))
...">make-rrec</a>
  (thyps thints untranslate ctx wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((saved-pspv (<a class="sym-link local-def" href="#def-rewrite_24-pspv" data-sym="REWRITE$-PSPV" title="(defun rewrite$-pspv (thints wrld state)
  (make-pspv (ens state) wrld state :orig-hints thints))">rewrite$-pspv</a> thints wrld state)) (hyps-clause (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> thyps))
      (clause (add-literal <a class="sym-link local-def" href="#def-_2Arewrite_24-last-literal_2A" data-sym="*REWRITE$-LAST-LITERAL*" title="(defconst *rewrite$-last-literal* (fcons-term* &#39;rewrite$-last-literal-fn))">*rewrite$-last-literal*</a> hyps-clause <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>))
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> rcnst) (<a class="sym-link local-def" href="#def-rewrite_24-rcnst" data-sym="REWRITE$-RCNST" title="(defun rewrite$-rcnst (clause saved-pspv hints ctx wrld state)
  (b*
   (((er pair)
     (find-applicable-hint-settings *initial-clause-id* clause nil saved-pspv
                                    ctx hints wrld nil state))
...">rewrite$-rcnst</a> clause saved-pspv thints ctx wrld state))
      (gstack (<a class="sym-link system" href="../../rewrite.html#def-initial-gstack" data-sym="INITIAL-GSTACK">initial-gstack</a> 'simplify-clause nil clause))
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> type-alist pot-lst fc-pair-lst)) (<a class="sym-link local-def" href="#def-rewrite_24-setup" data-sym="REWRITE$-SETUP" title="(defun rewrite$-setup (hyps-clause rcnst untranslate ctx wrld state)
  (b*
   (((when (null hyps-clause)) (value (list* nil nil)))
    (pts (enumerate-elements hyps-clause 0))
    ((mv contradictionp type-alist fc-pair-lst)
...">rewrite$-setup</a> hyps-clause
          rcnst
          untranslate
          ctx
          wrld
          state)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../basis-a.html#def-make" data-sym="MAKE">make</a> rewrite$-record
        <span class="keyword">:saved-pspv</span> saved-pspv
        <span class="keyword">:rcnst</span> rcnst
        <span class="keyword">:type-alist</span> type-alist
        <span class="keyword">:gstack</span> gstack
        <span class="keyword">:fc-pair-lst</span> fc-pair-lst
        <span class="keyword">:pot-lst</span> pot-lst))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-forced-assumptions-hints" data-defines="REWRITE$-FORCED-ASSUMPTIONS-HINTS" data-references="SOFT,ER,T,MEMBER-EQ,VALUE,EQ,REWRITE$,QUOTE,TRANSLATE-HINTS,CONSP,COND,STATE,WRLD,CTX,THINTS,PROVE-FORCED-ASSUMPTIONS,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN,REWRITE$-HYPS-MAIN,REWRITE$-FN" data-part-name="REWRITE$-FORCED-ASSUMPTIONS-HINTS" data-part-args="STATE,WRLD,CTX,THINTS,PROVE-FORCED-ASSUMPTIONS" data-part-body="SOFT,ER,T,MEMBER-EQ,THINTS,VALUE,EQ,STATE,WRLD,CTX,REWRITE$,QUOTE,TRANSLATE-HINTS,PROVE-FORCED-ASSUMPTIONS,CONSP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-FORCED-ASSUMPTIONS-HINTS">rewrite$-forced-assumptions-hints</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-forced-assumptions-hints" data-sym="REWRITE$-FORCED-ASSUMPTIONS-HINTS" title="(defun rewrite$-forced-assumptions-hints
       (prove-forced-assumptions thints ctx wrld state)
  (cond
   ((consp prove-forced-assumptions)
    (translate-hints &#39;rewrite$ prove-forced-assumptions ctx wrld state))
...">rewrite$-forced-assumptions-hints</a>
  (prove-forced-assumptions thints ctx wrld state)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((consp prove-forced-assumptions) (translate-hints '<a class="sym-link local-def" href="#def-rewrite_24" data-sym="REWRITE$" title="(defmacro rewrite$
          (term
           &amp;key alist (ctx &#39;&#39;rewrite$) hyps equiv geneqv backchain-limit-rw
           expand hands-off in-theory no-thanks nonlinearp restrict
           rw-cache-state (default-hints-p &#39;t) (prove-forced-assumptions &#39;t)
...">rewrite$</a>
        prove-forced-assumptions
        ctx
        wrld
        state))
    ((<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> prove-forced-assumptions <span class="keyword">:same-hints</span>) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> thints))
    ((<a class="sym-link system" href="../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> prove-forced-assumptions '(<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> nil <span class="keyword">:none-forced</span>)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
        ctx
        <span class="string">"The :prove-forced-assumptions argument, ~x0, is illegal."</span>
        prove-forced-assumptions))))</pre>
  </div>

<div class="form-block function" id="def-collect-non-termp-cdrs" data-defines="COLLECT-NON-TERMP-CDRS" data-references="CONS,T,CDR,CDAR,TERMP,ENDP,COND,ALISTP,XARGS,DECLARE,WRLD,ALIST,DEFUN" data-used-by="REWRITE$-FN" data-part-name="COLLECT-NON-TERMP-CDRS" data-part-args="WRLD,ALIST" data-part-declare="ALIST,ALISTP,XARGS,DECLARE" data-part-body="CONS,T,CDR,COLLECT-NON-TERMP-CDRS,WRLD,CDAR,TERMP,ALIST,ENDP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="COLLECT-NON-TERMP-CDRS">collect-non-termp-cdrs</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-collect-non-termp-cdrs" data-sym="COLLECT-NON-TERMP-CDRS" title="(defun collect-non-termp-cdrs (alist wrld)
  (declare (xargs :guard (alistp alist)))
  (cond ((endp alist) nil)
        ((termp (cdar alist) wrld) (collect-non-termp-cdrs (cdr alist) wrld))
        (t (cons (cdar alist) (collect-non-termp-cdrs (cdr alist) wrld)))))">collect-non-termp-cdrs</a>
  (alist wrld)
  (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../axioms.html#def-alistp" data-sym="ALISTP">alistp</a> alist)))
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-endp" data-sym="ENDP">endp</a> alist) nil)
    ((termp (<a class="sym-link system" href="../../axioms.html#def-cdar" data-sym="CDAR">cdar</a> alist) wrld) (<a class="sym-link local-def" href="#def-collect-non-termp-cdrs" data-sym="COLLECT-NON-TERMP-CDRS" title="(defun collect-non-termp-cdrs (alist wrld)
  (declare (xargs :guard (alistp alist)))
  (cond ((endp alist) nil)
        ((termp (cdar alist) wrld) (collect-non-termp-cdrs (cdr alist) wrld))
        (t (cons (cdar alist) (collect-non-termp-cdrs (cdr alist) wrld)))))">collect-non-termp-cdrs</a> (cdr alist) wrld))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (cons (<a class="sym-link system" href="../../axioms.html#def-cdar" data-sym="CDAR">cdar</a> alist)
        (<a class="sym-link local-def" href="#def-collect-non-termp-cdrs" data-sym="COLLECT-NON-TERMP-CDRS" title="(defun collect-non-termp-cdrs (alist wrld)
  (declare (xargs :guard (alistp alist)))
  (cond ((endp alist) nil)
        ((termp (cdar alist) wrld) (collect-non-termp-cdrs (cdr alist) wrld))
        (t (cons (cdar alist) (collect-non-termp-cdrs (cdr alist) wrld)))))">collect-non-termp-cdrs</a> (cdr alist) wrld)))))</pre>
  </div>

<div class="form-block function" id="def-collect-non-terms" data-defines="COLLECT-NON-TERMS" data-references="CONS,T,CDR,CAR,TERMP,ENDP,COND,WRLD,LST,DEFUN" data-used-by="REWRITE$-TRANSLATE-LST" data-part-name="COLLECT-NON-TERMS" data-part-args="WRLD,LST" data-part-body="CONS,T,CDR,COLLECT-NON-TERMS,WRLD,CAR,TERMP,LST,ENDP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="COLLECT-NON-TERMS">collect-non-terms</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-collect-non-terms" data-sym="COLLECT-NON-TERMS" title="(defun collect-non-terms (lst wrld)
  (cond ((endp lst) nil)
        ((termp (car lst) wrld) (collect-non-terms (cdr lst) wrld))
        (t (cons (car lst) (collect-non-terms (cdr lst) wrld)))))">collect-non-terms</a>
  (lst wrld)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-endp" data-sym="ENDP">endp</a> lst) nil)
    ((termp (car lst) wrld) (<a class="sym-link local-def" href="#def-collect-non-terms" data-sym="COLLECT-NON-TERMS" title="(defun collect-non-terms (lst wrld)
  (cond ((endp lst) nil)
        ((termp (car lst) wrld) (collect-non-terms (cdr lst) wrld))
        (t (cons (car lst) (collect-non-terms (cdr lst) wrld)))))">collect-non-terms</a> (cdr lst) wrld))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (cons (car lst) (<a class="sym-link local-def" href="#def-collect-non-terms" data-sym="COLLECT-NON-TERMS" title="(defun collect-non-terms (lst wrld)
  (cond ((endp lst) nil)
        ((termp (car lst) wrld) (collect-non-terms (cdr lst) wrld))
        (t (cons (car lst) (collect-non-terms (cdr lst) wrld)))))">collect-non-terms</a> (cdr lst) wrld)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-translate-hints-fn" data-defines="REWRITE$-TRANSLATE-HINTS-FN" data-references="VALUE,T,TRANSLATE-HINTS,TRANSLATE-HINTS+,IF,OR,COND,DEFAULT-HINTS,QUASIQUOTE,HINTS0,LIST,AND,APPEND,KWD-ALIST,B*,STATE,WRLD,CTX,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,DEFUN" data-used-by="REWRITE$-HYPS-MAIN,REWRITE$-TRANSLATE-HINTS,REWRITE$-FN" data-part-name="REWRITE$-TRANSLATE-HINTS-FN" data-part-args="STATE,WRLD,CTX,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW" data-part-body="VALUE,T,TRANSLATE-HINTS,STATE,CTX,TRANSLATE-HINTS+,DEFAULT-HINTS-P,IF,OR,COND,WRLD,DEFAULT-HINTS,QUASIQUOTE,HINTS0,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,LIST,BACKCHAIN-LIMIT-RW,AND,APPEND,KWD-ALIST,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-TRANSLATE-HINTS-FN">rewrite$-translate-hints-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-translate-hints-fn" data-sym="REWRITE$-TRANSLATE-HINTS-FN" title="(defun rewrite$-translate-hints-fn
       (backchain-limit-rw expand hands-off in-theory no-thanks nonlinearp
        restrict rw-cache-state default-hints-p ctx wrld state)
  (b*
   ((kwd-alist
...">rewrite$-translate-hints-fn</a>
  (backchain-limit-rw expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    default-hints-p
    ctx
    wrld
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((kwd-alist (<a class="sym-link system" href="../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> backchain-limit-rw
           (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:backchain-limit-rw</span> backchain-limit-rw))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> expand (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:expand</span> expand))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> hands-off (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:hands-off</span> hands-off))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:in-theory</span> <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> no-thanks (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:no-thanks</span> no-thanks))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> nonlinearp (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:nonlinearp</span> nonlinearp))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> restrict (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:restrict</span> restrict))
         (<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> rw-cache-state (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:rw-cache-state</span> rw-cache-state)))) (hints0 `((<span class="string">"Goal"</span> ,@KWD-ALIST)))
      (<a class="sym-link system" href="../../axioms.html#def-default-hints" data-sym="DEFAULT-HINTS">default-hints</a> (<a class="sym-link system" href="../../axioms.html#def-default-hints" data-sym="DEFAULT-HINTS">default-hints</a> wrld)))
    (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> kwd-alist <a class="sym-link system" href="../../axioms.html#def-default-hints" data-sym="DEFAULT-HINTS">default-hints</a>) (if default-hints-p
          (<a class="sym-link system" href="../../history-management.html#def-translate-hints_2B" data-sym="TRANSLATE-HINTS+">translate-hints+</a> ctx hints0 <a class="sym-link system" href="../../axioms.html#def-default-hints" data-sym="DEFAULT-HINTS">default-hints</a> ctx wrld state)
          (translate-hints ctx hints0 ctx wrld state)))
      (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-translate-lst" data-defines="REWRITE$-TRANSLATE-LST" data-references="COLLECT-NON-TERMS,BAD,LET,T,TRANSLATE-TERM-LST,SOFT,ER,TRUE-LISTP,NOT,VALUE,NULL,COND,STATE,WRLD,CTX,TRANSLATE,LST,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN,REWRITE$-HYPS-MAIN,REWRITE$-FN" data-part-name="REWRITE$-TRANSLATE-LST" data-part-args="STATE,WRLD,CTX,TRANSLATE,LST" data-part-body="COLLECT-NON-TERMS,BAD,LET,STATE,WRLD,T,TRANSLATE-TERM-LST,TRANSLATE,CTX,SOFT,ER,TRUE-LISTP,NOT,VALUE,LST,NULL,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-TRANSLATE-LST">rewrite$-translate-lst</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-translate-lst" data-sym="REWRITE$-TRANSLATE-LST" title="(defun rewrite$-translate-lst (lst translate ctx wrld state)
  (cond ((null lst) (value nil))
        ((not (true-listp lst)) (er soft ctx &quot;Not a true-list:~|~x0.&quot; lst))
        (translate (translate-term-lst lst t t t ctx wrld state))
        (t
...">rewrite$-translate-lst</a>
  (lst translate ctx wrld state)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> lst) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
    ((<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> lst)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft ctx <span class="string">"Not a true-list:~|~x0."</span> lst))
    (translate (translate-term-lst lst <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ctx wrld state))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (let ((bad (<a class="sym-link local-def" href="#def-collect-non-terms" data-sym="COLLECT-NON-TERMS" title="(defun collect-non-terms (lst wrld)
  (cond ((endp lst) nil)
        ((termp (car lst) wrld) (collect-non-terms (cdr lst) wrld))
        (t (cons (car lst) (collect-non-terms (cdr lst) wrld)))))">collect-non-terms</a> lst wrld)))
        (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> bad) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> lst))
          (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
              ctx
              <span class="string">"A supplied list of terms included the following, ~
                           which ~#0~[is not a term~/are not terms~]: ~&amp;0.  ~
                           Specify :translate t to avoid this error."</span>
              bad)))))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-fn" data-defines="REWRITE$-FN" data-references="REWRITE$-MAIN,INITIALIZE-FC-WORMHOLE-SITES,SEMI-INITIALIZE-BRR-WORMHOLE,-,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,MAKE-RREC,REWRITE$-TRANSLATE-HINTS-FN,REWRITE$-RECORD,PROVE-SPEC-VAR,ACCESS,THINTS,CONGRUENCES,GETPROPC,LAST,CAR,CADR,EQUIVALENCE-RELATIONP,SYMBOLP,EQUAL,QUOTE,EQ,NULL,REWRITE$-TRANSLATE-LST,THYPS,WHEN,COLLECT-NON-TERMP-CDRS,BAD,STRIP-CARS,PAIRLIS$,STRIP-CDRS,TRANSLATE-TERM-LST,CDRS,SYMBOL-ALISTP,NOT,TRANSLATED-ALIST,SOFT,VALUE,TERMP,T,COND,TTERM,REWRITE$-CHECK-ARGS,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE,STATE,RREC,WRLD,CTX,REPEAT,MUST-REWRITE,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,OBJ,GENEQV,EQUIV,HYPS,ALIST,TERM,DEFUN" data-used-by="REWRITE$" data-part-name="REWRITE$-FN" data-part-args="STATE,RREC,WRLD,CTX,REPEAT,MUST-REWRITE,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,OBJ,GENEQV,EQUIV,HYPS,ALIST,TERM" data-part-body="OBJ,REWRITE$-MAIN,INITIALIZE-FC-WORMHOLE-SITES,SEMI-INITIALIZE-BRR-WORMHOLE,-,PROVE-FORCED-ASSUMPTIONS,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,UNTRANSLATE,MAKE-RREC,DEFAULT-HINTS-P,REWRITE$-TRANSLATE-HINTS-FN,REWRITE$-RECORD,PROVE-SPEC-VAR,ACCESS,THINTS,CONGRUENCES,GETPROPC,LAST,CAR,CADR,EQUIVALENCE-RELATIONP,SYMBOLP,EQUAL,QUOTE,EQ,EQUIV,NULL,GENEQV,REWRITE$-TRANSLATE-LST,THYPS,WHEN,COLLECT-NON-TERMP-CDRS,BAD,STRIP-CARS,PAIRLIS$,STRIP-CDRS,TRANSLATE-TERM-LST,CDRS,SYMBOL-ALISTP,NOT,TRANSLATED-ALIST,SOFT,VALUE,TERMP,T,TERM,TRANSLATE,COND,TTERM,STATE,WRLD,CTX,RREC,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,HYPS,REPEAT,MUST-REWRITE,ALIST,REWRITE$-CHECK-ARGS,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-FN">rewrite$-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-fn" data-sym="REWRITE$-FN" title="(defun rewrite$-fn
       (term alist hyps equiv geneqv obj backchain-limit-rw expand hands-off
        in-theory no-thanks nonlinearp restrict rw-cache-state default-hints-p
        prove-forced-assumptions translate untranslate must-rewrite repeat ctx
        wrld rrec state)
...">rewrite$-fn</a>
  (term alist
    hyps
    equiv
    geneqv
    obj
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    default-hints-p
    prove-forced-assumptions
    translate
    untranslate
    must-rewrite
    repeat
    ctx
    wrld
    rrec
    state)
  (<a class="sym-link system" href="../../axioms.html#def-with-guard-checking-error-triple" data-sym="WITH-GUARD-CHECKING-ERROR-TRIPLE">with-guard-checking-error-triple</a> nil
    (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> ?) (<a class="sym-link local-def" href="#def-rewrite_24-check-args" data-sym="REWRITE$-CHECK-ARGS" title="(defun rewrite$-check-args
       (alist must-rewrite repeat hyps backchain-limit-rw expand hands-off
        in-theory no-thanks nonlinearp restrict rw-cache-state rrec ctx wrld
        state)
  (er-progn
...">rewrite$-check-args</a> alist
           must-rewrite
           repeat
           hyps
           backchain-limit-rw
           expand
           hands-off
           <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
           no-thanks
           nonlinearp
           restrict
           rw-cache-state
           rrec
           ctx
           wrld
           state)) ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> tterm) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (translate (translate term <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ctx wrld state))
            ((termp term wrld) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> term))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"The first argument of rewrite$ must be a term unless ~
                       :translate is specifed, but ~x0 is not a term."</span>
                term))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> translated-alist) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../axioms.html#def-symbol-alistp" data-sym="SYMBOL-ALISTP">symbol-alistp</a> alist)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"The :ALIST argument that was supplied rewrite$ is not a ~
                     symbol-alistp:~|~x0."</span>
                alist))
            (translate (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> cdrs) (translate-term-lst (<a class="sym-link system" href="../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> alist) <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ctx wrld state)))
                (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-pairlis_24" data-sym="PAIRLIS$">pairlis$</a> (<a class="sym-link system" href="../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> alist) cdrs))))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((bad (<a class="sym-link local-def" href="#def-collect-non-termp-cdrs" data-sym="COLLECT-NON-TERMP-CDRS" title="(defun collect-non-termp-cdrs (alist wrld)
  (declare (xargs :guard (alistp alist)))
  (cond ((endp alist) nil)
        ((termp (cdar alist) wrld) (collect-non-termp-cdrs (cdr alist) wrld))
        (t (cons (cdar alist) (collect-non-termp-cdrs (cdr alist) wrld)))))">collect-non-termp-cdrs</a> alist wrld)) ((when bad) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                      ctx
                      <span class="string">"Non-term value~#0~[~/s~] in :ALIST argument of ~
                             rewrite$:~|~&amp;0"</span>
                      bad)))
                (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> alist)))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> thyps) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (rrec (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> <span class="keyword">:ignored</span>))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-rewrite_24-translate-lst" data-sym="REWRITE$-TRANSLATE-LST" title="(defun rewrite$-translate-lst (lst translate ctx wrld state)
  (cond ((null lst) (value nil))
        ((not (true-listp lst)) (er soft ctx &quot;Not a true-list:~|~x0.&quot; lst))
        (translate (translate-term-lst lst t t t ctx wrld state))
        (t
...">rewrite$-translate-lst</a> hyps translate ctx wrld state))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> geneqv) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> equiv) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> geneqv))
            (geneqv (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"It is illegal for a call of rewrite$ to include values ~
                     for both the :EQUIV and :GENEQV options."</span>))
            ((<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> equiv 'equal) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
            ((<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> (symbolp equiv)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"The :EQUIV argument of rewrite$ must be a symbol, unlike ~
                     ~x0."</span>
                equiv))
            ((<a class="sym-link system" href="../../basis-b.html#def-equivalence-relationp" data-sym="EQUIVALENCE-RELATIONP">equivalence-relationp</a> equiv wrld) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-cadr" data-sym="CADR">cadr</a> (car (<a class="sym-link system" href="../../axioms.html#def-last" data-sym="LAST">last</a> (<a class="sym-link system" href="../../axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> equiv 'congruences nil wrld))))))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"The :EQUIV argument of rewrite$ must denote a known ~
                       equivalence relation, unlike ~x0."</span>
                equiv))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> thints) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (rrec (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> prove-spec-var
                  (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>)
                  <span class="keyword">:orig-hints</span>)))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-rewrite_24-translate-hints-fn" data-sym="REWRITE$-TRANSLATE-HINTS-FN" title="(defun rewrite$-translate-hints-fn
       (backchain-limit-rw expand hands-off in-theory no-thanks nonlinearp
        restrict rw-cache-state default-hints-p ctx wrld state)
  (b*
   ((kwd-alist
...">rewrite$-translate-hints-fn</a> backchain-limit-rw
                expand
                hands-off
                <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
                no-thanks
                nonlinearp
                restrict
                rw-cache-state
                default-hints-p
                ctx
                wrld
                state))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> rrec) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (rrec (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> rrec))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-make-rrec" data-sym="MAKE-RREC" title="(defun make-rrec (thyps thints untranslate ctx wrld state)
  (b*
   ((saved-pspv (rewrite$-pspv thints wrld state))
    (hyps-clause (dumb-negate-lit-lst thyps))
    (clause (add-literal *rewrite$-last-literal* hyps-clause t))
...">make-rrec</a> thyps thints untranslate ctx wrld state))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> forced-assumptions-hints) (<a class="sym-link local-def" href="#def-rewrite_24-forced-assumptions-hints" data-sym="REWRITE$-FORCED-ASSUMPTIONS-HINTS" title="(defun rewrite$-forced-assumptions-hints
       (prove-forced-assumptions thints ctx wrld state)
  (cond
   ((consp prove-forced-assumptions)
    (translate-hints &#39;rewrite$ prove-forced-assumptions ctx wrld state))
...">rewrite$-forced-assumptions-hints</a> prove-forced-assumptions
            thints
            ctx
            wrld
            state))
        (<a class="sym-link system" href="../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../rewrite.html#def-semi-initialize-brr-wormhole" data-sym="SEMI-INITIALIZE-BRR-WORMHOLE">semi-initialize-brr-wormhole</a> state))
        (<a class="sym-link system" href="../../axioms.html#def--" data-sym="-">-</a> (initialize-fc-wormhole-sites)))
      (<a class="sym-link local-def" href="#def-rewrite_24-main" data-sym="REWRITE$-MAIN" title="(defun rewrite$-main
       (term alist geneqv obj prove-forced-assumptions forced-assumptions-hints
        untranslate must-rewrite repeat rrec ctx wrld state)
  (b*
   ((rcnst (access rewrite$-record rrec :rcnst))
...">rewrite$-main</a> tterm
        translated-alist
        geneqv
        obj
        prove-forced-assumptions
        forced-assumptions-hints
        untranslate
        must-rewrite
        repeat
        rrec
        ctx
        wrld
        state))))</pre>
  </div>

<div class="form-block macro" id="def-rewrite_24" data-defines="REWRITE$" data-references="REWRITE$-FN,QUASIQUOTE,STATE,W,WRLD,RREC,?,OBJ,REPEAT,MUST-REWRITE,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,T,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,GENEQV,EQUIV,HYPS,QUOTE,CTX,ALIST,&KEY,TERM,DEFMACRO" data-used-by="REWRITE$-FORCED-ASSUMPTIONS-HINTS,REWRITE$-SETUP" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$">rewrite$</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-rewrite_24" data-sym="REWRITE$" title="(defmacro rewrite$
          (term
           &amp;key alist (ctx &#39;&#39;rewrite$) hyps equiv geneqv backchain-limit-rw
           expand hands-off in-theory no-thanks nonlinearp restrict
           rw-cache-state (default-hints-p &#39;t) (prove-forced-assumptions &#39;t)
...">rewrite$</a>
  (term &amp;key
    alist
    (ctx ''<a class="sym-link local-def" href="#def-rewrite_24" data-sym="REWRITE$" title="(defmacro rewrite$
          (term
           &amp;key alist (ctx &#39;&#39;rewrite$) hyps equiv geneqv backchain-limit-rw
           expand hands-off in-theory no-thanks nonlinearp restrict
           rw-cache-state (default-hints-p &#39;t) (prove-forced-assumptions &#39;t)
...">rewrite$</a>)
    hyps
    equiv
    geneqv
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    (default-hints-p '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
    (prove-forced-assumptions '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
    translate
    untranslate
    must-rewrite
    (repeat '<span class="number">1</span>)
    (obj ''?)
    rrec
    (wrld '(<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
  `(<a class="sym-link local-def" href="#def-rewrite_24-fn" data-sym="REWRITE$-FN" title="(defun rewrite$-fn
       (term alist hyps equiv geneqv obj backchain-limit-rw expand hands-off
        in-theory no-thanks nonlinearp restrict rw-cache-state default-hints-p
        prove-forced-assumptions translate untranslate must-rewrite repeat ctx
        wrld rrec state)
...">rewrite$-fn</a> ,TERM
    ,ALIST
    ,HYPS
    ,EQUIV
    ,GENEQV
    ,OBJ
    ,BACKCHAIN-LIMIT-RW
    ,EXPAND
    ,HANDS-OFF
    ,IN-THEORY
    ,NO-THANKS
    ,NONLINEARP
    ,RESTRICT
    ,RW-CACHE-STATE
    ,DEFAULT-HINTS-P
    ,PROVE-FORCED-ASSUMPTIONS
    ,TRANSLATE
    ,UNTRANSLATE
    ,MUST-REWRITE
    ,REPEAT
    ,CTX
    ,WRLD
    ,RREC
    state))</pre>
  </div>

<div class="form-block function" id="def-flatten-ors-in-lit" data-defines="FLATTEN-ORS-IN-LIT" data-references="*NIL*,LIST,T,DUMB-NEGATE-LIT,APPEND,*T*,EQUAL,OR,COND,T3,T2,T1,FARGN,FLATTEN-ANDS-IN-LIT,DUMB-NEGATE-LIT-LST,&,IF,NOT,QUOTE,CASE-MATCH,TERM,DEFUN" data-used-by="FLATTEN-ORS-IN-LIT-LST" data-part-name="FLATTEN-ORS-IN-LIT" data-part-args="TERM" data-part-body="*NIL*,LIST,T,DUMB-NEGATE-LIT,FLATTEN-ORS-IN-LIT,APPEND,*T*,EQUAL,OR,COND,T3,T2,T1,FARGN,FLATTEN-ANDS-IN-LIT,DUMB-NEGATE-LIT-LST,&,IF,NOT,QUOTE,TERM,CASE-MATCH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="FLATTEN-ORS-IN-LIT">flatten-ors-in-lit</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a>
  (term)
  (<a class="sym-link system" href="../../basis-a.html#def-case-match" data-sym="CASE-MATCH">case-match</a> term
    (('<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> ('if &amp; &amp; &amp;)) (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> (flatten-ands-in-lit (<a class="sym-link system" href="../../axioms.html#def-fargn" data-sym="FARGN">fargn</a> term <span class="number">1</span>))))
    (('if t1 t2 t3) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> (equal t2 <a class="sym-link system" href="../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>) (equal t2 t1)) (<a class="sym-link system" href="../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a> t1) (<a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a> t3)))
        ((equal t3 <a class="sym-link system" href="../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>) (<a class="sym-link system" href="../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a> (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit" data-sym="DUMB-NEGATE-LIT">dumb-negate-lit</a> t1))
            (<a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a> t2)))
        (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> term))))
    (&amp; (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((equal term <a class="sym-link system" href="../../axioms.html#def-_2Anil_2A" data-sym="*NIL*">*nil*</a>) nil) (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> term))))))</pre>
  </div>

<div class="form-block function" id="def-flatten-ors-in-lit-lst" data-defines="FLATTEN-ORS-IN-LIT-LST" data-references="CDR,CAR,FLATTEN-ORS-IN-LIT,APPEND,ENDP,IF,X,DEFUN" data-used-by="REWRITE$-CLAUSE-TAIL" data-part-name="FLATTEN-ORS-IN-LIT-LST" data-part-args="X" data-part-body="CDR,FLATTEN-ORS-IN-LIT-LST,CAR,FLATTEN-ORS-IN-LIT,APPEND,X,ENDP,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="FLATTEN-ORS-IN-LIT-LST">flatten-ors-in-lit-lst</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-flatten-ors-in-lit-lst" data-sym="FLATTEN-ORS-IN-LIT-LST" title="(defun flatten-ors-in-lit-lst (x)
  (if (endp x)
      nil
      (append (flatten-ors-in-lit (car x)) (flatten-ors-in-lit-lst (cdr x)))))">flatten-ors-in-lit-lst</a>
  (x)
  (if (<a class="sym-link system" href="../../axioms.html#def-endp" data-sym="ENDP">endp</a> x)
    nil
    (<a class="sym-link system" href="../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link local-def" href="#def-flatten-ors-in-lit" data-sym="FLATTEN-ORS-IN-LIT" title="(defun flatten-ors-in-lit (term)
  (case-match term
              ((&#39;not (&#39;if &amp; &amp; &amp;))
               (dumb-negate-lit-lst (flatten-ands-in-lit (fargn term 1))))
              ((&#39;if t1 t2 t3)
...">flatten-ors-in-lit</a> (car x))
      (<a class="sym-link local-def" href="#def-flatten-ors-in-lit-lst" data-sym="FLATTEN-ORS-IN-LIT-LST" title="(defun flatten-ors-in-lit-lst (x)
  (if (endp x)
      nil
      (append (flatten-ors-in-lit (car x)) (flatten-ors-in-lit-lst (cdr x)))))">flatten-ors-in-lit-lst</a> (cdr x)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-clause-tail" data-defines="REWRITE$-CLAUSE-TAIL" data-references="ACCUMULATE-RW-CACHE,*NIL*,IF,ADD-LITERAL,1+,CDR,EQUAL,DUMB-NEGATE-LIT,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,ERASE-RW-CACHE,EQ,*DEFAULT-STEP-LIMIT*,REWRITE-ATM,PSTK,?FTTREE1,TTREE1,VAL,?STEP-LIMIT,RW-CACHE-STATE,CONS-TAG-TREES,*T*,LIST,WHEN,REWRITE-CLAUSE-TYPE-ALIST,CURRENT-CLAUSE,TTREE0,TYPE-ALIST,CONTRADICTIONP,CURRENT-LITERAL,MAKE,CHANGE,LOCAL-RCNST,REWRITE-CONSTANT,ACCESS,CONS,NEW-PTS,CAR,STRIP-NOT,ATM,NOT-FLG,B*,T,FLATTEN-ORS-IN-LIT-LST,MV,NULL,COND,STATE,TTREE,RCNST,POT-LST,WRLD,FC-PAIR-LST,NEW-CLAUSE,GSTACK,BKPTR,PTS,TAIL,DEFUN" data-used-by="REWRITE$-CLAUSE*" data-part-name="REWRITE$-CLAUSE-TAIL" data-part-args="STATE,TTREE,RCNST,POT-LST,WRLD,FC-PAIR-LST,NEW-CLAUSE,GSTACK,BKPTR,PTS,TAIL" data-part-body="ACCUMULATE-RW-CACHE,*NIL*,IF,ADD-LITERAL,1+,CDR,REWRITE$-CLAUSE-TAIL,EQUAL,DUMB-NEGATE-LIT,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,ERASE-RW-CACHE,EQ,*DEFAULT-STEP-LIMIT*,STATE,GSTACK,BKPTR,REWRITE-ATM,PSTK,?FTTREE1,TTREE1,VAL,?STEP-LIMIT,RW-CACHE-STATE,CONS-TAG-TREES,*T*,LIST,WHEN,POT-LST,WRLD,FC-PAIR-LST,REWRITE-CLAUSE-TYPE-ALIST,CURRENT-CLAUSE,TTREE0,TYPE-ALIST,CONTRADICTIONP,CURRENT-LITERAL,MAKE,CHANGE,LOCAL-RCNST,RCNST,REWRITE-CONSTANT,ACCESS,PTS,CONS,NEW-PTS,CAR,STRIP-NOT,ATM,NOT-FLG,B*,T,TTREE,NEW-CLAUSE,FLATTEN-ORS-IN-LIT-LST,MV,TAIL,NULL,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CLAUSE-TAIL">rewrite$-clause-tail</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-clause-tail" data-sym="REWRITE$-CLAUSE-TAIL" title="(defun rewrite$-clause-tail
       (tail pts bkptr gstack new-clause fc-pair-lst wrld pot-lst rcnst ttree
        state)
  (cond ((null tail) (mv nil (flatten-ors-in-lit-lst new-clause) ttree))
        (t
...">rewrite$-clause-tail</a>
  (tail pts
    bkptr
    gstack
    new-clause
    fc-pair-lst
    wrld
    pot-lst
    rcnst
    ttree
    state)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> tail) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> nil (<a class="sym-link local-def" href="#def-flatten-ors-in-lit-lst" data-sym="FLATTEN-ORS-IN-LIT-LST" title="(defun flatten-ors-in-lit-lst (x)
  (if (endp x)
      nil
      (append (flatten-ors-in-lit (car x)) (flatten-ors-in-lit-lst (cdr x)))))">flatten-ors-in-lit-lst</a> new-clause) ttree))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> not-flg atm) (<a class="sym-link system" href="../../basis-b.html#def-strip-not" data-sym="STRIP-NOT">strip-not</a> (car tail))) (new-pts (cons (car pts) (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:pt</span>)))
          (local-rcnst (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite-constant
              rcnst
              <span class="keyword">:current-literal</span> (<a class="sym-link system" href="../../basis-a.html#def-make" data-sym="MAKE">make</a> current-literal <span class="keyword">:not-flg</span> not-flg <span class="keyword">:atm</span> atm)
              <span class="keyword">:pt</span> new-pts))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> contradictionp type-alist ttree0 current-clause) (rewrite-clause-type-alist tail
              new-clause
              fc-pair-lst
              local-rcnst
              wrld
              pot-lst))
          ((when contradictionp) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> nil (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <a class="sym-link system" href="../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>) (cons-tag-trees ttree0 ttree)))
          (rw-cache-state (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:rw-cache-state</span>))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit val ttree1 ?fttree1) (<a class="sym-link system" href="../../basis-b.html#def-pstk" data-sym="PSTK">pstk</a> (rewrite-atm atm
                not-flg
                bkptr
                gstack
                type-alist
                wrld
                pot-lst
                local-rcnst
                current-clause
                state
                <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>
                (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> rw-cache-state <span class="keyword">:atom</span>) (<a class="sym-link system" href="../../rewrite.html#def-erase-rw-cache" data-sym="ERASE-RW-CACHE">erase-rw-cache</a> ttree))
                  (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ttree)))))
          (ttree1 (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> rw-cache-state <span class="keyword">:atom</span>) (<a class="sym-link system" href="../../rewrite.html#def-erase-rw-cache" data-sym="ERASE-RW-CACHE">erase-rw-cache</a> ttree1))
              (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ttree1)))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit bad-ass ttree1) (resume-suspended-assumption-rewriting ttree1
              nil
              gstack
              pot-lst
              local-rcnst
              wrld
              state
              <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>))
          (val (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (bad-ass (car tail))
              (not-flg (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit" data-sym="DUMB-NEGATE-LIT">dumb-negate-lit</a> val))
              (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> val)))
          ((when (equal val <a class="sym-link system" href="../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>)) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="string">"by rewriting a negated hypothesis, ~x0, to T"</span>
              (car tail)
              nil)))
        (<a class="sym-link local-def" href="#def-rewrite_24-clause-tail" data-sym="REWRITE$-CLAUSE-TAIL" title="(defun rewrite$-clause-tail
       (tail pts bkptr gstack new-clause fc-pair-lst wrld pot-lst rcnst ttree
        state)
  (cond ((null tail) (mv nil (flatten-ors-in-lit-lst new-clause) ttree))
        (t
...">rewrite$-clause-tail</a> (cdr tail)
          (cdr pts)
          (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> bkptr)
          gstack
          (add-literal val new-clause <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
          fc-pair-lst
          wrld
          pot-lst
          (if (equal val <a class="sym-link system" href="../../axioms.html#def-_2Anil_2A" data-sym="*NIL*">*nil*</a>)
            local-rcnst
            rcnst)
          (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (bad-ass ttree)
            ((<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> rw-cache-state <span class="keyword">:atom</span>) ttree1)
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../rewrite.html#def-accumulate-rw-cache" data-sym="ACCUMULATE-RW-CACHE">accumulate-rw-cache</a> <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> ttree1 ttree)))
          state)))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-clause_2A" data-defines="REWRITE$-CLAUSE*" data-references="COND,*DEFAULT-STEP-LIMIT*,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,?STEP-LIMIT,REWRITE-CONSTANT,CHANGE,PROOFS-CO,CONS,LIST,FMS,PROVE,IO?,INT=,REWRITE$-SETUP,NEW-FC-PAIR-LST,NEW-POT-LST,?TYPE-ALIST,1+,LIST*,VALUE,EQUAL,MSG,T,UNTRANSLATE-LST,IF,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,SOFT,ER,DUMB-NEGATE-LIT-LST,CL,TERM,LET,WHEN,ENUMERATE-ELEMENTS,REWRITE$-CLAUSE-TAIL,NEW-TTREE,NEW-CLAUSE,STR,MV,B*,STATE,WRLD,CTX,UNTRANSLATE,POT-LST,FC-PAIR-LST,TTREE,GSTACK,RCNST,COMPLETED-ITERS,REPEAT-LIMIT,CLAUSE,DEFUN" data-used-by="REWRITE$-HYPS-MAIN" data-part-name="REWRITE$-CLAUSE*" data-part-args="STATE,WRLD,CTX,UNTRANSLATE,POT-LST,FC-PAIR-LST,TTREE,GSTACK,RCNST,COMPLETED-ITERS,REPEAT-LIMIT,CLAUSE" data-part-body="REWRITE$-CLAUSE*,COND,*DEFAULT-STEP-LIMIT*,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,?STEP-LIMIT,REWRITE-CONSTANT,CHANGE,PROOFS-CO,CONS,LIST,FMS,PROVE,IO?,REPEAT-LIMIT,INT=,REWRITE$-SETUP,NEW-FC-PAIR-LST,NEW-POT-LST,?TYPE-ALIST,1+,COMPLETED-ITERS,LIST*,VALUE,EQUAL,MSG,T,UNTRANSLATE-LST,UNTRANSLATE,IF,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,CTX,SOFT,ER,DUMB-NEGATE-LIT-LST,CL,TERM,LET,WHEN,STATE,TTREE,RCNST,POT-LST,WRLD,FC-PAIR-LST,GSTACK,ENUMERATE-ELEMENTS,CLAUSE,REWRITE$-CLAUSE-TAIL,NEW-TTREE,NEW-CLAUSE,STR,MV,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CLAUSE*">rewrite$-clause*</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-clause_2A" data-sym="REWRITE$-CLAUSE*" title="(defun rewrite$-clause*
       (clause repeat-limit completed-iters rcnst gstack ttree fc-pair-lst
        pot-lst untranslate ctx wrld state)
  (b*
   (((mv str new-clause new-ttree)
...">rewrite$-clause*</a>
  (clause repeat-limit
    completed-iters
    rcnst
    gstack
    ttree
    fc-pair-lst
    pot-lst
    untranslate
    ctx
    wrld
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> str new-clause new-ttree) (<a class="sym-link local-def" href="#def-rewrite_24-clause-tail" data-sym="REWRITE$-CLAUSE-TAIL" title="(defun rewrite$-clause-tail
       (tail pts bkptr gstack new-clause fc-pair-lst wrld pot-lst rcnst ttree
        state)
  (cond ((null tail) (mv nil (flatten-ors-in-lit-lst new-clause) ttree))
        (t
...">rewrite$-clause-tail</a> clause
         (enumerate-elements clause <span class="number">0</span>)
         <span class="number">1</span>
         gstack
         nil
         fc-pair-lst
         wrld
         pot-lst
         rcnst
         ttree
         state)) ((when str) (let ((term new-clause) (cl (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> clause)))
          (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
            ctx
            <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
            (if untranslate
              (untranslate-lst cl <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> wrld)
              cl)
            (<a class="sym-link system" href="../../axioms.html#def-msg" data-sym="MSG">msg</a> str
              (if untranslate
                (untranslate term <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> wrld)
                term)))))
      ((when (equal clause new-clause)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> clause ttree)))
      (completed-iters (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> ?type-alist new-pot-lst new-fc-pair-lst)) (<a class="sym-link local-def" href="#def-rewrite_24-setup" data-sym="REWRITE$-SETUP" title="(defun rewrite$-setup (hyps-clause rcnst untranslate ctx wrld state)
  (b*
   (((when (null hyps-clause)) (value (list* nil nil)))
    (pts (enumerate-elements hyps-clause 0))
    ((mv contradictionp type-alist fc-pair-lst)
...">rewrite$-setup</a> new-clause rcnst untranslate ctx wrld state))
      ((when (<a class="sym-link system" href="../../axioms.html#def-int_3D" data-sym="INT=">int=</a> repeat-limit completed-iters)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> new-clause new-ttree)))
      (state (<a class="sym-link system" href="../../basis-a.html#def-io_3F" data-sym="IO?">io?</a> <a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a>
          nil
          state
          (completed-iters)
          (<a class="sym-link system" href="../../basis-a.html#def-fms" data-sym="FMS">fms</a> <span class="string">"NOTE:  Starting ~n0 iteration for rewrite$-hyps.~%"</span>
            (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (cons #\0 (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))))
            (<a class="sym-link system" href="../../basis-b.html#def-proofs-co" data-sym="PROOFS-CO">proofs-co</a> state)
            state
            nil)))
      (rcnst (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite-constant rcnst <span class="keyword">:current-clause</span> new-clause))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> ?step-limit bad-ass new-ttree) (resume-suspended-assumption-rewriting new-ttree
          nil
          gstack
          pot-lst
          rcnst
          wrld
          state
          <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>))
      ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> fc-pair-lst pot-lst) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (bad-ass (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> fc-pair-lst pot-lst))
          (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> new-fc-pair-lst new-pot-lst)))))
    (<a class="sym-link local-def" href="#def-rewrite_24-clause_2A" data-sym="REWRITE$-CLAUSE*" title="(defun rewrite$-clause*
       (clause repeat-limit completed-iters rcnst gstack ttree fc-pair-lst
        pot-lst untranslate ctx wrld state)
  (b*
   (((mv str new-clause new-ttree)
...">rewrite$-clause*</a> new-clause
      repeat-limit
      completed-iters
      rcnst
      gstack
      new-ttree
      fc-pair-lst
      pot-lst
      untranslate
      ctx
      wrld
      state)))</pre>
  </div>

<div class="form-block function" id="def-update-rrec" data-defines="UPDATE-RREC" data-references="VALUE,REWRITE$-SETUP,FC-PAIR-LST,POT-LST,TYPE-ALIST,LIST*,ER,REWRITE$-RECORD,ACCESS,REWRITE-CONSTANT,CHANGE,RCNST,T,*REWRITE$-LAST-LITERAL*,ADD-LITERAL,CLAUSE,B*,STATE,WRLD,CTX,UNTRANSLATE,HYPS-CLAUSE,RREC,DEFUN" data-used-by="REWRITE$-HYPS,REWRITE$-HYPS-MAIN,REWRITE$-HYPS-RETURN" data-part-name="UPDATE-RREC" data-part-args="STATE,WRLD,CTX,UNTRANSLATE,HYPS-CLAUSE,RREC" data-part-body="VALUE,STATE,WRLD,CTX,UNTRANSLATE,REWRITE$-SETUP,FC-PAIR-LST,POT-LST,TYPE-ALIST,LIST*,ER,RREC,REWRITE$-RECORD,ACCESS,REWRITE-CONSTANT,CHANGE,RCNST,T,HYPS-CLAUSE,*REWRITE$-LAST-LITERAL*,ADD-LITERAL,CLAUSE,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="UPDATE-RREC">update-rrec</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>
  (rrec hyps-clause untranslate ctx wrld state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> ((clause (add-literal <a class="sym-link local-def" href="#def-_2Arewrite_24-last-literal_2A" data-sym="*REWRITE$-LAST-LITERAL*" title="(defconst *rewrite$-last-literal* (fcons-term* &#39;rewrite$-last-literal-fn))">*rewrite$-last-literal*</a> hyps-clause <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)) (rcnst (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite-constant
          (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>)
          <span class="keyword">:current-clause</span> clause))
      ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> type-alist pot-lst fc-pair-lst)) (<a class="sym-link local-def" href="#def-rewrite_24-setup" data-sym="REWRITE$-SETUP" title="(defun rewrite$-setup (hyps-clause rcnst untranslate ctx wrld state)
  (b*
   (((when (null hyps-clause)) (value (list* nil nil)))
    (pts (enumerate-elements hyps-clause 0))
    ((mv contradictionp type-alist fc-pair-lst)
...">rewrite$-setup</a> hyps-clause
          rcnst
          untranslate
          ctx
          wrld
          state)))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite$-record
        rrec
        <span class="keyword">:rcnst</span> rcnst
        <span class="keyword">:type-alist</span> type-alist
        <span class="keyword">:fc-pair-lst</span> fc-pair-lst
        <span class="keyword">:pot-lst</span> pot-lst))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-hyps-return" data-defines="REWRITE$-HYPS-RETURN" data-references="DUMB-NEGATE-LIT-LST,LIST*,T,VALUE,NOT,COND,ER,B*,STATE,WRLD,CTX,UNTRANSLATE,PAIRS,TTREE,RREC,UPDATE-RREC,CLAUSE,DEFUN" data-used-by="REWRITE$-HYPS-MAIN" data-part-name="REWRITE$-HYPS-RETURN" data-part-args="STATE,WRLD,CTX,UNTRANSLATE,PAIRS,TTREE,RREC,UPDATE-RREC,CLAUSE" data-part-body="PAIRS,TTREE,DUMB-NEGATE-LIT-LST,LIST*,STATE,WRLD,CTX,UNTRANSLATE,CLAUSE,T,VALUE,UPDATE-RREC,NOT,COND,RREC,ER,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-HYPS-RETURN">rewrite$-hyps-return</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-hyps-return" data-sym="REWRITE$-HYPS-RETURN" title="(defun rewrite$-hyps-return
       (clause update-rrec rrec ttree pairs untranslate ctx wrld state)
  (b*
   (((er rrec)
     (cond ((not update-rrec) (value rrec))
...">rewrite$-hyps-return</a>
  (clause <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>
    rrec
    ttree
    pairs
    untranslate
    ctx
    wrld
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> rrec) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> rrec))
         (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a> rrec clause untranslate ctx wrld state)))))
    (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> clause) rrec ttree pairs))))</pre>
  </div>

<div class="form-block macro" id="def-rewrite_24-translate-hints" data-defines="REWRITE$-TRANSLATE-HINTS" data-references="REWRITE$-TRANSLATE-HINTS-FN,QUASIQUOTE,STATE,W,QUOTE,WRLD,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,&KEY,CTX,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-TRANSLATE-HINTS">rewrite$-translate-hints</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-rewrite_24-translate-hints" data-sym="REWRITE$-TRANSLATE-HINTS" title="(defmacro rewrite$-translate-hints
          (ctx
           &amp;key backchain-limit-rw expand hands-off in-theory no-thanks
           nonlinearp restrict rw-cache-state default-hints-p
           (wrld &#39;(w state)))
...">rewrite$-translate-hints</a>
  (ctx &amp;key
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    default-hints-p
    (wrld '(<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
  `(<a class="sym-link local-def" href="#def-rewrite_24-translate-hints-fn" data-sym="REWRITE$-TRANSLATE-HINTS-FN" title="(defun rewrite$-translate-hints-fn
       (backchain-limit-rw expand hands-off in-theory no-thanks nonlinearp
        restrict rw-cache-state default-hints-p ctx wrld state)
  (b*
   ((kwd-alist
...">rewrite$-translate-hints-fn</a> ctx
    ,BACKCHAIN-LIMIT-RW
    ,EXPAND
    ,HANDS-OFF
    ,IN-THEORY
    ,NO-THANKS
    ,NONLINEARP
    ,RESTRICT
    ,RW-CACHE-STATE
    ,DEFAULT-HINTS-P
    ,CTX
    ,WRLD
    state))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-hyps-main" data-defines="REWRITE$-HYPS-MAIN" data-references="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,PROVE-SPEC-VAR,CHANGE,PROVE,VAL,ERP,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,EQ,REWRITE$-HYPS-RETURN,NOT,NULL,WHEN,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,DUMB-NEGATE-LIT-LST,REWRITE$-CLAUSE*,TTREE,CLAUSE,LIST*,SAVED-PSPV,POT-LST,FC-PAIR-LST,GSTACK,REWRITE$-RECORD,ACCESS,RCNST,MAKE-RREC,RREC,REWRITE$-TRANSLATE-HINTS-FN,T,VALUE,QUASIQUOTE,SOFT,OR,AND,COND,REWRITE$-TRANSLATE-LST,THYPS,CHK-REPEAT,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE,STATE,WRLD,CTX,REPEAT-LIMIT,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,UPDATE-RREC,DEFAULT-HINTS-P-P,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,THINTS,HYPS,DEFUN" data-used-by="REWRITE$-HYPS" data-part-name="REWRITE$-HYPS-MAIN" data-part-args="STATE,WRLD,CTX,REPEAT-LIMIT,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,UPDATE-RREC,DEFAULT-HINTS-P-P,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,THINTS,HYPS" data-part-body="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,PROVE-SPEC-VAR,CHANGE,PROVE,VAL,ERP,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,EQ,UPDATE-RREC,REWRITE$-HYPS-RETURN,PROVE-FORCED-ASSUMPTIONS,NOT,NULL,WHEN,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,DUMB-NEGATE-LIT-LST,REWRITE$-CLAUSE*,TTREE,CLAUSE,LIST*,SAVED-PSPV,POT-LST,FC-PAIR-LST,GSTACK,REWRITE$-RECORD,ACCESS,RCNST,UNTRANSLATE,MAKE-RREC,RREC,DEFAULT-HINTS-P,REWRITE$-TRANSLATE-HINTS-FN,T,VALUE,QUASIQUOTE,SOFT,DEFAULT-HINTS-P-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,OR,AND,COND,THINTS,WRLD,TRANSLATE,HYPS,REWRITE$-TRANSLATE-LST,THYPS,STATE,CTX,REPEAT-LIMIT,CHK-REPEAT,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-HYPS-MAIN">rewrite$-hyps-main</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-hyps-main" data-sym="REWRITE$-HYPS-MAIN" title="(defun rewrite$-hyps-main
       (hyps thints backchain-limit-rw expand hands-off in-theory no-thanks
        nonlinearp restrict rw-cache-state default-hints-p default-hints-p-p
        update-rrec prove-forced-assumptions translate untranslate repeat-limit
        ctx wrld state)
...">rewrite$-hyps-main</a>
  (hyps thints
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    default-hints-p
    default-hints-p-p
    <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>
    prove-forced-assumptions
    translate
    untranslate
    repeat-limit
    ctx
    wrld
    state)
  (<a class="sym-link system" href="../../axioms.html#def-with-guard-checking-error-triple" data-sym="WITH-GUARD-CHECKING-ERROR-TRIPLE">with-guard-checking-error-triple</a> nil
    (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> ?) (<a class="sym-link local-def" href="#def-chk-repeat" data-sym="CHK-REPEAT" title="(defun chk-repeat (repeat ctx state)
  (cond ((posp repeat) (value nil))
        (t
         (er soft ctx
             &quot;The :REPEAT argument must be a positive integer; ~x0 is thus ~
...">chk-repeat</a> repeat-limit ctx state)) ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> thyps) (<a class="sym-link local-def" href="#def-rewrite_24-translate-lst" data-sym="REWRITE$-TRANSLATE-LST" title="(defun rewrite$-translate-lst (lst translate ctx wrld state)
  (cond ((null lst) (value nil))
        ((not (true-listp lst)) (er soft ctx &quot;Not a true-list:~|~x0.&quot; lst))
        (translate (translate-term-lst lst t t t ctx wrld state))
        (t
...">rewrite$-translate-lst</a> hyps translate ctx wrld state))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> thints) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-and" data-sym="AND">and</a> thints
               (<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> backchain-limit-rw
                 expand
                 hands-off
                 <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
                 no-thanks
                 nonlinearp
                 restrict
                 rw-cache-state
                 default-hints-p-p)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <span class="string">"It is illegal to supply keyword :THINTS to rewrite$-hyps if ~
                any individual hints keywords are supplied, in this case: ~&amp;0."</span>
                `(,@(AND BACKCHAIN-LIMIT-RW &#39;(:BACKCHAIN-LIMIT-RW)) ,@(AND EXPAND &#39;(:EXPAND))
                  ,@(AND HANDS-OFF &#39;(:HANDS-OFF))
                  ,@(AND IN-THEORY &#39;(:IN-THEORY))
                  ,@(AND NO-THANKS &#39;(:NO-THANKS))
                  ,@(AND NONLINEARP &#39;(:NONLINEARP))
                  ,@(AND RESTRICT &#39;(:RESTRICT))
                  ,@(AND RW-CACHE-STATE &#39;(:RW-CACHE-STATE))
                  ,@(AND DEFAULT-HINTS-P-P &#39;(:DEFAULT-HINTS-P-P)))))
            (thints (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> thints))
            (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-rewrite_24-translate-hints-fn" data-sym="REWRITE$-TRANSLATE-HINTS-FN" title="(defun rewrite$-translate-hints-fn
       (backchain-limit-rw expand hands-off in-theory no-thanks nonlinearp
        restrict rw-cache-state default-hints-p ctx wrld state)
  (b*
   ((kwd-alist
...">rewrite$-translate-hints-fn</a> backchain-limit-rw
                expand
                hands-off
                <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
                no-thanks
                nonlinearp
                restrict
                rw-cache-state
                default-hints-p
                ctx
                wrld
                state))))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> rrec) (<a class="sym-link local-def" href="#def-make-rrec" data-sym="MAKE-RREC" title="(defun make-rrec (thyps thints untranslate ctx wrld state)
  (b*
   ((saved-pspv (rewrite$-pspv thints wrld state))
    (hyps-clause (dumb-negate-lit-lst thyps))
    (clause (add-literal *rewrite$-last-literal* hyps-clause t))
...">make-rrec</a> thyps thints untranslate ctx wrld state))
        (rcnst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>))
        (gstack (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:gstack</span>))
        (fc-pair-lst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:fc-pair-lst</span>))
        (pot-lst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:pot-lst</span>))
        (saved-pspv (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> clause ttree)) (<a class="sym-link local-def" href="#def-rewrite_24-clause_2A" data-sym="REWRITE$-CLAUSE*" title="(defun rewrite$-clause*
       (clause repeat-limit completed-iters rcnst gstack ttree fc-pair-lst
        pot-lst untranslate ctx wrld state)
  (b*
   (((mv str new-clause new-ttree)
...">rewrite$-clause*</a> (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit-lst" data-sym="DUMB-NEGATE-LIT-LST">dumb-negate-lit-lst</a> thyps)
            repeat-limit
            <span class="number">0</span>
            rcnst
            gstack
            nil
            fc-pair-lst
            pot-lst
            untranslate
            ctx
            wrld
            state))
        (ttree (<a class="sym-link system" href="../../prove.html#def-set-cl-ids-of-assumptions" data-sym="SET-CL-IDS-OF-ASSUMPTIONS">set-cl-ids-of-assumptions</a> ttree *initial-clause-id*))
        ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> n0 assns pairs ttree) (<a class="sym-link system" href="../../prove.html#def-extract-and-clausify-assumptions" data-sym="EXTRACT-AND-CLAUSIFY-ASSUMPTIONS">extract-and-clausify-assumptions</a> nil
            ttree
            nil
            (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>)
            wrld
            (<a class="sym-link system" href="../../prove.html#def-splitter-output" data-sym="SPLITTER-OUTPUT">splitter-output</a>)))
        ((when (<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> pairs) (<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> prove-forced-assumptions))) (<a class="sym-link local-def" href="#def-rewrite_24-hyps-return" data-sym="REWRITE$-HYPS-RETURN" title="(defun rewrite$-hyps-return
       (clause update-rrec rrec ttree pairs untranslate ctx wrld state)
  (b*
   (((er rrec)
     (cond ((not update-rrec) (value rrec))
...">rewrite$-hyps-return</a> clause
            <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>
            rrec
            ttree
            pairs
            untranslate
            ctx
            wrld
            state))
        ((when (<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> prove-forced-assumptions <span class="keyword">:none-forced</span>)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
            ctx
            <span class="string">"There were forced assumptions from simplifying hypotheses, ~
              which is not allowed in this context."</span>))
        (clause-set (<a class="sym-link system" href="../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> pairs))
        (forced-goal (termify-clause-set clause-set))
        (state (<a class="sym-link local-def" href="#def-rewrite_24-process-assumptions-msg" data-sym="REWRITE$-PROCESS-ASSUMPTIONS-MSG" title="(defun rewrite$-process-assumptions-msg
       (n0 pairs untranslate clause-set forced-goal wrld state)
  (io? prove nil state (n0 pairs untranslate clause-set forced-goal wrld)
       (fms &quot;~@0Rewriting is complete for the input term, but ~
             it remains to prove the goal generated by cleaning up ~n1 forced ~
...">rewrite$-process-assumptions-msg</a> n0
            pairs
            untranslate
            clause-set
            forced-goal
            wrld
            state))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> forced-assumptions-hints) (<a class="sym-link local-def" href="#def-rewrite_24-forced-assumptions-hints" data-sym="REWRITE$-FORCED-ASSUMPTIONS-HINTS" title="(defun rewrite$-forced-assumptions-hints
       (prove-forced-assumptions thints ctx wrld state)
  (cond
   ((consp prove-forced-assumptions)
    (translate-hints &#39;rewrite$ prove-forced-assumptions ctx wrld state))
...">rewrite$-forced-assumptions-hints</a> prove-forced-assumptions
            thints
            ctx
            wrld
            state))
        ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> erp val state) (<a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a> forced-goal
            (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> prove-spec-var
              saved-pspv
              <span class="keyword">:user-supplied-term</span> forced-goal)
            forced-assumptions-hints
            (ens state)
            wrld
            ctx
            state))
        ((when erp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
            ctx
            <span class="string">"Rewriting of hypotheses has failed because of failure to prove ~
              all of the assumptions forced during the rewriting.  Either ~
              disable forcing (see :DOC disable-forcing) or, if you are ~
              willing to ignore the forced assumptions, specify option ~
              :PROVE-FORCED-ASSUMPTIONS NIL for rewrite$-hyps."</span>))
        (ttree (<a class="sym-link system" href="../../prove.html#def-process-assumptions-ttree" data-sym="PROCESS-ASSUMPTIONS-TTREE">process-assumptions-ttree</a> assns ttree)))
      (<a class="sym-link local-def" href="#def-rewrite_24-hyps-return" data-sym="REWRITE$-HYPS-RETURN" title="(defun rewrite$-hyps-return
       (clause update-rrec rrec ttree pairs untranslate ctx wrld state)
  (b*
   (((er rrec)
     (cond ((not update-rrec) (value rrec))
...">rewrite$-hyps-return</a> clause
        <a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a>
        rrec
        (cons-tag-trees val ttree)
        pairs
        untranslate
        ctx
        wrld
        state))))</pre>
  </div>

<div class="form-block macro" id="def-rewrite_24-hyps" data-defines="REWRITE$-HYPS" data-references="REWRITE$-HYPS-MAIN,QUASIQUOTE,STATE,W,WRLD,CTX,REPEAT,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,UPDATE-RREC,DEFAULT-HINTS-P-P,T,QUOTE,DEFAULT-HINTS-P,RW-CACHE-STATE,RESTRICT,NONLINEARP,NO-THANKS,IN-THEORY,HANDS-OFF,EXPAND,BACKCHAIN-LIMIT-RW,THINTS,&KEY,HYPS,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-HYPS">rewrite$-hyps</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-rewrite_24-hyps" data-sym="REWRITE$-HYPS" title="(defmacro rewrite$-hyps
          (hyps
           &amp;key thints backchain-limit-rw expand hands-off in-theory no-thanks
           nonlinearp restrict rw-cache-state
           (default-hints-p &#39;t default-hints-p-p) (update-rrec &#39;t)
...">rewrite$-hyps</a>
  (hyps &amp;key
    thints
    backchain-limit-rw
    expand
    hands-off
    <a class="sym-link system" href="../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a>
    no-thanks
    nonlinearp
    restrict
    rw-cache-state
    (default-hints-p '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> default-hints-p-p)
    (<a class="sym-link local-def" href="#def-update-rrec" data-sym="UPDATE-RREC" title="(defun update-rrec (rrec hyps-clause untranslate ctx wrld state)
  (b*
   ((clause (add-literal *rewrite$-last-literal* hyps-clause t))
    (rcnst
     (change rewrite-constant (access rewrite$-record rrec :rcnst)
...">update-rrec</a> '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
    (prove-forced-assumptions '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
    translate
    untranslate
    (repeat '<span class="number">1</span>)
    (ctx ''<a class="sym-link local-def" href="#def-rewrite_24-hyps" data-sym="REWRITE$-HYPS" title="(defmacro rewrite$-hyps
          (hyps
           &amp;key thints backchain-limit-rw expand hands-off in-theory no-thanks
           nonlinearp restrict rw-cache-state
           (default-hints-p &#39;t default-hints-p-p) (update-rrec &#39;t)
...">rewrite$-hyps</a>)
    (wrld '(<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
  `(<a class="sym-link local-def" href="#def-rewrite_24-hyps-main" data-sym="REWRITE$-HYPS-MAIN" title="(defun rewrite$-hyps-main
       (hyps thints backchain-limit-rw expand hands-off in-theory no-thanks
        nonlinearp restrict rw-cache-state default-hints-p default-hints-p-p
        update-rrec prove-forced-assumptions translate untranslate repeat-limit
        ctx wrld state)
...">rewrite$-hyps-main</a> ,HYPS
    ,THINTS
    ,BACKCHAIN-LIMIT-RW
    ,EXPAND
    ,HANDS-OFF
    ,IN-THEORY
    ,NO-THANKS
    ,NONLINEARP
    ,RESTRICT
    ,RW-CACHE-STATE
    ,DEFAULT-HINTS-P
    ,DEFAULT-HINTS-P-P
    ,UPDATE-RREC
    ,PROVE-FORCED-ASSUMPTIONS
    ,TRANSLATE
    ,UNTRANSLATE
    ,REPEAT
    ,CTX
    ,WRLD
    state))</pre>
  </div>

<div class="form-block constant" id="def-_2Arewrite_24-false-context_2A" data-defines="*REWRITE$-FALSE-CONTEXT*" data-references="*NIL*,LIST,DEFCONST" data-used-by="REWRITE$-CONTEXT*" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*REWRITE$-FALSE-CONTEXT*">*rewrite$-false-context*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-false-context_2A" data-sym="*REWRITE$-FALSE-CONTEXT*" title="(defconst *rewrite$-false-context* (list *nil*))">*rewrite$-false-context*</a> (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> <a class="sym-link system" href="../../axioms.html#def-_2Anil_2A" data-sym="*NIL*">*nil*</a>))</pre>
  </div>

<div class="form-block constant" id="def-_2Arewrite_24-true-context_2A" data-defines="*REWRITE$-TRUE-CONTEXT*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*REWRITE$-TRUE-CONTEXT*">*rewrite$-true-context*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-true-context_2A" data-sym="*REWRITE$-TRUE-CONTEXT*" title="(defconst *rewrite$-true-context* nil)">*rewrite$-true-context*</a> nil)</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-context-tail" data-defines="REWRITE$-CONTEXT-TAIL" data-references="CONS,CONS-TAG-TREES,1+,CDR,WHEN,OK-TO-FORCE,ASSUME-TRUE-FALSE-BC,TS-TTREE,?FALSE-TYPE-ALIST,TRUE-TYPE-ALIST,MUST-BE-FALSE,MUST-BE-TRUE,ENS,DUMB-NEGATE-LIT,TERM,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,REWRITE-CONSTANT,ACCESS,*GENEQV-IFF*,?,QUOTE,REWRITE,REWRITE-ENTRY,TTREE1,VAL,CAR,STRIP-NOT,ATM,NOT-FLG,B*,T,REVERSE,MV,NULL,COND,ACC,TS-BACKCHAIN-LIMIT,STEP-LIMIT,STATE,TTREE,RCNST,POT-LST,WRLD,TYPE-ALIST,GSTACK,RDEPTH,BKPTR,TAIL,DEFUN" data-used-by="REWRITE$-CONTEXT*" data-part-name="REWRITE$-CONTEXT-TAIL" data-part-args="ACC,TS-BACKCHAIN-LIMIT,STEP-LIMIT,STATE,TTREE,RCNST,POT-LST,WRLD,TYPE-ALIST,GSTACK,RDEPTH,BKPTR,TAIL" data-part-body="CONS,CONS-TAG-TREES,1+,CDR,REWRITE$-CONTEXT-TAIL,WHEN,TS-BACKCHAIN-LIMIT,OK-TO-FORCE,ASSUME-TRUE-FALSE-BC,TS-TTREE,?FALSE-TYPE-ALIST,TRUE-TYPE-ALIST,MUST-BE-FALSE,MUST-BE-TRUE,ENS,DUMB-NEGATE-LIT,TERM,POT-LST,RESUME-SUSPENDED-ASSUMPTION-REWRITING,BAD-ASS,GSTACK,RCNST,REWRITE-CONSTANT,ACCESS,STATE,WRLD,*GENEQV-IFF*,?,QUOTE,RDEPTH,BKPTR,REWRITE,REWRITE-ENTRY,TTREE1,VAL,STEP-LIMIT,CAR,STRIP-NOT,ATM,NOT-FLG,B*,T,TTREE,TYPE-ALIST,ACC,REVERSE,MV,TAIL,NULL,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CONTEXT-TAIL">rewrite$-context-tail</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-context-tail" data-sym="REWRITE$-CONTEXT-TAIL" title="(defun rewrite$-context-tail
       (tail bkptr rdepth gstack type-alist wrld pot-lst rcnst ttree state
        step-limit ts-backchain-limit acc)
  (cond ((null tail) (mv nil (reverse acc) type-alist ttree))
        (t
...">rewrite$-context-tail</a>
  (tail bkptr
    rdepth
    gstack
    type-alist
    wrld
    pot-lst
    rcnst
    ttree
    state
    step-limit
    ts-backchain-limit
    acc)
  (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> tail) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> nil (<a class="sym-link system" href="../../axioms.html#def-reverse" data-sym="REVERSE">reverse</a> acc) type-alist ttree))
    (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> not-flg atm) (<a class="sym-link system" href="../../basis-b.html#def-strip-not" data-sym="STRIP-NOT">strip-not</a> (car tail))) ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> step-limit val ttree1) (<a class="sym-link system" href="../../rewrite.html#def-rewrite-entry" data-sym="REWRITE-ENTRY">rewrite-entry</a> (<a class="sym-link system" href="../../rewrite.html#def-rewrite" data-sym="REWRITE">rewrite</a> atm nil bkptr)
              <span class="keyword">:rdepth</span> rdepth
              <span class="keyword">:step-limit</span> step-limit
              <span class="keyword">:type-alist</span> type-alist
              <span class="keyword">:obj</span> '?
              <span class="keyword">:geneqv</span> <a class="sym-link system" href="../../rewrite.html#def-_2Ageneqv-iff_2A" data-sym="*GENEQV-IFF*">*geneqv-iff*</a>
              <span class="keyword">:pequiv-info</span> nil
              <span class="keyword">:wrld</span> wrld
              <span class="keyword">:state</span> state
              <span class="keyword">:fnstack</span> nil
              <span class="keyword">:ancestors</span> nil
              <span class="keyword">:backchain-limit</span> (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:backchain-limit-rw</span>)
              <span class="keyword">:simplify-clause-pot-lst</span> nil
              <span class="keyword">:rcnst</span> rcnst
              <span class="keyword">:gstack</span> gstack
              <span class="keyword">:ttree</span> ttree))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> step-limit bad-ass ttree1) (resume-suspended-assumption-rewriting ttree1
              nil
              gstack
              pot-lst
              rcnst
              wrld
              state
              step-limit))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> term ttree) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (bad-ass (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> (car tail) ttree))
              (not-flg (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../basis-b.html#def-dumb-negate-lit" data-sym="DUMB-NEGATE-LIT">dumb-negate-lit</a> val) ttree1))
              (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> val ttree1))))
          (ens (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>))
          ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> must-be-true
             must-be-false
             true-type-alist
             ?false-type-alist
             ts-ttree) (assume-true-false-bc term
              nil
              (<a class="sym-link system" href="../../rewrite.html#def-ok-to-force" data-sym="OK-TO-FORCE">ok-to-force</a> rcnst)
              nil
              type-alist
              ens
              wrld
              pot-lst
              nil
              <span class="keyword">:fta</span> ts-backchain-limit))
          ((when must-be-true) (<a class="sym-link local-def" href="#def-rewrite_24-context-tail" data-sym="REWRITE$-CONTEXT-TAIL" title="(defun rewrite$-context-tail
       (tail bkptr rdepth gstack type-alist wrld pot-lst rcnst ttree state
        step-limit ts-backchain-limit acc)
  (cond ((null tail) (mv nil (reverse acc) type-alist ttree))
        (t
...">rewrite$-context-tail</a> (cdr tail)
              (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> bkptr)
              rdepth
              gstack
              type-alist
              wrld
              pot-lst
              rcnst
              (cons-tag-trees ts-ttree ttree)
              state
              step-limit
              ts-backchain-limit
              acc))
          ((when must-be-false) (<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="string">"by rewriting a contextual test term, ~x0, to NIL"</span>
              (car tail)
              nil
              (cons-tag-trees ts-ttree ttree))))
        (<a class="sym-link local-def" href="#def-rewrite_24-context-tail" data-sym="REWRITE$-CONTEXT-TAIL" title="(defun rewrite$-context-tail
       (tail bkptr rdepth gstack type-alist wrld pot-lst rcnst ttree state
        step-limit ts-backchain-limit acc)
  (cond ((null tail) (mv nil (reverse acc) type-alist ttree))
        (t
...">rewrite$-context-tail</a> (cdr tail)
          (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> bkptr)
          rdepth
          gstack
          true-type-alist
          wrld
          pot-lst
          rcnst
          ttree
          state
          step-limit
          ts-backchain-limit
          (cons term acc))))))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-context_2A" data-defines="REWRITE$-CONTEXT*" data-references="PROOFS-CO,CONS,LIST,FMS,PROVE,IO?,FLATTEN-ANDS-IN-LIT-LST,INT=,1+,EQUAL,MSG,UNTRANSLATE-LST,IF,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,SOFT,ER,TERM,LET,T,*REWRITE$-FALSE-CONTEXT*,LIST*,VALUE,COND,WHEN,REWRITE$-CONTEXT-TAIL,NEW-TTREE,NEW-TYPE-ALIST,NEW-LST,STR,MV,B*,STATE,CTX,TS-BACKCHAIN-LIMIT,STEP-LIMIT,TTREE,UNTRANSLATE,CONTRADICTION-OK,RCNST,POT-LST,WRLD,TYPE-ALIST,GSTACK,RDEPTH,COMPLETED-ITERS,REPEAT-LIMIT,LST,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN" data-part-name="REWRITE$-CONTEXT*" data-part-args="STATE,CTX,TS-BACKCHAIN-LIMIT,STEP-LIMIT,TTREE,UNTRANSLATE,CONTRADICTION-OK,RCNST,POT-LST,WRLD,TYPE-ALIST,GSTACK,RDEPTH,COMPLETED-ITERS,REPEAT-LIMIT,LST" data-part-body="REWRITE$-CONTEXT*,PROOFS-CO,CONS,LIST,FMS,PROVE,IO?,FLATTEN-ANDS-IN-LIT-LST,REPEAT-LIMIT,INT=,1+,COMPLETED-ITERS,EQUAL,MSG,UNTRANSLATE-LST,UNTRANSLATE,IF,*SIMPLIFY$-HYPS-CONTRADICTION-STRING*,CTX,SOFT,ER,TERM,LET,T,*REWRITE$-FALSE-CONTEXT*,LIST*,VALUE,CONTRADICTION-OK,COND,WHEN,TS-BACKCHAIN-LIMIT,STEP-LIMIT,STATE,TTREE,RCNST,POT-LST,WRLD,TYPE-ALIST,GSTACK,RDEPTH,LST,REWRITE$-CONTEXT-TAIL,NEW-TTREE,NEW-TYPE-ALIST,NEW-LST,STR,MV,B*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CONTEXT*">rewrite$-context*</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-context_2A" data-sym="REWRITE$-CONTEXT*" title="(defun rewrite$-context*
       (lst repeat-limit completed-iters rdepth gstack type-alist wrld pot-lst
        rcnst contradiction-ok untranslate ttree step-limit ts-backchain-limit
        ctx state)
  (b*
...">rewrite$-context*</a>
  (lst repeat-limit
    completed-iters
    rdepth
    gstack
    type-alist
    wrld
    pot-lst
    rcnst
    contradiction-ok
    untranslate
    ttree
    step-limit
    ts-backchain-limit
    ctx
    state)
  (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> str new-lst new-type-alist new-ttree) (<a class="sym-link local-def" href="#def-rewrite_24-context-tail" data-sym="REWRITE$-CONTEXT-TAIL" title="(defun rewrite$-context-tail
       (tail bkptr rdepth gstack type-alist wrld pot-lst rcnst ttree state
        step-limit ts-backchain-limit acc)
  (cond ((null tail) (mv nil (reverse acc) type-alist ttree))
        (t
...">rewrite$-context-tail</a> lst
         <span class="number">1</span>
         rdepth
         gstack
         type-alist
         wrld
         pot-lst
         rcnst
         ttree
         state
         step-limit
         ts-backchain-limit
         nil)) ((when str) (<a class="sym-link system" href="../../axioms.html#def-cond" data-sym="COND">cond</a> (contradiction-ok (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> <a class="sym-link local-def" href="#def-_2Arewrite_24-false-context_2A" data-sym="*REWRITE$-FALSE-CONTEXT*" title="(defconst *rewrite$-false-context* (list *nil*))">*rewrite$-false-context*</a> new-type-alist new-ttree)))
          (<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> (let ((term new-lst))
              (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
                ctx
                <a class="sym-link local-def" href="#def-_2Asimplify_24-hyps-contradiction-string_2A" data-sym="*SIMPLIFY$-HYPS-CONTRADICTION-STRING*" title="(defconst *simplify$-hyps-contradiction-string*
          &quot;An attempt has been made to simplify the following ~
   hypotheses:~|~%~x0.~|~%However, that list is contradictory!  (Technical ~
   note: the contradiction was found ~@1.)&quot;)">*simplify$-hyps-contradiction-string*</a>
                (if untranslate
                  (untranslate-lst lst <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> wrld)
                  lst)
                (<a class="sym-link system" href="../../axioms.html#def-msg" data-sym="MSG">msg</a> str
                  (if untranslate
                    (untranslate term <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a> wrld)
                    term)))))))
      ((when (equal lst new-lst)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> lst new-type-alist ttree)))
      (completed-iters (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))
      ((when (<a class="sym-link system" href="../../axioms.html#def-int_3D" data-sym="INT=">int=</a> repeat-limit completed-iters)) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> (flatten-ands-in-lit-lst new-lst)
            new-type-alist
            new-ttree)))
      (state (<a class="sym-link system" href="../../basis-a.html#def-io_3F" data-sym="IO?">io?</a> <a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a>
          nil
          state
          (completed-iters)
          (<a class="sym-link system" href="../../basis-a.html#def-fms" data-sym="FMS">fms</a> <span class="string">"NOTE:  Starting ~n0 iteration for rewrite$-context.~%"</span>
            (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (cons #\0 (<a class="sym-link system" href="../../axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="../../axioms.html#def-1_2B" data-sym="1+">1+</a> completed-iters))))
            (<a class="sym-link system" href="../../basis-b.html#def-proofs-co" data-sym="PROOFS-CO">proofs-co</a> state)
            state
            nil))))
    (<a class="sym-link local-def" href="#def-rewrite_24-context_2A" data-sym="REWRITE$-CONTEXT*" title="(defun rewrite$-context*
       (lst repeat-limit completed-iters rdepth gstack type-alist wrld pot-lst
        rcnst contradiction-ok untranslate ttree step-limit ts-backchain-limit
        ctx state)
  (b*
...">rewrite$-context*</a> new-lst
      repeat-limit
      completed-iters
      rdepth
      gstack
      type-alist
      wrld
      pot-lst
      rcnst
      contradiction-ok
      untranslate
      new-ttree
      step-limit
      ts-backchain-limit
      ctx
      state)))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-context-return" data-defines="REWRITE$-CONTEXT-RETURN" data-references="REWRITE$-RECORD,CHANGE,LIST*,PAIRS,TTREE,RREC,TYPE-ALIST,LST,DEFUN" data-used-by="REWRITE$-CONTEXT-MAIN" data-part-name="REWRITE$-CONTEXT-RETURN" data-part-args="PAIRS,TTREE,RREC,TYPE-ALIST,LST" data-part-body="PAIRS,TTREE,TYPE-ALIST,RREC,REWRITE$-RECORD,CHANGE,LST,LIST*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CONTEXT-RETURN">rewrite$-context-return</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-context-return" data-sym="REWRITE$-CONTEXT-RETURN" title="(defun rewrite$-context-return (lst type-alist rrec ttree pairs)
  (list* lst (change rewrite$-record rrec :type-alist type-alist) ttree pairs))">rewrite$-context-return</a>
  (lst type-alist rrec ttree pairs)
  (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> lst
    (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> rewrite$-record rrec <span class="keyword">:type-alist</span> type-alist)
    ttree
    pairs))</pre>
  </div>

<div class="form-block function" id="def-rewrite_24-context-main" data-defines="REWRITE$-CONTEXT-MAIN" data-references="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,CHANGE,PROVE,VAL,ERP,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,PROVE-SPEC-VAR,THINTS,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,SOFT,EQ,REWRITE$-CONTEXT-RETURN,VALUE,NOT,NULL,OR,WHEN,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,BACKCHAIN-LIMIT,*DEFAULT-STEP-LIMIT*,REWRITE-STACK-LIMIT,REWRITE$-CONTEXT*,TTREE,LST2,LIST*,REWRITE$-TRANSLATE-LST,TLST,SAVED-PSPV,POT-LST,TYPE-ALIST,GSTACK,REWRITE$-RECORD,ACCESS,RCNST,CHK-REPEAT,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE,STATE,WRLD,CTX,REPEAT-LIMIT,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,CONTRADICTION-OK,RREC,LST,DEFUN" data-used-by="REWRITE$-CONTEXT" data-part-name="REWRITE$-CONTEXT-MAIN" data-part-args="STATE,WRLD,CTX,REPEAT-LIMIT,UNTRANSLATE,TRANSLATE,PROVE-FORCED-ASSUMPTIONS,CONTRADICTION-OK,RREC,LST" data-part-body="CONS-TAG-TREES,PROCESS-ASSUMPTIONS-TTREE,ENS,CHANGE,PROVE,VAL,ERP,REWRITE$-FORCED-ASSUMPTIONS-HINTS,FORCED-ASSUMPTIONS-HINTS,PROVE-SPEC-VAR,THINTS,REWRITE$-PROCESS-ASSUMPTIONS-MSG,TERMIFY-CLAUSE-SET,FORCED-GOAL,STRIP-CDRS,CLAUSE-SET,SOFT,EQ,REWRITE$-CONTEXT-RETURN,VALUE,PROVE-FORCED-ASSUMPTIONS,NOT,NULL,OR,WHEN,SPLITTER-OUTPUT,REWRITE-CONSTANT,EXTRACT-AND-CLAUSIFY-ASSUMPTIONS,PAIRS,ASSNS,N0,MV,*INITIAL-CLAUSE-ID*,SET-CL-IDS-OF-ASSUMPTIONS,BACKCHAIN-LIMIT,*DEFAULT-STEP-LIMIT*,UNTRANSLATE,CONTRADICTION-OK,REWRITE-STACK-LIMIT,REWRITE$-CONTEXT*,TTREE,LST2,LIST*,WRLD,TRANSLATE,LST,REWRITE$-TRANSLATE-LST,TLST,SAVED-PSPV,POT-LST,TYPE-ALIST,GSTACK,RREC,REWRITE$-RECORD,ACCESS,RCNST,STATE,CTX,REPEAT-LIMIT,CHK-REPEAT,?,ER,B*,WITH-GUARD-CHECKING-ERROR-TRIPLE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CONTEXT-MAIN">rewrite$-context-main</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-rewrite_24-context-main" data-sym="REWRITE$-CONTEXT-MAIN" title="(defun rewrite$-context-main
       (lst rrec contradiction-ok prove-forced-assumptions translate
        untranslate repeat-limit ctx wrld state)
  (with-guard-checking-error-triple nil
                                    (b*
...">rewrite$-context-main</a>
  (lst rrec
    contradiction-ok
    prove-forced-assumptions
    translate
    untranslate
    repeat-limit
    ctx
    wrld
    state)
  (<a class="sym-link system" href="../../axioms.html#def-with-guard-checking-error-triple" data-sym="WITH-GUARD-CHECKING-ERROR-TRIPLE">with-guard-checking-error-triple</a> nil
    (<a class="sym-link external" href="../std/util/bstar.html#def-b_2A" data-sym="B*">b*</a> (((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> ?) (<a class="sym-link local-def" href="#def-chk-repeat" data-sym="CHK-REPEAT" title="(defun chk-repeat (repeat ctx state)
  (cond ((posp repeat) (value nil))
        (t
         (er soft ctx
             &quot;The :REPEAT argument must be a positive integer; ~x0 is thus ~
...">chk-repeat</a> repeat-limit ctx state)) (rcnst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:rcnst</span>))
        (gstack (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:gstack</span>))
        (type-alist (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:type-alist</span>))
        (pot-lst (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:pot-lst</span>))
        (saved-pspv (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite$-record rrec <span class="keyword">:saved-pspv</span>))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> tlst) (<a class="sym-link local-def" href="#def-rewrite_24-translate-lst" data-sym="REWRITE$-TRANSLATE-LST" title="(defun rewrite$-translate-lst (lst translate ctx wrld state)
  (cond ((null lst) (value nil))
        ((not (true-listp lst)) (er soft ctx &quot;Not a true-list:~|~x0.&quot; lst))
        (translate (translate-term-lst lst t t t ctx wrld state))
        (t
...">rewrite$-translate-lst</a> lst translate ctx wrld state))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> lst2 type-alist ttree)) (<a class="sym-link local-def" href="#def-rewrite_24-context_2A" data-sym="REWRITE$-CONTEXT*" title="(defun rewrite$-context*
       (lst repeat-limit completed-iters rdepth gstack type-alist wrld pot-lst
        rcnst contradiction-ok untranslate ttree step-limit ts-backchain-limit
        ctx state)
  (b*
...">rewrite$-context*</a> tlst
            repeat-limit
            <span class="number">0</span>
            (<a class="sym-link system" href="../../axioms.html#def-rewrite-stack-limit" data-sym="REWRITE-STACK-LIMIT">rewrite-stack-limit</a> wrld)
            gstack
            type-alist
            wrld
            pot-lst
            rcnst
            contradiction-ok
            untranslate
            nil
            <a class="sym-link system" href="../../axioms.html#def-_2Adefault-step-limit_2A" data-sym="*DEFAULT-STEP-LIMIT*">*default-step-limit*</a>
            (<a class="sym-link system" href="../../axioms.html#def-backchain-limit" data-sym="BACKCHAIN-LIMIT">backchain-limit</a> wrld <span class="keyword">:ts</span>)
            ctx
            state))
        (ttree (<a class="sym-link system" href="../../prove.html#def-set-cl-ids-of-assumptions" data-sym="SET-CL-IDS-OF-ASSUMPTIONS">set-cl-ids-of-assumptions</a> ttree *initial-clause-id*))
        ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> n0 assns pairs ttree) (<a class="sym-link system" href="../../prove.html#def-extract-and-clausify-assumptions" data-sym="EXTRACT-AND-CLAUSIFY-ASSUMPTIONS">extract-and-clausify-assumptions</a> nil
            ttree
            nil
            (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> rewrite-constant rcnst <span class="keyword">:current-enabled-structure</span>)
            wrld
            (<a class="sym-link system" href="../../prove.html#def-splitter-output" data-sym="SPLITTER-OUTPUT">splitter-output</a>)))
        ((when (<a class="sym-link system" href="../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../axioms.html#def-null" data-sym="NULL">null</a> pairs) (<a class="sym-link system" href="../../axioms.html#def-not" data-sym="NOT">not</a> prove-forced-assumptions))) (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link local-def" href="#def-rewrite_24-context-return" data-sym="REWRITE$-CONTEXT-RETURN" title="(defun rewrite$-context-return (lst type-alist rrec ttree pairs)
  (list* lst (change rewrite$-record rrec :type-alist type-alist) ttree pairs))">rewrite$-context-return</a> lst2 type-alist rrec ttree pairs)))
        ((when (<a class="sym-link system" href="../../axioms.html#def-eq" data-sym="EQ">eq</a> prove-forced-assumptions <span class="keyword">:none-forced</span>)) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
            ctx
            <span class="string">"There were forced assumptions from simplifying the context, but ~
              proving of forced assumptions has been disabled for this call ~
              of rewrite$-context."</span>))
        (clause-set (<a class="sym-link system" href="../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> pairs))
        (forced-goal (termify-clause-set clause-set))
        (state (<a class="sym-link local-def" href="#def-rewrite_24-process-assumptions-msg" data-sym="REWRITE$-PROCESS-ASSUMPTIONS-MSG" title="(defun rewrite$-process-assumptions-msg
       (n0 pairs untranslate clause-set forced-goal wrld state)
  (io? prove nil state (n0 pairs untranslate clause-set forced-goal wrld)
       (fms &quot;~@0Rewriting is complete for the input term, but ~
             it remains to prove the goal generated by cleaning up ~n1 forced ~
...">rewrite$-process-assumptions-msg</a> n0
            pairs
            untranslate
            clause-set
            forced-goal
            wrld
            state))
        (thints (<a class="sym-link system" href="../../axioms.html#def-access" data-sym="ACCESS">access</a> prove-spec-var saved-pspv <span class="keyword">:orig-hints</span>))
        ((<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> forced-assumptions-hints) (<a class="sym-link local-def" href="#def-rewrite_24-forced-assumptions-hints" data-sym="REWRITE$-FORCED-ASSUMPTIONS-HINTS" title="(defun rewrite$-forced-assumptions-hints
       (prove-forced-assumptions thints ctx wrld state)
  (cond
   ((consp prove-forced-assumptions)
    (translate-hints &#39;rewrite$ prove-forced-assumptions ctx wrld state))
...">rewrite$-forced-assumptions-hints</a> prove-forced-assumptions
            thints
            ctx
            wrld
            state))
        ((<a class="sym-link system" href="../../axioms.html#def-mv" data-sym="MV">mv</a> erp val state) (<a class="sym-link system" href="../../prove.html#def-prove" data-sym="PROVE">prove</a> forced-goal
            (<a class="sym-link system" href="../../basis-a.html#def-change" data-sym="CHANGE">change</a> prove-spec-var
              saved-pspv
              <span class="keyword">:user-supplied-term</span> forced-goal)
            forced-assumptions-hints
            (ens state)
            wrld
            ctx
            state))
        ((when erp) (<a class="sym-link system" href="../../axioms.html#def-er" data-sym="ER">er</a> soft
            ctx
            <span class="string">"Rewriting of hypotheses has failed because of failure to prove ~
              all of the assumptions forced during the rewriting.  Either ~
              disable forcing (see :DOC disable-forcing) or, if you are ~
              willing to ignore the forced assumptions, specify option ~
              :PROVE-FORCED-ASSUMPTIONS NIL for rewrite$-context."</span>))
        (ttree (<a class="sym-link system" href="../../prove.html#def-process-assumptions-ttree" data-sym="PROCESS-ASSUMPTIONS-TTREE">process-assumptions-ttree</a> assns ttree)))
      (<a class="sym-link system" href="../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link local-def" href="#def-rewrite_24-context-return" data-sym="REWRITE$-CONTEXT-RETURN" title="(defun rewrite$-context-return (lst type-alist rrec ttree pairs)
  (list* lst (change rewrite$-record rrec :type-alist type-alist) ttree pairs))">rewrite$-context-return</a> lst2
          type-alist
          rrec
          (cons-tag-trees val ttree)
          pairs)))))</pre>
  </div>

<div class="form-block macro" id="def-rewrite_24-context" data-defines="REWRITE$-CONTEXT" data-references="REWRITE$-CONTEXT-MAIN,QUASIQUOTE,STATE,W,WRLD,CTX,REPEAT,UNTRANSLATE,TRANSLATE,T,QUOTE,PROVE-FORCED-ASSUMPTIONS,CONTRADICTION-OK,&KEY,RREC,LST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="REWRITE$-CONTEXT">rewrite$-context</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-rewrite_24-context" data-sym="REWRITE$-CONTEXT" title="(defmacro rewrite$-context
          (lst rrec
           &amp;key contradiction-ok (prove-forced-assumptions &#39;t) translate
           untranslate (repeat &#39;1) (ctx &#39;&#39;rewrite$-context) (wrld &#39;(w state)))
  `(rewrite$-context-main ,lst ,rrec ,contradiction-ok">rewrite$-context</a>
  (lst rrec
    &amp;key
    contradiction-ok
    (prove-forced-assumptions '<a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)
    translate
    untranslate
    (repeat '<span class="number">1</span>)
    (ctx ''<a class="sym-link local-def" href="#def-rewrite_24-context" data-sym="REWRITE$-CONTEXT" title="(defmacro rewrite$-context
          (lst rrec
           &amp;key contradiction-ok (prove-forced-assumptions &#39;t) translate
           untranslate (repeat &#39;1) (ctx &#39;&#39;rewrite$-context) (wrld &#39;(w state)))
  `(rewrite$-context-main ,lst ,rrec ,contradiction-ok">rewrite$-context</a>)
    (wrld '(<a class="sym-link system" href="../../axioms.html#def-w" data-sym="W">w</a> state)))
  `(<a class="sym-link local-def" href="#def-rewrite_24-context-main" data-sym="REWRITE$-CONTEXT-MAIN" title="(defun rewrite$-context-main
       (lst rrec contradiction-ok prove-forced-assumptions translate
        untranslate repeat-limit ctx wrld state)
  (with-guard-checking-error-triple nil
                                    (b*
...">rewrite$-context-main</a> ,LST
    ,RREC
    ,CONTRADICTION-OK
    ,PROVE-FORCED-ASSUMPTIONS
    ,TRANSLATE
    ,UNTRANSLATE
    ,REPEAT
    ,CTX
    ,WRLD
    state))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>