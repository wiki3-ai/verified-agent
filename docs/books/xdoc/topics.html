<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>topics - ACL2 Book</title>
  <meta property="name" content="topics">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">topics</h1>
    <div class="path"><a href="topics.lisp" class="source-link">books/xdoc/topics</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"XDOC"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="top.html" title="Open top">"top"</a>)</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc xdoc
  <span class="keyword">:parents</span> (documentation)
  <span class="keyword">:short</span> <span class="string">"&lt;i&gt;XDOC&lt;/i&gt; is a tool for documenting ACL2 books.  You can use it to
access documentation about ACL2 and its books, to document your own books, and
to create custom web-based manuals."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Below we cover how to use XDOC to build manuals or document your
own @(see acl2::books).  If you just want to browse the documentation, you
probably don&#39;t need to read any of this!  Instead, see @(see
documentation).&lt;/p&gt;

&lt;h3&gt;Starting Points&lt;/h3&gt;

&lt;p&gt;A good, tutorial-style introduction to XDOC can be found in:&lt;/p&gt;

&lt;blockquote&gt;
Jared Davis and Matt Kaufmann.  &lt;a
href=&#39;http://dx.doi.org/10.4204/EPTCS.152.2&#39;&gt;Industrial Strength Documentation
for ACL2&lt;/a&gt;.  ACL2 Workshop 2014.  EPTCS 152.  Pages 9-25.
&lt;/blockquote&gt;

&lt;p&gt;See &lt;i&gt;Building the Manual&lt;/i&gt; under @(see acl2::books-certification) for
information on building the ACL2+Books manual.  See @(see testing) for easy
instructions for how to test your XDOC strings.&lt;/p&gt;


&lt;p&gt;To use XDOC to document your own books, the first step is:&lt;/p&gt;

@({
 (include-book &quot;xdoc/top&quot; :dir :system)
})

&lt;p&gt;This book loads very quickly and requires no ttags.  It gives you @(see
defxdoc) and @(see defsection), the basic commands for adding documentation.
It also installs a new @(&#39;:doc&#39;) command, via @(see ld-keyword-aliases), so
that you can see new documentation from the terminal.&lt;/p&gt;

&lt;p&gt;For a possibly more convenient way to construct XDOC strings, do the
following:&lt;/p&gt;

@({
 (include-book &quot;xdoc/constructors&quot; :dir :system)
})

&lt;p&gt;This book includes community book @(&#39;xdoc/top.lisp&#39;), and in addition
provides utilities to construct well-formed XDOC strings in a modular way.  See
&lt;see topic=&#39;@(url xdoc::constructors)&#39;&gt;the documentation&lt;/see&gt; for more
details.&lt;/p&gt;

&lt;p&gt;Once you have documented your books, you may wish to create a manual that
can be viewed from a web browser or from the @(see acl2::acl2-doc) Emacs-based
browser.  You can do this quite easily with XDOC&#39;s @(see save) command.
This command can be embedded in an ordinary ACL2 book, so that your manual is
automatically regenerated when you build your project.&lt;/p&gt;


&lt;h3&gt;New Features&lt;/h3&gt;

&lt;p&gt;XDOC now supports @(see katex-integration) for writing LaTeX-like formulas
like
@($
\left( \sum_{i=0}^{n} \sqrt{f(i)} \right) &lt; \frac{n^2}{k}
$)
within your documentation.&lt;/p&gt;

&lt;p&gt;When writing documentation, you can now optionally have XDOC topics
automatically displayed as you submit new @(see defxdoc) forms&amp;mdash;just
add:&lt;/p&gt;

@({
 (include-book &quot;xdoc/debug&quot; :dir :system)
})

&lt;p&gt;to your @(see acl2::acl2-customization) file, or include it while you are
developing your book.  Afterward, each @(see defxdoc) form you submit will be
immediately shown at the terminal, giving you a quick, text-mode preview that
may help you to diagnose any markup problems.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc missing-parents-test
  <span class="keyword">:short</span> <span class="string">"A topic with no @(&#39;:parents&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This topic has no @(&#39;:parents&#39;) and is just meant to ensure that
@(see missing-parents) is working correctly.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (set-default-parents xdoc))</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc defxdoc
  <span class="keyword">:short</span> <span class="string">"Add documentation to the @(see xdoc) database."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;box&gt;&lt;p&gt;Note: @(&#39;defxdoc&#39;) is very basic.  You will usually want to
use @(see defsection) or @(see std::define) instead.&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;@(&#39;Defxdoc&#39;) is the XDOC alternative to ACL2&#39;s built-in @(&#39;defdoc&#39;)
command.&lt;/p&gt;

&lt;p&gt;General form:&lt;/p&gt;

@({
 (defxdoc name
   [:parents parents]
   [:short   short]
   [:long    long])
})

&lt;p&gt;Example:&lt;/p&gt;

@({
 (defxdoc duplicity
   :parents (std/lists defsort count no-duplicatesp)
   :short &quot;@(call duplicity) counts how many times the
            element @(&#39;a&#39;) occurs within the string @(&#39;x&#39;).&quot;
   :long &quot;&lt;p&gt;This function is similar to ACL2&#39;s built-in
          @(&#39;count&#39;) function but is more limited:&lt;/p&gt;  ...&quot;)
})

&lt;p&gt;The @(&#39;name&#39;) of each documentation topic must be a symbol.  All of the
keyword arguments are optional:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;@(&#39;parents&#39;) let you associate this documentation with other topics.  A
topic may have many parents, but circular chains of parents are not allowed and
will lead to errors when generating manuals.  If no @(&#39;:parents&#39;) are given
explicitly, the &lt;see topic=&#39;@(url set-default-parents)&#39;&gt;default parents&lt;/see&gt;
will be used.&lt;/li&gt;

&lt;li&gt;@(&#39;short&#39;) should be a short description of this topic that is suitable for
inlining in other pages.  For instance, it may be displayed in subtopic listing
and in &quot;hover&quot; text on navigation pages.&lt;/li&gt;

&lt;li&gt;@(&#39;long&#39;) should be the full, detailed documentation for this topic.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;The @(&#39;short&#39;) and @(&#39;long&#39;) strings may be written using the XDOC @(see
markup) language, and may also use @(see preprocessor) commands to insert
function definitions, theorems, topic links, and so on.&lt;/p&gt;

&lt;p&gt;Many examples of using XDOC can be found throughout the ACL2 books.  See for
instance the @(see acl2::std), @(see acl2::std/strings) or @(see
acl2::std/osets) libraries.&lt;/p&gt;

&lt;h3&gt;Note for Advanced Users&lt;/h3&gt;

&lt;p&gt;XDOC just stores its documentation in an ordinary ACL2 table, so if you want
to do something like automatically generate documentation from macros, you
might decide to bypass @(&#39;defxdoc&#39;) and just manipulate the table directly.&lt;/p&gt;

&lt;p&gt;It is not possible to directly use @(&#39;defxdoc&#39;) from raw Lisp, but you can
use @(see defxdoc-raw) instead.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc markup
  <span class="keyword">:short</span> <span class="string">"The &lt;a href=&#39;http://en.wikipedia.org/wiki/Xml&#39;&gt;XML&lt;/a&gt; markup
language that is the basis of XDOC documentation strings."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;XDOC uses an XML markup language that is similar to a subset of &lt;a
href=&#39;http://en.wikipedia.org/wiki/HTML&#39;&gt;HTML&lt;/a&gt;.  Note that unlike HTML,
beginning and ending tags are case-sensitive and must match exactly.  As in
HTML, you must escape characters like @(&#39;&lt;&#39;) in text to distinguish them from
tags.&lt;/p&gt;

&lt;h3&gt;Formatting Text&lt;/h3&gt;

&lt;p&gt;Various tags allow you to control the font:&lt;/p&gt;
&lt;ul&gt;
 &lt;li&gt;&lt;b&gt;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;&lt;/b&gt;&lt;/li&gt;
 &lt;li&gt;&lt;i&gt;&amp;lt;i&amp;gt;italics&amp;lt;/i&amp;gt;&lt;/i&gt;&lt;/li&gt;
 &lt;li&gt;&lt;u&gt;&amp;lt;u&amp;gt;underline&amp;lt;/u&amp;gt;&lt;/u&gt;&lt;/li&gt;
 &lt;li&gt;&lt;tt&gt;&amp;lt;tt&amp;gt;typewriter text&amp;lt;/tt&amp;gt;&lt;/tt&gt;&lt;/li&gt;
 &lt;li&gt;&lt;color rgb=&quot;#ff0000&quot;&gt;&amp;lt;color rgb=&amp;quot;#ff0000&amp;quot;&amp;gt;colored text&amp;lt;/color&amp;gt;&lt;/color&gt;&lt;/li&gt;
 &lt;li&gt;&lt;sf&gt;&amp;lt;sf&amp;gt;sans-serif&amp;lt;/sf&amp;gt;&lt;/sf&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;See @(see terminal) for how such tags are displayed at the terminal or with
the @(see acl2::ACL2-Doc) browser for Emacs.&lt;/p&gt;

&lt;h3&gt;Displaying Source Code&lt;/h3&gt;

&lt;p&gt;The @(see preprocessor) allows you to insert function definitions, theorems,
etc., from the ACL2 world.  This can help you avoid having to copy and paste
definitions into your documentation, which can help to keep your documentation
up to date.&lt;/p&gt;

&lt;p&gt;But sometimes you want to write other kinds of code fragments as examples.
The raw markup options are:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;Use the @(&#39;&lt;tt&gt;&#39;) tag for short, inline pieces of code, such as &lt;tt&gt;(+ 1
x)&lt;/tt&gt;.&lt;/li&gt;

&lt;li&gt;Use the @(&#39;&lt;code&gt;&#39;) tag for longer code examples that should be indented
and &quot;preformatted,&quot; i.e., newlines and spaces should be preserved.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;&lt;b&gt;However&lt;/b&gt;, it&#39;s often better to use the preprocessor&#39;s
&lt;tt&gt;@@(&#39;...&#39;)&lt;/tt&gt; and &lt;tt&gt;@@({...})&lt;/tt&gt; macros, respectively.  These are nice
because they automatically escape special HTML characters like &amp;lt; into
&amp;amp;lt; and also automatically add hyperlinks to documented functions.&lt;/p&gt;

&lt;p&gt;(Implementation Note.  The @(&#39;&lt;tt&gt;&#39;) and @(&#39;&lt;code&gt;&#39;) tags in XDOC do not
correspond to the @(&#39;&lt;tt&gt;&#39;) and @(&#39;&lt;code&gt;&#39;) tags in HTML.  In fact, @(&#39;&lt;tt&gt;&#39;)
is rendered with an HTML @(&#39;&lt;span&gt;&#39;), and @(&#39;&lt;code&gt;&#39;) is rendered with an HTML
@(&#39;&lt;pre&gt;&#39;).)&lt;/p&gt;

&lt;p&gt;Whenever you include Lisp code fragments in your documentation, you should
usually keep everything &lt;b&gt;indented one space&lt;/b&gt; to prevent Emacs problems.
For instance:&lt;/p&gt;

@({
|(defxdoc foo
|  :long &quot;&lt;h3&gt;How to format @(&#39;&lt;code&gt;&#39;) blocks&lt;/h3&gt;
|
|&lt;p&gt;GOOD -- the form is indented one space:&lt;/p&gt;
|&lt;code&gt;
| (my-lisp-form (foo ...)
|               (bar ...))
|&lt;/code&gt;
|
|&lt;p&gt;BAD -- the form is directly on the left-margin:&lt;/p&gt;
|&lt;code&gt;
|(my-lisp-form (foo ...)
|              (bar ...))
|&lt;/code&gt;
})

&lt;p&gt;Without this leading space, Emacs can become confused and think that
@(&#39;(my-lisp-form ...)&#39;), rather than @(&#39;(defxdoc foo ...)&#39;), is the top-level
expression.  This can ruin syntax highlighting and also commands like @(&#39;C-t
e&#39;) for sending s-expressions to the @(&#39;*shell*&#39;) window.&lt;/p&gt;




&lt;h3&gt;Hyperlinks&lt;/h3&gt;

&lt;p&gt;&lt;i&gt;Internal links&lt;/i&gt; between documentation topics and &lt;i&gt;Emacs tags-search
links&lt;/i&gt; into the source code are handled by the @(see preprocessor).&lt;/p&gt;

&lt;p&gt;You can add &lt;i&gt;external links&lt;/i&gt; to web pages with ordinary HTML-style
links, e.g.,&lt;/p&gt;

@({
&lt;a href=&quot;https://www.cs.utexas.edu/&quot;&gt;University of Texas Department of
Computer Science&lt;/a&gt;
})

&lt;p&gt;produces a link to the &lt;a href=&quot;https://www.cs.utexas.edu/&quot;&gt;University of
Texas Department of Computer Science&lt;/a&gt;.&lt;/p&gt;


&lt;h3&gt;Typesetting Mathematics (Experimental)&lt;/h3&gt;

&lt;p&gt;XDOC&#39;s fancy web viewer now has some support for LaTeX-like mathematics.
For instance, you can write formulas such as&lt;/p&gt;

@([
     c = \pm\sqrt{b^2 + a^2}
])

&lt;p&gt;See @(see katex-integration) for details.&lt;/p&gt;


&lt;h3&gt;Images and other Resources&lt;/h3&gt;

&lt;p&gt;Documentation topics can include inline images and (via hyperlinks) can
refer to other kinds of files, like PDF files.  You have to tell XDOC where to
find these files; see @(see add-resource-directory).  After setting up a
suitable resource directory, you can use @(&#39;img&#39;) tags such as:&lt;/p&gt;

@({
    &lt;img src=&#39;res/centaur/centaur-logo.png&#39;/&gt;
})

&lt;p&gt;to produce output such as:&lt;/p&gt;

&lt;img src=&#39;res/centaur/centaur-logo.png&#39;/&gt;


&lt;h3&gt;Structuring Documents&lt;/h3&gt;

&lt;h1&gt;@(&#39;&lt;h1&gt;&#39;) creates the biggest heading&lt;/h1&gt;
&lt;h2&gt;@(&#39;&lt;h2&gt;&#39;) the next biggest&lt;/h2&gt;
&lt;h3&gt;@(&#39;&lt;h3&gt;&#39;) a medium size heading (a good default)&lt;/h3&gt;
&lt;h4&gt;@(&#39;&lt;h4&gt;&#39;) a smaller heading&lt;/h4&gt;
&lt;h5&gt;@(&#39;&lt;h5&gt;&#39;) a very small heading&lt;/h5&gt;

&lt;p&gt;@(&#39;&lt;p&gt;&#39;) tags should be put around paragraphs.&lt;/p&gt;

&lt;blockquote&gt;@(&#39;&lt;blockquote&gt;&#39;) can be used to create indented paragraphs like
this one.  (Let&#39;s put enough text here to make it word-wrap.  Mumble mumble
mumble.  Mumble.  Mumble mumble.)&lt;/blockquote&gt;

&lt;p&gt;@(&#39;&lt;br/&gt;&#39;) can be used&lt;br/&gt;
to write haikus and so on&lt;br/&gt;
but is discouraged&lt;/p&gt;

&lt;p&gt;Bulleted and numbered lists work as in HTML.  The list itself begins with
@(&#39;&lt;ul&gt;&#39;) (for bulleted lists) or @(&#39;&lt;ol&gt;&#39;) (for numbered lists).  Each list
element is an @(&#39;&lt;li&gt;&#39;) tag.  For instance,&lt;/p&gt;

@({
&lt;ul&gt;
  &lt;li&gt;one&lt;/li&gt;
  &lt;li&gt;two&lt;/li&gt;
  &lt;li&gt;three&lt;/li&gt;
&lt;/ul&gt;
})

&lt;p&gt;Produces:&lt;/p&gt;

&lt;box&gt;
&lt;ul&gt;
  &lt;li&gt;one&lt;/li&gt;
  &lt;li&gt;two&lt;/li&gt;
  &lt;li&gt;three&lt;/li&gt;
&lt;/ul&gt;
&lt;/box&gt;

&lt;p&gt;You can also use definition lists, which are comprised of @(&#39;&lt;dl&gt;&#39;),
@(&#39;&lt;dt&gt;&#39;), and @(&#39;&lt;dd&gt;&#39;) tags.  For instance,&lt;/p&gt;

@({
&lt;dl&gt;
  &lt;dt&gt;Inputs&lt;/dt&gt;
  &lt;dd&gt;&lt;tt&gt;x&lt;/tt&gt;, the list we are traversing&lt;/dd&gt;
  &lt;dd&gt;&lt;tt&gt;max&lt;/tt&gt;, limit on how many we can accumulate&lt;/dd&gt;
  &lt;dd&gt;&lt;tt&gt;acc&lt;/tt&gt;, accumulator for our results&lt;/dd&gt;
&lt;/dl&gt;
})

&lt;p&gt;Produces:&lt;/p&gt;

&lt;box&gt;
&lt;dl&gt;
  &lt;dt&gt;Inputs&lt;/dt&gt;
  &lt;dd&gt;&lt;tt&gt;x&lt;/tt&gt;, the list we are traversing&lt;/dd&gt;
  &lt;dd&gt;&lt;tt&gt;max&lt;/tt&gt;, limit on how many we can accumulate&lt;/dd&gt;
  &lt;dd&gt;&lt;tt&gt;acc&lt;/tt&gt;, accumulator for our results&lt;/dd&gt;
&lt;/dl&gt;
&lt;/box&gt;

&lt;p&gt;These framed boxes are generated with the @(&#39;&lt;box&gt;&#39;) tag.&lt;/p&gt;

&lt;p&gt;A subset of HTML tables is implemented, including @(&#39;&lt;table&gt;&#39;), @(&#39;&lt;tr&gt;&#39;),
@(&#39;&lt;th&gt;&#39;), and @(&#39;&lt;td&gt;&#39;).  To encourage portability, this is a somewhat limited
facility&amp;mdash;you cannot control widths, padding, etc. on table cells. Here is
an example table:&lt;/p&gt;

&lt;table&gt;
&lt;tr&gt; &lt;th&gt;Color&lt;/th&gt; &lt;th&gt;Land&lt;/th&gt;   &lt;th&gt;Power Source&lt;/th&gt; &lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;White&lt;/td&gt; &lt;td&gt;Plains&lt;/td&gt;
     &lt;td&gt;Goodness, order and light, all that is richeous and holy.  Adversary
         of evil and chaos.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;Blue&lt;/td&gt;  &lt;td&gt;Islands&lt;/td&gt;
     &lt;td&gt;Air and water, knowledge and control, illusion and sleight of hand.
         Adversary of chaos and nature.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;Black&lt;/td&gt;  &lt;td&gt;Swamps&lt;/td&gt;
     &lt;td&gt;Evil, darkness and despair, ambition and will, suffering and death.
         Adversary of nature and goodness.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;Red&lt;/td&gt;  &lt;td&gt;Mountains&lt;/td&gt;
     &lt;td&gt;Fire and chaos, impulsiveness and fury, freedom and whimsy.
         Adversary of goodness and control.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;Green&lt;/td&gt; &lt;td&gt;Forests&lt;/td&gt;
     &lt;td&gt;Life and nature, growth and fertility.  Adversary of control and
         death.&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;


&lt;p&gt;It&#39;s relatively easy to add new tags.  There is undocumented support for
images and icons, but this is currently awkward.  In the future, we may add
other tags that users request.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defpointer syntax markup)</pre>
  </div>

<div class="form-block other" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc preprocessor
  <span class="keyword">:short</span> <span class="string">"In addition to its @(see markup) language, XDOC includes a
preprocessor which can be used to interpret certain directives of the form
@(&#39;@(...)&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;h3&gt;Functions and Theorems&lt;/h3&gt;

&lt;p&gt;To look up function definitions (or pieces of definitions) from the ACL2
world and insert them into your documentation, you can use:&lt;/p&gt;

&lt;table&gt;

&lt;tr&gt;  &lt;td&gt;@(&#39;@(def fn)&#39;)&lt;/td&gt;
      &lt;td&gt;insert the definition of &lt;i&gt;fn&lt;/i&gt;&lt;br/&gt;
          (also works for theorems, macros, ...)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;  &lt;td&gt;@(&#39;@(def? fn)&#39;)&lt;/td&gt;
      &lt;td&gt;Same as @(&#39;@(def fn)&#39;) but doesn&#39;t
          produce an error if the definition isn&#39;t found&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;@(&#39;@(body fn)&#39;)&lt;/td&gt;
     &lt;td&gt;just the body of &lt;i&gt;fn&lt;/i&gt;&lt;/td&gt; &lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;@(&#39;@(formals fn)&#39;)&lt;/td&gt;
     &lt;td&gt;just the formals of &lt;i&gt;fn&lt;/i&gt;&lt;/td&gt; &lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;@(&#39;@(measure fn)&#39;)&lt;/td&gt;
     &lt;td&gt;just the measure of &lt;i&gt;fn&lt;/i&gt;&lt;/td&gt; &lt;/tr&gt;

&lt;tr&gt; &lt;td&gt;@(&#39;@(call fn)&#39;)&lt;/td&gt;
     &lt;td&gt;a generic function call of &lt;i&gt;fn&lt;/i&gt;&lt;/td&gt; &lt;/tr&gt;

&lt;/table&gt;

&lt;p&gt;We expect that @(&#39;def&#39;) and @(&#39;body&#39;) directives will expand to large code
fragments, so they are automatically wrapped in @(&#39;&lt;code&gt;&#39;) blocks.&lt;/p&gt;

&lt;p&gt;The @(&#39;call&#39;) directive is automatically wrapped in @(&#39;&lt;tt&gt;&#39;) tags, i.e.,
@(&#39;@(call fib)&#39;) might become @(&#39;&lt;tt&gt;(fib x)&lt;/tt&gt;&#39;).  An alternative is to use
@(&#39;@(ccall fib)&#39;), for &quot;code call,&quot; which inserts @(&#39;&lt;code&gt;&#39;) tags instead;
this could be more appropriate for functions with many arguments.&lt;/p&gt;

&lt;p&gt;The other directives just become plain text, and you can wrap whatever
formatting commands you like around them and use them inline in paragraphs,
etc.&lt;/p&gt;

&lt;h3&gt;Adding Examples or Code Fragments&lt;/h3&gt;

&lt;p&gt;There is special syntax to put in raw or verbatim text.  This is especially
useful for examples and code fragments, where you don&#39;t want to have to escape
special character like @(&#39;&lt;&#39;) with @(&#39;&amp;lt;&#39;).&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;tt&gt;@@(&#39;...&#39;)&lt;/tt&gt; inserts @(&#39;...&#39;) into @(&#39;&lt;tt&gt;&#39;) XDOC tags.&lt;/li&gt;
&lt;li&gt;&lt;tt&gt;@@({...})&lt;/tt&gt; inserts @(&#39;...&#39;) into @(&#39;&lt;code&gt;&#39;) XDOC tags.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These have a special feature for automatically linking to documented topics.
For instance, &lt;tt&gt;@@(&#39;(consp x)&#39;)&lt;/tt&gt; produces @(&#39;(consp x)&#39;), and
&lt;tt&gt;@@({ (consp x) })&lt;/tt&gt; produces:&lt;/p&gt;

@({
 (consp x)
})

&lt;h3&gt;Evaluating Lisp from Doc Strings&lt;/h3&gt;

&lt;p&gt;The preprocessor has a special backtick syntax for dynamically evaluating
ACL2 expressions.  This can be used to inject constants and examples into your
documentation.  For instance:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;@(`(+ 1 2 3)`)&#39;)          produces @(`(+ 1 2 3)`)&lt;/li&gt;
&lt;li&gt;@(&#39;@(`(mv &#39;a 10 state)`)&#39;)   produces @(`(mv &#39;a 10 state)`)&lt;/li&gt;
&lt;li&gt;@(&#39;@(`acl2::*pkg-witness-name*`)&#39;) produces @(`acl2::*pkg-witness-name*`)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;By default, the backtick syntax introduces @(&#39;&lt;tt&gt;&#39;) tags and automatically
escapes any special XML characters like @(&#39;&lt;&#39;).  Sometimes this isn&#39;t what you
want.  When the result of your evaluation is large, you can use a spcial
@(&#39;:code&#39;) prefix to insert @(&#39;&lt;code&gt;&#39;) tags instead.  For instance:
@(&#39;@(`(:code (make-list 100))`)&#39;) produces:&lt;/p&gt;

@(`(:code (make-list 100))`)

&lt;p&gt;(Advanced) Introducing @(&#39;&lt;tt&gt;&#39;) tags also doesn&#39;t work well for certain,
sophisticated uses of evaluation, e.g., to generate hyperlinks, etc.  The
special @(&#39;:raw&#39;) prefix can be used to insert exactly the contents of a
string, with no automatic escaping.  For instance:
  @(&#39;  @(`(:raw &quot;a &amp;lt; b&quot;)`)  &#39;) produces
       @(`(:raw &quot;a &amp;lt; b&quot;)`).
Note that it is quite easy to use @(&#39;:raw&#39;) incorrectly; you have to escape
things properly yourself!&lt;/p&gt;

&lt;h3&gt;Emacs Links&lt;/h3&gt;

&lt;p&gt;The @(&#39;@(srclink name)&#39;) directive inserts a source-code link for users who
have configured their web browser as described in @(see emacs-links).  For
documentation in the acl2-doc browser @(see acl2::acl2-doc) or at the terminal,
the name is enclosed in angle brackets (@(&#39;&lt;name&gt;&#39;)), which essentially
represent a source-code link when using the acl2-doc `@(&#39;/&#39;)&#39; command.&lt;/p&gt;

&lt;p&gt;It is often unnecessary to use @(&#39;srclink&#39;) directly, because these links
are automatically inserted by @(&#39;@(def fn)&#39;).  One good reason to use
@(&#39;srclink&#39;) is to link to macros like @(srclink defxdoc), which often are
written using backquote and hence do not display nicely.&lt;/p&gt;

&lt;p&gt;Source links are sometimes inappropriate, e.g., for definitions or theorems
that are generated by macros.  You can suppress the automatic source links on
@(&#39;def&#39;) commands by using @(&#39;@(gdef fn)&#39;) instead.  This stands for
&quot;generated definition.&quot;&lt;/p&gt;


&lt;h3&gt;Documentation Links&lt;/h3&gt;

&lt;p&gt;The easiest way to link between topics is to use @(&#39;@(see name)&#39;), which
expands into a link to @(&#39;name&#39;).  The text shown to the reader is just the
name of the topic, typically in lower case though the case may be preserved,
for example if a topic name has mixed case.  Note also that @(&#39;@(csee name)&#39;)
can be used for links whose first letter should be capitalized; that @(&#39;@(tsee
name)&#39;) can be used for links that should appear in type-writer font; and that
@(&#39;@(see?  name)&#39;) is useful for macros, since a link is inserted if @(&#39;name&#39;)
is documented but otherwise @(&#39;name&#39;) simply appears in typewriter font.&lt;/p&gt;

&lt;p&gt;For most purposes, @(&#39;@(see name)&#39;) is adequate and it is also recommended.
Finer-grained control (e.g., changing the link text) is also possible, but then
you have to understand how file names get mangled.  The basic story is that
@(&#39;@(see name)&#39;) expands to:&lt;/p&gt;

@({
&lt;see topic=&quot;mangled-topic-name&quot;&gt;printed-topic-name&lt;/see&gt;
})

&lt;p&gt;Where:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;@(&#39;mangled-topic-name&#39;) is a canonical, url/file-name friendly,
human-hostile mangling of @(&#39;name&#39;)&#39;s package and symbol names, and&lt;/li&gt;

&lt;li&gt;@(&#39;printed-topic-name&#39;) is an XML-escaped variant of @(&#39;name&#39;), e.g., where
@(&#39;&lt;&#39;) becomes @(&#39;&amp;lt;&#39;), etc.; depending on the package of the current topic&#39;s
name, it may or may not include the package portion of @(&#39;name&#39;).&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;So, to support custom links, we provide&lt;/p&gt;

&lt;ul&gt;
 &lt;li&gt;@(&#39;@(url name)&#39;), which expands to @(&#39;mangled-topic-name&#39;)&lt;/li&gt;
 &lt;li&gt;@(&#39;@(sym name)&#39;), which expands to @(&#39;printed-topic-name&#39;)&lt;/li&gt;
 &lt;li&gt;@(&#39;@(csym name)&#39;), like @(&#39;sym&#39;), but with the first letter capitalized&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can use these to write your own @(&#39;&lt;see&gt;&#39;) tags.  You should probably
&lt;i&gt;never&lt;/i&gt; write a @(&#39;&lt;see&gt;&#39;) tag yourself without using @(&#39;@(url ...)&#39;).
Some examples:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;@(url defxdoc)&#39;) expands to @(url defxdoc)&lt;/li&gt;
&lt;li&gt;@(&#39;@(sym defxdoc)&#39;) expands to @(sym defxdoc)&lt;/li&gt;
&lt;li&gt;@(&#39;@(csym defxdoc)&#39;) expands to @(csym defxdoc)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Escaping of @&lt;/h3&gt;

&lt;p&gt;Since @(&#39;@(&#39;) is intercepted by the preprocessor, you may occasionally need
to escape it.  You can write @(&#39;@@&#39;) to generate a single @(&#39;@&#39;) sign.&lt;/p&gt;

&lt;p&gt;Besides @(&#39;@(&#39;) and @(&#39;@@&#39;), the preprocessor leaves any other uses of
@(&#39;@&#39;) intact.  So, most uses of @(&#39;@&#39;), such as in email addresses, do not
need to be escaped.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc terminal
  <span class="keyword">:short</span> <span class="string">"Display of XDOC tags at the terminal or in @(see acl2::ACL2-Doc)"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;For relevant background see @(see markup).  This topic discusses
the display of certain XDOC tags when using either the @(&#39;:&#39;)@(see doc) command
at the terminal or the @(see acl2::ACL2-Doc) browser for Emacs.  We begin with
a brief summary that should suffice for most users, followed by basic
information about three ways to display marked-up text, and concluding with
design notes followed by further information including additional options
provided by building text-based manuals.&lt;/p&gt;

&lt;h3&gt;Summary&lt;/h3&gt;

&lt;p&gt;The following tags, which we call &amp;ldquo;font tags&amp;rdquo;, indicate a
desired font; see @(see markup).&lt;/p&gt;

&lt;ul&gt;
 &lt;li&gt;&lt;b&gt;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;&lt;/b&gt;&lt;/li&gt;
 &lt;li&gt;&lt;i&gt;&amp;lt;i&amp;gt;italics&amp;lt;/i&amp;gt;&lt;/i&gt;&lt;/li&gt;
 &lt;li&gt;&lt;em&gt;&amp;lt;em&amp;gt;emphasis&amp;lt;/em&amp;gt;&lt;/em&gt;&lt;/li&gt;
 &lt;li&gt;&lt;u&gt;&amp;lt;u&amp;gt;underline&amp;lt;/u&amp;gt;&lt;/u&gt;&lt;/li&gt;
 &lt;li&gt;&lt;tt&gt;&amp;lt;tt&amp;gt;typewriter text&amp;lt;/tt&amp;gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Note that the XDOC @(see preprocessor) replaces &lt;tt&gt;@@(&#39;{some text}&#39;)&lt;/tt&gt;
with @(&#39;&lt;v&gt;{some text}&lt;/v&gt;&#39;), which is treated as described here for
@(&#39;&lt;tt&gt;{some text}&lt;/tt&gt;&#39;).&lt;/p&gt;

&lt;p&gt;By default, the @(&#39;:doc&#39;) command at the terminal and the ACL2-Doc browser
attempt to handle font tags as indicated above.  (There can be variations
depending on your platform; for example, sometimes text to be italicized is
displayed with underlining.)  The next section discusses ways to modify that
that behavior without having to rebuild the manuals; then we discuss rebuilding
the manuals.&lt;/p&gt;

&lt;h3&gt;Three ways to display marked-up text&lt;/h3&gt;

&lt;p&gt;The behaviors of the font tags correspond to the legal values of environment
variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;), as follows.&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;@(&#39;&quot;FANCY&quot;&#39;), @(&#39;&quot;&quot;&#39;), or (the default) @(&#39;nil&#39;), representing what is
refernced below as a &amp;ldquo;fancy environment&amp;rdquo;:&lt;br/&gt;An attempt is made to
use a font that conveys the intention, as follows.

&lt;ul&gt;
 &lt;li&gt;@(&#39;&lt;b&gt;..&lt;/b&gt;&#39;): bold text, often red or blue to help it to stand out&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;i&gt;..&lt;/i&gt;&#39;): italics&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;em&gt;..&lt;/em&gt;&#39;): italics&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;u&gt;..&lt;/u&gt;&#39;): underlined&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;tt&gt;..&lt;/tt&gt;&#39;): grey background&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

&lt;li&gt;@(&#39;&quot;SIMPLE&quot;&#39;):&lt;br/&gt;The font tags are handled as follows.
&lt;ul&gt;
 &lt;li&gt;@(&#39;&lt;b&gt;..&lt;/b&gt;&#39;): Replace each of @(&#39;&lt;b&gt;&#39;) and @(&#39;&lt;/b&gt;&#39;) by two underscores,
@(&#39;__&#39;).&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;i&gt;..&lt;/i&gt;&#39;): Replace each of @(&#39;&lt;i&gt;&#39;) and @(&#39;&lt;/i&gt;&#39;) by an underscore, @(&#39;_&#39;).&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;em&gt;..&lt;/em&gt;&#39;): Replace each of @(&#39;&lt;em&gt;&#39;) and @(&#39;&lt;/em&gt;&#39;) by an underscore, @(&#39;_&#39;).&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;u&gt;..&lt;/u&gt;&#39;): Replace each of @(&#39;&lt;u&gt;&#39;) and @(&#39;&lt;/u&gt;&#39;) by an underscore, @(&#39;_&#39;).&lt;/li&gt;
 &lt;li&gt;@(&#39;&lt;tt&gt;..&lt;/tt&gt;&#39;): Just drop @(&#39;&lt;tt&gt;&#39;) and @(&#39;&lt;/tt&gt;&#39;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

&lt;li&gt;@(&#39;&quot;PLAIN&quot;&#39;):&lt;br/&gt;The font tags are all dropped; that is, the text is
printed as though the tags were not present.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;As noted above, the default is a fancy environment, where the @(&#39;:doc&#39;)
command and ACL2-Doc browser attempt to handle font tags as indicated
(italic, etc.).  Technically, this is controlled by the addition of so-called
Select Graphic Rendition (SGR) control sequences when rendering the
documentation as text.  Customization of this behavior depends on the following
three cases.&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;For the built-in @(&#39;:doc&#39;) command this behavior cannot be customized.&lt;/li&gt;

&lt;li&gt;However, behavior is fully customizable for the &amp;ldquo;modified
@(&#39;:doc&#39;)&amp;rdquo; command, which is the @(&#39;:doc&#39;) command provided by @(see
XDOC), for example after evaluating @(&#39;(include-book
&quot;xdoc/init&quot; :dir :system)&#39;).  One simply sets environment variable
@(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;) according to the desired case of the three cases above.
This can be done either before starting ACL2 or else by calling @(tsee setenv$)
inside ACL2, e.g., @(&#39;(setenv$ &quot;ACL2_XDOC_TAGS&quot; &quot;PLAIN&quot;)&#39;).&lt;/li&gt;

&lt;li&gt;For ACL2-Doc the behavior is partially customizable.  For a default build
of the manual (which however can be overridden as described in the next
section), one cannot get the behavior described above for @(&#39;&quot;SIMPLE&quot;&#39;).
However, if you set environment variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;) to
@(&#39;&quot;PLAIN&quot;&#39;) or @(&#39;&quot;SIMPLE&quot;&#39;) in a way that is visible to Emacs, you can
eliminate the SGR control sequences so that you see plain text.  One way to
accomplish this is to evaluate the form @(&#39;(setenv &quot;ACL2_XDOC_TAGS&quot;
&quot;PLAIN&quot;)&#39;) inside Emacs.&lt;/li&gt;

&lt;/ul&gt;

&lt;h3&gt;Design notes&lt;/h3&gt;

&lt;p&gt;Here we make a few observations about why font tags are handled as they
are.&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;We have seen that for a fancy environment, text within
&lt;tt&gt;&amp;lt;b&amp;gt;...&amp;lt;/b&amp;gt;&lt;/tt&gt; is rendered not only as bold but also as red.
That is because bold text does not often show up clearly.&lt;/li&gt;

&lt;li&gt;The use of &amp;lsquo;@(&#39;*&#39;)&amp;rsquo; as a delimiter is avoided because that
character so often appears in ACL2 names, in particular, in constant symbols.
Underscore, by contrast, appears much less often.&lt;/li&gt;

&lt;li&gt;The use of a grey background (which may technically be called
&amp;ldquo;white&amp;rdquo;, but it&#39;s really grey!) is rather common for fixed-width
code text, so it seems a good choice for the @(&#39;&lt;tt&gt;&#39;) tag in a fancy
environment.&lt;/li&gt;

&lt;/ul&gt;

&lt;h3&gt;Changing the default builds of text-based manuals&lt;/h3&gt;

&lt;p&gt;The remainder of this topic can probably be ignored by most.  It discusses
how to build the text-based documentation used by @(&#39;:doc&#39;) and ACL2-Doc to
modify handling of the font tags above.&lt;/p&gt;

&lt;p&gt;First let us review basics of how @(&#39;:doc&#39;), modified @(&#39;:doc&#39;), and
ACL2-Doc work.  These all read a text-based manual that has been built by
removing all @(see preprocessor) directives and all tags, including font tags.
By default, these are built in a fancy environment (as defined above), which
inserts SGR control sequences for font tags.  Terminals often intepret these
tags by displaying text using suitable fonts (italics, underline, etc.), and
this is how text is displayed by @(&#39;:doc&#39;).  ACL2-Doc invokes Emacs utilities
to provide such fonts.  We are ready to explain the restrictions above.&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;The built-in @(&#39;:doc&#39;) command simply prints out the rendered text, which
is why its behavior cannot be customized (unless perhaps one modifies the
terminal environment).&lt;/li&gt;

&lt;li&gt;If Emacs sees a value of environment variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;) of
@(&#39;&quot;PLAIN&quot;&#39;) or @(&#39;&quot;SIMPLE&quot;&#39;), it removes SGR control sequences from the
rendered text before displaying it as plain text.  But there is no way to take
that rendered text and add markings as specified for the @(&#39;&quot;SIMPLE&quot;&#39;)
case.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;On the other hand, the modified @(&#39;:doc&#39;) command renders the original
documentation, which still has tags.  That rendering is sensitive to the value
of environment variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;).  But the items above tells us
that there is not the same flexibility for the built-in @(&#39;:doc&#39;) command or
ACL2-Doc.&lt;/p&gt;

&lt;p&gt;The only way to get such flexibility is to build text-based manuals for
@(&#39;:doc&#39;) and ACL2-Doc that render text as desired, which requires setting
environment variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;) when building thse manuals.  Since
@(&#39;:doc&#39;) is based off ACL2 source file @(&#39;doc.lisp&#39;), which is to be modified
only by the ACL2 implementors, we focus on building the documentation for
ACL2-Doc.&lt;/p&gt;

&lt;p&gt;The ACL2+books rendered manual is file
@(&#39;books/system/doc/rendered-doc-combined.lsp&#39;), and there is also an
&amp;ldquo;ACL2 only&amp;rdquo; manual restricted to built-in functions in file
@(&#39;books/system/doc/rendered-doc.lsp&#39;).  These can be built with any of the
three default behaviors (fancy, simple, or plain) by setting the environment
variable @(&#39;&quot;ACL2_XDOC_TAGS&quot;&#39;) before building those manuals, for example as
follows while standing in the @(&#39;books&#39;) directory.  The @(&#39;--acl2&#39;) and
@(&#39;-j&#39;) options are up to the user.  Note: You might need first to delete file
@(&#39;doc/top.cert&#39;) under @(&#39;books/&#39;).&lt;/p&gt;

@({
(export ACL2_XDOC_TAGS=FANCY ; ./build/cert.pl --acl2 acl2 doc/top)
(export ACL2_XDOC_TAGS=SIMPLE ; ./build/cert.pl --acl2 acl2 doc/top)
(export ACL2_XDOC_TAGS=PLAIN ; ./build/cert.pl --acl2 acl2 doc/top)
})

&lt;p&gt;For example, suppose you want underscores to surround text that is marked
with @(&#39;&lt;i&gt;&#39;), so that for example &amp;ldquo;&amp;lt;i&amp;gt;italicized
text&amp;lt;/i&amp;gt;&amp;rdquo; is printed as &amp;ldquo;_italicized text_&amp;rdquo;.  It then
suffices to build the manual with @(&#39;&quot;SIMPLE&quot;&#39;) as in the second command
displayed above, except that when using @(&#39;:doc&#39;) at the terminal you would
first need to include the @(see acl2::community-book) @(&#39;&quot;xdoc/init&quot;&#39;) as
discussed above, so that you are using the modified @(&#39;:doc&#39;) command.&lt;/p&gt;

&lt;p&gt;We close by describing an implementation detail; ideally it can be ignored,
but we mention it in case someone finds it to be useful.  When the manual is
built (by certifying @(see acl2::community-book) @(&#39;doc/top&#39;)), a file is
created, @(&#39;system/doc/acl2-doc-search&#39;), that is consulted by search commands
in ACL2-Doc.  When that file is built in a fancy environment (which, again, is
the default), then environment variable @(&#39;ACL2_XDOC_TAGS&#39;) is first
temporarily bound to @(&#39;&quot;PLAIN&quot;&#39;) so that @(&#39;system/doc/acl2-doc-search&#39;)
will not contain any SGR control sequences that might cause search
mismatches.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc save
  <span class="keyword">:short</span> <span class="string">"Saves the XDOC database into files for web browsers, etc."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Once you have documented your books with @(see defxdoc), you may
wish to create a manual that can be viewed from a web browser or from the
acl2-doc Emacs-based browser (see @(see acl2::acl2-doc)).&lt;/p&gt;

&lt;h4&gt;Basic Example&lt;/h4&gt;

@({
 ;; my-manual.lisp - a book that creates a manual
 (in-package &quot;MYPKG&quot;)

 (include-book &quot;my-library1&quot;) ;; load books I want in the manual
 (include-book &quot;my-library2&quot;) ;; (documented with xdoc)

 (include-book &quot;xdoc/save&quot; :dir :system)  ;; load xdoc::save

 (defxdoc acl2::top           ;; create a &quot;top&quot; topic
   :short &quot;My Manual&quot;
   :long &quot;&lt;p&gt;This manual explains how to use my books...&lt;/p&gt;&quot;)

 (xdoc::save &quot;./mylib-manual&quot; :error t)  ;; write the manual
})

&lt;p&gt;Notes about this example:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;The @(&#39;xdoc::save&#39;) command will export all currently-loaded, documented
topics.  Because of this, you can mostly control what goes into the manual
&lt;b&gt;just by including books&lt;/b&gt;, but see below for additional notes about how to
control what goes in a manual.&lt;/li&gt;

&lt;li&gt;The @(&#39;save&#39;) command is a macro that expands into @(see
acl2::embedded-event-form)s.  Typically, you just put it into a new book (e.g.,
@(&#39;my-manual.lisp&#39;) above) so that your manual will be regenerated as part of
building your project.&lt;/li&gt;

&lt;li&gt;The @(&#39;save&#39;) requires certain &lt;see topic=&#39;@(url defttag)&#39;&gt;trust
tags&lt;/see&gt;.  You may need to enable trust tags in your build system to certify
the @(&#39;my-manual&#39;) book.  For instance, @(&#39;cert.pl&#39;) users may need a
@(&#39;.acl2&#39;) file with a line such as:

@({
    ; cert-flags: ? t :ttags :all
})&lt;/li&gt;

&lt;li&gt;After saving a manual, you should be able to view it by going to, e.g.,
@(&#39;mylib-manual/index.html&#39;) in your web browser.  If you want to share your
manual with others, you should read about @(see deploying-manuals).&lt;/li&gt;

&lt;/ul&gt;


&lt;h4&gt;General Form&lt;/h4&gt;

@({
    (save &lt;target-dir&gt;
          [:redef-okp  bool]               ;; default is nil
          [:zip-p      bool]               ;; default is t
          [:logo-image path]               ;; default is nil
          [:error      bool]               ;; default is nil
          [:broken-links-limit nil-or-nat] ;; default is nil
          )
})

&lt;p&gt;The only (required) argument to the @(&#39;save&#39;) command is the name of a
directory where the want the manual to go.  All arguments are evaluated.
As might be expected:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;If the target directory does not exist, it will be created.&lt;/li&gt;

&lt;li&gt;If the target directory already exists, it &lt;color rgb=&quot;#ff0000&quot;&gt;will be
overwritten&lt;/color&gt;.  (&lt;b&gt;&lt;color rgb=&quot;#ff0000&quot;&gt;WARNING&lt;/color&gt;&lt;/b&gt;: So, the
target directory should not be one containing files that you want to keep, such
as the directory containing the file that invokes @(&#39;xdoc::save&#39;), or its
parent directory (or its parent, etc.).)&lt;/li&gt;

&lt;/ul&gt;

&lt;h5&gt;Option Summary&lt;/h5&gt;

&lt;dl&gt;

&lt;dt&gt;@(&#39;redef-okp&#39;)&lt;/dt&gt;

&lt;dd&gt;By default, the @(&#39;save&#39;) command will complain if any topic is defined
more than once.  This is often annoying when you are developing books,
especially if your books are slow to certify and you don&#39;t want to have your
build fail just because of a documentation problem.  So, if you want to
suppress this error (and turn it into a printed warning), you can set
@(&#39;:redef-okp t&#39;).&lt;/dd&gt;

&lt;dt&gt;@(&#39;zip-p&#39;)&lt;/dt&gt;

&lt;dd&gt;To support the &lt;a href=&#39;download/&#39;&gt;Download this Manual&lt;/a&gt;
feature (normally accessed from the toolbar button) the @(&#39;save&#39;) command will
zip up the manual to create @(&#39;.tar.gz&#39;), @(&#39;.tar.bz2&#39;), and @(&#39;.zip&#39;) files.
If you don&#39;t care about generating these files and want to avoid the time to
build them, you can set @(&#39;:zip-p nil&#39;).&lt;/dd&gt;

&lt;dt&gt;@(&#39;:logo-image&#39;)&lt;/dt&gt;

&lt;dd&gt;You can provide a custom image to use as the logo for the @(see top) topic.
The path you provide should be relative to whatever book contains the @(&#39;save&#39;)
command.&lt;/dd&gt;

&lt;dt&gt;@(&#39;:error&#39;)&lt;/dt&gt;

&lt;dd&gt;The value is @(&#39;t&#39;) or @(&#39;nil&#39;), to indicate whether or not (respectively)
to cause an error upon encountering a syntax error in xdoc source (marked with
&quot;xdoc error&quot;).&lt;/dd&gt;

&lt;dt&gt;@(&#39;:broken-links-limit&#39;)&lt;/dt&gt;

&lt;dd&gt;The value is @(&#39;nil&#39;) by default.  Otherwise, it is a natural number
specifying the maximum allowed number of broken links; if the ``broken topic
link&#39;&#39; report shows more broken links than that limit, an error occurs.&lt;/dd&gt;

&lt;/dl&gt;


&lt;h3&gt;Avoiding Unwanted Documentation&lt;/h3&gt;

&lt;p&gt;By default, the @(&#39;save&#39;) command will generate a manual that covers the
documentation for all books that you have loaded.  This usually works well
as long as you know all of the books that you need to include.&lt;/p&gt;

&lt;p&gt;One caveat is that @(&#39;xdoc/save&#39;) includes some supporting books that are,
themselves, documented.  Accordingly, you may find that your manual includes
documentation from libraries like @(see acl2::std/strings) and @(see
oslib::oslib) in your output even if you haven&#39;t loaded these libraries
yourself.  If you really want precise control over what goes into your manual,
then, you may want to do something like this:&lt;/p&gt;

@({
 ;; nothing-extra-manual.lisp - manual with nothing extra
 (in-package &quot;MYPKG&quot;)

 (include-book &quot;my-library1&quot;) ;; load books I want in the manual
 (include-book &quot;my-library2&quot;) ;; (documented with xdoc)

 (make-event ;; save current documentation
  `(defconst *just-my-documentation*
     &#39;,(xdoc::get-xdoc-table (w state))))

 (include-book &quot;xdoc/save&quot; :dir :system)

 ;; clobber any docs that were added due to xdoc/save
 (table xdoc::xdoc &#39;xdoc::doc *just-my-documentation*)

 (defxdoc acl2::top           ;; create a &quot;top&quot; topic
   :short &quot;My Manual&quot;
   :long &quot;&lt;p&gt;This manual explains how to use my books...&lt;/p&gt;&quot;)

 (xdoc::save &quot;./mylib-manual&quot; :error t)
})"</span>)</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc save-rendered
  <span class="keyword">:parents</span> (xdoc)
  <span class="keyword">:short</span> <span class="string">"Saves the XDOC database into files for the acl2-doc browser"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Also see @(see save-rendered-event) for a corresponding macro that
  provides additional functionality.&lt;/p&gt;

 @({
 General Form:

 (save-rendered outfile
                header
                topic-list-name
                error
                write-acl2-doc-search-file
                state)
 })

 &lt;p&gt;where @(&#39;outfile&#39;) is the pathname for the output file containing rendered
 documentation, @(&#39;header&#39;) is to be written to the top of
 @(&#39;outfile&#39;) (typically as a comment), and the value of @(&#39;topic-list-name&#39;)
 is a symbol that can be the first argument of @(tsee defconst), hence of the
 form @(&#39;*c*&#39;).  The value of @(&#39;error&#39;) should be @(&#39;t&#39;) or @(&#39;nil&#39;) to
 indicate whether or not (respectively) to cause an error upon encountering a
 syntax error in xdoc source (marked by &quot;xdoc error&quot;).  When the value of
 @(&#39;write-acl2-doc-search-file&#39;) is not @(&#39;nil&#39;), then a file
 @(&#39;&quot;acl2-doc-search&quot;&#39;) is written, to be used for speeding up @(see
 acl2::acl2-doc) search commands.&lt;/p&gt;

 &lt;p&gt;Upon success, the call displayed above returns the error-triple @(&#39;(mv
 nil (value-triple :ok) state)&#39;); probably the value is unimportant except that
 it allows an @(&#39;xdoc::save-rendered&#39;) call to be placed inside
 @(&#39;make-event&#39;), as displayed below.&lt;/p&gt;

 &lt;p&gt;For example, the following form may be found in community book
 @(&#39;books/doc/top.lisp&#39;).  Its evaluation creates the output file
 @(&#39;books/system/doc/rendered-doc-combined.lsp&quot;&#39;).  That file starts with a
 comment from the string, @(&#39;*rendered-doc-combined-header*&#39;), then contains
 @(&#39;(in-package &quot;ACL2&quot;)&#39;), and concludes with a form @(&#39;(defconst
 *ACL2+BOOKS-DOCUMENTATION* &#39;&lt;big-alist&gt;)&#39;), where @(&#39;&lt;big-alist&gt;&#39;) is an alist
 representing the XDOC database.&lt;/p&gt;

 @({
 (make-event
  (time$
   (xdoc::save-rendered
    (extend-pathname (cbd)
                     &quot;../system/doc/rendered-doc-combined.lsp&quot;
                     state)
    *rendered-doc-combined-header*
    &#39;*acl2+books-documentation*
    t ; cause error upon encountering xdoc error
    state)))
 })

 &lt;p&gt;The output file is typically used by the acl2-doc Emacs-based browser for
 XDOC.  See @(see acl2::acl2-doc), specifically the discussion of custom
 manuals, which explains that the @(&#39;filename&#39;) argument of Emacs function
 @(&#39;extend-acl2-doc-manual-alist&#39;) is exactly the output file created by
 @(&#39;xdoc::save-rendered&#39;).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc save-rendered-event
  <span class="keyword">:parents</span> (xdoc)
  <span class="keyword">:short</span> <span class="string">"Event that invokes @(tsee save-rendered), supporting extra functionality"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;See @(see save-rendered) for relevant background.&lt;/p&gt;

 @({
 General Form:

 (save-rendered-event outfile
                      header
                      topic-list-name
                      error
                      &amp;key
                      script-file script-args timep write-acl2-doc-search-file)
 })

 &lt;p&gt;where the four required arguments correspond to the same arguments of
 @(tsee save-rendered).  Although @(&#39;save-rendered&#39;) and
 @(&#39;save-rendered-event&#39;) have similar effects &amp;mdash; indeed,
 @(&#39;save-rendered-event&#39;) invokes @(&#39;save-rendered&#39;) with the same first four
 arguments &amp;mdash; @(&#39;save-rendered-event&#39;) is a macro that generates an event
 form (using @(tsee make-event)) that can be placed in a book.  All arguments
 are evaluated.  The keyword arguments of @(&#39;save-rendered-event&#39;) provide
 additional functionality, as follows.&lt;/p&gt;

 &lt;p&gt;Suppose @(&#39;:script-file&#39;) is supplied with a non-@(&#39;nil&#39;) value.  Then
 there must be an active trust tag (see @(see defttag).  The value of
 @(&#39;:script-file&#39;) should be a string that names a file to be executed as a
 shell command, using @(tsee sys-call).  The argument list of that command is
 provided by the value of @(&#39;:script-args&#39;).  For an example, see the call of
 @(&#39;xdoc::save-rendered-event&#39;) in community book @(&#39;doc/top.lisp&#39;).&lt;/p&gt;

 &lt;p&gt;If @(&#39;:timep&#39;) is non-@(&#39;nil&#39;) then the entire computation will be wrapped
 in a call of @(tsee time$).&lt;/p&gt;

 &lt;p&gt;The value of keyword option @(&#39;:write-acl2-doc-search-file&#39;), which is
 @(&#39;nil&#39;) by default, is passed directly to the corresponding parameter of
 @(tsee save-rendered).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc deploying-manuals
  <span class="keyword">:parents</span> (save)
  <span class="keyword">:short</span> <span class="string">"How to distribute XDOC manuals for other people to use."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;After you have documented your books with XDOC and created a
manual, you may wish to share your manual with coworkers, collaborators,
customers, sponsors, etc.  The best way to do this may depend on many
factors.&lt;/p&gt;

&lt;p&gt;By default, the manuals created by @(see save) use only client-side
JavaScript code.  This makes deployment very easy: you can just copy the files
to wherever you like, and you don&#39;t even need a web server.&lt;/p&gt;

&lt;p&gt;This approach&amp;mdash;just copying the default manual&amp;mdash;is well-suited
for:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Browsing from your local hard-drive, or&lt;/li&gt;
&lt;li&gt;Browsing from a fast NFS drive or intranet server&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;But the default manuals will &lt;b&gt;perform badly on slow connections&lt;/b&gt;.  So,
if your users are going to read the manual over, e.g., VPNs or public web
sites, then you may wish to read on.&lt;/p&gt;


&lt;h3&gt;Server-Supported Manuals&lt;/h3&gt;

&lt;p&gt;The basic reason that the default manuals are slow is that they work by
simply loading the data for &lt;b&gt;every&lt;/b&gt; topic, at startup.  As of the time of
writing (July 2025), this comes to around 310 MB of data for the basic
@(&#39;doc/top.lisp&#39;) manual.  It&#39;s no big deal to load 310 MB from a local hard
drive or a fast intranet connection, but it can be quite slow over the
internet.&lt;/p&gt;

&lt;p&gt;The XDOC manuals created by @(&#39;save&#39;) can be reconfigured to just load the
@(&#39;:long&#39;) sections as they are accessed.  This results in a much
faster-loading manual, and is how, for instance, the online XDOC manual at
Centaur was deployed.&lt;/p&gt;

&lt;p&gt;This option requires a small amount of configuration, and you may need to
coordinate with your network administrator to get certain software
installed.&lt;/p&gt;

&lt;p&gt;If you want to use our scripts directly, you will need a web server that
supports &lt;a href=&#39;http://www.perl.org&#39;&gt;Perl&lt;/a&gt; scripts with the CGI, DBI, and
DBD::SQLite modules installed.  If for some reason this poses a problem, you
may find that you can easily port these scripts to other popular languages,
like PHP or Ruby, with SQLite support.&lt;/p&gt;


&lt;h4&gt;Step 1: Create the Database&lt;/h4&gt;

&lt;p&gt;In the manual directory you created with the @(see save) command, you should
find a Perl script named @(&#39;xdata2sql.pl&#39;).  When you run this script, you
should see something like the following output:&lt;/p&gt;

@({
$ cd my-library/manual
$ perl xdata2sql.pl
-------------------------------------------------------------------------------

xdata2sql.pl: Convert xdata.js into xdata.db (an sqlite3 database)

   NOTE: Most folks don&#39;t need to run this at all!
         If you just want to:
          - browse an XDOC manual on your local hard drive, or
          - share an XDOC manual on your fast intranet
         then ignore this script and just see index.html.

The main use for this script is to share XDOC manuals on the internet.  In this
scenario, just having the web browser load in the entire (generally 20+ MB)
xdata.js file is not very practical, because some users will have slow
connections and will take too long to load the file.

There are many ways to solve this.  Our approach is to convert xdata.js into an
sqlite3 database, and then use a server-side script that will allow us to
access topics only as they are requested.

-------------------------------------------------------------------------------

; Converting xdata.js

; Reading file
; Checking file
; Parsing JSON data.
; Creating new xdata.db.
; Creating xdoc_data table.
; Populating xdoc_data table.
; All done.

To actually use the database, see xdataget.pl.
})

&lt;p&gt;After this step, you should have a new file named @(&#39;xdata.db&#39;) in your
manual directory.  This is an SQLite3 database that has the information for
your XDOC topics.  It should be roughly as large as @(&#39;xdata.js&#39;).&lt;/p&gt;

&lt;p&gt;If you are missing some required Perl modules, then instead of the above
output you may see a message such as&lt;/p&gt;

@({
    Can&#39;t locate DBI.pm in @INC ...
})

&lt;p&gt;In this case, you may need to ask your systems administrator to install the
missing modules.&lt;/p&gt;


&lt;h4&gt;Step 2: Set up the Web Server&lt;/h4&gt;

&lt;p&gt;Once you have created the @(&#39;xdata.db&#39;) file, you will need to copy both it
and a different script, @(&#39;xdataget.pl&#39;), to some directory in your web
server.  If @(&#39;xdata.db&#39;) is not placed in the same directory as
@(&#39;xdataget.pl&#39;), @(&#39;xdataget.pl&#39;) will not be able to find it.&lt;/p&gt;

&lt;p&gt;Typically, for @(&#39;xdataget.pl&#39;) to work at all, it will need to have its
executable bit set, and it may need to be in a special directory within your
web server, typically named @(&#39;cgi-bin&#39;).&lt;/p&gt;

&lt;p&gt;To make sure the script is working, you should now load it in your web
browser by going to, e.g., @(&#39;http://my-server/cgi-bin/xdataget.pl&#39;).  If
everything is working, you should see a page that looks like this:&lt;/p&gt;

@({
     {&quot;results&quot;:[

     ]}
})

&lt;p&gt;If, instead, you see a message like &lt;i&gt;Internal Server Error&lt;/i&gt;, then you
may have a permissions problem, or your web server&#39;s version of Perl may be
missing a require library, or something else may be wrong; ask your systems
administrator for help.&lt;/p&gt;

&lt;p&gt;You may also wish to load, e.g.,:&lt;/p&gt;

@({
    http://my-server/cgi-bin/xdataget.pl?keys=ACL2____TOP
})

&lt;p&gt;and make sure that you can see some text from your top topic.&lt;/p&gt;


&lt;h4&gt;Step 3: Configure the Manual to use the Server&lt;/h4&gt;

&lt;p&gt;The final step is to edit the file @(&#39;config.js&#39;) in your manual.
This file contains comments with the example syntax.  Basically you
just need to change:&lt;/p&gt;

@({
    var XDATAGET = &quot;&quot;;
})

&lt;p&gt;To have the right URL for your xdataget.pl script, e.g., into:&lt;/p&gt;

@({
    var XDATAGET = &quot;http://my-server/cgi-bin/xdataget.pl&quot;;
})

&lt;p&gt;At this point, your manual should load topic data dynamically as needed.
The result should be much faster for users on slow connections.&lt;/p&gt;

&lt;h4&gt;Deploying the SEO Manual&lt;/h4&gt;

&lt;p&gt;There is also an SEO variant of the server-supported manual which is more
accessible to web crawlers (but less accessible to humans).  To deploy this
manual, repeat the steps above but with the @(&#39;xdata2sql4seo.pl&#39;) script, which
will produce @(&#39;xdata-seo.db&#39;).  You will also need to deploy to a server which
supports PHP.&lt;/p&gt;

&lt;p&gt;The SEO variant of the manual is intended to be deployed in addition to the
regular server-supported manual, not to replace it.  The SEO variant is not
intended for typical use and is only provided to allow search engines to index
the site.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc emacs-links
  <span class="keyword">:short</span> <span class="string">"Instructions for integrating XDOC web pages with &lt;a
  href=&#39;http://www.gnu.org/software/emacs/&#39;&gt;Emacs&lt;/a&gt;."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(csee preprocessor) directives such as @(&#39;@(def get-xdoc-table)&#39;)
result in the introduction of special links for Emacs.  Here&#39;s what these links
look like:&lt;/p&gt;

@(def get-xdoc-table)

&lt;p&gt;Depending on your environment, it &lt;b&gt;may&lt;/b&gt; be easy to configure your web
browser so that clicking on these links will cause Emacs to directly open up
the appropriate source file and jump to the named function.&lt;/p&gt;

&lt;p&gt;The basic idea is:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;Each Emacs link generates a &lt;a
href=&#39;https://en.wikipedia.org/wiki/Data_URI_scheme&#39;&gt;Data URIs&lt;/a&gt; that tells
your web browser to download a new, generated file whose &lt;a
href=&#39;https://en.wikipedia.org/wiki/Internet_media_type&#39;&gt;MIME type&lt;/a&gt; is
@(&#39;application/x-acl2-xdoc-link&#39;).&lt;/li&gt;

&lt;li&gt;You configure your web browser to send @(&#39;application/x-acl2-xdoc-link&#39;)
files to Emacs.&lt;/li&gt;

&lt;li&gt;You configure your Emacs to carry out a tags search instead of loading
these files.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;The net effect is that clicking on these links will send you directly to the
desired function in the source code.  This is &lt;b&gt;really slick&lt;/b&gt; if you can
get it working.&lt;/p&gt;


&lt;h2&gt;Configuring Emacs&lt;/h2&gt;

&lt;h4&gt;Loading the XDOC Elisp&lt;/h4&gt;

&lt;p&gt;The XDOC directory includes a file called @(&#39;xdoc.el&#39;), which tells emacs
what to do with these xdoc-link files.  To tell emacs to load this file at
startup, you can just add a command to your @(&#39;.emacs&#39;) file like:&lt;/p&gt;

@({
 (load &quot;/path/to/acl2/books/xdoc/xdoc.el&quot;)
})

&lt;p&gt;This file will be loaded automatically if you load the file of emacs
utilities that comes with ACL2:&lt;/p&gt;

@({
 (load &quot;/path/to/acl2/emacs/emacs-acl2.el&quot;)
})

&lt;h4&gt;Managing your TAGS tables&lt;/h4&gt;

&lt;p&gt;For emacs to make sense of the links you follow, it will need to have the
appropriate &lt;a
href=&quot;https://www.gnu.org/software/emacs/manual/html_node/emacs/Tags-Tables.html&quot;&gt;tags
tables&lt;/a&gt; loaded for all of the libraries you are using.&lt;/p&gt;

&lt;p&gt;If you aren&#39;t familiar with tags, you basically just need to:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;Occasionally generate @(&#39;TAGS&#39;) files for your libraries, using the command
@(&#39;etags *.lisp&#39;) or similar.&lt;/li&gt;

&lt;li&gt;Tell Emacs to &quot;visit&quot; these tags tables with @(&#39;visit-tags-table&#39;).&lt;/li&gt;

&lt;/ul&gt;

&lt;h5&gt;Jared&#39;s Approach:&lt;/h5&gt;

&lt;ul&gt;

&lt;li&gt;I add a @(&#39;TAGS&#39;) target to my Makefiles, so that when I build my library
the @(&#39;etags *.lisp&#39;) command is re-run and the @(&#39;TAGS&#39;) file is kept up to
date.  The Makefile syntax is:

@({
TAGS: $(wildcard *.lisp)
      etags *.lisp
})&lt;/li&gt;

&lt;li&gt;Then, in my @(&#39;.emacs&#39;) file, I have a series of commands like the
following:

@({
 (ignore-errors (visit-tags-table &quot;/path/to/acl2/TAGS&quot;))
 (ignore-errors (visit-tags-table &quot;/path/to/acl2/books/xdoc/TAGS&quot;))
 (ignore-errors (visit-tags-table &quot;/path/to/my/stuff/TAGS&quot;))
})

This ensures that the relevant @(&#39;TAGS&#39;) files are loaded every time I start
Emacs.  The use of @(&#39;ignore-errors&#39;) prevents Emacs from complaining if one of
these @(&#39;TAGS&#39;) files was deleted in a &quot;make clean&quot; or similar.&lt;/li&gt;

&lt;li&gt;One final addition to the @(&#39;.emacs&#39;) file is:

@({
 (setq tags-revert-without-query t)
})

which tells Emacs to go ahead and reload these files when they are rebuilt by
Make, instead of prompting you if you want to reload them.&lt;/li&gt;

&lt;/ul&gt;


&lt;h4&gt;Setting up Emacsclient (recommended)&lt;/h4&gt;

&lt;p&gt;You can set things up so that links open up in &lt;b&gt;new instances&lt;/b&gt; of
Emacs, or in &lt;b&gt;new buffers&lt;/b&gt; of an already-running Emacs.&lt;/p&gt;

&lt;p&gt;If you want everything to open up in a new instance of Emacs, you can skip
this section.  But I prefer to use a single Emacs for everything, and just have
links open up in new buffers.&lt;/p&gt;

&lt;p&gt;This is quite easy.  First, add @(&#39;(server-start)&#39;) to your @(&#39;.emacs&#39;) file
and restart Emacs.&lt;/p&gt;

&lt;p&gt;Next, to ensure everything is working properly, launch a separate terminal
and type:&lt;/p&gt;

@({
emacsclient --no-wait my-file
})

&lt;p&gt;If all is well, @(&#39;my-file&#39;) will be loaded into your already-running emacs
as a new buffer.&lt;/p&gt;



&lt;h2&gt;Configuring the Web Browser&lt;/h2&gt;

&lt;p&gt;The last thing we need to do is instruct your web browser to send xdoc-link
files to Emacs.&lt;/p&gt;

&lt;p&gt;How to do this depends on your web browser and/or operating system.  In some
cases it may be hard to pass command-line options to emacs directly, so you may
find it useful to use the script @(&#39;emacsclient-wrapper.sh&#39;), found in the xdoc
directory.&lt;/p&gt;

&lt;p&gt;The basic starting point is probably to try to click on an emacs link like
@(srclink append) and try to tell your browser to open it with the
@(&#39;emacsclient-wrapper.sh&#39;) script.  If your browser opens it with some other
program, you might need to edit the default file associations of your operating
system or window manager.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc extract-keyword-from-args
  <span class="keyword">:parents</span> (defsection)
  <span class="keyword">:short</span> <span class="string">"Get the value for a keyword argument like @(&#39;:foo value&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(call extract-keyword-from-args) is given @(&#39;kwd&#39;), which should
be a keyword symbol, and a list of @(&#39;args&#39;) which are typically the @(&#39;&amp;rest
args&#39;) given to a macro.  It scans the list of @(&#39;args&#39;), looking for the
indicated keyword, and returns @(&#39;(kwd . value)&#39;), or @(&#39;nil&#39;) if no such
keyword is found.  For instance,&lt;/p&gt;

@({
 (extract-keyword-from-args :bar &#39;(:foo 3 :bar 5 :baz 7))
   --&gt;
 (:bar . 5)
})

&lt;p&gt;This function is mainly useful for writing macros that mix @(&#39;&amp;rest&#39;) parts
with keyword arguments.  See also @(see throw-away-keyword-parts).&lt;/p&gt;

@(def extract-keyword-from-args)"</span>)</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc throw-away-keyword-parts
  <span class="keyword">:parents</span> (defsection)
  <span class="keyword">:short</span> <span class="string">"Throw away any keyword arguments and their values from a macro
argument list."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(call throw-away-keyword-parts) is given a list of arguments that
are typically the @(&#39;&amp;rest args&#39;) given to a macro.  It scans the arguments for
any keyword symbols such as @(&#39;:foo&#39;), and throws away both the keyword and the
argument that follows it.  For instance,&lt;/p&gt;

@({
 (throw-away-keyword-parts &#39;(x y z :foo 3 :bar 5 blah blah blah))
   --&gt;
 &#39;(x y z blah blah blah)
})

&lt;p&gt;This function is mainly useful for writing macros that mix @(&#39;&amp;rest&#39;) parts
with keyword arguments.  See also @(see extract-keyword-from-args).&lt;/p&gt;

@(def throw-away-keyword-parts)"</span>)</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc defsection
  <span class="keyword">:short</span> <span class="string">"Fancy @(&#39;(encapsulate nil ...)&#39;) with a name and @(see xdoc) support."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;h4&gt;General Form&lt;/h4&gt;

@({
 (defsection name
    [:parents   parents]
    [:short     short]
    [:long      long]
    [:autodoc   autodoc]
    [:extension topic]
    [:set-as-default-parent t/nil]
    ... events and commentary ...)
})

&lt;h4&gt;Example&lt;/h4&gt;

@({
 (defsection foo
   :parents (parent1 parent2 ...)
   :short &quot;@(call foo) is like @(see bar), but better when...&quot;
   :long &quot;&lt;p&gt;The main differences between @(&#39;foo&#39;) and @(&#39;bar&#39;) are ...&lt;/p&gt;&quot;

   (defund foo (x) ...)
   (local (in-theory (enable foo)))
   (defthm foo-thm1 ...)
   (defthm foo-thm2 ...)

   &quot;&lt;p&gt;NOTE: the next theorem is really useful, but we keep it disabled
   because it gets too expensive when...&lt;/p&gt;&quot;

   (defthmd foo-thm3 ...))
})

&lt;box&gt;&lt;p&gt;Note: this example might be better written as a @(see std::define),
which is much like a @(&#39;defsection&#39;) but has additional features.&lt;/p&gt;&lt;/box&gt;

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p&gt;Like an @(see encapsulate), a @(&#39;defsection&#39;) introduces a new scope for
@(see local) events.  This is often useful when you are trying to prove a
theorem that requires some lemmas: by proving the lemmas locally, you can
prevent them from affecting the rest of your book.&lt;/p&gt;

&lt;p&gt;It is often useful to organize books into sections.  There are a few minor
reasons you might prefer using @(&#39;defsection&#39;) for this, instead of plain
@(&#39;encapsulate&#39;)s.  For instance,&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;It is easier to identify in the @(&#39;:pbt&#39;) history, and&lt;/li&gt;

&lt;li&gt;It indents more nicely than @(&#39;encapsulate&#39;) in a vanilla emacs.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;But the main reasons to use @(&#39;defsection&#39;) are its documentation features.
The definitions and theorems within a section can be &lt;b&gt;automatically&lt;/b&gt;
included in the documentation page for that section, along with any running
commentary.  This helps to avoid copying-and-pasting code into the manual, and
keeps it up-to-date as the code changes.&lt;/p&gt;


&lt;h3&gt;Ordinary Sections&lt;/h3&gt;

&lt;p&gt;The @(&#39;:parents&#39;), @(&#39;:short&#39;), and @(&#39;:long&#39;) keywords are optional.  If
any of these keywords are provided, they will be used to introduce a @(see
defxdoc) command; otherwise no documentation will be generated.&lt;/p&gt;

&lt;p&gt;By default, the @(&#39;:long&#39;) string you give will be automatically extended
with a &quot;Definitions and Theorems&quot; part that lists all of the (non-local,
non-redundant) definitions and theorems introduced in the section.&lt;/p&gt;

&lt;p&gt;For instance, in the above example, the @(&#39;:long&#39;) field would be extended
with:&lt;/p&gt;

@({
 &lt;h3&gt;Definition and Theorems&lt;/h3&gt;

 @(def foo)
 @(thm foo-thm1)
 @(thm foo-thm2)

 &lt;p&gt;NOTE: the next theorem is really useful, but we keep it disabled
   because it gets too expensive when...&lt;/p&gt;

 @(thm foo-thm3)
})

&lt;p&gt;If you do not want this automatic documentation, you can turn it off with
@(&#39;:autodoc nil&#39;).&lt;/p&gt;

&lt;p&gt;If you want the section name to be the default parent for the encapsulated
events, then you can pass @(&#39;:set-as-default-parent t&#39;). Then @(&#39;(local
(xdoc::set-default-parents name))&#39;) will be inserted at the beginning of the
events, where &quot;name&quot; is the name of the section.&lt;/p&gt;

&lt;h3&gt;Extended Sections&lt;/h3&gt;

&lt;p&gt;The @(&#39;:extension&#39;) keyword allows you to say that this section is a
continuation of a previously introduced concept.&lt;/p&gt;

&lt;p&gt;When @(&#39;:extension topic&#39;) is provided, then @(&#39;topic&#39;) must be the name of
a previously documented @(see xdoc) section, and you are not allowed to use
@(&#39;:parents&#39;) or @(&#39;:short&#39;) since the topic already exists.  Note that whereas
topics can have multiple parents, you can only extend a single topic at a
time.&lt;/p&gt;

&lt;p&gt;The main purpose of an @(&#39;:extension&#39;) section is to add additional
documentation, either via the @(&#39;:long&#39;) string or via the automatic events and
commentary.  The documentation obtained this way is just appended onto the
existing @(&#39;:long&#39;) for the topic.&lt;/p&gt;

&lt;p&gt;For example, say we have already defined the above @(&#39;foo&#39;) section in some
&quot;basic&quot; book.  We might then want to add some additional &quot;advanced&quot;
theorems about it in some other book.  We could do this via:&lt;/p&gt;

@({
 (defsection advanced-theorems-about-foo
   :extension foo

   &quot;&lt;p&gt;Additional theorems are also available in the @(&#39;advanced&#39;) book.  (We
     don&#39;t include these in the basic book since they take a long time to
     prove.)&lt;/p&gt;&quot;

   (defthm foo-thm4 ...)
   (defthm foo-thm5 ...))
})

&lt;p&gt;This will result in the commentary and definitions of @(&#39;foo-thm4&#39;) and
@(&#39;foo-thm5&#39;) being added onto the end of the documentation for @(&#39;foo&#39;).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc defsection-progn
  <span class="keyword">:short</span> <span class="string">"Fancy @(&#39;(progn ...)&#39;) with a name and @(see xdoc) support."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;The @(&#39;defsection-progn&#39;) macro is like @(see defsection) except
that it generates @({(progn ...)}) instead of an @({(encapsulate nil ...)})&lt;/p&gt;

&lt;p&gt;This has a number of consequences, mostly having to do with the scope of
@(&#39;local&#39;) events within the section.  In short, a @(&#39;defsection-progn&#39;) does
not introduce a new local scope, but a @(&#39;defsection&#39;) does.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc undocumented
  <span class="keyword">:short</span> <span class="string">"Placeholder for documentation topics that lack good @(&#39;:parents&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Many @(see acl2::macros) such as @(see std::deflist) and other
@(see acl2::std/util) macros can automatically generate @(see xdoc)
documentation topics.&lt;/p&gt;

&lt;p&gt;When someone uses these macros but doesn&#39;t give any @(&#39;:parents&#39;) for the
resulting documentation, we put the resulting documentation here.  This seems
better than just dropping the documentation completely, since at least you can
at least see the boilerplate documentation and any embedded documentation that
the programmer did provide.&lt;/p&gt;

&lt;p&gt;As ongoing documentation improvement work, most topics here can benefit from
being given more appropriate @(&#39;:parents&#39;).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc missing-parents
  <span class="keyword">:short</span> <span class="string">"Placeholder for documentation topics that lack @(&#39;:parents&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;If a @(see defxdoc) form ends up having no parents, it ends up
being put here.  See also @(see undocumented).&lt;/p&gt;

&lt;p&gt;Historic note.  We used to put these topics directly underneath @(see top)
instead.  But we found that during development, this sometimes led to a
strange-looking hierarchy where ``random&#39;&#39; topics were presented as top-level
topics just because they were new or being moved around or because @(see
set-default-parents) forms weren&#39;t quite in the right places.  To avoid this,
we now move these topics to @(&#39;missing-parents&#39;) and print notes about them
when a manual is saved with @(see xdoc::save).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc set-default-parents
  <span class="keyword">:short</span> <span class="string">"Set up default parents to use for @(see xdoc)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;When documenting a book of inter-related functions, you may
sometimes wish to use the same @(&#39;:parents&#39;) across many @(see defxdoc) or
@(see defsection) commands.  This can sometimes get tedious.&lt;/p&gt;

&lt;p&gt;The macro @(call set-default-parents) can be used to set up a default list
of parent topics to be automatically used by commands such as @(see defxdoc)
and @(see defsection).&lt;/p&gt;

&lt;p&gt;Basic Example:&lt;/p&gt;

@({
   (local (set-default-parents fox-p))

   (defxdoc make-fox           ;; use default :parents, (fox-p)
     :short ...
     :long ...)

   (defsection feed-fox        ;; use default :parents, (fox-p)
     :short ...
     :long ...)

   (defsection chase-mouse     ;; use explicit :parents, (fox-p mouse-p)
     :parents (fox-p mouse-p)
     :short ...
     :long ...)

   (local (set-default-parents fox-p hawk-p))

   (defsection bother-hawk     ;; use default :parents, (fox-p hawk-p)
     :short ...
     :long ...)

   (local (set-default-parents nil))

   (defxdoc zebra-p            ;; use default :parents, nil
     :short ...
     :long ...)
})

&lt;p&gt;Note that @(&#39;set-default-parents&#39;) is just a macro that expands to a @(see
table) event.  It&#39;s good practice to only &lt;b&gt;locally&lt;/b&gt; set the default
parents&amp;mdash;otherwise the default parents can &quot;leak&quot; from your book and
lead you to inadvertently set the parents of other, unrelated topics.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc xdoc-extend
  <span class="keyword">:short</span> <span class="string">"Extend an existing XDOC topic with additional content."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Basic example:&lt;/p&gt;

@({
     (defxdoc foo
       :short &quot;Example of xdoc-extend.&quot;
       :long &quot;&lt;p&gt;Foo is very important.&lt;/p&gt;&quot;)

     (xdoc::xdoc-extend foo
       &quot;&lt;p&gt;Note: you can&#39;t use Foo with Bar.&lt;/p&gt;&quot;)
})

&lt;p&gt;is roughly equivalent to just writing:&lt;/p&gt;

@({
     (defxdoc foo
       :short &quot;Example of xdoc-extend.&quot;
       :long &quot;&lt;p&gt;Foo is very important.&lt;/p&gt;
               &lt;p&gt;Note: you can&#39;t use Foo with Bar.&lt;/p&gt;&quot;)
})

&lt;p&gt;@(call xdoc-extend) requires that @(&#39;name&#39;) is an existing XDOC topic, e.g.,
it may have been introduced with @(see defxdoc), @(see defsection), or similar.
We just look up that topic and extend its @(&#39;:long&#39;) string by appending the
new @(&#39;long&#39;) fragment to it.&lt;/p&gt;

&lt;p&gt;This mechanism is barbaric and fragile.  For instance:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;You can&#39;t put the new content anywhere except at the end of the current
@(&#39;long&#39;) string.  (But see @(see xdoc-prepend) if you want to extend the
beginning of a topic).&lt;/li&gt;

&lt;li&gt;If you extend a topic several times in different books, the resulting text
may differ depending on the particular @(see include-book) order that happens
to be used.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;Nevertheless, judiciously used, it can be a useful tool for connecting
together related content that must be kept in separate files, e.g., for
bootstrapping or other reasons.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc xdoc-prepend
  <span class="keyword">:short</span> <span class="string">"Extend an existing XDOC topic with additional content, at the front."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(call xdoc-prepend) is very much like @(see xdoc-extend), except
that it extends the @(&#39;:long&#39;) string for @(&#39;name&#39;) at the front, instead of at
the back.&lt;/p&gt;

&lt;p&gt;Basic example:&lt;/p&gt;

@({
     (defxdoc foo
       :short &quot;Example of xdoc-prepend.&quot;
       :long &quot;&lt;p&gt;Foo is very important.&lt;/p&gt;&quot;)

     (xdoc::xdoc-prepend foo
       &quot;&lt;p&gt;Never use Foo, use Bar instead!&lt;/p&gt;&quot;)
})

&lt;p&gt;is roughly equivalent to just writing:&lt;/p&gt;

@({
     (defxdoc foo
       :short &quot;Example of xdoc-prepend.&quot;
       :long &quot;&lt;p&gt;Never use Foo, use Bar instead!&lt;/p&gt;
               &lt;p&gt;Foo is very important.&lt;/p&gt;&quot;)
})

&lt;p&gt;See @(see xdoc-extend) for related commentary.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-subtopics
  <span class="keyword">:short</span> <span class="string">"Control the ordering of subtopics in the XDOC display."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;@(call order-subtopics) allows you to specify what order the
subtopics of @(&#39;name&#39;) will be presented in.  For instance:&lt;/p&gt;

@({
    (xdoc::order-subtopics mini-tutorial
      (example syntax semantics gotchas references))
})

&lt;p&gt;By default, XDOC shows subtopics in an alphabetical order.  For most
reference-manual material this is generally fine.  But, especially for tutorial
guides, you sometimes intend your topics to be read in some particular order,
and alphabetizing things gets in the way.&lt;/p&gt;

&lt;p&gt;The @(&#39;order-subtopics&#39;) command lets you specify the exact subtopic
ordering that should be used for a particular topic.  One general form is:&lt;/p&gt;

@({
    (xdoc::order-subtopics parent
      (subtopic1 subtopic2 ... subtopicn))
})

&lt;p&gt;You don&#39;t have to give a complete order.  Any subtopics that aren&#39;t
mentioned will be listed last, in the usual alphabetical order.&lt;/p&gt;

&lt;p&gt;A second general form has an optional argument of @(&#39;t&#39;).  This specifies
that the order for unspecified child topics is the order in which the topics
were defined, rather than alphabetical.&lt;/p&gt;

@({
    (xdoc::order-subtopics parent
      (subtopic1 subtopic2 ... subtopicn)
      t)
})

&lt;p&gt;A special case of that second general form lists no subtopics, thus
specifying simply that all children are to be listed in the order in which they
were defined.&lt;/p&gt;

@({
    (xdoc::order-subtopics parent
      nil
      t)
})

&lt;p&gt;We require @(&#39;parent&#39;) to refer to some defined topic, but the subtopics
don&#39;t need to be defined at @(&#39;order-subtopics&#39;) time.  This makes it easy to
keep the subtopic ordering close to the defxdoc command, e.g., you can
write:&lt;/p&gt;

@({
     (defxdoc mini-tutorial ...))
     (order-subtopics mini-tutorial (example syntax ...))

     (defxdoc example ...)
     (defxdoc syntax ...)
})

&lt;p&gt;We do at least warn about undefined topics when you @(see save) a
manual.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc xdoc-tests
  <span class="keyword">:short</span> <span class="string">"Topics that exist only to test XDOC functionality."</span>)</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (set-default-parents xdoc-tests))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc entities
  <span class="keyword">:parents</span> (xdoc xdoc-tests)
  <span class="keyword">:short</span> <span class="string">"HTML entity support in XDOC."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;h3&gt;Entities that XDOC allows:&lt;/h3&gt;

&lt;p&gt;Normal XML entities:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;amp;&#39;)   becomes &amp;amp;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;lt;&#39;)    becomes &amp;lt;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;gt;&#39;)    becomes &amp;gt;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;quot;&#39;)  becomes &amp;quot;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;apos;&#39;)  becomes &amp;apos;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Additional basic and math entities allowed by XDOC:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;nbsp;&#39;)  becomes &amp;nbsp; (that is, a single space)&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;mdash;&#39;) becomes &amp;mdash;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;larr;&#39;)  becomes &amp;larr;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;rarr;&#39;)  becomes &amp;rarr;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;harr;&#39;)  becomes &amp;harr;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;lang;&#39;)  becomes &amp;lang;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;rang;&#39;)  becomes &amp;rang;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;hellip;&#39;) becomes &amp;hellip;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;lsquo;&#39;) becomes &amp;lsquo;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;rsquo;&#39;) becomes &amp;rsquo;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ldquo;&#39;) becomes &amp;ldquo;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;rdquo;&#39;) becomes &amp;rdquo;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;and;&#39;)   becomes &amp;and;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;or;&#39;)    becomes &amp;or;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;not;&#39;)   becomes &amp;not;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ne;&#39;)    becomes &amp;ne;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;le;&#39;)    becomes &amp;le;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ge;&#39;)    becomes &amp;ge;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;mid;&#39;)   becomes &amp;mid;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;times;&#39;) becomes &amp;times;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Capitalized Greek letters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;Alpha;&#39;) becomes &amp;Alpha;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Beta;&#39;) becomes &amp;Beta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Gamma;&#39;) becomes &amp;Gamma;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Delta;&#39;) becomes &amp;Delta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Epsilon;&#39;) becomes &amp;Epsilon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Zeta;&#39;) becomes &amp;Zeta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Eta;&#39;) becomes &amp;Eta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Theta;&#39;) becomes &amp;Theta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Iota;&#39;) becomes &amp;Iota;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Kappa;&#39;) becomes &amp;Kappa;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Lambda;&#39;) becomes &amp;Lambda;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Mu;&#39;) becomes &amp;Mu;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Nu;&#39;) becomes &amp;Nu;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Xi;&#39;) becomes &amp;Xi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Omicron;&#39;) becomes &amp;Omicron;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Pi;&#39;) becomes &amp;Pi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Rho;&#39;) becomes &amp;Rho;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Sigma;&#39;) becomes &amp;Sigma;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Tau;&#39;) becomes &amp;Tau;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Upsilon;&#39;) becomes &amp;Upsilon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Phi;&#39;) becomes &amp;Phi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Chi;&#39;) becomes &amp;Chi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Psi;&#39;) becomes &amp;Psi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Omega;&#39;) becomes &amp;Omega;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Lower case Greek letters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;alpha;&#39;) becomes &amp;alpha;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;beta;&#39;) becomes &amp;beta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;gamma;&#39;) becomes &amp;gamma;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;delta;&#39;) becomes &amp;delta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;epsilon;&#39;) becomes &amp;epsilon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;zeta;&#39;) becomes &amp;zeta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;eta;&#39;) becomes &amp;eta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;theta;&#39;) becomes &amp;theta;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;iota;&#39;) becomes &amp;iota;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;kappa;&#39;) becomes &amp;kappa;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;lambda;&#39;) becomes &amp;lambda;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;mu;&#39;) becomes &amp;mu;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;nu;&#39;) becomes &amp;nu;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;xi;&#39;) becomes &amp;xi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;omicron;&#39;) becomes &amp;omicron;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;pi;&#39;) becomes &amp;pi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;rho;&#39;) becomes &amp;rho;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;sigma;&#39;) becomes &amp;sigma;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;tau;&#39;) becomes &amp;tau;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;upsilon;&#39;) becomes &amp;upsilon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;phi;&#39;) becomes &amp;phi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;chi;&#39;) becomes &amp;chi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;psi;&#39;) becomes &amp;psi;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;omega;&#39;) becomes &amp;omega;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Capitalized letters with diacritics:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;Ccedil;&#39;) becomes &amp;Ccedil;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Aacute;&#39;) becomes &amp;Aacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Agrave;&#39;) becomes &amp;Agrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Acirc;&#39;) becomes &amp;Acirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Atilde;&#39;) becomes &amp;Atilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Auml;&#39;) becomes &amp;Auml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Aring;&#39;) becomes &amp;Aring;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Egrave;&#39;) becomes &amp;Egrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Eacute;&#39;) becomes &amp;Eacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ecirc;&#39;) becomes &amp;Ecirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Euml;&#39;) becomes &amp;Euml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Igrave;&#39;) becomes &amp;Igrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Iacute;&#39;) becomes &amp;Iacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Icirc;&#39;) becomes &amp;Icirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Iuml;&#39;) becomes &amp;Iuml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ntilde;&#39;) becomes &amp;Ntilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ograve;&#39;) becomes &amp;Ograve;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Oacute;&#39;) becomes &amp;Oacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ocirc;&#39;) becomes &amp;Ocirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Otilde;&#39;) becomes &amp;Otilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ouml;&#39;) becomes &amp;Ouml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ugrave;&#39;) becomes &amp;Ugrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Uacute;&#39;) becomes &amp;Uacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Ucirc;&#39;) becomes &amp;Ucirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Uuml;&#39;) becomes &amp;Uuml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Aogon;&#39;) becomes &amp;Aogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Eogon;&#39;) becomes &amp;Eogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Iogon;&#39;) becomes &amp;Iogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Uogon;&#39;) becomes &amp;Uogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;Nacute;&#39;) becomes &amp;Nacute;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Lower case letters with diacritics:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;ccedil;&#39;) becomes &amp;ccedil;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;aacute;&#39;) becomes &amp;aacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;agrave;&#39;) becomes &amp;agrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;acirc;&#39;) becomes &amp;acirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;atilde;&#39;) becomes &amp;atilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;auml;&#39;) becomes &amp;auml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;aring;&#39;) becomes &amp;aring;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;egrave;&#39;) becomes &amp;egrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;eacute;&#39;) becomes &amp;eacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ecirc;&#39;) becomes &amp;ecirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;euml;&#39;) becomes &amp;euml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;igrave;&#39;) becomes &amp;igrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;iacute;&#39;) becomes &amp;iacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;icirc;&#39;) becomes &amp;icirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;iuml;&#39;) becomes &amp;iuml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ntilde;&#39;) becomes &amp;ntilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ograve;&#39;) becomes &amp;ograve;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;oacute;&#39;) becomes &amp;oacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ocirc;&#39;) becomes &amp;ocirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;otilde;&#39;) becomes &amp;otilde;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ouml;&#39;) becomes &amp;ouml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ugrave;&#39;) becomes &amp;ugrave;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;uacute;&#39;) becomes &amp;uacute;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;ucirc;&#39;) becomes &amp;ucirc;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;uuml;&#39;) becomes &amp;uuml;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;aogon;&#39;) becomes &amp;aogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;eogon;&#39;) becomes &amp;eogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;iogon;&#39;) becomes &amp;iogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;uogon;&#39;) becomes &amp;uogon;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;nacute;&#39;) becomes &amp;nacute;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Mathematical symbols:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;&amp;forall;&#39;) becomes &amp;forall;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;exist;&#39;) becomes &amp;exist;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;empty;&#39;) becomes &amp;empty;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;isin;&#39;) becomes &amp;isin;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;notin;&#39;) becomes &amp;notin;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;prod;&#39;) becomes &amp;prod;&lt;/li&gt;
&lt;li&gt;@(&#39;&amp;sum;&#39;) becomes &amp;sum;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;A few tests&lt;/h3&gt;

&lt;p&gt;Test of `single&#39; and ``double&#39;&#39; smart quoting for legacy topics.&lt;/p&gt;

&lt;p&gt;Test of &amp;lsquo;single&amp;rsquo; and &amp;ldquo;double&amp;rdquo; smart quoting for
regular old entities.&lt;/p&gt;

&lt;p&gt;Test of &lt;tt&gt;`single&#39; and ``double&#39;&#39;&lt;/tt&gt; quotes in a @(&#39;&lt;tt&gt;&#39;) tag and in
a @(&#39;&lt;code&gt;&#39;) tag:&lt;/p&gt;

&lt;code&gt;`single&#39; and ``double&#39;&#39;&lt;/code&gt;

&lt;p&gt;Test of @(&#39; `single&#39; and ``double&#39;&#39; &#39;) quotes in inline preprocessor stuff,
and in preprocessor blocks here:&lt;/p&gt;

@({ `single&#39; and ``double&#39;&#39; quotes ! })

&lt;p&gt;Test of primes in math: @($ foo&#39; $) and&lt;/p&gt;

@([ foo&#39; ])

&lt;p&gt;That should probably about do it.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(order-subtopics xdoc-tests
  (order-test-w order-test-o
    order-test-r
    order-test-z-intentionally-missing
    order-test-k
    order-test-s))</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-s <span class="keyword">:short</span> <span class="string">"S"</span>)</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-w <span class="keyword">:short</span> <span class="string">"W"</span>)</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-r <span class="keyword">:short</span> <span class="string">"R"</span>)</pre>
  </div>

<div class="form-block other" id="form-32" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-o <span class="keyword">:short</span> <span class="string">"O"</span>)</pre>
  </div>

<div class="form-block other" id="form-33" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-k <span class="keyword">:short</span> <span class="string">"K"</span>)</pre>
  </div>

<div class="form-block other" id="form-34" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc xdoc-test-order-subtopics-flg
  <span class="keyword">:short</span> <span class="string">"Parent topic for testing chronological order of subtopics."</span>)</pre>
  </div>

<div class="form-block other" id="form-35" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(order-subtopics xdoc-test-order-subtopics-flg
  (order-test-flg-move-to-front)
  <a class="sym-link system" href="../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-36" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (set-default-parents xdoc-test-order-subtopics-flg))</pre>
  </div>

<div class="form-block other" id="form-37" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-w <span class="keyword">:short</span> <span class="string">"W"</span>)</pre>
  </div>

<div class="form-block other" id="form-38" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-o <span class="keyword">:short</span> <span class="string">"O"</span>)</pre>
  </div>

<div class="form-block other" id="form-39" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-o <span class="keyword">:short</span> <span class="string">"O"</span>)</pre>
  </div>

<div class="form-block other" id="form-40" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-move-to-front
  <span class="keyword">:short</span> <span class="string">"Move to front"</span>)</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-r <span class="keyword">:short</span> <span class="string">"R"</span>)</pre>
  </div>

<div class="form-block other" id="form-42" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-k <span class="keyword">:short</span> <span class="string">"K"</span>)</pre>
  </div>

<div class="form-block other" id="form-43" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc order-test-flg-s <span class="keyword">:short</span> <span class="string">"S"</span>)</pre>
  </div>

<div class="form-block other" id="form-44" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../axioms.html#def-local" data-sym="LOCAL">local</a> (set-default-parents xdoc))</pre>
  </div>

<div class="form-block other" id="form-45" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc katex-integration
  <span class="keyword">:short</span> <span class="string">"Support for LaTeX-like typesetting of mathematics in XDOC
topics. (experimental)"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;box&gt;&lt;p&gt;&lt;b&gt;Experimental.&lt;/b&gt; This whole thing is experimental.  Jared
reserves the right to decide it is a bad idea and remove support for
it.&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;The &lt;a href=&#39;https://www.khanacademy.org/&#39;&gt;Khan Academy&lt;/a&gt; has developed a
very nice Javascript library, &lt;a
href=&#39;https://github.com/Khan/KaTeX&#39;&gt;KaTeX&lt;/a&gt;, for rendering mathematical
formulas in the web browser.  We have now integrated KaTeX into XDOC&#39;s fancy
web-based viewer, allowing you to typeset basic formulas.&lt;/p&gt;


&lt;h3&gt;Basic Usage&lt;/h3&gt;

&lt;box&gt;&lt;p&gt;&lt;b&gt;&lt;color rgb=&#39;#ff0000&#39;&gt;ESCAPING WARNING&lt;/color&gt;&lt;/b&gt;. LaTeX-style
formulas may be especially hard to type in ordinary ACL2 string literals
because you have to escape all the backslashes.  For instance, you have to
remember to write @(&#39;\\sqrt{x}&#39;) instead of @(&#39;\sqrt{x}&#39;).  You can avoid
this headache by using the @(see acl2::fancy-string-reader). In the rest of
this document, we will use the concrete xdoc syntax without the escapes for
simplicity.&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;To typeset block-style formulas, you can use the @(&#39;@([...])&#39;) @(see
preprocessor) directive, e.g.,:&lt;/p&gt;

@({
    @([
       c = \pm\sqrt{a^2 + b^2}
    ])
})

&lt;p&gt;Produces an indented block of mathematics:&lt;/p&gt;

@([
    c = \pm\sqrt{a^2 + b^2}
])

&lt;p&gt;You can also write inline math using @(&#39;@($...$)&#39;) directive, for
instance:&lt;/p&gt;

@({
     The product @($a \times b$) is even.
})

&lt;p&gt;Produces text such as: the product @($a \times b$).&lt;/p&gt;


&lt;h3&gt;Tips and Tricks&lt;/h3&gt;

&lt;h5&gt;Fast Preview.&lt;/h5&gt;

&lt;p&gt;The &lt;a href=&#39;formula.html&#39;&gt;KaTeX Preview&lt;/a&gt; page lets you interactively
type in your formula and see how it will be typeset.  It may be especially
helpful since KaTeX only supports a particular subset of LaTeX.&lt;/p&gt;

&lt;h5&gt;Invalid Formulas.&lt;/h5&gt;

&lt;p&gt;Invalid formulas will display as an ugly error message.  For instance, here
is an invalid @(&#39;@([ ... ])&#39;) style formula:&lt;/p&gt;

@([
      { there is no closing brace
])

&lt;p&gt;And here is an invalid @(&#39;@($...$)&#39;) style formula,
@($
      { there is no closing brace
$), embedded in a paragraph.&lt;/p&gt;

&lt;h3&gt;Miscellaneous Notes&lt;/h3&gt;

&lt;p&gt;The preprocessor directives expand into @(&#39;&lt;math&gt;&#39;) and @(&#39;&lt;mathfrag&gt;&#39;)
tags.  But you will probably want to stick to the preprocessor syntax, rather
than directly using @(&#39;&lt;math&gt;&#39;) tags, because if you try to use raw @(&#39;&lt;math&gt;&#39;)
tags then you have to remember to escape XML characters like @(&#39;&lt;&#39;) with
@(&#39;&amp;lt;&#39;), which just isn&#39;t very readable.&lt;/p&gt;

&lt;p&gt;All of this is fundamentally limited to the web-based viewer.  It seems very
unlikely that @(&#39;&lt;math&gt;&#39;) formulas will ever look nice when shown at the
terminal with @(&#39;:doc&#39;) or in the ACL2-Doc Emacs viewer.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-46" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc defpointer
  <span class="keyword">:short</span> <span class="string">"Define an alias for a documentation topic."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Examples:&lt;/p&gt;

@({
    (defpointer acl2s acl2-sedan)
    (defpointer guard-hints xargs t)
})

&lt;p&gt;General Form:&lt;/p&gt;

@({
    (defpointer new-topic target-topic [keyword-p])
})

&lt;p&gt;This is a simple macro that expands to a @(see defxdoc) form.  It introduces
a new @(see xdoc) topic, @(&#39;new-topic&#39;), that merely links to
@(&#39;target-topic&#39;).  The new topic will only be listed under @(see
pointers).&lt;/p&gt;

&lt;p&gt;A common practice when documenting keyword symbols is to create a
doc topic in in the &quot;ACL2&quot; package or some other relevant package,
rather than the &quot;KEYWORD&quot; package to which the keyword symbol
rightfully belongs.  In keeping with this practice, the @(&#39;keywordp&#39;)
argument to @(&#39;defpointer&#39;), if non-nil, adds a clarification that the
doc topic is really about the keyword symbol with the same name as
@(&#39;new-topic&#39;), rather than @(&#39;new-topic&#39;) itself.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-47" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc add-resource-directory
  <span class="keyword">:short</span> <span class="string">"Tell @(see xdoc) about directories of resources (e.g., images, PDF
files, etc.) that should be copied into manuals."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Occasionally you may wish to include images or other files within
an XDOC documentation topic.  For this to work, XDOC&#39;s @(see save) command
needs to know about these files so that it can copy them into the manual it
produces.  The @(&#39;add-resource-directory&#39;) command lets you tell XDOC which
directories to copy and what to name them.&lt;/p&gt;

&lt;h3&gt;Example&lt;/h3&gt;

&lt;p&gt;Suppose that in the @(&#39;vl&#39;) library there are some images that we want to
include in the manual.  We can put these images into a directory, say
@(&#39;images&#39;), and then do:&lt;/p&gt;

@({
    (xdoc::add-resource-directory &quot;vl&quot; &quot;images&quot;)
})

&lt;p&gt;This will cause the @(see xdoc::save) command to copy everything from the
@(&#39;images&#39;) directory into the @(&#39;res/vl&#39;) directory of our manual.  To refer
to these images, we can then write @(see markup) such as:&lt;/p&gt;

@({
    &lt;img src=&quot;res/vl/logo.jpg&quot;/&gt;
})

&lt;p&gt;These resource directories might also contain files other than images, for
instance, PDF files.  You can at provide hyperlinks to these files by just
linking into the @(&#39;res&#39;) directory, for instance:&lt;/p&gt;

@({
    &lt;a href=&quot;res/vl/slides.pdf&quot;&gt;See the Slides!&lt;/a&gt;
})


&lt;h3&gt;General form&lt;/h3&gt;

@({
    (xdoc::add-resource-directory dirname path)
})


&lt;ul&gt;

&lt;li&gt;&lt;b&gt;dirname&lt;/b&gt; controls where the directory will be placed in within the
manual&#39;s @(&#39;res&#39;) directory.  In the example above, the @(&#39;dirname&#39;) is
@(&#39;&quot;vl&quot;&#39;) so the files will be copied into @(&#39;&quot;res/vl&quot;&#39;).&lt;/li&gt;

&lt;li&gt;&lt;b&gt;path&lt;/b&gt; controls where the files will be copied from.  We recommend
always using a simple path such as the name of an immediate subdirectory.&lt;/li&gt;

&lt;/ul&gt;

&lt;h3&gt;Working example&lt;/h3&gt;

&lt;p&gt;The directory @(&#39;books/xdoc/centaur&#39;) contains a @(&#39;centaur-logo.png&#39;) file.
The file @(&#39;xdoc/topics.lisp&#39;) adds this directory as a resource directory.  If
all is well, you should see the logo below:&lt;/p&gt;

&lt;img src=&#39;res/centaur/centaur-logo.png&#39;/&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-48" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(add-resource-directory <span class="string">"centaur"</span> <span class="string">"centaur"</span>)</pre>
  </div>

<div class="form-block other" id="form-49" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc testing
  <span class="keyword">:short</span> <span class="string">"Testing new or revised XDOC strings"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Contributors to the XDOC manual should check that their XDOC
 strings are well-formed.  This topic shows an easy way to check
 well-formedness of XDOC strings, without the need to build the manual.  Also
 discussed is a way to check for the absence of broken links by building the
 manual.&lt;/p&gt;

 &lt;p&gt;To test a topic, first submit a suitable @(tsee in-package) form if
 necessary, and then to test your topic named, say, @(&#39;FOO&#39;):&lt;/p&gt;

 @({
 (include-book &quot;xdoc/top&quot; :dir :system)
 (defxdoc ...) ; or whatever form you have that includes an XDOC string
 :doc foo ; a bit noisy and slow the first time, but could do this twice
 })

 &lt;p&gt;The output should be free of obvious errors.  Otherwise, you can use the
 error message to debug the error; then submit your form and @(&#39;:doc foo&#39;)
 again.&lt;/p&gt;

 &lt;p&gt;A XDOC feature (the second ``NEW&#39;&#39; feature in the @(see xdoc)
 documentation) avoids the need to invoke @(&#39;:doc&#39;) explicitly.  In brief: you
 can simply include community-book @(&#39;xdoc/debug&#39;), for example by putting its
 include-book form in your acl2-customization file (see @(see
 acl2::acl2-customization)).&lt;/p&gt;

 &lt;p&gt;Checking for broken links requires you to build the manual; for
 instructions, see the section ``Building the manual&#39;&#39; in the topic @(see
 acl2::books-certification).  This build will create a file
 @(&#39;books/doc/top.cert.out&#39;).  Search in that file for the word ``broken&#39;&#39; and
 you will find the following report of a broken link:&lt;/p&gt;

 @({
 ;;; ACL2____SOME-BROKEN-LINK:
 ;;;    from ACL2-DOC
 })

 &lt;p&gt;If any other broken links are reported, you can modify the parent topic
 (e.g., @(&#39;ACL2-DOC&#39;) just above &amp;mdash; but please leave that one in place!)
 to fix the indicated broken link.&lt;/p&gt;

 &lt;p&gt;The @(&#39;:short&#39;) and @(&#39;:long&#39;) strings, if supplied, must consist entirely
 of standard characters (see @(see standard-char-p)), except that tabs are also
 allowed.  Making this check requires you to build the manual (as described
 just above).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-50" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defpointer build-the-manual xdoc)</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>