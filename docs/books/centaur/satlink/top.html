<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>top - ACL2 Book</title>
  <meta property="name" content="top">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">top</h1>
    <div class="path"><a href="top.lisp" class="source-link">books/centaur/satlink/top</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"SATLINK"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="cnf.html" title="Open cnf">"cnf"</a>)</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="dimacs.html" title="Open dimacs">"dimacs"</a>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="lrat-interface.html" title="Open lrat-interface">"lrat-interface"</a>)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../projects/sat/lrat/sorted/lrat-parser.html" title="Open projects/sat/lrat/sorted/lrat-parser">"projects/sat/lrat/sorted/lrat-parser"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/strings/decimal.html" title="Open std/strings/decimal">"std/strings/decimal"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/strings/strnatless.html" title="Open std/strings/strnatless">"std/strings/strnatless"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/strings/defs.html" title="Open std/strings/defs">"std/strings/defs"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../oslib/tempfile.html" title="Open oslib/tempfile">"oslib/tempfile"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/misc/tshell.html" title="Open centaur/misc/tshell">"centaur/misc/tshell"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="config.html" title="Open config">"config"</a>)</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/lists/nthcdr.html" title="Open std/lists/nthcdr">"std/lists/nthcdr"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc satlink
  <span class="keyword">:parents</span> (boolean-reasoning)
  <span class="keyword">:short</span> <span class="string">"A simple representation for Boolean formulas in &lt;see topic=&#39;@(url
cnf)&#39;&gt;conjunctive normal form&lt;/see&gt;, and a mechanism for calling SAT solvers
from within ACL2 and trusting what they say. (CCL Only)"</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;SAT solvers are programs that can solve the &lt;a
href=&#39;https://en.wikipedia.org/wiki/Boolean_satisfiability_problem&#39;&gt;Boolean
satisfiability problem&lt;/a&gt;.  Modern solvers implement clever algorithms in fast
languages like C and C++, so they can quickly solve many large problems.
Developing faster SAT solvers is an active area of research with frequent &lt;a
href=&#39;http://www.satcompetition.org/&#39;&gt;competitions&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;SAT solvers are useful because many problems can be recast as SAT problems.
For instance, the @(see gl) framework can translate many ACL2 proof goals,
e.g., bounded arithmetic problems, into SAT problems.  This allows for a large
class of theorems to be solved quickly and automatically by the SAT solver.
This is especially useful in @(see acl2::hardware-verification).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Satlink&lt;/b&gt; is an interfacing library that allows ACL2 to make use of
off-the-shelf SAT solvers like &lt;a
href=&#39;http://fmv.jku.at/lingeling/&#39;&gt;lingeling&lt;/a&gt;, &lt;a
href=&#39;http://www.labri.fr/perso/lsimon/glucose/&#39;&gt;glucose&lt;/a&gt;, and so on; see
@(see sat-solver-options) for download and build help.  It provides:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;A (trivial) representation and semantics for Boolean formulas in
conjunctive normal form; see @(see cnf).&lt;/li&gt;

&lt;li&gt;A function, @(see sat), that can invoke a SAT solver on a formula and
interpret its output.  This is done via @(see acl2::tshell), so the integration
is very smooth, e.g., you can interrupt the SAT solver.&lt;/li&gt;

&lt;li&gt;A @(see logical-story) that allows us to &lt;color rgb=&#39;#ff0000&#39;&gt;&lt;b&gt;assume,
using a &lt;see topic=&#39;@(url defttag)&#39;&gt;trust tag&lt;/see&gt;&lt;/b&gt;&lt;/color&gt;, that when the
SAT solver claims the formula is unsatisfiable, it&#39;s correct.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;We don&#39;t have to assume anything when the SAT solver claims that a formula
is satisfiable, since we can just check the alleged satisfying assignment it
produces.&lt;/p&gt;

&lt;p&gt;The soundness threat may be reduced by checking the output of the SAT
solver.  There has been recent progress in the SAT community toward
standardizing formats for UNSAT proofs, reducing the overhead of producing
these proofs, and developing fast tools to check these proofs.  Satlink
includes, e.g., a @(&#39;glucose-cert&#39;) script that implements this idea; see @(see
sat-solver-options).&lt;/p&gt;


&lt;h3&gt;Loading the Library&lt;/h3&gt;

&lt;p&gt;Satlink is a low-level library.  It would be a bit weird to want to use it
directly.  Instead, it is typically used indirectly through other tools, such
as the @(see gl) framework, or @(see acl2::aig-sat), or the @(see
aignet::aignet-cnf) translation.  These other approaches are likely to be more
convenient than using Satlink directly.&lt;/p&gt;

&lt;p&gt;If you want to include Satlink directly for some reason, the book to include
is:&lt;/p&gt;

@({
 (include-book &quot;centaur/satlink/top&quot; :dir :system)
})

&lt;p&gt;Once you load this book, you generally need to construct your input @(see
cnf) formula in some way, and then call @(see sat).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc sat-solver-options
  <span class="keyword">:parents</span> (satlink)
  <span class="keyword">:short</span> <span class="string">"How to get a SAT solver that you can use with @(see satlink)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;To use Satlink you will need at least one SAT solver.  Below are
some solvers that are known to work well with Satlink.  You may wish to install
several of these.  This lets you switch between solvers to figure out which
solver is best for your particular problem, and perhaps to gain some additional
confidence that a particular problem really is unsatisfiable (by checking it
with many solvers.)&lt;/p&gt;

&lt;p&gt;Special recommendations are for Glucose (no longer the most modern or
highest-performing, but adequate and needed for certifying certain ACL2
community books) and Kissat (as of 2020, the best-performing free/open-source
solver).&lt;/p&gt;


&lt;h3&gt;&lt;a href=&#39;http://www.labri.fr/perso/lsimon/glucose/&#39;&gt;Glucose&lt;/a&gt; &amp;mdash;
open source, recommended&lt;/h3&gt;

&lt;p&gt;Based on our experiences using @(see gl) for proofs about hardware modules
at Centaur, we usually try Glucose first.  On Linux, version 3.0, 4.0, or 4.1
should work with Satlink without modification (though, some users have had
difficulty with 4.0).  (We have also successfully used earlier versions with
Satlink, but occasionally needed to patch them in minor ways, e.g., to print
counterexamples.)&lt;/p&gt;

&lt;p&gt;Quick instructions:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Download Glucose 3.0 and extract @(&#39;glucose-3.0.tgz&#39;) somewhere&lt;/li&gt;
&lt;li&gt;@(&#39;cd glucose-3.0/core; make&#39;)&lt;/li&gt;
&lt;li&gt;@(&#39;cd glucose-3.0/simp; make&#39;)&lt;/li&gt;
&lt;li&gt;Verify that @(&#39;glucose-3.0/simp/glucose --help&#39;) prints a help message&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;(NOTE for Mac and FreeBSD/PCBSD users: If you are building Glucose 3.0 or
4.0, the build might fail.  In that case, a solution may be first to make the
replacements shown below, where the the first in each pair (@(&#39;&lt;&#39;)) is the
Mac/FreeBSD/PCBSD version, while the second in each pair (@(&#39;&gt;&#39;)) is the
original source.  (Thanks to Marijn Heule and Warren Hunt for these
suggestions.)&lt;/p&gt;

&lt;p&gt;In file @(&#39;../glucose-3.0/core/SolverTypes.h&#39;):&lt;/p&gt;

@({
&lt;     // friend Lit mkLit(Var var, bool sign = false);
---
&gt;     friend Lit mkLit(Var var, bool sign = false);

&lt; inline  Lit  mkLit     (Var var, bool sign = false) { Lit p; p.x =
var + var + (int)sign; return p; }
---
&gt; inline  Lit  mkLit     (Var var, bool sign) { Lit p; p.x = var + var + (int)sign; return p; }

})

&lt;p&gt;In the file @(&#39;../glucose-3.0/utils/System.cc&#39;) comment the line below, but
note that this is probably only necessary for FreeBSD/PCBSD, not for Mac:&lt;/p&gt;

@({
   &lt;   // double MiniSat::memUsedPeak(void) { return memUsed(); }
   ---
   &gt;   double MiniSat::memUsedPeak(void) { return memUsed(); }
})

&lt;p&gt;End of NOTE for Mac and FreeBSD/PCBSD users.)&lt;/p&gt;

&lt;p&gt;Now create a shell script as follows, somewhere in your @(&#39;$PATH&#39;), named
@(&#39;glucose&#39;).  Note that the order of the arguments is important.&lt;/p&gt;

@({
    #!/bin/sh
    /path/to/glucose-3.0/simp/glucose -model &quot;$@&quot;
})

&lt;p&gt;As a quick test to make sure things are working, you can try to certify this
book (where below, &amp;ldquo;[books]&amp;rdquo; refers to the community books
directory):&lt;/p&gt;

@({
    cd [books]/centaur/satlink/solvers
    cert.pl test-glucose
})

&lt;p&gt;You should now be able to use Satlink with configurations such as:&lt;/p&gt;

@({
    (satlink::make-config :cmdline &quot;glucose&quot;)
})

&lt;p&gt;Glucose can (optionally) produce UNSAT proofs that can be checked by a
simpler program.  Satlink includes a script that makes it easy to run the
solver and then check any UNSAT answers.  See @(see unsat-checking) for more
information.&lt;/p&gt;



&lt;h3&gt;&lt;a href=&#39;http://www.cril.univ-artois.fr/~hoessen/penelope.html&#39;&gt;Penelope&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Penelope is a (mostly) open-source, parallel sat solver.  The build process
is simple: run @(&#39;make&#39;) and add the resulting @(&#39;penelope&#39;) executable to your
@(&#39;PATH&#39;).  As a quick test to ensure things are working, you can try to
certify this book:&lt;/p&gt;

@({
    cd [books]/centaur/satlink/solvers
    cert.pl test-penelope
})

&lt;p&gt;Note that you will usually need to point Penelope at a configuration file
that tells it, e.g., how many cores to use.  The Penelope distribution has a
@(&#39;configuration.ini&#39;) file that you can start with.  You can then use a
Satlink configuration like:&lt;/p&gt;

@({
    (satlink::make-config
     :cmdline &quot;penelope -config=/path/to/configuration.ini&quot;)
})

&lt;p&gt;We are not aware of any UNSAT proof support for this solver.&lt;/p&gt;


&lt;h3&gt;&lt;a href=&#39;http://fmv.jku.at/lingeling/&#39;&gt;Lingeling&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;An older version of Lingeling (Version ALA) is released under an open
source (GPL3) license.  For most of our problems, we found this version to be
somewhat slower than Glucose 2.1.  Of course, our experiences may not be
representative.&lt;/p&gt;

&lt;p&gt;Newer versions of Lingeling are available under a more restrictive license.
These modern versions fared very well in the recent SAT competitions, so if the
license does not pose a problem for you, it may well be worth trying.&lt;/p&gt;

&lt;p&gt;For the open source version ALA, the build process is simple: download and
extract the tarball, run @(&#39;./configure&#39;) and @(&#39;make&#39;), and then add the
resulting @(&#39;lingeling&#39;) and/or @(&#39;plingeling&#39;) executables to your PATH.  As a
quick test to ensure things are working, you can try to certify these
books:&lt;/p&gt;

@({
    cd [books]/centaur/satlink/solvers
    cert.pl test-lingeling
    cert.pl test-plingeling
})

&lt;p&gt;Newer versions of Lingeling are allegedly able to produce unsat proofs, but
we haven&#39;t figured out how to make it work.&lt;/p&gt;

&lt;h3&gt;&lt;a href=&#39;http://fmv.jku.at/kissat/&#39;&gt;Kissat&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Variants of Kissat won most of the major tracks at the 2022 SAT
competition. It can also be found on Github &lt;a
href=&#39;https://github.com/arminbiere/kissat&#39;&gt;here&lt;/a&gt;. It is built using a
standard @(&#39;configure&#39;) followed by @(&#39;make&#39;); run @(&#39;./configure -h&#39;) to see
options.&lt;/p&gt;


&lt;h3&gt;&lt;a
href=&#39;http://tools.computational-logic.org/content/riss3g.php&#39;&gt;Riss3G&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The Riss3g solver is a (mostly) open-source variant of Glucose that did
fairly well in recent competitions and seems to be sometimes faster than
Glucose.&lt;/p&gt;

&lt;p&gt;The build process was reasonably straightforward.  After building, put the
resulting @(&#39;riss3g&#39;) and @(&#39;riss3gSimp&#39;) programs into your @(&#39;PATH&#39;).  As a
quick test to ensure things are working, you can try to certify these
books:&lt;/p&gt;

@({
    cd [books]/centaur/satlink/solvers
    cert.pl test-riss3g
    cert.pl test-riss3gSimp
})

&lt;p&gt;Like Glucose, @(&#39;riss3g&#39;) has an ability to produce unsat proofs that can be
checked with an external program.  Satlink includes a script that makes it easy
to run the solver and then check any UNSAT answers.  See @(see unsat-checking)
for more information.&lt;/p&gt;


&lt;h3&gt;Other Solvers&lt;/h3&gt;

&lt;p&gt;In principle, Satlink should work with any SAT solver that implements the
DIMACS format.  This format is used in the &lt;a
href=&#39;http://www.satcompetition.org/&#39;&gt;SAT competitions&lt;/a&gt;, so it is
implemented by many solvers.  Accordingly, you may wish to look at, e.g., the
&lt;a href=&#39;http://www.satcompetition.org/2013/results.shtml&#39;&gt;SAT Competition
Results&lt;/a&gt; to get ideas about what SAT solvers are likely to perform well.&lt;/p&gt;

&lt;p&gt;Getting a new solver to work with Satlink &lt;i&gt;should&lt;/i&gt; be straightforward.
Typically you will need to install the solver, add it to your @(&#39;PATH&#39;), and
then figure out how to run it.  Satlink expects to be able to invoke the solver
using:&lt;/p&gt;

@({
     &lt;solver-command&gt; &lt;input-file&gt;
})

&lt;p&gt;Sometimes a solver may need extra command-line arguments.  For instance,
Glucose needs a @(&#39;-model&#39;) switch or it won&#39;t print the satisfying
assignment (i.e., @(&#39;v&#39;) lines) in case of SAT.  You might be able to write a
small script to supply these arguments, e.g., as in the @(&#39;glucose&#39;) script
above.&lt;/p&gt;

&lt;p&gt;To test out your new solver, Satlink includes a primitive @(see
check-config) command that you can use to try your solver on a handful of
trivial problems.  This is a very good way to make sure that at least the basic
i/o contract seems to be working.  It should be easy to adapt one of the
@(&#39;test-&#39;) scripts in the @(&#39;centaur/satlink/solvers&#39;) directory to suit your
solver.&lt;/p&gt;

&lt;p&gt;If the @(&#39;check-config&#39;) passes and you want a more thorough check, you
might try to run your new solver on, e.g., @(&#39;centaur/esim/tutorial/sat.lsp&#39;)
and the various files in @(&#39;centaur/regression&#39;).&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection unsat-checking
  <span class="keyword">:parents</span> (sat-solver-options)
  <span class="keyword">:short</span> <span class="string">"Options for running SAT solvers that produce UNSAT proofs."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;For higher confidence (at some cost to runtime), some SAT solvers
are able to produce UNSAT proofs.  Small programs such as &lt;a
href=&#39;http://www.cs.utexas.edu/~marijn/drat-trim/&#39;&gt;drat-trim&lt;/a&gt; can check
these proofs, to ensure the SAT solver reasoned correctly.&lt;/p&gt;

&lt;p&gt;Satlink now includes Perl scripts that can make use of this capability for
the Glucose and Riss3g solvers.  In particular, see the following scripts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;centaur/satlink/solvers/glucose-cert&#39;)&lt;/li&gt;
&lt;li&gt;@(&#39;centaur/satlink/solvers/riss3g-cert&#39;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The general idea of these scripts is, e.g., for Glucose:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;We first call Glucose to solve the problem;&lt;/li&gt;

&lt;li&gt;When Glucose reports SAT, we just exit (because Satlink can check the
satisfying assignment itself); or&lt;/li&gt;

&lt;li&gt;When Glucose reports UNSAT, we check the proof using the Drat-Trim unsat
proof checker.  We only print an &quot;s UNSATISFIABLE&quot; line if Drat-Trim says
that the proof is ok.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;All of this works well with Satlink.  You can still see the output from the
solver and the verifier in real time, interrupt it, etc.&lt;/p&gt;


&lt;h3&gt;Setup&lt;/h3&gt;

&lt;p&gt;To use these tools, you will need to first:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;Install @(&#39;glucose&#39;) and/or @(&#39;riss3g&#39;) as described in @(see
sat-solver-options), and&lt;/li&gt;

&lt;li&gt;Install the &lt;a
href=&#39;http://www.cs.utexas.edu/~marijn/drat-trim/&#39;&gt;drat-trim&lt;/a&gt; program as
@(&#39;drat-trim&#39;) somewhere in your PATH.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;You can then add the @(&#39;glucose-cert&#39;) or @(&#39;riss3g-cert&#39;) scripts to your
PATH.  As a quick test to ensure things are working, you can try to certify
these books:&lt;/p&gt;

@({
    cd [books]/centaur/satlink/solvers
    cert.pl test-glucose-cert
    cert.pl test-riss3g-cert
})

&lt;p&gt;To use these scripts from Satlink, you can then typically just use a Satlink
configuration such as:&lt;/p&gt;

@({
    (satlink::make-config :cmdline &quot;glucose-cert&quot; ...)
})


&lt;h3&gt;Skipping Proof Checking During Development&lt;/h3&gt;

&lt;p&gt;The environment variable SATLINK_TRUST_SOLVER can be set to 1 to suppress
proof checking.  When this variable is set, we will NOT instruct the solver to
produce an UNSAT proof and (of course) will not check the non-existent
proof.&lt;/p&gt;

&lt;p&gt;We use this feature as follows:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;We generally set @(&#39;SATLINK_TRUST_SOLVER=1&#39;) in our startup scripts.  This
way, when we are working with ACL2 (either interactively, or when rebuilding
books), we just trust the solver and avoid the overhead of UNSAT checking.&lt;/li&gt;

&lt;li&gt;We set @(&#39;SATLINK_TRUST_SOLVER=0&#39;) for our nightly regressions.  These are
run automatically, overnight, so performance is not very important.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;This gives us a good blend of performance and confidence.  If the solver
somehow screws up and claims to have proven a theorem that isn&#39;t really true,
we may not find out about it until our regression fails.  But in exchange, we
can always use @(&#39;glucose-cert&#39;) with no performance impact on our everyday
work.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection dimacs-interp
  <span class="keyword">:parents</span> (dimacs)
  <span class="keyword">:short</span> <span class="string">"How we interpret the DIMACS formatted output from the SAT solver."</span>)</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-skip-ws
  <span class="keyword">:parents</span> (dimacs-interp)
  ((x stringp <span class="string">"String we&#39;re processing"</span>) (n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="string">"Current position in @(&#39;x&#39;)."</span>)
    (xl (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
      <span class="string">"Pre-computed length of @(&#39;x&#39;)."</span>))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl)
  <span class="keyword">:returns</span> (new-n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
    <span class="string">"New position after skipping whitespace."</span>)
  <span class="keyword">:measure</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
          <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> xl n))) (lnfix n)) (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> #\ ) (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> #\	))) (satlink-skip-ws x
          (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> (lnfix n))
          xl)))
    (lnfix n))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> lower-bound-satlink-skip-ws
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
      (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n
        (satlink-skip-ws x n xl)))
    <span class="keyword">:rule-classes</span> ((<span class="keyword">:rewrite</span>) (<span class="keyword">:linear</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> lower-bound-satlink-skip-ws-nfix
    (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)
      (satlink-skip-ws x n xl))
    <span class="keyword">:rule-classes</span> (<span class="keyword">:rewrite</span> <span class="keyword">:linear</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> upper-bound-satlink-skip-ws
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
        (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> xl)
        (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl))
      (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (satlink-skip-ws x n xl)
        xl))
    <span class="keyword">:rule-classes</span> ((<span class="keyword">:rewrite</span>) (<span class="keyword">:linear</span>))))</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-parse-variable-line
  <span class="keyword">:parents</span> (dimacs-interp)
  <span class="keyword">:prepwork</span> ((<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable fold-consts-in-+))))
  ((x stringp <span class="string">"String we&#39;re processing."</span>) (n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="string">"Current position in @(&#39;x&#39;)."</span>)
    (xl (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
      <span class="string">"Pre-computed length of @(&#39;x&#39;)."</span>)
    (saw-zero-p <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Have we seen a 0 yet?"</span>)
    (env$ <span class="string">"Satisfying assignment we&#39;re populating."</span>))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (error <span class="string">"True if there is an error parsing this line."</span>)
    (saw-zero-p <span class="string">"Did we ever see 0?  (checked later)."</span>)
    (env$ <span class="string">"Updated satisfying assignment."</span>))
  <span class="keyword">:measure</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
  (b* ((n (satlink-skip-ws x n xl)) ((when (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) n))
           <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> xl n))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil saw-zero-p env$))
      (minus-p (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n) #\-))
      (n (if minus-p
          (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> n <span class="number">1</span>)
          n))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> xl n)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Error parsing variable line: ends with minus? ~s0~%"</span>
          x)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> saw-zero-p env$))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> val <a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a>) (parse-nat-from-string x
          <span class="number">0</span>
          <span class="number">0</span>
          n
          xl))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> <a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a>)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Error parsing variable line: ~s0~%"</span>
          x)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> saw-zero-p env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> val) saw-zero-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Error: saw zero multiple times: ~s0~%"</span>
          x)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> saw-zero-p env$))
      (saw-zero-p (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> saw-zero-p (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> val)))
      (index (<a class="sym-link system" href="../../../axioms.html#def-1-" data-sym="1-">1-</a> val))
      (env$ (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> val) env$)
          ((&lt; index (bits-length env$)) (set-bit index
              (if minus-p
                <span class="number">0</span>
                <span class="number">1</span>)
              env$))
          (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> env$))))
    (satlink-parse-variable-line x
      (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> n <a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a>)
      xl
      saw-zero-p
      env$)))</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defprod satlink-parser-state
  ((saw-unsat-p <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>) (saw-sat-p <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (saw-unknown-p <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (saw-zero-p <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>))
  <span class="keyword">:layout</span> <span class="keyword">:tree</span>)</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-handle-line
  <span class="keyword">:parents</span> (dimacs-interp)
  ((line <span class="string">"one line of sat solver output"</span> stringp) (pstate satlink-parser-state-p)
    (env$ <span class="string">"evolving variable bindings"</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (error-p <span class="string">"did we see something we don&#39;t understand?"</span>)
    (new-pstate satlink-parser-state-p)
    env$)
  (b* ((<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> line)) ((when (&lt; <a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <span class="number">2</span>)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
          (satlink-parser-state-fix pstate)
          env$))
      (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> line <span class="number">0</span>))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> #\s) (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> #\v))
           (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> line <span class="number">1</span>) #\ ))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
          (satlink-parser-state-fix pstate)
          env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> #\s)) (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((strprefixp <span class="string">"s SATISFIABLE"</span> line) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
              (change-satlink-parser-state pstate
                <span class="keyword">:saw-sat-p</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
              env$))
          ((strprefixp <span class="string">"s UNSATISFIABLE"</span> line) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
              (change-satlink-parser-state pstate
                <span class="keyword">:saw-unsat-p</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
              env$))
          ((strprefixp <span class="string">"s UNKNOWN"</span> line) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
              (change-satlink-parser-state pstate
                <span class="keyword">:saw-unknown-p</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
              env$))
          (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../axioms.html#def-prog2_24" data-sym="PROG2$">prog2$</a> (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Unrecognized result line: ~s0~%"</span>
                line)
              (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
                (satlink-parser-state-fix pstate)
                env$)))))
      ((when (satlink-parser-state-&gt;saw-zero-p pstate)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Variable lines after already saw zero: ~s0~%"</span>
          line)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          (satlink-parser-state-fix pstate)
          env$))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> error saw-zero-p env$) (satlink-parse-variable-line line
          <span class="number">1</span>
          <a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a>
          nil
          env$)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> error
      (change-satlink-parser-state pstate
        <span class="keyword">:saw-zero-p</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> saw-zero-p <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))
      env$)))</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-handle-lines
  <span class="keyword">:parents</span> (dimacs-interp)
  ((lines <a class="sym-link system" href="../../../axioms.html#def-string-listp" data-sym="STRING-LISTP">string-listp</a>) (pstate satlink-parser-state-p)
    (env$ <span class="string">"evolving variable bindings"</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (error-p <span class="string">"did we see something we don&#39;t understand?"</span>)
    (new-pstate satlink-parser-state-p)
    env$)
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> lines)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil
         (satlink-parser-state-fix pstate)
         env$)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> error-p pstate env$) (satlink-handle-line (car lines)
          pstate
          env$))
      ((when error-p) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> error-p pstate env$)))
    (satlink-handle-lines (cdr lines)
      pstate
      env$)))</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-parse-output
  <span class="keyword">:parents</span> (dimacs-interp)
  ((out <a class="sym-link system" href="../../../axioms.html#def-string-listp" data-sym="STRING-LISTP">string-listp</a>
     <span class="string">"output lines from the SAT solver."</span>) (env$ <span class="string">"empty env to populate, should be sized already."</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (status <span class="string">"Either :failed, :sat, or :unsat"</span>)
    (env$ <span class="string">"Variable assignment, in the :sat case."</span>))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> error-p
        (satlink-parser-state pstate)
        env$) (satlink-handle-lines out
         (make-satlink-parser-state)
         env$)) ((when error-p) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-unsat-p pstate.saw-sat-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says both SAT and UNSAT~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-unsat-p
           pstate.saw-unknown-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says both UNSAT and UNKNOWN~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-sat-p
           pstate.saw-unknown-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says both SAT and UNKNOWN~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-sat-p
           (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> pstate.saw-zero-p))) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says SAT but we didn&#39;t find a 0 in variable lines?~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-unsat-p pstate.saw-zero-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says UNSAT but is giving us variables?~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> pstate.saw-unknown-p
           pstate.saw-zero-p)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver says UNKNOWN but is giving us variables?~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$))
      ((when pstate.saw-unsat-p) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:unsat</span> env$))
      ((when pstate.saw-sat-p) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:sat</span> env$))
      ((when pstate.saw-unknown-p) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$)))
    (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK error: solver didn&#39;t report its result~%"</span>)
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$)))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection satlink-extra-hook
  <span class="keyword">:parents</span> (satlink)
  <span class="keyword">:short</span> <span class="string">"An attachable hook for performing extra actions after successful
calls of the SAT solver."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is an advanced feature for Satlink hackers.&lt;/p&gt;

&lt;p&gt;@(call satlink-extra-hook) is an attachable function (see @(see defattach))
that is called by @(see satlink-run-impl) after successful invocations of the
SAT solver.&lt;/p&gt;

&lt;p&gt;The default hook does nothing, but you may be able to implement custom hooks
that do useful things.  For instance, the @(see gather-benchmarks) hook can be
used to automatically collect up the DIMACS files for Satlink problems.  These
kinds of hooks might require additional trust tags, so it is nice to keep them
out of Satlink itself.&lt;/p&gt;

&lt;p&gt;A hook can access several arguments:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;@(&#39;cnf&#39;) is the formula we were trying to solve.&lt;/li&gt;

&lt;li&gt;@(&#39;filename&#39;) is the name of the temporary input file that was given to the
SAT solver.  At the time the hook is invoked, the file should still exist, even
when we are removing temporary files.&lt;/li&gt;

&lt;li&gt;@(&#39;status&#39;) says whether the SAT solver returned @(&#39;:sat&#39;) or @(&#39;:unsat&#39;).
Note that you don&#39;t have to consider @(&#39;:failed&#39;) because the hook does not get
invoked in that case.&lt;/li&gt;

&lt;li&gt;@(&#39;env$&#39;) is the satisfying assignment in case of @(&#39;:sat&#39;) answers.&lt;/li&gt;

&lt;li&gt;@(&#39;state&#39;) is the usual ACL2 state, which might be useful for sending some
extra information to your hook, e.g., state globals or similar.&lt;/li&gt;

&lt;/ul&gt;"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> (((satlink-extra-hook <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>
        <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>
        <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>
        env$
        state) =&gt;
       state
       <span class="keyword">:formals</span> (cnf filename
         status
         env$
         state)
       <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (lit-list-listp cnf)
         (stringp filename)
         (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:sat</span>) (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:unsat</span>)))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> satlink-extra-hook
        (cnf filename
          status
          env$
          state)
        (declare (xargs <span class="keyword">:stobjs</span> (env$ state))
          (ignorable cnf
            filename
            status
            env$
            state))
        state))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> state-p1-of-satlink-extra-hook
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a> state)
        (<a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a> (satlink-extra-hook cnf
            filename
            status
            env$
            state)))))
  (define default-satlink-hook
    ((cnf lit-list-listp) (filename stringp)
      (status (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:sat</span>) (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:unsat</span>)))
      (env$)
      (state))
    (declare (ignorable cnf
        filename
        status
        env$
        state))
    <span class="keyword">:returns</span> (state <a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a>
      <span class="keyword">:hyp</span> (<a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a> state))
    state)
  (<a class="sym-link system" href="../../../axioms.html#def-defattach" data-sym="DEFATTACH">defattach</a> satlink-extra-hook
    default-satlink-hook))</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define satlink-run-impl
  <span class="keyword">:parents</span> (logical-story)
  <span class="keyword">:short</span> <span class="string">"Core function used to run the SAT solver."</span>
  ((config config-p
     <span class="string">"Which solver to call, etc."</span>) (cnf lit-list-listp
      <span class="string">"The formula to solve."</span>)
    (env$ <span class="string">"Empty env to populate, will usually be resized"</span>)
    &amp;key
    (state 'state))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (status <span class="string">":sat, :unsat, or :failed"</span>)
    (env$ <span class="string">"Variable assignment, in the :sat case."</span>)
    (lrat-proof <span class="string">"LRAT proof, in the :unsat case, if config.lrat-check is set."</span>)
    (state <a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a>
      <span class="keyword">:hyp</span> (<a class="sym-link system" href="../../../axioms.html#def-state-p1" data-sym="STATE-P1">state-p1</a> state)
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(satlink-run-impl state-p1-of-dimacs-export.state
           state-p1-of-satlink-extra-hook
           state-p1-of-tempfile-fn
           state-p1-of-tshell-call.state)))))
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This function actually runs the SAT solver: it exports the formula
into a @(see dimacs) file, invokes the SAT solver on it, and interprets the
answer.  This function is typically never used directly; instead see @(see
satlink-run).&lt;/p&gt;"</span>
  (b* (((config config)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> filename state) (tempfile <span class="string">"satlink"</span>))
      ((unless filename) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Error generating temporary filename.~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$ nil state))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp max-index state) (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (dimacs-export cnf
            <span class="keyword">:filename</span> filename)
          <span class="keyword">:msg</span> <span class="string">"; SATLINK: writing ~s0: ~st sec, ~sa bytes~%"</span>
          <span class="keyword">:args</span> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> filename)
          <span class="keyword">:mintime</span> config.mintime))
      ((unless okp) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Error writing dimacs file ~s0~%"</span>
          filename)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$ nil state))
      ((fun (cleanup filename
           config
           state)) (b* (((unless (config-&gt;remove-temps config)) state) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> &amp; &amp; state) (tshell-call (cat <span class="string">"rm "</span> filename))))
          state))
      (cmd (cat config.cmdline <span class="string">" "</span> filename))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status lines state) (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (tshell-call cmd
            <span class="keyword">:print</span> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> config.verbose 'satlink-echo)
              (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> config.timing 'satlink-echo-time))
            <span class="keyword">:save</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
          <span class="keyword">:msg</span> <span class="string">"; SATLINK: `~s0`: ~st sec, ~sa bytes~%"</span>
          <span class="keyword">:args</span> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> cmd)
          <span class="keyword">:mintime</span> config.mintime))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> status <span class="number">127</span>)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Couldn&#39;t execute SAT solver command `~s0` (exit code 127).  Not in path?~%"</span>
          cmd)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$ nil state))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-string-listp" data-sym="STRING-LISTP">string-listp</a> lines)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SATLINK: Tshell somehow didn&#39;t give us a string list.~%"</span>)
        (b* ((state (cleanup filename
               config
               state)))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$ nil state)))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status env$) (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (b* ((env$ (resize-bits (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> max-index) env$)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status env$) (satlink-parse-output lines env$)))
            (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status env$))
          <span class="keyword">:msg</span> <span class="string">"; SATLINK: interpreting output: ~st sec, ~sa bytes~%"</span>
          <span class="keyword">:mintime</span> config.mintime))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> lrat-proof state) (if (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:unsat</span>) config.lrat-check)
          (b* ((lrat-proof (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (lrat-read-file (cat filename <span class="string">".lrat"</span>)
                   state)
                 <span class="keyword">:msg</span> <span class="string">"; SATLINK: read lrat file: ~st sec, ~sa bytes~%"</span>
                 <span class="keyword">:mintime</span> config.mintime)) ((unless (config-&gt;remove-temps config)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> lrat-proof state))
              ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> &amp; &amp; state) (tshell-call (cat <span class="string">"rm "</span> (cat filename <span class="string">".lrat"</span>)))))
            (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> lrat-proof state))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil state)))
      (state (if (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:sat</span>) (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:unsat</span>))
          (satlink-extra-hook cnf
            filename
            status
            env$
            state)
          state))
      (state (cleanup filename
          config
          state)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status
      env$
      lrat-proof
      state)))</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection logical-story
  <span class="keyword">:parents</span> (satlink)
  <span class="keyword">:short</span> <span class="string">"How we logically assume that the SAT solver&#39;s claims of unsat are
correct."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;The whole point of Satlink is to be able to call an external SAT
solver, written in C or C++, and trust its results.  Here, we explain exactly
how we do that.&lt;/p&gt;

&lt;p&gt;Our assumptions about the SAT solver will be expressed as constraints about
a new function, @(&#39;satlink-run-fn&#39;).  Informally, the idea behind this function
is that it will have the following signature:&lt;/p&gt;

&lt;code&gt;
 (satlink-run-fn config formula env$) &amp;rarr; (status env$)
&lt;/code&gt;

&lt;dl&gt;

&lt;dt&gt;Inputs&lt;/dt&gt;

&lt;dd&gt;@(&#39;config&#39;) is a @(see config-p) that says which SAT solver to run and how
to run it.&lt;/dd&gt;

&lt;dd&gt;@(&#39;formula&#39;) is the @(see cnf) formula to solve.&lt;/dd&gt;

&lt;dd&gt;@(&#39;env$&#39;) is @(see env$), a bit array that will be used to store the
satisfying assignment from the SAT solver, in the SAT case.&lt;/dd&gt;

&lt;dt&gt;Outputs&lt;/dt&gt;

&lt;dd&gt;@(&#39;status&#39;) is the answer we get back from the SAT solver; in practice it
will either be @(&#39;:sat&#39;) or @(&#39;:unsat&#39;), or perhaps @(&#39;:failed&#39;) if we run into
some kind of gross error&amp;mdash;for instance, perhaps the SAT solver produces
output that we weren&#39;t expecting, like &quot;Segmentation fault&quot; or
&quot;Killed&quot;.&lt;/dd&gt;

&lt;dd&gt;@(&#39;env$&#39;) is the updated @(see env$) bit array; in the @(&#39;:sat&#39;) case it
should contain the satisfying assignment.&lt;/dd&gt;

&lt;dd&gt;@(&#39;lrat-proof&#39;) will be NIL unless @(&#39;config.lrat-check&#39;) is true.  In that
case, it is expected that the solver will write a file
&quot;[input-filename].lrat&quot; containing an LRAT proof; see
&quot;projects/sat/lrat/README&quot;.&lt;/dd&gt;

&lt;/dl&gt;

&lt;h3&gt;Axiomatization&lt;/h3&gt;

&lt;p&gt;We use ACL2&#39;s @(see acl2::partial-encapsulate) feature to assume that the function
satisfies certain constraints.&lt;/p&gt;

&lt;p&gt;To make our story as tight as possible, we would like to assume very little
about @(&#39;satlink-run-fn&#39;).  It turns out we only need three constraints, with
the first two constraints just saying that the function returns three values:&lt;/p&gt;

@(thm true-listp-of-satlink-run-fn)
@(thm len-of-satlink-run-fn)

&lt;p&gt;The final constraint is the real one.  The idea here is to express:&lt;/p&gt;

&lt;box&gt;&lt;p&gt;
   if @(&#39;satlink-run-fn&#39;) returns @(&#39;:unsat&#39;),&lt;br/&gt;
   then the formula evaluates to false under every environment.
&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;However, we don&#39;t even need to assume that if our solver outputs an LRAT
proof that can be checked by the LRAT checker in &quot;projects/sat/lrat&quot;.  So if
the configuration option @(&#39;lrat-check&#39;) is set to true, then we don&#39;t assume
this.  If @(&#39;lrat-check&#39;) is @(&#39;NIL&#39;), then we&#39;ll just assume the solver is
correct.&lt;/p&gt;

&lt;p&gt;But the quantification here isn&#39;t quite right for a rewrite rule, so
instead we assume the contrapositive:&lt;/p&gt;

&lt;box&gt;&lt;p&gt;
   if NOT(the formula evaluates to false under every environment),&lt;br/&gt;
   and we are not checking an LRAT proof,&lt;br/&gt;
   then NOT( @(&#39;satlink-run-fn&#39;) returns @(&#39;:unsat&#39;) )
&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;Which simplifies down to:&lt;/p&gt;

&lt;box&gt;&lt;p&gt;
   if the formula evaluates to true under any environment,&lt;br/&gt;
   and we are not checking an LRAT proof,&lt;br/&gt;
   then @(&#39;satlink-run-fn&#39;) does not return @(&#39;:unsat&#39;)
&lt;/p&gt;&lt;/box&gt;

&lt;p&gt;So the real constraint looks like this:&lt;/p&gt;

@(thm satlink-run-fn-unsat-claim)


&lt;p&gt;And that&#39;s it.  We don&#39;t need to assume anything about what happens in the
@(&#39;:sat&#39;) case or the case where we&#39;re checking LRAT proofs, because our
top-level @(see sat) wrapper will verify those answers.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block function" id="def-satlink-useless-clauseproc" data-defines="SATLINK-USELESS-CLAUSEPROC" data-references="LIST,CLAUSE,DEFUN" data-part-name="SATLINK-USELESS-CLAUSEPROC" data-part-args="CLAUSE" data-part-body="CLAUSE,LIST" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SATLINK-USELESS-CLAUSEPROC">satlink-useless-clauseproc</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-satlink-useless-clauseproc" data-sym="SATLINK-USELESS-CLAUSEPROC" title="(defun satlink::satlink-useless-clauseproc (satlink::clause)
  (list satlink::clause))">satlink-useless-clauseproc</a>
  (clause)
  (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> clause))</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-partial-encapsulate" data-sym="PARTIAL-ENCAPSULATE">partial-encapsulate</a> (((satlink-run-fn <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> env$) =&gt;
     (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> env$ <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>)
     <span class="keyword">:formals</span> (config <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> env$)
     <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (config-p config)
       (lit-list-listp <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>))))
  nil
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> satlink-run-fn
      (config <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> env$)
      (declare (ignore config <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>)
        (xargs <span class="keyword">:stobjs</span> env$))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$ nil)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> true-listp-of-satlink-run-fn
    (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> (satlink-run-fn config
        <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
        env$))
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> len-of-satlink-run-fn
    (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> (satlink-run-fn config
          <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
          env$))
      <span class="number">3</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> satlink-run-fn-unsat-claim
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (equal (eval-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
            arbitrary-env)
          <span class="number">1</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (config-&gt;lrat-check config)))
      (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">0</span>
            (satlink-run-fn config
              <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
              env$))
          <span class="keyword">:unsat</span>)))))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection satlink-run
  <span class="keyword">:parents</span> (logical-story)
  <span class="keyword">:short</span> <span class="string">"Connection between the implementation and the logical story."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;In the logic, this function does nothing more than call
@(&#39;satlink-run-fn&#39;), the constrained function that is the basis of our @(see
logical-story).&lt;/p&gt;

&lt;p&gt;Under the hood, through a trust tag, we smash its definition and have it
invoke @(see satlink-run-impl), which actually calls the SAT solver.&lt;/p&gt;"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> satlink-run
    (config <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> env$)
    <span class="string">"Returns (MV STATUS ENV$ LRAT-PROOF)"</span>
    (declare (xargs <span class="keyword">:stobjs</span> env$
        <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (config-p config)
          (lit-list-listp <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>))))
    (satlink-run-fn config
      <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
      env$)))</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defttag" data-sym="DEFTTAG">defttag</a> <span class="keyword">:satlink</span>)</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(include-raw <span class="string">"top-raw.lsp"</span>)</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define sat
  <span class="keyword">:parents</span> (satlink)
  <span class="keyword">:short</span> <span class="string">"Top-level function for running a SAT solver."</span>
  ((<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <span class="string">"A @(see cnf) formula to solve."</span>
     lit-list-listp) (env$ <span class="string">"Environment to populate with a satisfying assignment, in the case
             of SAT.  Will be emptied, in any case."</span>)
    &amp;key
    ((config <span class="string">"Configuration for running a SAT solver."</span>
       config-p) '*default-config*))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (status <span class="string">"@(&#39;:sat&#39;), @(&#39;:unsat&#39;), or @(&#39;:failed&#39;)."</span>)
    (env$ <span class="string">"Satisfying assignment, in the case of @(&#39;:sat&#39;)."</span>))
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is the top-level wrapper for calling SAT.  It handles the
details of clearing out the @(see env$) and checking the SAT solver&#39;s answers
when there is a counterexample or an LRAT proof available.&lt;/p&gt;"</span>
  (b* ((env$ (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-non-exec" data-sym="NON-EXEC">non-exec</a> nil)
         <span class="keyword">:exec</span> (resize-bits <span class="number">0</span> env$))) ((when (trivial-unsat-p <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:unsat</span> env$))
      ((config config) config)
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status
         env$
         lrat-proof) (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (satlink-run config
            <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
            env$)
          <span class="keyword">:msg</span> <span class="string">"; SATLINK: round trip: ~st sec, ~sa bytes.~%"</span>
          <span class="keyword">:mintime</span> config.mintime))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:unsat</span>) config.lrat-check)) (b* ((lrat-formula (formula-to-lrat-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <span class="number">1</span>)) (ok (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (lrat-refutation-p$ lrat-proof
                  lrat-formula)
                <span class="keyword">:msg</span> <span class="string">"; SATLINK: lrat check: ~st sec, ~sa bytes.~%"</span>
                <span class="keyword">:mintime</span> config.mintime))
            ((unless ok) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SAT: Supposedly unsatisfiable, but check of LRAT proof failed!~%"</span>)
              (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$)))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:unsat</span> env$)))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> status <span class="keyword">:sat</span>)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status env$))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-time_24" data-sym="TIME$">time$</a> (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> <span class="number">0</span>
             (eval-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> env$))
           <span class="keyword">:msg</span> <span class="string">"; SATLINK: verifying assignment: ~st sec, ~sa bytes~%"</span>
           <span class="keyword">:mintime</span> config.mintime)) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"SAT: Supposedly satisfiable, but assignment is wrong~%"</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:failed</span> env$)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <span class="keyword">:sat</span> env$))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> sat-normalize-env
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-syntaxp" data-sym="SYNTAXP">syntaxp</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal env$ ''nil)))
      (equal (sat <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
          env$
          <span class="keyword">:config</span> config)
        (sat <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> nil <span class="keyword">:config</span> config))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> sat-when-sat
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status new-env$) (sat <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
           env$
           <span class="keyword">:config</span> config)))
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (equal status <span class="keyword">:sat</span>)
        (equal (eval-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> new-env$)
          <span class="number">1</span>))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> sat-when-unsat
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> status &amp;) (sat <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
           env$
           <span class="keyword">:config</span> config)))
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (equal (eval-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> env)
          <span class="number">1</span>)
        (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal status <span class="keyword">:unsat</span>))))
    <span class="keyword">:hints</span> ((<span class="string">"goal"</span> <span class="keyword">:use</span> ((<span class="keyword">:instance</span> main-theorem
          (proof (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">2</span>
              (satlink-run config
                <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>
                env$)))
          (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (formula-to-lrat-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <span class="number">1</span>))) (<span class="keyword">:instance</span> satisfiable-suff
           (assignment (env$-to-lrat-assignment (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> (max-index-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a>))
               env))
           (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (formula-to-lrat-formula <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <span class="number">1</span>))))
       <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (trivial-unsat-p-correct)
         (lrat-refutation-p$))))))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>