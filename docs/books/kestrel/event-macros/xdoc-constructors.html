<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>xdoc-constructors - ACL2 Book</title>
  <meta property="name" content="xdoc-constructors">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">xdoc-constructors</h1>
    <div class="path"><a href="xdoc-constructors.lisp" class="source-link">books/kestrel/event-macros/xdoc-constructors</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="../../std/util/define.html" title="std/util/define">define</a>
      <a class="include-link" href="../../std/util/defmacro-plus.html" title="std/util/defmacro-plus">defmacro-plus</a>
      <a class="include-link" href="../../xdoc/defxdoc-plus.html" title="xdoc/defxdoc-plus">defxdoc-plus</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/util/define.html" title="Open std/util/define">"std/util/define"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/util/defmacro-plus.html" title="Open std/util/defmacro-plus">"std/util/defmacro-plus"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../xdoc/defxdoc-plus.html" title="Open xdoc/defxdoc-plus">"xdoc/defxdoc-plus"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ event-macro-xdoc-constructors
  <span class="keyword">:parents</span> (event-macros composite-constructors)
  <span class="keyword">:short</span> <span class="string">"Utilities to construct &lt;see topic=&#39;@(url xdoc)&#39;&gt;XDOC&lt;/see&gt; strings
          to document &lt;see topic=&#39;@(url event-macros)&#39;&gt;event macros&lt;/see&gt;
          and their implementations."</span>)</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ event-macro-xdoc-constructors-user-level
  <span class="keyword">:parents</span> (event-macro-xdoc-constructors)
  <span class="keyword">:short</span> <span class="string">"Utilities to construct &lt;see topic=&#39;@(url xdoc)&#39;&gt;XDOC&lt;/see&gt; strings
          to document &lt;see topic=&#39;@(url event-macros)&#39;&gt;event macros&lt;/see&gt;
          at the user level."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"The @(&#39;xdoc::evmac-section-...&#39;) utilities construct level-3 sections.
     Some are relatively thin wrappers,
     which precede their arguments
     (which must be zero or more pieces of XDOC text)
     with specific level-3 headings.
     Other utilities provide more automation."</span>)
    (p <span class="string">"The @(&#39;xdoc::evmac-input-...&#39;) utilities construct
     &lt;see topic=&#39;@(url xdoc::desc)&#39;&gt;descriptions&lt;/see&gt;
     of inputs that are expected to be common to multiple event macros.
     Each such utility includes zero or more parameters
     to customize the description,
     as well as zero or more additional pieces of XDOC text (e.g. paragraphs)
     that are appended after the automatically generated XDOC text."</span>))
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-intro-title_2A" data-defines="*EVMAC-SECTION-INTRO-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-INTRO-TITLE*">*evmac-section-intro-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-intro-title_2A" data-sym="*EVMAC-SECTION-INTRO-TITLE*" title="(defconst xdoc::*evmac-section-intro-title* &quot;Introduction&quot;)">*evmac-section-intro-title*</a> <span class="string">"Introduction"</span>)</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-intro
  (&amp;rest content)
  <span class="keyword">:short</span> <span class="string">"Construct the introduction section
          of the user documentation of an event macro."</span>
  `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-intro-title_2A" data-sym="*EVMAC-SECTION-INTRO-TITLE*" title="(defconst xdoc::*evmac-section-intro-title* &quot;Introduction&quot;)">*evmac-section-intro-title*</a> ,@CONTENT))</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-form-title_2A" data-defines="*EVMAC-SECTION-FORM-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-FORM-TITLE*">*evmac-section-form-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-form-title_2A" data-sym="*EVMAC-SECTION-FORM-TITLE*" title="(defconst xdoc::*evmac-section-form-title* &quot;General Form&quot;)">*evmac-section-form-title*</a> <span class="string">"General Form"</span>)</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-form
  (&amp;rest content)
  <span class="keyword">:short</span> <span class="string">"Construct the general form section
          of the user documentation of an event macro."</span>
  `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-form-title_2A" data-sym="*EVMAC-SECTION-FORM-TITLE*" title="(defconst xdoc::*evmac-section-form-title* &quot;General Form&quot;)">*evmac-section-form-title*</a> ,@CONTENT))</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-inputs-title_2A" data-defines="*EVMAC-SECTION-INPUTS-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-INPUTS-TITLE*">*evmac-section-inputs-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-inputs-title_2A" data-sym="*EVMAC-SECTION-INPUTS-TITLE*" title="(defconst xdoc::*evmac-section-inputs-title* &quot;Inputs&quot;)">*evmac-section-inputs-title*</a> <span class="string">"Inputs"</span>)</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-inputs
  (&amp;rest content)
  <span class="keyword">:short</span> <span class="string">"Construct the inputs section
          of the user documentation of an event macro."</span>
  `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-inputs-title_2A" data-sym="*EVMAC-SECTION-INPUTS-TITLE*" title="(defconst xdoc::*evmac-section-inputs-title* &quot;Inputs&quot;)">*evmac-section-inputs-title*</a> ,@CONTENT))</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-appconds-title_2A" data-defines="*EVMAC-SECTION-APPCONDS-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-APPCONDS-TITLE*">*evmac-section-appconds-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-appconds-title_2A" data-sym="*EVMAC-SECTION-APPCONDS-TITLE*" title="(defconst xdoc::*evmac-section-appconds-title* &quot;Applicability Conditions&quot;)">*evmac-section-appconds-title*</a>
  <span class="string">"Applicability Conditions"</span>)</pre>
  </div>

<div class="form-block other" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-appconds
  (macro &amp;rest content)
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  <span class="keyword">:short</span> <span class="string">"Construct the applicability conditions section
          of the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Since this documentation is part of the XDOC topic
     whose name is the name of the macro,
     the @(&#39;macro-ref&#39;) variable is not a link."</span>))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(&#39;"</span> macro-name <span class="string">"&#39;)"</span>))
      (inputs-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"`"</span>
          <a class="sym-link local-def" href="#def-_2Aevmac-section-inputs-title_2A" data-sym="*EVMAC-SECTION-INPUTS-TITLE*" title="(defconst xdoc::*evmac-section-inputs-title* &quot;Inputs&quot;)">*evmac-section-inputs-title*</a>
          <span class="string">"&#39; section"</span>)))
    `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-appconds-title_2A" data-sym="*EVMAC-SECTION-APPCONDS-TITLE*" title="(defconst xdoc::*evmac-section-appconds-title* &quot;Applicability Conditions&quot;)">*evmac-section-appconds-title*</a>
      (p <span class="string">"In order for "</span>
        ,MACRO-REF
        <span class="string">" to apply,
        in addition to the requirements on the inputs
        stated in the "</span>
        ,INPUTS-REF
        <span class="string">", the following "</span>
        (seetopic <span class="string">"acl2::event-macro-applicability-conditions"</span>
          <span class="string">"applicability conditions"</span>)
        <span class="string">" must be proved.
         The proofs are attempted when "</span>
        ,MACRO-REF
        <span class="string">" is called,
        using the hints optionally supplied as the @(&#39;:hints&#39;) input
        described in the "</span>
        ,INPUTS-REF
        <span class="string">"."</span>)
      ,@CONTENT)))</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-generated-title_2A" data-defines="*EVMAC-SECTION-GENERATED-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-GENERATED-TITLE*">*evmac-section-generated-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-generated-title_2A" data-sym="*EVMAC-SECTION-GENERATED-TITLE*" title="(defconst xdoc::*evmac-section-generated-title* &quot;Generated Events&quot;)">*evmac-section-generated-title*</a>
  <span class="string">"Generated Events"</span>)</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-generated
  (&amp;rest content)
  <span class="keyword">:short</span> <span class="string">"Construct the generated events section
          of the user documentation of an event macro."</span>
  `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-generated-title_2A" data-sym="*EVMAC-SECTION-GENERATED-TITLE*" title="(defconst xdoc::*evmac-section-generated-title* &quot;Generated Events&quot;)">*evmac-section-generated-title*</a>
    ,@CONTENT))</pre>
  </div>

<div class="form-block constant" id="def-_2Aevmac-section-redundancy-title_2A" data-defines="*EVMAC-SECTION-REDUNDANCY-TITLE*" data-references="DEFCONST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="*EVMAC-SECTION-REDUNDANCY-TITLE*">*evmac-section-redundancy-title*</span><span class="form-type">constant</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> <a class="sym-link local-def" href="#def-_2Aevmac-section-redundancy-title_2A" data-sym="*EVMAC-SECTION-REDUNDANCY-TITLE*" title="(defconst xdoc::*evmac-section-redundancy-title* &quot;Redundancy&quot;)">*evmac-section-redundancy-title*</a>
  <span class="string">"Redundancy"</span>)</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-section-redundancy
  (macro)
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  <span class="keyword">:short</span> <span class="string">"Construct the redundancy section
          of the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This assumes an event macro with a @(&#39;:print&#39;) and @(&#39;:show-only&#39;) inputs
     with specific meanings.
     This XDOC constructor may be generalized in the future
     to cover event macros that do not have exactly
     those two specific inputs with those specific meanings."</span>)
    (p <span class="string">"Since this documentation is part of the XDOC topic
     whose name is the name of the macro,
     the @(&#39;macro-ref&#39;) variable is not a link."</span>))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(&#39;"</span> macro-name <span class="string">"&#39;)"</span>)))
    `(section <a class="sym-link local-def" href="#def-_2Aevmac-section-redundancy-title_2A" data-sym="*EVMAC-SECTION-REDUNDANCY-TITLE*" title="(defconst xdoc::*evmac-section-redundancy-title* &quot;Redundancy&quot;)">*evmac-section-redundancy-title*</a>
      (p (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"A call of "</span>
          ,MACRO-REF
          <span class="string">" is redundant if and only if
         it is identical to a previous successful call of "</span>
          ,MACRO-REF
          <span class="string">" whose @(&#39;:show-only&#39;) input is not @(&#39;t&#39;),
         except that the two calls may differ in
         their @(&#39;:print&#39;) and @(&#39;:show-only&#39;) inputs.
         These inputs do not affect the generated events,
         and thus they are ignored for the purpose of redundancy."</span>))
      (p (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"A call of "</span>
          ,MACRO-REF
          <span class="string">" whose @(&#39;:show-only&#39;) input is @(&#39;t&#39;)
         does not generate any event.
         Thus, no successive call may be redundant with such a call."</span>)))))</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-input-hints
  (&amp;key additional)
  <span class="keyword">:short</span> <span class="string">"Construct a description of the @(&#39;:hints&#39;) input
          for the user documentation of an event macro."</span>
  (let ((appconds-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
         <span class="string">"`"</span>
         <a class="sym-link local-def" href="#def-_2Aevmac-section-appconds-title_2A" data-sym="*EVMAC-SECTION-APPCONDS-TITLE*" title="(defconst xdoc::*evmac-section-appconds-title* &quot;Applicability Conditions&quot;)">*evmac-section-appconds-title*</a>
         <span class="string">"&#39; section"</span>)))
    `(desc <span class="string">"@(&#39;:hints&#39;) &amp;mdash; default @(&#39;nil&#39;)"</span>
      (p <span class="string">"Hints to prove the applicability conditions."</span>)
      (p <span class="string">"It must be one of the following:"</span>)
      (ul (li <span class="string">"A "</span>
          (seetopic <span class="string">"acl2::keyword-value-listp"</span>
            <span class="string">"keyword-value list"</span>)
          <span class="string">" @(&#39;(appcond1 hints1 appcond2 hints2 ...)&#39;),
         where each @(&#39;appcondk&#39;) is a keyword
         that identifies one of the applicability conditions
         listed in the "</span>
          ,APPCONDS-REF
          <span class="string">" and each @(&#39;hintsk&#39;) is a list of hints of the kind
         that may appear just after @(&#39;:hints&#39;) in a @(tsee defthm).
         The hints @(&#39;hintsk&#39;) are used
         to prove applicability condition @(&#39;appcondk&#39;).
         The @(&#39;appcond1&#39;), @(&#39;appcond2&#39;), ... keywords must be all distinct.
         An @(&#39;appcondk&#39;) keyword is allowed only if
         the corresponding applicability condition is present,
         as specified in the "</span>
          ,APPCONDS-REF
          <span class="string">"."</span>)
        (li <span class="string">"A list of hints of the kind
         that may appear just after @(&#39;:hints&#39;) in a @(tsee defthm).
         In this case, these same hints are used
         to prove every applicability condition,."</span>))
      ,@ADDITIONAL)))</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-input-print
  (macro &amp;key additional)
  <span class="keyword">:short</span> <span class="string">"Construct a description of the @(&#39;:print&#39;) input
          for the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"Since this documentation is part of the XDOC topic
    whose name is the name of the macro,
    the @(&#39;macro-ref&#39;) variable is not a link."</span>)
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(&#39;"</span> macro-name <span class="string">"&#39;)"</span>)))
    `(desc <span class="string">"@(&#39;:print&#39;) &amp;mdash; default @(&#39;:result&#39;)"</span>
      (p <span class="string">"Specifies what is printed on the screen
        (see "</span>
        (seetopic <span class="string">"acl2::event-macro-screen-printing"</span>
          <span class="string">"screen printing"</span>)
        <span class="string">")."</span>)
      (p <span class="string">"It must be one of the following:"</span>)
      (ul (li <span class="string">"@(&#39;nil&#39;), to print nothing (not even error output)."</span>)
        (li <span class="string">"@(&#39;:error&#39;), to print only error output (if any)."</span>)
        (li <span class="string">"@(&#39;:result&#39;), to print, besides any error output,
         also the "</span>
          (seetopic <span class="string">"acl2::event-macro-results"</span> <span class="string">"results"</span>)
          <span class="string">" of "</span>
          ,MACRO-REF
          <span class="string">".
         This is the default value of the @(&#39;:print&#39;) input."</span>)
        (li <span class="string">"@(&#39;:info&#39;), to print,
         besides any error output and the results,
         also some additional information about
         the internal operations of "</span>
          ,MACRO-REF
          <span class="string">"."</span>)
        (li <span class="string">"@(&#39;:all&#39;), to print,
         besides any error output,
         the results,
         and the additional information,
         also ACL2&#39;s output in response to all the submitted events."</span>))
      (p <span class="string">"If the call of "</span>
        ,MACRO-REF
        <span class="string">" is redundant,
        an indication to that effect is printed on the screen,
        unless @(&#39;:print&#39;) is @(&#39;nil&#39;)."</span>)
      ,@ADDITIONAL)))</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-input-show-only
  (macro &amp;key additional)
  <span class="keyword">:short</span> <span class="string">"Construct a description of the @(&#39;:show-only&#39;) input
          for the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"Since this documentation is part of the XDOC topic
    whose name is the name of the macro,
    the @(&#39;macro-ref&#39;) variable is not a link."</span>)
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(&#39;"</span> macro-name <span class="string">"&#39;)"</span>))
      (redundancy-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"`"</span>
          <a class="sym-link local-def" href="#def-_2Aevmac-section-redundancy-title_2A" data-sym="*EVMAC-SECTION-REDUNDANCY-TITLE*" title="(defconst xdoc::*evmac-section-redundancy-title* &quot;Redundancy&quot;)">*evmac-section-redundancy-title*</a>
          <span class="string">"&#39; section"</span>)))
    `(desc <span class="string">"@(&#39;:show-only&#39;) &amp;mdash; default @(&#39;nil&#39;)"</span>
      (p (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"Determines whether the event expansion of "</span>
          ,MACRO-REF
          <span class="string">" is submitted to ACL2 or just printed on the screen:"</span>))
      (ul (li <span class="string">"@(&#39;nil&#39;), to submit it."</span>)
        (li (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
            <span class="string">"@(&#39;t&#39;), to just print it.
          In this case:
          the event expansion is printed even if @(&#39;:print&#39;) is @(&#39;nil&#39;)
          (because the user has explicitly asked to show the event expansion);
          the resulting events are not re-printed separately
          (other than their appearance in the printed event expansion)
          even if @(&#39;:print&#39;) is @(&#39;:result&#39;) or @(&#39;:info&#39;) or @(&#39;:all&#39;);
          no ACL2 output is printed for the event expansion
          even if @(&#39;:print&#39;) is @(&#39;:all&#39;)
          (because the event expansion is not submitted).
          If the call of "</span>
            ,MACRO-REF
            <span class="string">" is redundant
          (as defined in the "</span>
            ,REDUNDANCY-REF
            <span class="string">"), the event expansion generated by the existing call
          is printed."</span>)))
      ,@ADDITIONAL)))</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-desc-input-name
  (prefix &amp;key desc auto-desc additional name-rest)
  <span class="keyword">:short</span> <span class="string">"Construct a description of a @(&#39;:...-name&#39;) input
          for the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is for an input to determine the name of
     an entity (e.g. a function) generated by the event macro."</span>)
    (p <span class="string">"The @(&#39;...&#39;) in @(&#39;:...-name&#39;) is passed as
     the @(&#39;prefix&#39;) argument of this macro."</span>)
    (p <span class="string">"A description of the entitty whose name is being determined
     is passed as the @(&#39;desc&#39;) argument of this macro."</span>)
    (p <span class="string">"The @(&#39;auto-desc&#39;) argument of this macro describes the name used
     when the @(&#39;:...-name&#39;) input is @(&#39;:auto&#39;)."</span>)
    (p <span class="string">"An XDOC tree of additional text can be passed
     as the @(&#39;additional&#39;) argument of this macro."</span>)
    (p <span class="string">"The @(&#39;name-rest&#39;) argument of this macro is
     the name that the generated documentation says that will be used
     as the name of the entity in the rest of the documentation page."</span>))
  (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp prefix)
        (stringp desc)
        (stringp auto-desc)
        (stringp name-rest))))
  `(desc ,(CONCATENATE &#39;STRING &quot;@(&#39;:&quot; PREFIX &quot;-name&#39;) &amp;mdash; default @(&#39;:auto&#39;)&quot;)
    (p <span class="string">"Determines the name of "</span> ,DESC <span class="string">"."</span>)
    (p <span class="string">"It must be one of the following:"</span>)
    (ul (li <span class="string">"@(&#39;:auto&#39;), to use "</span> ,AUTO-DESC <span class="string">"."</span>)
      (li <span class="string">"Any other symbol, to use as the name."</span>))
    ,@(AND ADDITIONAL (LIST ADDITIONAL))
    (p <span class="string">"In the rest of this documentation page,
      let @(&#39;"</span>
      ,NAME-REST
      <span class="string">"&#39;) be this name."</span>)))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-desc-input-enable-t/nil
  (prefix &amp;key <a class="sym-link system" href="../../../axioms.html#def-default" data-sym="DEFAULT">default</a> desc)
  <span class="keyword">:short</span> <span class="string">"Construct a description of a @(&#39;:...-enable&#39;) input
          for the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is for an input to determine the enablement of
     an entity (e.g. a function) generated by the event macro."</span>)
    (p <span class="string">"The @(&#39;...&#39;) in @(&#39;:...-enable&#39;) is passed as
     the @(&#39;prefix&#39;) argument of this macro."</span>)
    (p <span class="string">"The default is passed as the @(&#39;default&#39;) argument of this macro."</span>)
    (p <span class="string">"The description of the entity is passed as
     the @(&#39;desc&#39;) argument of this macro."</span>))
  (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp prefix) (<a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> <a class="sym-link system" href="../../../axioms.html#def-default" data-sym="DEFAULT">default</a>) (stringp desc))))
  `(desc ,(CONCATENATE &#39;STRING &quot;@(&#39;:&quot; PREFIX &quot;-enable&#39;) &amp;mdash; default &quot;
              (IF DEFAULT
                  &quot;@(&#39;t&#39;)&quot;
                  &quot;@(&#39;nil&#39;)&quot;))
    (p <span class="string">"Determines whether "</span> ,DESC <span class="string">" is enabled."</span>)
    (p <span class="string">"It must be one of the following:"</span>)
    (ul (li <span class="string">"@(&#39;t&#39;), to enable."</span>)
      (li <span class="string">"@(&#39;nil&#39;), to disable."</span>))))</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-desc-function/lambda/macro
  (&amp;key (subject '<span class="string">"It"</span>)
    (1arg 'nil)
    (1res 'nil)
    (stobjs 'nil)
    (<a class="sym-link system" href="../../../basis-b.html#def-guard" data-sym="GUARD">guard</a> 'nil)
    (dont-be-or-call 'nil)
    (additional-function 'nil)
    (additional-lambda 'nil)
    (additional-forms '<span class="string">""</span>))
  <span class="keyword">:short</span> <span class="string">"Construct a common description text for an input that must be
          a function name or a lambda expression or a macro name."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This text expresses some common requirements
     on this kind of inputs to event macros."</span>)
    (p <span class="string">"This utility provides some customization facilities:"</span>)
    (ul (li <span class="string">"The @(&#39;subject&#39;) parameter must be XDOC text
      that describes the subject of the assertion of the requirements.
      The default is the string @(&#39;&quot;It&quot;&#39;),
      which should be appropriate if this text follows
      some preceding text that describes what the input is for."</span>)
      (li <span class="string">"The @(&#39;1arg&#39;) parameter must be a boolean
      that specifies whether the function or lambda expression
      must be unary (i.e. take one argument) or not."</span>)
      (li <span class="string">"The @(&#39;1res&#39;) parameter must be a boolean
      that specifies whether the function or lambda expression
      must return a single (i.e. non-@(tsee mv)) result or not."</span>)
      (li <span class="string">"The @(&#39;stobjs&#39;) parameter must be a boolean
      that specifies whether the function or lambda expression
      can have input or output stobjs."</span>)
      (li <span class="string">"The @(&#39;guard&#39;) parameter must be one of the following:
      (i) XDOC text that describes the condition under which
      the guards must be verified;
      (ii) @(&#39;t&#39;), to indicate that the guards must always be verified;
      (iii) @(&#39;nil&#39;), to indicate that there are no requirements
      on the guards being verified.
      The default is @(&#39;nil&#39;)."</span>)
      (li <span class="string">"The @(&#39;dont-be-or-call&#39;) parameter must be one of the following:
      (i) XDOC text that describes functions that
      the input (if a function) must differ from
      or that the input (if a lambda expression) must not reference;
      (ii) @(&#39;nil&#39;) (the default), to indicate no such requirements."</span>)
      (li <span class="string">"The @(&#39;additional-function&#39;) parameter must be one of the following:
      (i) XDOC text that describes additional requirements
      for the function (typically a sentence);
      (ii) @(&#39;nil&#39;) (the default) for no additional text."</span>)
      (li <span class="string">"The @(&#39;additional-lambda&#39;) parameter must be one of the following:
      (i) XDOC text that describes additional requirements
      for the lambda expression (typically a sentence);
      (ii) @(&#39;nil&#39;) (the default) for no additional text."</span>)
      (li <span class="string">"The @(&#39;additional-forms&#39;) parameter must consist of
      XDOC list items that describe additional possible forms of the input,
      besides the function and lambda expression forms.
      For instance, an additional form could be a keyword @(&#39;:auto&#39;)
      to infer the function or lambda expression automatically.
      The default is the empty string, i.e. no additional forms."</span>))
    (p <span class="string">"Looking at some uses of this utility should make it clearer."</span>)
    (p <span class="string">"This utility may need to be extended and generalized in the future,
     in particular with more customization facilities."</span>))
  `(&amp;&amp; (p ,SUBJECT <span class="string">" must be one of the following:"</span>)
    (ul (li <span class="string">"The name of a "</span>
        ,(IF 1ARG
     &quot;unary &quot;
     &quot;&quot;)
        <span class="string">"logic-mode function."</span>
        ,(IF STOBJS
     &quot;&quot;
     &#39;(XDOC::&amp;&amp; &quot; This function must have no input or output &quot;
       (XDOC::SEETOPIC &quot;acl2::stobj&quot; &quot;stobjs&quot;) &quot;.&quot;))
        ,(IF 1RES
     &#39;(XDOC::&amp;&amp; &quot; This function must return
              a single (i.e. non-&quot;
       (XDOC::SEETOPIC &quot;acl2::mv&quot; &quot;@(&#39;mv&#39;)&quot;) &quot; result.&quot;)
     &quot;&quot;)
        ,(COND ((EQ GUARD T) &quot; This function must be guard-verified.&quot;)
       ((EQ GUARD NIL) &quot;&quot;)
       (T
        `(XDOC::&amp;&amp; &quot; If &quot; ,GUARD
          &quot;, then this function must be guard-verified.&quot;)))
        ,(IF DONT-BE-OR-CALL
     `(XDOC::&amp;&amp; &quot; This function must be distinct from &quot; ,DONT-BE-OR-CALL &quot;.&quot;)
     &quot;&quot;)
        ,(IF ADDITIONAL-FUNCTION
     `(XDOC::&amp;&amp; &quot; &quot; ,ADDITIONAL-FUNCTION)
     &quot;&quot;))
      (li <span class="string">"A "</span>
        ,(IF 1ARG
     &quot;unary &quot;
     &quot;&quot;)
        <span class="string">"closed lambda expression
       that only references logic-mode functions."</span>
        ,(IF STOBJS
     &quot;&quot;
     &#39;(XDOC::&amp;&amp; &quot; This lambda expression must have no input or output &quot;
       (XDOC::SEETOPIC &quot;acl2::stobj&quot; &quot;stobjs&quot;) &quot;.&quot;))
        ,(IF 1RES
     &#39;(XDOC::&amp;&amp; &quot; This lambda expression must return
              a single (i.e. non-&quot;
       (XDOC::SEETOPIC &quot;acl2::mv&quot; &quot;@(&#39;mv&#39;)&quot;) &quot; result.&quot;)
     &quot;&quot;)
        ,(COND
  ((EQ GUARD T)
   `(XDOC::&amp;&amp; &quot; The body of this lambda expression
                 must only call guard-verified functions,
                 except possibly
                 in the @(&#39;:logic&#39;) subterms of &quot;
     (XDOC::SEETOPIC &quot;acl2::mbe&quot; &quot;@(&#39;mbe&#39;)&quot;) &quot;s or via &quot;
     (XDOC::SEETOPIC &quot;acl2::ec-call&quot; &quot;@(&#39;ec-call&#39;)&quot;) &quot;.&quot;))
  ((EQ GUARD NIL) &quot;&quot;)
  (T
   `(XDOC::&amp;&amp; &quot; If &quot; ,GUARD &quot;, then the body of this lambda expression
                   must only call guard-verified functions,
                   except possibly
                   in the @(&#39;:logic&#39;) subterms of &quot;
     (XDOC::SEETOPIC &quot;acl2::mbe&quot; &quot;@(&#39;mbe&#39;)&quot;) &quot;s or via &quot;
     (XDOC::SEETOPIC &quot;acl2::ec-call&quot; &quot;@(&#39;ec-call&#39;)&quot;) &quot;.&quot;)))
        <span class="string">" As an abbreviation, the name @(&#39;mac&#39;) of a macro stands for
       the lambda expression @(&#39;(lambda (z1 z2 ...) (mac z1 z2 ...))&#39;),
       where @(&#39;z1&#39;), @(&#39;z2&#39;), ... are the required parameters of @(&#39;mac&#39;);
       that is, a macro name abbreviates its eta-expansion
       (considering only the macro&#39;s required parameters)."</span>
        ,(IF DONT-BE-OR-CALL
     `(XDOC::&amp;&amp; &quot; This lambda expression must not reference &quot; ,DONT-BE-OR-CALL
       &quot;.&quot;)
     &quot;&quot;)
        ,(IF ADDITIONAL-LAMBDA
     `(XDOC::&amp;&amp; &quot; &quot; ,ADDITIONAL-LAMBDA)
     &quot;&quot;))
      ,ADDITIONAL-FORMS)))</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-desc-term
  (&amp;key (subject 'nil)
    (free-vars 'nil)
    (1res 'nil)
    (stobjs 'nil)
    (<a class="sym-link system" href="../../../basis-b.html#def-guard" data-sym="GUARD">guard</a> 'nil)
    (dont-call 'nil)
    (additional 'nil))
  <span class="keyword">:short</span> <span class="string">"Construct a common description text for an input that must be a term."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This text expresses some common requirements
     on this kind of inputs to event macros."</span>)
    (p <span class="string">"This utility provides some customization facilities:"</span>)
    (ul (li <span class="string">"The @(&#39;subject&#39;) parameter must be either @(&#39;nil&#39;)
      or XDOC text that describes
      the subject of the assertion of the requirements.
      The default is @(&#39;nil&#39;), which means that there is no subject,
      and the description starts with &quot;A term that...&quot;.
      If not @(&#39;nil&#39;), the description starts with
      &quot;&lt;i&gt;subject&lt;/i&gt; must be a term...&quot;."</span>)
      (li <span class="string">"The @(&#39;free-vars&#39;) parameter must be one of the following:
      (i) XDOC text that describes the allowed free variables in the term;
      (ii) @(&#39;nil&#39;) (the default) for no requirements on free variables."</span>)
      (li <span class="string">"The @(&#39;1res&#39;) parameter must be a boolean
      that specifies whether the term
      must return a single (i.e. non-@(tsee mv)) value or not."</span>)
      (li <span class="string">"The @(&#39;stobjs&#39;) parameter must be a boolean
      that specifies whether the term
      can have input or output stobjs."</span>)
      (li <span class="string">"The @(&#39;guard&#39;) parameter must be one of the following:
      (i) XDOC text that describes the condition under which
      the guards must be verified;
      (ii) @(&#39;t&#39;), to indicate that the guards must always be verified;
      (iii) @(&#39;nil&#39;), to indicate that there are no requirements
      on the guards being verified.
      The default is @(&#39;nil&#39;)."</span>)
      (li <span class="string">"The @(&#39;dont-call&#39;) parameters must one of the following:
      (i) XDOC text that describes functions that this term must not call;
      (ii) @(&#39;nil&#39;) (the default),
      to indicate that the term may call any function."</span>)
      (li <span class="string">"The @(&#39;additional&#39;) parameter must be one of the following:
      (i) XDOC text that describes additional requirements
      for the term (typically a sentence);
      (ii) @(&#39;nil&#39;) (the default) for no additional text."</span>))
    (p <span class="string">"Looking at some uses of this utility should make it clearer."</span>)
    (p <span class="string">"This utility may need to be extended and generalized in the future,
     in particular with more customization facilities."</span>))
  `(&amp;&amp; ,@(IF SUBJECT
      (LIST SUBJECT &quot; must be a&quot;)
      (LIST &quot;A&quot;))
    <span class="string">" term that only references logic-mode functions"</span>
    ,(IF FREE-VARS
     `(XDOC::&amp;&amp; &quot; and that includes no free variables other than &quot; ,FREE-VARS)
     &quot;&quot;)
    ,(IF STOBJS
     &quot;&quot;
     &#39;(XDOC::&amp;&amp; &quot;. This term must have no output &quot;
       (XDOC::SEETOPIC &quot;acl2::stobj&quot; &quot;stobjs&quot;) &quot;.&quot;))
    ,(IF 1RES
     `(XDOC::&amp;&amp; &quot; This term must return
            a single (i.e. non-&quot;
       (XDOC::SEETOPIC &quot;acl2::mv&quot; &quot;@(&#39;mv&#39;)&quot;) &quot; value.&quot;)
     &quot;&quot;)
    ,(COND
  ((EQ GUARD T)
   `(XDOC::&amp;&amp; &quot; This term
               must only call guard-verified functions,
               except possibly
               in the @(&#39;:logic&#39;) subterms of &quot;
     (XDOC::SEETOPIC &quot;acl2::mbe&quot; &quot;@(&#39;mbe&#39;)&quot;) &quot;s or via &quot;
     (XDOC::SEETOPIC &quot;acl2::ec-call&quot; &quot;@(&#39;ec-call&#39;)&quot;) &quot;.&quot;))
  ((EQ GUARD NIL) &quot;&quot;)
  (T
   `(XDOC::&amp;&amp; &quot; If &quot; ,GUARD &quot;, then this term
                 must only call guard-verified functions,
                 except possibly
                 in the @(&#39;:logic&#39;) subterms of &quot;
     (XDOC::SEETOPIC &quot;acl2::mbe&quot; &quot;@(&#39;mbe&#39;)&quot;) &quot;s or via &quot;
     (XDOC::SEETOPIC &quot;acl2::ec-call&quot; &quot;@(&#39;ec-call&#39;)&quot;) &quot;.&quot;)))
    ,(IF DONT-CALL
     `(XDOC::&amp;&amp; &quot; This term must not reference &quot; ,DONT-CALL &quot;.&quot;)
     &quot;&quot;)
    ,(IF ADDITIONAL
     `(XDOC::&amp;&amp; &quot; &quot; ,ADDITIONAL)
     &quot;&quot;)))</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-appcond
  (name main &amp;key design-notes design-notes-appcond presence)
  <span class="keyword">:short</span> <span class="string">"Construct an applicability condition description
          in the user documentation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This generates an @(tsee xdoc::desc)."</span>)
    (p <span class="string">"The @(&#39;name&#39;) input must be a string
     that names the applicability condition."</span>)
    (p <span class="string">"The @(&#39;main&#39;) input must be an XDOC tree
     that contains the main description of the applicability condition,
     consisting of explanatory natural language
     and formal code for the formula(s)."</span>)
    (p <span class="string">"The @(&#39;design-notes&#39;) and @(&#39;design-notes-appcond&#39;) inputs
     must be either both present or both absent.
     If present, they must be both XDOC trees:
     the first one references the design notes of the event macro
     (which usually includes a link to the design notes);
     the second one provides the name of the applicability condition
     (usually some mathematical notation) used in the design notes.
     If these two inputs are present,
     the generated XDOC includes text
     relating the applicability condition to the design notes."</span>)
    (p <span class="string">"If the @(&#39;presence&#39;) input is present,
     it must be an XDOC tree.
     In this case,
     the generated XDOC includes text
     explaining that the applicability condition is present
     under the condition described by the @(&#39;presence&#39;) input."</span>))
  (declare (xargs <span class="keyword">:guard</span> (stringp name)))
  `(desc ,(CONCATENATE &#39;STRING &quot;@(&#39;&quot; NAME &quot;&#39;)&quot;)
    ,MAIN
    ,@(AND DESIGN-NOTES DESIGN-NOTES-APPCOND
       `((XDOC::P &quot;This corresponds to &quot; ,DESIGN-NOTES-APPCOND &quot; in the &quot;
          ,DESIGN-NOTES &quot;.&quot;)))
    ,@(AND PRESENCE
       `((XDOC::P &quot;This applicability condition is present if and only if &quot;
          ,PRESENCE &quot;.&quot;)))))</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection evmac-topic-design-notes
  <span class="keyword">:short</span> <span class="string">"Generate an XDOC topic for the design notes of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This utility takes the following arguments:"</span>)
    (ul (li <span class="string">"The event macro&#39;s symbol."</span>)
      (li <span class="string">"A string for the @(&#39;href&#39;) link with the actual notes,
      normally of the form @(&#39;res/.../&lt;notes&gt;.pdf&#39;), based on the "</span>
        (seetopic <span class="string">"xdoc::add-resource-directory"</span>
          <span class="string">"XDOC resource directory"</span>)
        <span class="string">"."</span>)
      (li <span class="string">"A list of additional parent topics, besides the macro itself."</span>)
      (li <span class="string">"Zero or more XDOC trees (often just strings)
      to put into the bullets that explain the correspondence between
      the symbols in the design notes and the user documentation.
      If this list is empty,
      then no bulletted list is generated,
      and no introductory text for it."</span>)
      (li <span class="string">"Zero or more XDOC trees (often paragraphs)
      that provide some additional explanation
      about how the design notes relate to the event macro
      (e.g. parts of the design notes that are not implemented yet."</span>))
    (@def <span class="string">"xdoc::evmac-topic-design-notes"</span>))
  (define evmac-topic-design-notes-make-bullets
    ((correspondences tree-listp))
    <span class="keyword">:returns</span> (bullets tree-listp <span class="keyword">:hyp</span> <span class="keyword">:guard</span>)
    <span class="keyword">:parents</span> nil
    (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> correspondences) nil)
      (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (cons (li (car correspondences))
          (evmac-topic-design-notes-make-bullets (cdr correspondences))))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> evmac-topic-design-notes
    (macro notes-ref
      &amp;key
      additional-parents
      correspondences
      additional-doc)
    (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (symbolp macro)
          (stringp notes-ref)
          (<a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> additional-parents))))
    (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(tsee "</span> macro-name <span class="string">")"</span>))
        (this-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-DESIGN"</span>))
        (parents (cons macro additional-parents))
        (short (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"Design notes for "</span> macro-ref <span class="string">"."</span>))
        (long `(topstring (p <span class="string">"The design of "</span>
              ,MACRO-REF
              <span class="string">" is described in "</span>
              (a <span class="keyword">:href</span> ,NOTES-REF <span class="string">"these notes"</span>)
              <span class="string">", which use "</span>
              (a <span class="keyword">:href</span> <span class="string">"res/kestrel-design-notes/notation.pdf"</span>
                <span class="string">"this notation"</span>)
              <span class="string">"."</span>)
            ,@(AND CORRESPONDENCES
       `((XDOC::P &quot;The correspondence between
                            the design notes and the user documentation
                            is the following:&quot;)
         (XDOC::UL-FN NIL
          (XDOC::EVMAC-TOPIC-DESIGN-NOTES-MAKE-BULLETS
           (LIST ,@CORRESPONDENCES)))))
            ,@ADDITIONAL-DOC)))
      `(defxdoc ,THIS-TOPIC
        <span class="keyword">:parents</span> ,PARENTS
        <span class="keyword">:short</span> ,SHORT
        <span class="keyword">:long</span> ,LONG))))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ event-macro-xdoc-constructors-implementation-level
  <span class="keyword">:parents</span> (event-macro-xdoc-constructors)
  <span class="keyword">:short</span> <span class="string">"Utilities to construct &lt;see topic=&#39;@(url xdoc)&#39;&gt;XDOC&lt;/see&gt; strings
          to document the implementation of
          &lt;see topic=&#39;@(url event-macros)&#39;&gt;event macros&lt;/see&gt;."</span>
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection evmac-topic-implementation
  <span class="keyword">:short</span> <span class="string">"Generate an XDOC topic for the implementation of an event macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"The topic lists the names used for arguments and results of functions,
     along with brief descriptions of the names.
     This listing consists of bullets in an unordered list.
     The @(&#39;:items&#39;) argument must be a list of XDOC trees,
     each of which is wrapped into an @(tsee xdoc::li),
     and the so-wrapped items are put into an @(tsee xdoc::ul)."</span>)
    (p <span class="string">"We also provide some named constants for certain common items,
     like the @(&#39;state&#39;) variable.
     We also provide some functions for certain common kinds of items,
     like the user inputs to the event macro."</span>)
    (p <span class="string">"If there are no items, the list is omitted altogether."</span>)
    (p <span class="string">"This macro also provides a @(&#39;:default-parent&#39;) option,
     which is @(&#39;nil&#39;) by default and is passed to @(tsee defxdoc+)."</span>)
    (p <span class="string">"This macro also provides a @(&#39;:additional&#39;) option,
     which must be a list of XDOC trees (@(&#39;nil&#39;) by default),
     which is added at the end of the @(tsee defxdoc+),
     to provide additional information about
     the implementation being documented."</span>)
    (@def <span class="string">"xdoc::evmac-topic-implementation"</span>))
  (define evmac-topic-implementation-li-wrap
    ((items <a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a>))
    <span class="keyword">:parents</span> nil
    <span class="keyword">:returns</span> (li-wrapped-items <a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a>)
    (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> items) nil)
      (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (cons `(li ,(CAR ITEMS))
          (evmac-topic-implementation-li-wrap (cdr items))))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> evmac-topic-implementation
    (macro &amp;key items default-parent additional)
    (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
    (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(tsee "</span> macro-name <span class="string">")"</span>))
        (this-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-IMPLEMENTATION"</span>))
        (parent-topic macro)
        (short (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"Implementation of "</span> macro-ref <span class="string">"."</span>))
        (long (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> items additional)
            `(topstring (p <span class="string">"The implementation functions have arguments and results
                        consistently named as follows
                        (unless otherwise stated, explicitly or implicitly,
                        in the functions):"</span>)
              (ul ,@(XDOC::EVMAC-TOPIC-IMPLEMENTATION-LI-WRAP ITEMS))
              (p <span class="string">"Implementation functions&#39; arguments and results
                        that are not listed above
                        are described in, or clear from,
                        those functions&#39; documentation."</span>)
              ,@ADDITIONAL))))
      `(defxdoc+ ,THIS-TOPIC
        <span class="keyword">:parents</span> (,PARENT-TOPIC)
        <span class="keyword">:short</span> ,SHORT
        ,@(AND LONG (LIST :LONG LONG))
        <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
        <span class="keyword">:default-parent</span> ,DEFAULT-PARENT)))
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-state*
    (&amp;&amp; <span class="string">"@(&#39;state&#39;) is the ACL2 "</span>
      (seetopic <span class="string">"acl2::state"</span> <span class="string">"state"</span>)
      <span class="string">"."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-wrld*
    (&amp;&amp; <span class="string">"@(&#39;wrld&#39;) is the ACL2 "</span>
      (seetopic <span class="string">"acl2::world"</span> <span class="string">"world"</span>)
      <span class="string">"."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-ctx*
    (&amp;&amp; <span class="string">"@(&#39;ctx&#39;) is the "</span>
      (seetopic <span class="string">"ctx"</span> <span class="string">"context"</span>)
      <span class="string">" used for errors."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-call*
    <span class="string">"@(&#39;call&#39;) is the call of the event macro."</span>)
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-names-to-avoid*
    <span class="string">"@(&#39;names-to-avoid&#39;) is a cumulative list of names of generated events,
     used to ensure the absence of name clashes in the generated events."</span>)
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *evmac-topic-implementation-item-appcond-thm-names*
    <span class="string">"@(&#39;appcond-thm-names&#39;) is an alist
     from the keywords that identify the applicability conditions
     to the corresponding generated theorem names."</span>)
  (define evmac-topic-implementation-item-input
    ((name stringp))
    <span class="keyword">:parents</span> nil
    (&amp;&amp; <span class="string">"@(&#39;"</span>
      name
      <span class="string">"&#39;) is the homonymous input to the event macro."</span>))
  (define evmac-topic-implementation-item-input-untyped/typed
    ((name stringp))
    <span class="keyword">:parents</span> nil
    (&amp;&amp; <span class="string">"@(&#39;"</span>
      name
      <span class="string">"&#39;) is the homonymous input to the event macro
               if it has no type;
               otherwise, it is the (possibly different) typed value
               resulting from processing that input."</span>))
  (define evmac-topic-implementation-item-fn-doc
    ((name stringp))
    <span class="keyword">:parents</span> nil
    (&amp;&amp; <span class="string">"@(&#39;"</span>
      name
      <span class="string">"&#39;) is the homonymous function symbol "</span>
      <span class="string">"described in the user documentation."</span>))
  (define evmac-topic-implementation-item-thm-doc
    ((name stringp))
    <span class="keyword">:parents</span> nil
    (&amp;&amp; <span class="string">"@(&#39;"</span>
      name
      <span class="string">"&#39;) is the homonymous theorem symbol "</span>
      <span class="string">"described in the user documentation."</span>))
  (define evmac-topic-implementation-item-var-doc
    ((name stringp))
    <span class="keyword">:parents</span> nil
    (&amp;&amp; <span class="string">"@(&#39;"</span>
      name
      <span class="string">"&#39;) is the homonymous variable symbol "</span>
      <span class="string">"described in the user documentation."</span>)))</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-topic-library-extensions
  (macro)
  <span class="keyword">:short</span> <span class="string">"Generate an XDOC topic for the library extensions
          that are part of the implementation of an event macro."</span>
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(tsee "</span> macro-name <span class="string">")"</span>))
      (this-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-LIBRARY-EXTENSIONS"</span>))
      (parent-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-IMPLEMENTATION"</span>))
      (short (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"Library extensions for "</span>
          macro-ref
          <span class="string">"."</span>))
      (long (topstring-p <span class="string">"These are used by, but more general than, "</span>
          macro-ref
          <span class="string">". Thus, they should be moved
                 to more general libraries eventually."</span>)))
    `(defxdoc+ ,THIS-TOPIC
      <span class="keyword">:parents</span> (,PARENT-TOPIC)
      <span class="keyword">:short</span> ,SHORT
      <span class="keyword">:long</span> ,LONG
      <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
      <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-topic-input-processing
  (macro &amp;rest additional)
  <span class="keyword">:short</span> <span class="string">"Generate an XDOC topic for the input processing
          that is part of the implementation of an event macro."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This macro accepts additional pieces of XDOC text,
    which are added at the end of the generated @(&#39;:long&#39;)."</span>)
  (declare (xargs <span class="keyword">:guard</span> (symbolp macro)))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(tsee "</span> macro-name <span class="string">")"</span>))
      (this-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-INPUT-PROCESSING"</span>))
      (parent-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-IMPLEMENTATION"</span>))
      (short (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"Input processing performed by "</span>
          macro-ref
          <span class="string">"."</span>))
      (long `(topstring (p <span class="string">"See "</span>
            (seetopic <span class="string">"acl2::event-macro-input-processing"</span>
              <span class="string">"input processing"</span>)
            <span class="string">" for general background."</span>)
          ,@ADDITIONAL)))
    `(defxdoc+ ,THIS-TOPIC
      <span class="keyword">:parents</span> (,PARENT-TOPIC)
      <span class="keyword">:short</span> ,SHORT
      <span class="keyword">:long</span> ,LONG
      <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
      <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defmacro+ evmac-topic-event-generation
  (macro &amp;key
    some-local-p
    some-local-nonlocal-p
    some-nonlocal-p)
  <span class="keyword">:short</span> <span class="string">"Generate an XDOC topic for the event generation
          that is part of the implementation of an event macro."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"An event macro may generate some events only locally;
    in this case, the @(&#39;:some-local-p&#39;) argument must be @(&#39;t&#39;).
    An event macro may generate some events both locally and non-locally,
    where the local variant has proof hints and the non-local variant does not;
    in this case, the @(&#39;:some-local-nonlocal-p&#39;) argument must be @(&#39;t&#39;).
    An event macro may generate some events only non-locally;
    in this case the @(&#39;:some-nonlocal-p&#39;) argument must be @(&#39;t&#39;).
    These arguments are used to customize the generated @(&#39;:long&#39;)."</span>)
  (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (symbolp macro)
        (<a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> some-local-p)
        (<a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> some-local-nonlocal-p)
        (<a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> some-nonlocal-p))))
  (b* ((macro-name (<a class="sym-link system" href="../../../axioms.html#def-string-downcase" data-sym="STRING-DOWNCASE">string-downcase</a> (symbol-name macro))) (macro-ref (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"@(tsee "</span> macro-name <span class="string">")"</span>))
      (this-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-EVENT-GENERATION"</span>))
      (parent-topic (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> macro <span class="string">"-IMPLEMENTATION"</span>))
      (short (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a>
          <span class="string">"Event generation performed by "</span>
          macro-ref
          <span class="string">"."</span>))
      (para-local-nonlocal? (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> some-local-nonlocal-p
          '((p <span class="string">"Some events are generated in two slightly different variants:
                 one that is local to the generated "</span>
             (seetopic <span class="string">"acl2::encapsulate"</span> <span class="string">"@(&#39;encapsulate&#39;)"</span>)
             <span class="string">", and one that is exported from the "</span>
             (seetopic <span class="string">"acl2::encapsulate"</span> <span class="string">"@(&#39;encapsulate&#39;)"</span>)
             <span class="string">". Proof hints are in the former but not in the latter,
                 thus keeping the ACL2 history ``clean&#39;&#39;;
                 some proof hints may refer to events
                 that are generated only locally to the "</span>
             (seetopic <span class="string">"acl2::encapsulate"</span> <span class="string">"@(&#39;encapsulate&#39;)"</span>)
             <span class="string">"."</span>))))
      (para-local? (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> some-local-p
          '((p <span class="string">"Some events are generated only locally to the generated "</span>
             (seetopic <span class="string">"acl2::encapsulate"</span> <span class="string">"@(&#39;encapsulate&#39;)"</span>)
             <span class="string">". These are auxiliary events
                 needed to introduce the non-local (i.e. exported) events,
                 but whose presence in the ACL2 history is no longer needed
                 once the exported events have been introduced.
                 These only-local events have generated fresh names.
                 In contrast, exported events have names
                 that are user-controlled, directly or indirectly."</span>))))
      (para-nonlocal? (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> some-nonlocal-p
          '((p <span class="string">"Some events are generated only non-locally to the generated "</span>
             (seetopic <span class="string">"acl2::encapsulate"</span> <span class="string">"@(&#39;encapsulate&#39;)"</span>)
             <span class="string">", i.e. they are exported,
                 without local counterparts."</span>))))
      (long? (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> some-local-nonlocal-p some-local-p some-nonlocal-p)
          `(topstring ,@PARA-LOCAL-NONLOCAL?
            ,@PARA-LOCAL?
            ,@PARA-NONLOCAL?))))
    `(defxdoc+ ,THIS-TOPIC
      <span class="keyword">:parents</span> (,PARENT-TOPIC)
      <span class="keyword">:short</span> ,SHORT
      ,@(AND LONG? (LIST :LONG LONG?))
      <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
      <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>