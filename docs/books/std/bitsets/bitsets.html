<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>bitsets - ACL2 Book</title>
  <meta property="name" content="bitsets">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">bitsets</h1>
    <div class="path"><a href="bitsets.lisp" class="source-link">books/std/bitsets/bitsets</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"BITSETS"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="bits-between.html" title="Open bits-between">"bits-between"</a>)</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="bignum-extract.html" title="Open bignum-extract">"bignum-extract"</a>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/bitops/equal-by-logbitp.html" title="Open centaur/bitops/equal-by-logbitp">"centaur/bitops/equal-by-logbitp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/misc/witness-cp.html" title="Open centaur/misc/witness-cp">"centaur/misc/witness-cp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/bitops/ihs-extensions.html" title="Open centaur/bitops/ihs-extensions">"centaur/bitops/ihs-extensions"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../ihs/quotient-remainder-lemmas.html" title="Open ihs/quotient-remainder-lemmas">"ihs/quotient-remainder-lemmas"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../arithmetic-3/bind-free/top.html" title="Open arithmetic-3/bind-free/top">"arithmetic-3/bind-free/top"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable* definitions
      expensive-rules
      ash-1-removal)))</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc bitsets
  <span class="keyword">:parents</span> (std/bitsets)
  <span class="keyword">:short</span> <span class="string">"Bitsets library: uses bitmasks to represent finite sets of (small)
natural numbers."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;h3&gt;Introduction&lt;/h3&gt;

&lt;p&gt;In this library, sets of natural numbers are represented as natural numbers
by saying @(&#39;a&#39;) is a member of the set @(&#39;X&#39;) when @(&#39;(logbitp a X)&#39;).  For
instance, the set {1, 2, 4} would be represented as the number 22.  In binary,
this number is 10110, and you can see that bits 1, 2, and 4 are each
&quot;true&quot;.&lt;/p&gt;

&lt;p&gt;This representation enjoys certain efficiencies.  In particular, operations
like union, intersection, difference, and subset testing can be carried out in
a &quot;word at a time&quot; fashion with bit operations.&lt;/p&gt;

&lt;p&gt;But bitsets are only appropriate for sets whose elements are reasonably
small numbers since the space needed to represent a bitset is determined by its
maximal element.  If your sets contain extremely small numbers---less than
28-60, depending on the Lisp---then they can be represented as fixnums and the
bitset operations will be remarkably efficient.&lt;/p&gt;

&lt;p&gt;Beyond this, bignums are necessary.  Even though bignum operations generally
involve memory allocation and are much slower than fixnum operations, using
bignums to represent sets can still be very efficient.  For instance, on 64-bit
CCL, bignums are represented as a header/data pair where the data is an array
of 32-bit words; operations like @(see logand) can smash together the two data
arrays a word at a time.&lt;/p&gt;

&lt;p&gt;Let&#39;s define the &lt;i&gt;density&lt;/i&gt; of a set as its cardinality divided by its
maximal element plus one (to account for zero-indexing).  Under this
definition, the set {1, 2, 4} has a density of 60%, whereas {96, 97, 98} has a
density of 3%.&lt;/p&gt;

&lt;p&gt;Without destructive updates, you probably can&#39;t do much better than bitsets
for dense sets.  But bitsets are not good at representing sparse sets.  For
instance, you would need 8 KB of memory just to represent the singleton set
{65536}.&lt;/p&gt;

&lt;p&gt;The &lt;see topic=&quot;@(url sbitsets)&quot;&gt;sparse bitsets&lt;/see&gt; library is an
alternative to bitsets that uses lists of @(&#39;(offset . data)&#39;) pairs instead of
ordinary natural numbers as the set representation.  This representation is
perhaps somewhat less efficient for dense sets, but is far more efficient for
sparse sets (e.g., {65536} can be represented with a single cons of fixnums
instead of an 8 KB bignum.) and still provides word-at-a-time operations in
many cases.&lt;/p&gt;


&lt;h3&gt;Bitset Operations&lt;/h3&gt;

&lt;p&gt;Convention:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;@(&#39;a, b, ...&#39;) denote set elements&lt;/li&gt;
&lt;li&gt;@(&#39;X, Y, ...&#39;) denote sets.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There is no such explicit @(&#39;bitsetp&#39;) recognizer; instead we just use
@(&#39;natp&#39;).  Similarly there is no separate bitset-fixing function because we
just use @(&#39;nfix&#39;).&lt;/p&gt;

&lt;p&gt;See @(see reasoning) for some notes about how to prove theorems about bitset
functions.&lt;/p&gt;

&lt;h5&gt;Bitset Constructors&lt;/h5&gt;

&lt;dl&gt;

&lt;dt&gt;@(&#39;(bitset-singleton a)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;{a}&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(ash 1 a)&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-insert a X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X U {a}&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logior (ash 1 a) x)&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-list a b ...)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;{a, b, ...}&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: repeated @(&#39;bitset-insert&#39;)s&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-list* a b ... X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X U {a, b, ...}&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: repeated @(&#39;bitset-insert&#39;)s&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-delete a X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X - {a}&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logandc1 (ash 1 a) x)&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-union X Y ...)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X U Y U ...&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logior x (logior y ...))&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-intersect X Y ...)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X \intersect Y \intersect ...&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logand x (logand y ...))&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-difference X Y)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs the set @(&#39;X - Y&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logandc1 y x)&#39;)&lt;/dd&gt;
&lt;/dl&gt;

&lt;h5&gt;Inspecting Bitsets&lt;/h5&gt;

&lt;dl&gt;
&lt;dt&gt;@(&#39;(bitset-memberp a X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Determine whether @(&#39;a&#39;) is a member of the set @(&#39;X&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logbitp a x)&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-intersectp X Y)&#39;)&lt;/dt&gt;
&lt;dd&gt;Determines whether @(&#39;X&#39;) and @(&#39;Y&#39;) have any common members&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logtest x y)&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-subsetp X Y)&#39;)&lt;/dt&gt;
&lt;dd&gt;Determines whether @(&#39;X&#39;) is a subset of @(&#39;Y&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(= 0 (logandc2 y x))&#39;)&lt;/dd&gt;

&lt;dt&gt;@(&#39;(bitset-cardinality X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Determines the cardinality of @(&#39;X&#39;)&lt;/dd&gt;
&lt;dd&gt;Execution: @(&#39;(logcount x)&#39;)&lt;/dd&gt;

&lt;/dl&gt;

&lt;h5&gt;Enumerating Bitset Members&lt;/h5&gt;

&lt;dl&gt;
&lt;dt&gt;@(&#39;(bitset-members X)&#39;)&lt;/dt&gt;
&lt;dd&gt;Constructs an ordinary ordered set with the elements of X.&lt;/dd&gt;
&lt;dd&gt;Expensive: must cons together all of the set elements.&lt;/dd&gt;
&lt;dd&gt;Important in @(see reasoning) about bitsets.&lt;/dd&gt;
&lt;/dl&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (set-default-parents bitsets))</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-members
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>))
  <span class="keyword">:short</span> <span class="string">"@(call bitset-members) converts a bitset into an ordinary, ordered
set."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Reasoning note: @(&#39;bitset-members&#39;) is fundamental to reasoning
about bitsets; see &lt;i&gt;Reasoning with Bitsets&lt;/i&gt; in @(see bitsets).  Its
definition and the theorem @(&#39;in-of-bitset-members&#39;) should generally be left
disabled since they expose the underlying representation of bitsets.&lt;/p&gt;

&lt;p&gt;Performance note: @(&#39;bitset-members&#39;) is &lt;b&gt;inherently expensive&lt;/b&gt;: no
matter how it is implemented, it must create at least @(&#39;|X|&#39;) conses.  You may
sometimes be able to avoid this cost using functions like @(see
bitset-memberp), @(see bitset-intersectp), or @(see bitset-subsetp)
instead.&lt;/p&gt;

&lt;p&gt;It is simple enough to convert a bitset into an ordered set: since the @(see
integer-length) of @(&#39;x&#39;) gives us an upper bound on its elements, we just need
to walk up to this bound and collect all @(&#39;i&#39;) such that @(&#39;(logbitp i
x)&#39;).&lt;/p&gt;

&lt;p&gt;The definition below uses @(see bits-between) to do just this.  However,
note that when the @(&#39;bignum-extract-opt&#39;) book is loaded (which requires a
ttag), a more efficient implementation is used; see @(see ttag-bitset-members)
and @(see bignum-extract) for details.&lt;/p&gt;"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (let ((x (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)))
      (bits-between <span class="number">0</span>
        (<a class="sym-link system" href="../../../axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> x)
        x))
    <span class="keyword">:exec</span> (bits-between <span class="number">0</span>
      (<a class="sym-link system" href="../../../axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> x)
      x))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-default
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
      (equal (bitset-members a) nil)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-nfix
    (equal (bitset-members (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))
      (bitset-members b)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> true-listp-of-bitset-members
    (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> (bitset-members x))
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> nat-listp-of-bitset-members
    (<a class="sym-link system" href="../../../axioms.html#def-nat-listp" data-sym="NAT-LISTP">nat-listp</a> (bitset-members x)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> no-duplicatesp-equal-of-bitset-members
    (<a class="sym-link system" href="../../../axioms.html#def-no-duplicatesp-equal" data-sym="NO-DUPLICATESP-EQUAL">no-duplicatesp-equal</a> (bitset-members x)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> setp-of-bitset-members
    (setp (bitset-members x)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthmd" data-sym="DEFTHMD">defthmd</a> in-of-bitset-members
    (equal (in a (bitset-members x))
      (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a)
        (logbitp a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)))))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable bitset-members)))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> x)
          (logbitp-mismatch x <span class="number">0</span>))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l1
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> x)
          (logbitp (logbitp-mismatch x <span class="number">0</span>)
            x))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable logbitp-mismatch-correct)
           <span class="keyword">:use</span> ((<span class="keyword">:instance</span> logbitp-mismatch-correct
              (a x)
              (b <span class="number">0</span>)))))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l2
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> x)
          (bitset-members x))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
           <span class="keyword">:use</span> ((<span class="keyword">:instance</span> in-of-bitset-members
              (a (logbitp-mismatch x <span class="number">0</span>))))))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l3
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> x))
          (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (bitset-members x)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:cases</span> ((equal x <span class="number">0</span>))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-under-iff
      (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (bitset-members x)
        (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> x)))))</pre>
  </div>

<div class="form-block other" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection bits-between-of-bignum-extract
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable bignum-extract)))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> slice) (integerp x))
        (equal (bits-between <span class="number">0</span>
            <span class="number">32</span>
            (ash x (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">-32</span> slice)))
          (add-to-each (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">-32</span> slice)
            (bits-between (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">32</span> slice)
              (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">32</span> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> slice))
              x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:use</span> ((<span class="keyword">:instance</span> bits-between-of-right-shift
            (n <span class="number">0</span>)
            (m <span class="number">32</span>)
            (k (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">-32</span> slice))))
         <span class="keyword">:in-theory</span> (disable bits-between-of-right-shift)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bits-between-of-bignum-extract
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-posp" data-sym="POSP">posp</a> slice) (integerp x))
      (equal (bits-between <span class="number">0</span>
          <span class="number">32</span>
          (bignum-extract x slice))
        (add-to-each (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">-32</span> slice)
          (bits-between (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">32</span> slice)
            (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> <span class="number">32</span> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> slice))
            x))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (loghead)
         (bits-between-of-increment-right-index right-shift-to-logtail))))))</pre>
  </div>

<div class="form-block other" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define ttag-bitset-members
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>))
  <span class="keyword">:parents</span> (bitset-members)
  <span class="keyword">:short</span> <span class="string">"Notes about the optimization of @(see bitset-members)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;The basic version of @(&#39;bitset-members&#39;) calls @(see bits-between),
which repeatedly indexes into the bitset using @(see logbitp).&lt;/p&gt;

&lt;p&gt;We found this wasn&#39;t very efficient in 64-bit CCL, and have developed an
alternate implementation that uses:&lt;/p&gt;

&lt;ol&gt;

&lt;li&gt;@(see bits-0-31), a partially unrolled version of @(see bits-between) that
is specialized for 32-bit numbers, and&lt;/li&gt;

&lt;li&gt;@(see bignum-extract), a function for extracting a 32-bit chunk from a
bignum in a particularly efficient way on 64-bit CCL.&lt;/li&gt;

&lt;/ol&gt;

&lt;p&gt;Basic performance testing suggests that @(&#39;ttag-bitset-members&#39;) is almost
5x faster than a regular version.  Here&#39;s the testing code I used:&lt;/p&gt;

@({
 (include-book &quot;bitsets&quot;)
 (include-book &quot;centaur/aig/random-sim&quot; :dir :system)
 (include-book &quot;centaur/misc/memory-mgmt&quot; :dir :system)
 (include-book &quot;std/util/defconsts&quot; :dir :system)

  (acl2::set-max-mem ;; newline to fool dependency scanner
    (* 30 (expt 2 30)))

  (acl2::defconsts (*random-data* state)
    (acl2::random-list 100000 (ash 1 5000) state))

 (defund bitset-members-list (x)
   (if (atom x)
       nil
     (cons (bitset-members (car x))
           (bitset-members-list (cdr x)))))

 (defund ttag-bitset-members-list (x)
   (if (atom x)
       nil
     (cons (ttag-bitset-members (car x))
           (ttag-bitset-members-list (cdr x)))))

 (progn$
  (gc$)
  (time$ (bitset-members-list *random-data*)
         :msg &quot;Unoptimized Original: ~st sec, ~sa bytes~%&quot;)
  (gc$)
  (time$ (ttag-bitset-members-list *random-data*)
         :msg &quot;Unoptimized TTAG: ~st sec, ~sa bytes~%&quot;)
  nil)

 (include-book &quot;bitsets-opt&quot;)

 (progn$
  (gc$)
  (time$ (bitset-members-list *random-data*)
         :msg &quot;Optimized Original: ~st sec, ~sa bytes~%&quot;)
  (gc$)
  (time$ (ttag-bitset-members-list *random-data*)
         :msg &quot;Optimized TTAG: ~st sec, ~sa bytes~%&quot;)
  nil)
})

&lt;p&gt;And the results (on compute-1-3):&lt;/p&gt;

@({
     Unoptimized Original: 12.80 sec, 4,001,843,488 bytes
     Unoptimized TTAG: 8.27 sec, 9,118,511,648 bytes
     Optimized Original: 4.05 sec, 4,001,843,488 bytes
     Optimized TTAG: 4.01 sec, 4,001,843,488 bytes
})"</span>
  <span class="keyword">:prepwork</span> ((<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable associativity-of-append))) (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> rassoc-append
        (equal (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> x (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> y z))
          (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> x y) z))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ash-5-to-times
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
          (equal (ash x <span class="number">5</span>) (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> x <span class="number">32</span>)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable ash floor)))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ash-minus-5-to-floor
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
          (equal (ash x <span class="number">-5</span>) (floor x <span class="number">32</span>)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable ash floor)))))
    (defund ttag-bitset-members-aux
      (slice x acc)
      (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> slice) (integerp x))))
      (if (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> slice)
        (bits-0-31 (ash slice <span class="number">5</span>)
          (bignum-extract x slice)
          acc)
        (ttag-bitset-members-aux (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (lnfix slice) <span class="number">1</span>))
          x
          (bits-0-31 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) (ash slice <span class="number">5</span>))
            (bignum-extract x slice)
            acc))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable loghead)))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ttag-bitset-members-aux-redef
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> slice) (integerp x))
        (equal (ttag-bitset-members-aux slice
            x
            acc)
          (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (bits-between <span class="number">0</span>
              (<a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> slice) <span class="number">32</span>)
              x)
            acc)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (ttag-bitset-members-aux bignum-extract)
           (right-shift-to-logtail))))))
  <span class="keyword">:guard-hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (bitset-members))))
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (bitset-members x)
    <span class="keyword">:exec</span> (ttag-bitset-members-aux (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) (ash (<a class="sym-link system" href="../../../axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> x) <span class="number">-5</span>))
      x
      nil)))</pre>
  </div>

<div class="form-block other" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-memberp
  ((a <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (bool <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-memberp) tests whether @(&#39;a&#39;) is a member of the set
@(&#39;X&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is reasonably efficient: it executes as @(see logbitp) and
does not need to use @(see bitset-members).&lt;/p&gt;

&lt;p&gt;We prefer to reason about @(&#39;(set::in a (bitset-members X))&#39;).  We could
have used this as the @(&#39;:logic&#39;) definition, but the @(see logbitp)-based
definition should be better for symbolic simulation with @(see gl::gl).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (logbitp a
    (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x)))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-memberp-removal
    (equal (bitset-memberp a x)
      (in (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
        (bitset-members x)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable bitset-memberp
         in-of-bitset-members)))))</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-singleton
  ((a <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-singleton) constructs the singleton set @(&#39;{a}&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is perhaps slightly more efficient than the equivalent,
 @(&#39;(bitset-insert A 0)&#39;).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
    (ash <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix a))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-singleton-when-not-natp
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
      (equal (bitset-singleton a)
        (bitset-singleton <span class="number">0</span>))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-singleton-of-nfix
    (equal (bitset-singleton (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a))
      (bitset-singleton a)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (equal (in a
            (bitset-members (bitset-singleton b)))
          (equal a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (in-of-bitset-members)
             ((expt) |(expt x 0)|))) (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> stable-under-simplificationp
            '(<span class="keyword">:in-theory</span> (enable expt))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-bitset-singleton
      (equal (bitset-members (bitset-singleton a))
        (insert (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a) nil))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-singleton))))))</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-insert
  ((a <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-insert) constructs the set @(&#39;X U {a}&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This looks pretty efficient, but keep in mind that it still has to
construct a new set and hence is linear in the size of the set.  You should
probably avoid calling this in a loop if possible; instead consider functions
like @(see bitset-union).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
    (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (ash <span class="number">1</span> (lnfix a)))
      (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-insert-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
      (equal (bitset-insert a x)
        (bitset-insert <span class="number">0</span> x))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-insert-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-insert a x)
        (bitset-singleton a)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable bitset-singleton))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-insert-of-nfix-left
    (equal (bitset-insert (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
        x)
      (bitset-insert a x)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-insert-of-nfix-right
    (equal (bitset-insert a
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))
      (bitset-insert a x)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (equal (in a
            (bitset-members (bitset-insert b x)))
          (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (equal a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))
            (in a (bitset-members x))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (in-of-bitset-members)
             (|(expt x 0)| |(expt x (if a b c))|))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthmd" data-sym="DEFTHMD">defthmd</a> bitset-members-of-bitset-insert
      (equal (bitset-members (bitset-insert a x))
        (insert (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
          (bitset-members x)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-insert))))))</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-delete
  ((a <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-delete) constructs the set @(&#39;X - {a}&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This looks pretty efficient, but keep in mind that it still has to
construct a new set and hence is linear in the size of the set.  You should
probably avoid calling this in a loop if possible; instead, consider functions
like @(see bitset-intersect) and @(see bitset-difference).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
    (<a class="sym-link system" href="../../../axioms.html#def-logandc1" data-sym="LOGANDC1">logandc1</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
        (ash <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix a))))
      (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-delete-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
      (equal (bitset-delete a x)
        (bitset-delete <span class="number">0</span> x))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-delete-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-delete a x) <span class="number">0</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-delete-of-nfix-left
    (equal (bitset-delete (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
        x)
      (bitset-delete a x)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-delete-of-nfix-right
    (equal (bitset-delete a
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))
      (bitset-delete a x)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (equal (in a
            (bitset-members (bitset-delete b x)))
          (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (in a (bitset-members x))
            (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b)))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (in-of-bitset-members)
             (|(expt x 0)| |(expt x (if a b c))|))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-bitset-delete
      (equal (bitset-members (bitset-delete a x))
        (delete (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
          (bitset-members x)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-delete))))))</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection bitset-union
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(&#39;(bitset-union X Y ...)&#39;) constructs the set @(&#39;X U Y U ...&#39;)."</span>
  (define bitset-binary-union
    ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (y <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
    <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    <span class="keyword">:parents</span> (bitset-union)
    <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
    <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
    (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
      (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))
        (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix y)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> bitset-union
    (&amp;rest <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)
    (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>) <span class="number">0</span>)
      ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (cdr <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)) (car <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>))
      (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../axioms.html#def-xxxjoin" data-sym="XXXJOIN">xxxjoin</a> 'bitset-binary-union
          <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>))))
  (<a class="sym-link system" href="../../../axioms.html#def-add-macro-alias" data-sym="ADD-MACRO-ALIAS">add-macro-alias</a> bitset-union
    bitset-binary-union$inline)
  (<a class="sym-link system" href="../../../axioms.html#def-add-macro-fn" data-sym="ADD-MACRO-FN">add-macro-fn</a> bitset-union
    bitset-binary-union$inline
    <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable bitset-union)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-union-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-union x y)
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-union-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (bitset-union x y)
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-union-of-nfix-left
    (equal (bitset-union (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)
        y)
      (bitset-union x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-union-of-nfix-right
    (equal (bitset-union x
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))
      (bitset-union x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (equal (in a
            (bitset-members (bitset-union x y)))
          (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (in a (bitset-members x))
            (in a (bitset-members y))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable in-of-bitset-members)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-bitset-union
      (equal (bitset-members (bitset-union x y))
        (union (bitset-members x)
          (bitset-members y)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-union))))))</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection bitset-intersect
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(&#39;(bitset-intersect X Y ...)&#39;) constructs the set @(&#39;X \intersect Y
  \intersect ...&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Note: if you only want to know whether or not two sets intersect,
@(see bitset-intersectp) is probably more efficient.&lt;/p&gt;"</span>
  (define bitset-binary-intersect
    ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (y <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
    <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    <span class="keyword">:parents</span> (bitset-intersect)
    <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
    <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
    (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
      (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))
        (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix y)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> bitset-intersect
    (&amp;rest <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)
    (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>) <span class="number">0</span>)
      ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (cdr <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)) (car <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>))
      (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../axioms.html#def-xxxjoin" data-sym="XXXJOIN">xxxjoin</a> 'bitset-binary-intersect
          <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>))))
  (<a class="sym-link system" href="../../../axioms.html#def-add-macro-alias" data-sym="ADD-MACRO-ALIAS">add-macro-alias</a> bitset-intersect
    bitset-binary-intersect$inline)
  (<a class="sym-link system" href="../../../axioms.html#def-add-macro-fn" data-sym="ADD-MACRO-FN">add-macro-fn</a> bitset-intersect
    bitset-binary-intersect$inline
    <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable bitset-intersect)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersect-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-intersect x y) <span class="number">0</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersect-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (bitset-intersect x y) <span class="number">0</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersect-of-nfix-left
    (equal (bitset-intersect (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)
        y)
      (bitset-intersect x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersect-of-nfix-right
    (equal (bitset-intersect x
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))
      (bitset-intersect x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (equal (in a
            (bitset-members (bitset-intersect x y)))
          (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (in a (bitset-members x))
            (in a (bitset-members y))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable in-of-bitset-members)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-bitset-intersect
      (equal (bitset-members (bitset-intersect x y))
        (intersect (bitset-members x)
          (bitset-members y)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-intersect))))))</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-difference
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (y <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (bitset <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-difference) constructs the set @(&#39;X - Y&#39;)."</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
    (<a class="sym-link system" href="../../../axioms.html#def-logandc1" data-sym="LOGANDC1">logandc1</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix y))
      (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-difference-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-difference x y) <span class="number">0</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-difference-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (bitset-difference x y)
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-difference-of-nfix-left
    (equal (bitset-difference (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)
        y)
      (bitset-difference x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-difference-of-nfix-right
    (equal (bitset-difference x
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))
      (bitset-difference x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (in a
            (bitset-members (bitset-difference x y)))
          (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (in a (bitset-members x))
            (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (in a (bitset-members y)))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable in-of-bitset-members)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-members-of-bitset-difference
      (equal (bitset-members (bitset-difference x y))
        (difference (bitset-members x)
          (bitset-members y)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-difference))))))</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (equal (bitset-members x)
            (bitset-members y))
          (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
          (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y)
          (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
        (equal (equal (logbitp a x)
            (logbitp a y))
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable in-of-bitset-members)
         <span class="keyword">:use</span> ((<span class="keyword">:instance</span> in-of-bitset-members
            (x x)) (<span class="keyword">:instance</span> in-of-bitset-members
             (x y)))))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthmd" data-sym="DEFTHMD">defthmd</a> equal-bitsets-by-membership
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (equal x y)
        (equal (bitset-members x)
          (bitset-members y))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable double-containment)
       <span class="keyword">:use</span> ((<span class="keyword">:functional-instance</span> equal-by-logbitp
          (logbitp-hyp (lambda nil
              (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
                (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y)
                (equal (bitset-members x)
                  (bitset-members y)))))
          (logbitp-lhs (lambda nil x))
          (logbitp-rhs (lambda nil y))))))))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> bitset-fns
      nil
      '((bitset-singleton$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>) (bitset-insert$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
        (bitset-delete$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
        (bitset-binary-intersect$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
        (bitset-binary-union$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
        (bitset-difference$inline . <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))
      <span class="keyword">:clear</span>)
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-equal-witnessing-lemma
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal a b))
        (let ((k (logbitp-mismatch (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
               (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))))
          (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> b))
            (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (in k (bitset-members a))
                (in k (bitset-members b)))))))
      <span class="keyword">:hints</span> ((<span class="string">"goal"</span> <span class="keyword">:use</span> ((<span class="keyword">:instance</span> equal-bitsets-by-membership
            (x (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a))
            (y (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))) (<span class="keyword">:instance</span> logbitp-mismatch-correct
             (a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a))
             (b (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))))
         <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (in-of-bitset-members <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
           (double-containment logbitp-mismatch-correct))))
      <span class="keyword">:rule-classes</span> nil)
    (defwitness bitset-equal-witnessing
      <span class="keyword">:predicate</span> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal a b))
      <span class="keyword">:expr</span> (let ((k (logbitp-mismatch (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
             (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b))))
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> b))
          (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (in k (bitset-members a))
              (in k (bitset-members b))))))
      <span class="keyword">:restriction</span> (let ((bitset-fns (<a class="sym-link system" href="../../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> 'bitset-fns world)))
        (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp a)
            (<a class="sym-link system" href="../../../axioms.html#def-assoc" data-sym="ASSOC">assoc</a> (car a) bitset-fns))
          (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp b)
            (<a class="sym-link system" href="../../../axioms.html#def-assoc" data-sym="ASSOC">assoc</a> (car b) bitset-fns))))
      <span class="keyword">:generalize</span> (((logbitp-mismatch (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> a)
          (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b)) . badbit))
      <span class="keyword">:hints</span> ('(<span class="keyword">:use</span> bitset-equal-witnessing-lemma <span class="keyword">:in-theory</span> nil)))
    (definstantiate bitset-equal-instancing
      <span class="keyword">:predicate</span> (equal a b)
      <span class="keyword">:expr</span> (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (in k (bitset-members a))
        (in k (bitset-members b)))
      <span class="keyword">:vars</span> (k)
      <span class="keyword">:restriction</span> (let ((bitset-fns (<a class="sym-link system" href="../../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> 'bitset-fns world)))
        (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp a)
            (<a class="sym-link system" href="../../../axioms.html#def-assoc" data-sym="ASSOC">assoc</a> (car a) bitset-fns))
          (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp b)
            (<a class="sym-link system" href="../../../axioms.html#def-assoc" data-sym="ASSOC">assoc</a> (car b) bitset-fns))))
      <span class="keyword">:hints</span> ('(<span class="keyword">:in-theory</span> nil)))
    (defexample bitset-equal-example
      <span class="keyword">:pattern</span> (in k (bitset-members x))
      <span class="keyword">:templates</span> (k)
      <span class="keyword">:instance-rulename</span> bitset-equal-instancing)
    (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> bitset-witnessing
      nil
      `(witness <span class="keyword">:ruleset</span> (bitset-equal-witnessing bitset-equal-instancing
          bitset-equal-example)))))</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> test1
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (equal (bitset-union (bitset-union a d)
              b)
            (bitset-intersect b c))
          (equal (bitset-union b
              (bitset-union a d))
            (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> b)))
        <span class="keyword">:hints</span> ((bitset-witnessing))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> test2
        (equal (bitset-union a
            (bitset-intersect b c))
          (bitset-intersect (bitset-union a b)
            (bitset-union a c)))
        <span class="keyword">:hints</span> ((bitset-witnessing))))))</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-subsetp
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (y <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-subsetp" data-sym="SUBSETP">subsetp</a> <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-subsetp) efficiently determines if @(&#39;X&#39;) is a subset
of @(&#39;Y&#39;)."</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span>
    (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
      (bitset-difference x y)))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-subsetp-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-subsetp x y) <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-subsetp-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (bitset-subsetp x y)
        (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> x))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-subsetp-of-nfix-left
    (equal (bitset-subsetp (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)
        y)
      (bitset-subsetp x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-subsetp-of-nfix-right
    (equal (bitset-subsetp x
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))
      (bitset-subsetp x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (bitset-subsetp x y)
            (in a (bitset-members x)))
          (in a (bitset-members y)))
        <span class="keyword">:hints</span> ((bitset-witnessing))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l1
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (bitset-subsetp x y)
          (subset (bitset-members x)
            (bitset-members y)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-subsetp)))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l2
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (subset (bitset-members x)
            (bitset-members y))
          (bitset-subsetp x y))
        <span class="keyword">:hints</span> ((bitset-witnessing))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-subsetp-removal
      (equal (bitset-subsetp x y)
        (subset (bitset-members x)
          (bitset-members y)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-subsetp)
         <span class="keyword">:cases</span> ((bitset-subsetp x y)))))))</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-intersectp
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte) (y <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-intersectp" data-sym="INTERSECTP">intersectp</a> <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-intersectp) efficiently determines if @(&#39;X&#39;) and @(&#39;Y&#39;)
have any common members."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is efficient because, unlike @(see bitset-intersect), we don&#39;t
actually construct the intersection.&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-logtest" data-sym="LOGTEST">logtest</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))
    (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix y)))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersectp-when-not-natp-left
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x))
      (equal (bitset-intersectp x y)
        nil)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersectp-when-not-natp-right
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> y))
      (equal (bitset-intersectp x y)
        nil)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersectp-of-nfix-left
    (equal (bitset-intersectp (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x)
        y)
      (bitset-intersectp x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersectp-of-nfix-right
    (equal (bitset-intersectp x
        (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> y))
      (bitset-intersectp x y)))
  (<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (bitset-intersectp x y)
          (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal <span class="number">0</span> (bitset-intersect x y))))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable bitset-intersectp
             bitset-intersect)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-intersectp-removal
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (bitset-intersectp x y)
        (intersect (bitset-members x)
          (bitset-members y)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable bitset-intersectp
           bitset-members-of-bitset-intersect
           double-containment)
         <span class="keyword">:use</span> ((<span class="keyword">:instance</span> bitset-members-of-bitset-intersect) (<span class="keyword">:instance</span> l0)))))))</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define bitset-cardinality
  ((x <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:type</span> unsigned-byte))
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"@(call bitset-cardinality) determines the cardinality of the set
@(&#39;X&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;We prefer to reason about @(&#39;(set::cardinality (bitset-members
X))&#39;).  We could have used this as the @(&#39;:logic&#39;) definition, but the @(see
logcount)-based definition should be better for symbolic simulation with @(see
gl::gl).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:split-types</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte
    (logcount (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> unsigned-byte (lnfix x))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (defund lsb-bits
      (n x)
      (if (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> x)
        nil
        (if (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> (logcar x) <span class="number">1</span>)
          (cons (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)
            (lsb-bits (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n))
              (logcdr x)))
          (lsb-bits (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n))
            (logcdr x))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthmd" data-sym="DEFTHMD">defthmd</a> logcount-is-len-lsb-bits
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
        (equal (logcount x)
          (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> (lsb-bits n x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable lsb-bits logcount**)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> member-equal-lsb-bits
      (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-member-equal" data-sym="MEMBER-EQUAL">member-equal</a> a
          (lsb-bits n x))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a)
          (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n) a)
          (logbitp (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n))
            (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:do-not</span> '(generalize fertilize)
         <span class="keyword">:in-theory</span> (enable lsb-bits logbitp**)
         <span class="keyword">:induct</span> (lsb-bits n x)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a))
          (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> b)))
        (equal (&lt;&lt; a b)
          (&lt; a b)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable &lt;&lt;
           <a class="sym-link system" href="../../../axioms.html#def-lexorder" data-sym="LEXORDER">lexorder</a>
           <a class="sym-link system" href="../../../axioms.html#def-alphorder" data-sym="ALPHORDER">alphorder</a>)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l1
      (equal (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> (car (lsb-bits n x)))
        (if (lsb-bits n x)
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable lsb-bits)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l2
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (lsb-bits n x)
        (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)
          (car (lsb-bits n x))))
      <span class="keyword">:rule-classes</span> ((<span class="keyword">:rewrite</span>) (<span class="keyword">:linear</span>))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable lsb-bits)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> setp-of-lsb-bits
      (setp (lsb-bits n x))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable* lsb-bits
           (<span class="keyword">:ruleset</span> primitive-rules))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable l0 l1 l2)))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthmd" data-sym="DEFTHMD">defthmd</a> sets-membership-hack
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (setp x)
          (<a class="sym-link system" href="../../../axioms.html#def-syntaxp" data-sym="SYNTAXP">syntaxp</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-quotep" data-sym="QUOTEP">quotep</a> x))))
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-member-equal" data-sym="MEMBER-EQUAL">member-equal</a> a x)
          (in a x)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable* (<span class="keyword">:ruleset</span> primitive-rules))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> in-lsb-bits
      (equal (in a
          (lsb-bits n x))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> a)
          (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n) a)
          (logbitp (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> a (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n))
            (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:use</span> ((<span class="keyword">:instance</span> sets-membership-hack
            (a a)
            (x (lsb-bits n x))))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> lsb-bits-is-bitset-members
      (equal (lsb-bits <span class="number">0</span> x)
        (bitset-members x))
      <span class="keyword">:hints</span> ((<span class="string">"goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (in-of-bitset-members)
           (lsb-bits))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> logcount-is-len-of-bitset-members
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
        (equal (logcount x)
          (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> (bitset-members x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable bitset-members)
         <span class="keyword">:use</span> ((<span class="keyword">:instance</span> logcount-is-len-lsb-bits (n <span class="number">0</span>)))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cardinality-is-len
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (setp x)
        (equal (cardinality x)
          (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable* (<span class="keyword">:ruleset</span> primitive-rules))))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> logcount-is-cardinality-of-bitset-members
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> x)
        (equal (logcount x)
          (cardinality (bitset-members x))))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> bitset-cardinality-removal
    (equal (bitset-cardinality x)
      (cardinality (bitset-members x)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable bitset-cardinality)))))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection bitset-list*
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"Macro to repeatedly insert into a bitset."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Example: @(&#39;(bitset-list* a b c X)&#39;) expands to:&lt;/p&gt;

@({
 (bitset-insert a
  (bitset-insert b
   (bitset-insert c X)))
})

&lt;p&gt;This is much like the @(see list*) macro for constructing lists.  See also
@(see bitset-list) for a @(see list)-like version.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; This is not very efficient.  Inserting N elements into a set
will require N calls of @(see bitset-insert).&lt;/p&gt;"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> bitset-list*-macro
    (lst)
    (declare (xargs <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> lst)
          (consp lst))))
    (if (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (cdr lst))
      (car lst)
      (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> 'bitset-insert
        (car lst)
        (bitset-list*-macro (cdr lst)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> bitset-list*
    (&amp;rest <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)
    (bitset-list*-macro <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)))</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection bitset-list
  <span class="keyword">:parents</span> (bitsets)
  <span class="keyword">:short</span> <span class="string">"Macro to construct a bitset from particular members."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Example: @(&#39;(bitset-list 1 2 4)&#39;) constructs the set @(&#39;{1, 2,
  4}&#39;).&lt;/p&gt;

&lt;p&gt;In general, @(&#39;(bitset-list x1 x2 ... xn)&#39;) expands to&lt;/p&gt;

@({
 (bitset-insert x1
  (bitset-insert x2
   (bitset-insert ...
     (bitset-insert xn 0))))
})

&lt;p&gt;This is much like the @(see list) macro for constructing lists.  See also
@(see bitset-list*) for a @(see list*)-like version.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; This is not very efficient.  Constructing a set with N elements
will require N calls of @(see bitset-insert).&lt;/p&gt;"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> bitset-list-macro
    (lst)
    (declare (xargs <span class="keyword">:guard</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))
    (if (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> lst)
      <span class="number">0</span>
      (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> 'bitset-insert
        (car lst)
        (bitset-list-macro (cdr lst)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> bitset-list
    (&amp;rest <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)
    (bitset-list-macro <a class="sym-link system" href="../../../defuns.html#def-args" data-sym="ARGS">args</a>)))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>