<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>base64 - ACL2 Book</title>
  <meta property="name" content="base64">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">base64</h1>
    <div class="path"><a href="base64.lisp" class="source-link">books/std/strings/base64</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"STR"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/util/define.html" title="Open std/util/define">"std/util/define"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="cat.html" title="Open cat">"cat"</a>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="decimal.html" title="Open decimal">"decimal"</a>)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/bitops/equal-by-logbitp.html" title="Open centaur/bitops/equal-by-logbitp">"centaur/bitops/equal-by-logbitp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../centaur/bitops/ihsext-basics.html" title="Open centaur/bitops/ihsext-basics">"centaur/bitops/ihsext-basics"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../arithmetic/top-with-meta.html" title="Open arithmetic/top-with-meta">"arithmetic/top-with-meta"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))</pre>
  </div>

<div class="form-block other" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="arithmetic.html" title="Open arithmetic">"arithmetic"</a>))</pre>
  </div>

<div class="form-block other" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection base64
  <span class="keyword">:parents</span> (std/strings)
  <span class="keyword">:short</span> <span class="string">"Routines for Base 64 string encoding/decoding."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;We implement ACL2 functions for Base 64 encoding and decoding as
described in &lt;a href=&#39;http://www.ietf.org/rfc/rfc4648.txt&#39;&gt;RFC 4648&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Our functions are quite efficient, given the constraints of ACL2 string
processing.  We prove the following inversion theorem, which shows that if
encode some text and then try to decode it, then (1) decoding succeeds and (2)
we get the original text back.&lt;/p&gt;

@(thm base64-decode-of-base64-encode)

&lt;p&gt;Of course, this theorem does not say anything about whether we have encoded
or decoded the text &quot;correctly&quot; as described in RFC 4648.  After all, if we
simply used the identity function as our encoder and decoder, the above theorem
would still hold.&lt;/p&gt;

&lt;p&gt;However, to the degree possible, our encoder/decoder are intended to
implement Base64 encoding as described by RFC 4648.  We do not implement
variants of base64 encoding such as &quot;base64 URL encoding&quot; and &quot;base64 MIME
encoding.&quot; Some particular details of our implementation:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;Per Section 3.1, our encoder does not add line breaks.&lt;/li&gt;

&lt;li&gt;Per Section 3.2, our encoder adds appropriate padding characters.&lt;/li&gt;

&lt;li&gt;Per Section 3.3, our decoder rejects data with non-alphabet
characters.&lt;/li&gt;

&lt;li&gt;Per Section 3.5, our encoder sets the pad bits to zero.&lt;/li&gt;

&lt;li&gt;We use the Base64 alphabet described in Table 1.  We do not use the &quot;URL
and Filename safe&quot; Base64 alphabet.&lt;/li&gt;

&lt;/ul&gt;

&lt;p&gt;We have not attempted to prove the &quot;other&quot; inversion property, i.e., if we
start with some encoded text, decode it, and re-encode the result, then we
should get back our initial, encoded text.  This is probably not currently
true.  To prove it, we would need to change the decoder to reject inputs where
the pad bits are nonzero.  Implementations &quot;may&quot; choose to implement this
check according to Section 3.5, and in principle it would be a nice
enhancement.&lt;/p&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection base64-impl
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Implementation details of @(see base64) encoding/decoding."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;These routines should generally not be used directly, and may be
changed in future versions of the library.&lt;/p&gt;

&lt;p&gt;Here are some naming conventions used throughout these functions:&lt;/p&gt;

&lt;ul&gt;

&lt;li&gt;&lt;b&gt;chars&lt;/b&gt; refer to actual @(see acl2::characters), which typically will
be in the Base64 alphabet, i.e., @(&#39;A-Z&#39;), @(&#39;a-z&#39;), @(&#39;0-9&#39;), @(&#39;+&#39;), and
@(&#39;/&#39;).  Of course, when decoding, data might be coming from some external
source; it might contain pad characters @(&#39;=&#39;) or even arbitrary, invalid
characters from beyond the Base64 alphabet.&lt;/li&gt;

&lt;li&gt;&lt;b&gt;codes&lt;/b&gt; refer to actual @(see char-code)s, with the usual
correspondence to &lt;i&gt;chars&lt;/i&gt;.&lt;/li&gt;

&lt;li&gt;&lt;b&gt;values&lt;/b&gt; refer to the interpretation of each Base64 character as a
numeric value.  For instance, the value of @(&#39;#\A&#39;) is 0; the value of @(&#39;#\B&#39;)
is 1, and so on.  In our representation, the values are exactly the 64 natural
numbers from 0-63, and can be recognized with, e.g., @(&#39;(unsigned-byte-p 6
val)&#39;).&lt;/li&gt;

&lt;li&gt;&lt;b&gt;bytes&lt;/b&gt; refer to ordinary 8-bit bytes, which typically will be part of
the original, un-encoded data.&lt;/li&gt;

&lt;/ul&gt;"</span>)</pre>
  </div>

<div class="form-block other" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define char-code-list
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>))
  (if (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> x)
    nil
    (cons (char-code (car x))
      (char-code-list (cdr x)))))</pre>
  </div>

<div class="form-block other" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (defsection characterp-of-char
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> x0
        (equal (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> c a) (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> c b))
          (&lt; a b))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> x1
        (equal (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">-1</span> a) b) (&lt; a (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> b)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable x0)
           <span class="keyword">:use</span> ((<span class="keyword">:instance</span> x0
              (c <span class="number">1</span>)
              (a (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">-1</span> a))
              (b b)))))))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> characterp-of-nth
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> x)
          (equal (characterp (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> n x))
            (&lt; (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> characterp-of-char
      (equal (characterp (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> s n))
        (&lt; (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> (explode s)))))))</pre>
  </div>

<div class="form-block other" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (defsection unsigned-byte-p-lemmas
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-6-upper-bound
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> x) (&lt; x <span class="number">64</span>)))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-8-upper-bound
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> x)
        (&lt; x <span class="number">256</span>)))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-8-of-char-code
      (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> (char-code x)))))</pre>
  </div>

<div class="form-block other" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable <a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a>)))</pre>
  </div>

<div class="form-block other" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> true-listp-when-character-listp
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> x)
      (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x))
    <span class="keyword">:rule-classes</span> ((<span class="keyword">:rewrite</span>) (<span class="keyword">:compound-recognizer</span>))))</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> stringp-when-character-listp
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> x)
      (equal (stringp x) nil))))</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> consp-under-iff-when-true-listp
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x)
      (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (consp x) x))
    <span class="keyword">:rule-classes</span> ((<span class="keyword">:rewrite</span> <span class="keyword">:backchain-limit-lst</span> <span class="number">0</span>))))</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection *b64-chars-from-vals-array*
  <span class="keyword">:parents</span> (b64-char-from-value)
  <span class="keyword">:short</span> <span class="string">"Array mapping each value to its associated character."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This array is the main lookup table used for encoding.  It
corresponds to Table 1 from RFC 4648.&lt;/p&gt;

@(def *b64-chars-from-vals-alist*)
@(def *b64-chars-from-vals-array*)"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *b64-chars-from-vals-alist*
    '((<span class="number">0</span> . #\A) (<span class="number">1</span> . #\B)
      (<span class="number">2</span> . #\C)
      (<span class="number">3</span> . #\D)
      (<span class="number">4</span> . #\E)
      (<span class="number">5</span> . #\F)
      (<span class="number">6</span> . #\G)
      (<span class="number">7</span> . #\H)
      (<span class="number">8</span> . #\I)
      (<span class="number">9</span> . #\J)
      (<span class="number">10</span> . #\K)
      (<span class="number">11</span> . #\L)
      (<span class="number">12</span> . #\M)
      (<span class="number">13</span> . #\N)
      (<span class="number">14</span> . #\O)
      (<span class="number">15</span> . #\P)
      (<span class="number">16</span> . #\Q)
      (<span class="number">17</span> . #\R)
      (<span class="number">18</span> . #\S)
      (<span class="number">19</span> . #\T)
      (<span class="number">20</span> . #\U)
      (<span class="number">21</span> . #\V)
      (<span class="number">22</span> . #\W)
      (<span class="number">23</span> . #\X)
      (<span class="number">24</span> . #\Y)
      (<span class="number">25</span> . #\Z)
      (<span class="number">26</span> . #\a)
      (<span class="number">27</span> . #\b)
      (<span class="number">28</span> . #\c)
      (<span class="number">29</span> . #\d)
      (<span class="number">30</span> . #\e)
      (<span class="number">31</span> . #\f)
      (<span class="number">32</span> . #\g)
      (<span class="number">33</span> . #\h)
      (<span class="number">34</span> . #\i)
      (<span class="number">35</span> . #\j)
      (<span class="number">36</span> . #\k)
      (<span class="number">37</span> . #\l)
      (<span class="number">38</span> . #\m)
      (<span class="number">39</span> . #\n)
      (<span class="number">40</span> . #\o)
      (<span class="number">41</span> . #\p)
      (<span class="number">42</span> . #\q)
      (<span class="number">43</span> . #\r)
      (<span class="number">44</span> . #\s)
      (<span class="number">45</span> . #\t)
      (<span class="number">46</span> . #\u)
      (<span class="number">47</span> . #\v)
      (<span class="number">48</span> . #\w)
      (<span class="number">49</span> . #\x)
      (<span class="number">50</span> . #\y)
      (<span class="number">51</span> . #\z)
      (<span class="number">52</span> . #\0)
      (<span class="number">53</span> . #\1)
      (<span class="number">54</span> . #\2)
      (<span class="number">55</span> . #\3)
      (<span class="number">56</span> . #\4)
      (<span class="number">57</span> . #\5)
      (<span class="number">58</span> . #\6)
      (<span class="number">59</span> . #\7)
      (<span class="number">60</span> . #\8)
      (<span class="number">61</span> . #\9)
      (<span class="number">62</span> . #\+)
      (<span class="number">63</span> . #\/)))
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *b64-chars-from-vals-array*
    (<a class="sym-link system" href="../../../axioms.html#def-compress1" data-sym="COMPRESS1">compress1</a> '*b64-chars-from-vals-array*
      (cons (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:header</span> <span class="keyword">:dimensions</span> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="number">64</span>)
          <span class="keyword">:maximum-length</span> <span class="number">65</span>
          <span class="keyword">:default</span> #\0
          <span class="keyword">:name</span> '*b64-chars-from-vals-array*)
        *b64-chars-from-vals-alist*))))</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection *b64-vals-from-codes-array*
  <span class="keyword">:parents</span> (b64-value-from-code)
  <span class="keyword">:short</span> <span class="string">"Array mapping each character code back to its associated value."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is the main lookup table used for decoding.  It covers every
character code from 0...255.  Codes for characters that aren&#39;t part of the
Base64 alphabet are mapped to NIL.&lt;/p&gt;

@(def *b64-vals-from-codes-array*)"</span>
  (<a class="sym-link system" href="../../../axioms.html#def-defconst" data-sym="DEFCONST">defconst</a> *b64-vals-from-codes-array*
    (<a class="sym-link system" href="../../../axioms.html#def-compress1" data-sym="COMPRESS1">compress1</a> '*b64-vals-from-codes-array*
      (cons (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:header</span> <span class="keyword">:dimensions</span> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="number">256</span>)
          <span class="keyword">:maximum-length</span> <span class="number">257</span>
          <span class="keyword">:default</span> nil
          <span class="keyword">:name</span> '*b64-vals-from-codes-array*)
        (<a class="sym-link system" href="../../../axioms.html#def-pairlis_24" data-sym="PAIRLIS$">pairlis$</a> (char-code-list (<a class="sym-link system" href="../../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> *b64-chars-from-vals-alist*))
          (<a class="sym-link system" href="../../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> *b64-chars-from-vals-alist*))))))</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-char-from-value
  ((<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> <span class="keyword">:type</span> (unsigned-byte <span class="number">6</span>)))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Look up the Base64 character for a value, e.g., @(&#39;0&#39;) &amp;rarr; @(&#39;#\A&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is our lowest level encoding function.  It&#39;s just an array
lookup.&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> character
    (<a class="sym-link system" href="../../../axioms.html#def-aref1" data-sym="AREF1">aref1</a> '*b64-chars-from-vals-array*
      *b64-chars-from-vals-array*
      <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-char-from-value-never-produces-a-pad
    (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal (b64-char-from-value <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>) #\=))))</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-value-from-code
  ((code <span class="keyword">:type</span> (unsigned-byte <span class="number">8</span>)))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>))
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Look up the value of a Base64 character code, e.g., @(&#39;(char-code
#\A)&#39;) &amp;rarr; @(&#39;0&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is our lowest level decoding function.  It&#39;s just an array
lookup.  Codes for characters that aren&#39;t part of the Base64 alphabet are
mapped to NIL.&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (<a class="sym-link system" href="../../../axioms.html#def-aref1" data-sym="AREF1">aref1</a> '*b64-vals-from-codes-array*
    *b64-vals-from-codes-array*
    (lnfix code))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-6-of-b64-value-from-code
    (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span>
        (b64-value-from-code code))
      (b64-value-from-code code)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-value-from-code-of-b64-char-from-value
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>)
      (equal (b64-value-from-code (char-code (b64-char-from-value <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>)))
        <a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a>))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (b64-char-from-value <a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a>)
         (equal-of-char-code-and-constant))))))</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-vals-from-bytes
  (b1 b2 b3)
  (declare (type (unsigned-byte <span class="number">8</span>) b1 b2 b3))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (v1 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (v2 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (v3 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (v4 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Encode 3 bytes into 4 base-64 characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;Convert three bytes into four values, basically as follows:&lt;/p&gt;
@({
      Byte   Bit Pattern  ---&gt;  Values
      b1      aaaaaabb           aaaaaa  v1
      b2      bbbbcccc           bbbbbb  v2
      b3      ccdddddd           cccccc  v3
                                 dddddd  v4
})"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (b* ((v1 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>) (ash (lnfix b1) <span class="number">-2</span>))) (v2h (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">2</span>) (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (lnfix b1) <span class="number">3</span>)))
      (v2l (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">4</span>) (ash (lnfix b2) <span class="number">-4</span>)))
      (v2 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>)
          (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>)
              (ash (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">2</span>) v2h) <span class="number">4</span>))
            (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">4</span>) v2l))))
      (v3h (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">4</span>) (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (lnfix b2) <span class="number">15</span>)))
      (v3l (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">2</span>) (ash (lnfix b3) <span class="number">-6</span>)))
      (v3 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>)
          (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>)
              (ash (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">4</span>) v3h) <span class="number">2</span>))
            (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">2</span>) v3l))))
      (v4 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">6</span>) (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (lnfix b3) <span class="number">63</span>))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> v1 v2 v3 v4))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-6-of-b64-vals-from-bytes
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b1))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b2))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b3)))
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> v1 v2 v3 v4) (b64-vals-from-bytes b1 b2 b3)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v1)
          (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v2)
          (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v3)
          (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v4)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-vals-from-bytes-padding-1
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> ?v1 ?v2 ?v3 ?v4) (b64-vals-from-bytes b1 b2 <span class="number">0</span>)))
      (equal v4 <span class="number">0</span>)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-vals-from-bytes-padding-2
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> ?v1 ?v2 ?v3 ?v4) (b64-vals-from-bytes b1 <span class="number">0</span> <span class="number">0</span>)))
      (equal v3 <span class="number">0</span>))))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-bytes-from-vals
  (v1 v2 v3 v4)
  (declare (type (unsigned-byte <span class="number">6</span>) v1 v2 v3 v4))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (b1 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (b2 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (b3 <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Decode 4 base-64 values into 3 bytes."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is just doing the inverse of @(see b64-vals-from-bytes).&lt;/p&gt;"</span>
  <span class="keyword">:inline</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  (b* ((b1 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>)
         (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (ash (lnfix v1) <span class="number">2</span>))
           (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (ash (lnfix v2) <span class="number">-4</span>))))) (b2 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>)
          (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>)
              (ash (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (lnfix v2) <span class="number">15</span>))
                <span class="number">4</span>))
            (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (ash (lnfix v3) <span class="number">-2</span>)))))
      (b3 (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>)
          (<a class="sym-link system" href="../../../axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>)
              (ash (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (<a class="sym-link system" href="../../../axioms.html#def-logand" data-sym="LOGAND">logand</a> (lnfix v3) <span class="number">3</span>))
                <span class="number">6</span>))
            (lnfix v4)))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> b1 b2 b3))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> unsigned-byte-p-8-of-b64-decode-4-chars
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v1))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v2))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v3))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">6</span> v4)))
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> b1 b2 b3) (b64-bytes-from-vals v1 v2 v3 v4)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b1)
          (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b2)
          (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b3)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-bytes-from-vals-of-b64-vals-from-bytes
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> v1 v2 v3 v4) (b64-vals-from-bytes b1 b2 b3)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> x1 x2 x3) (b64-bytes-from-vals v1 v2 v3 v4)))
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b1))
          (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b2))
          (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b3)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (equal x1 b1)
          (equal x2 b2)
          (equal x3 b3))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-vals-from-bytes)) (equal-by-logbitp-hammer)))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-bytes-from-vals-padding-1
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> v1 v2 v3 ?v4) (b64-vals-from-bytes b1 b2 <span class="number">0</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> x1 x2 ?x3) (b64-bytes-from-vals v1 v2 v3 <span class="number">0</span>)))
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b1))
          (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b2)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (equal x1 b1) (equal x2 b2))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable b64-bytes-from-vals-of-b64-vals-from-bytes)
       <span class="keyword">:use</span> ((<span class="keyword">:instance</span> b64-bytes-from-vals-of-b64-vals-from-bytes
          (b3 <span class="number">0</span>))))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-bytes-from-vals-padding-2
    (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> v1 v2 ?v3 ?v4) (b64-vals-from-bytes b1 <span class="number">0</span> <span class="number">0</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> x1 ?x2 ?x3) (b64-bytes-from-vals v1 v2 <span class="number">0</span> <span class="number">0</span>)))
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-unsigned-byte-p" data-sym="UNSIGNED-BYTE-P">unsigned-byte-p</a> <span class="number">8</span> b1))
        (equal x1 b1)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable b64-bytes-from-vals-of-b64-vals-from-bytes)
       <span class="keyword">:use</span> ((<span class="keyword">:instance</span> b64-bytes-from-vals-of-b64-vals-from-bytes
          (b2 <span class="number">0</span>)
          (b3 <span class="number">0</span>)))))))</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-enc3
  (c1 c2 c3)
  (declare (type character c1 c2 c3))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (e1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e3 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e4 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Encode 3 arbitrary characters into 4 base-64 characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is the main function for encoding, which is used for all but
perhaps the last one or two characters.&lt;/p&gt;"</span>
  (b* ((byte1 (char-code c1)) (byte2 (char-code c2))
      (byte3 (char-code c3))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> val1 val2 val3 val4) (b64-vals-from-bytes byte1 byte2 byte3))
      (char1 (b64-char-from-value val1))
      (char2 (b64-char-from-value val2))
      (char3 (b64-char-from-value val3))
      (char4 (b64-char-from-value val4)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> char1 char2 char3 char4)))</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-enc2
  (c1 c2)
  (declare (type character c1 c2))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (e1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e3 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Encode 2 final characters into base-64 characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is only used if we have almost reached the end of the string
and there are exactly two characters left to encode; note that in this case we
also need to insert one explicit pad character (=).&lt;/p&gt;"</span>
  (b* ((byte1 (char-code c1)) (byte2 (char-code c2))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> val1 val2 val3 &amp;) (b64-vals-from-bytes byte1 byte2 <span class="number">0</span>))
      (char1 (b64-char-from-value val1))
      (char2 (b64-char-from-value val2))
      (char3 (b64-char-from-value val3)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> char1 char2 char3)))</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-enc1
  (c1)
  (declare (type character c1))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (e1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Encode 1 final character into base-64 characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is only used if we have almost reached the end of the string
and there is exactly one character left to encode; note that in this case we
need to insert two explicit pad characters (=).&lt;/p&gt;"</span>
  (b* ((byte1 (char-code c1)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> val1 val2 &amp; &amp;) (b64-vals-from-bytes byte1 <span class="number">0</span> <span class="number">0</span>))
      (char1 (b64-char-from-value val1))
      (char2 (b64-char-from-value val2)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> char1 char2)))</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-encode-last-group
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (e1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e3 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (e4 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:guard</span> (consp x)
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Encode the last group of (up to three) characters."</span>
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (cdr x)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2) (b64-enc1 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x))))
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 #\= #\=)))
    ((<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cddr" data-sym="CDDR">cddr</a> x)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3) (b64-enc2 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x) (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x))))
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 #\=)))
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (b64-enc3 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x)
        (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x)
        (<a class="sym-link system" href="../../../axioms.html#def-third" data-sym="THIRD">third</a> x)))))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-encode-list-impl
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>) (acc))
  <span class="keyword">:returns</span> (acc <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>
    <span class="keyword">:hyp</span> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> acc))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Tail-recursive version of @(see base64-encode-list)."</span>
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> x)) acc) ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x))) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-encode-last-group x)))
          (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> c4 c3 c2 c1 acc)))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-enc3 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x)
          (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x)
          (<a class="sym-link system" href="../../../axioms.html#def-third" data-sym="THIRD">third</a> x)))
      (acc (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> c4 c3 c2 c1 acc)))
    (b64-encode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x) acc)))</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-encode-list
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> <span class="string">"Character list to encode."</span>))
  <span class="keyword">:returns</span> (x-enc <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>
    <span class="string">"Encoded version of @(&#39;x&#39;)."</span>)
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Base64 encode a character list."</span>
  <span class="keyword">:verify-guards</span> nil
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> x)) nil) ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x))) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-encode-last-group x)))
            (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> c1 c2 c3 c4)))
        ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-enc3 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x)
            (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x)
            (<a class="sym-link system" href="../../../axioms.html#def-third" data-sym="THIRD">third</a> x))))
      (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> c1 c2 c3 c4)
        (base64-encode-list (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x))))
    <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def-reverse" data-sym="REVERSE">reverse</a> (b64-encode-list-impl x nil)))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-encode-list-impl-removal
    (equal (b64-encode-list-impl x acc)
      (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> (base64-encode-list x) acc))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-encode-list-impl))))
  (<a class="sym-link system" href="../../../axioms.html#def-verify-guards" data-sym="VERIFY-GUARDS">verify-guards</a> base64-encode-list))</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-dec3
  (c1 c2 c3 c4)
  (declare (type character c1 c2 c3 c4))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Decode 3 arbitrary characters from 4 base-64 characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is the main function for decoding, which is used for all but
perhaps the last one or two characters.&lt;/p&gt;"</span>
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Decoding can fail if we encounter non Base-64 alphabetic
                     characters in the input."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d3 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  (b* ((code1 (char-code c1)) (code2 (char-code c2))
      (code3 (char-code c3))
      (code4 (char-code c4))
      (val1 (b64-value-from-code code1))
      (val2 (b64-value-from-code code2))
      (val3 (b64-value-from-code code3))
      (val4 (b64-value-from-code code4))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> val1 val2 val3 val4)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil #\0 #\0 #\0))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b1)
         (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b2)
         (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b3)) (b64-bytes-from-vals val1
          val2
          val3
          val4))
      (char1 (code-char b1))
      (char2 (code-char b2))
      (char3 (code-char b3)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> char1 char2 char3))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-dec3-of-b64-enc3
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (characterp c1)
        (characterp c2)
        (characterp c3))
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> e1 e2 e3 e4) (b64-enc3 c1 c2 c3)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1 x2 x3) (b64-dec3 e1 e2 e3 e4)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp
          (equal x1 c1)
          (equal x2 c2)
          (equal x3 c3))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-enc3)))))</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-dec2
  (c1 c2 c3)
  (declare (type character c1 c2 c3))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Decode three base-64 characters to recover 2 arbitrary characters."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is only used to decode the last group of base-64 characters,
when there is exactly one pad.&lt;/p&gt;"</span>
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Decoding can fail if we encounter non Base-64 alphabetic
                     characters in the input."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d2 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  (b* ((code1 (char-code c1)) (code2 (char-code c2))
      (code3 (char-code c3))
      (val1 (b64-value-from-code code1))
      (val2 (b64-value-from-code code2))
      (val3 (b64-value-from-code code3))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> val1 val2 val3)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil #\0 #\0))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b1)
         (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b2)
         &amp;) (b64-bytes-from-vals val1 val2 val3 <span class="number">0</span>))
      (char1 (code-char b1))
      (char2 (code-char b2)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> char1 char2))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-dec2-of-b64-enc2
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (characterp c1) (characterp c2))
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> e1 e2 e3) (b64-enc2 c1 c2)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1 x2) (b64-dec2 e1 e2 e3)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp
          (equal x1 c1)
          (equal x2 c2))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-enc2)))))</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-dec1
  (c1 c2)
  (declare (type character c1 c2))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Decode two base-64 characters to recover 1 arbitrary character."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;This is only used to decode the last group of base-64 characters,
when there are two pads.&lt;/p&gt;"</span>
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Decoding can fail if we encounter non Base-64 alphabetic
                     characters in the input."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (d1 characterp <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  (b* ((code1 (char-code c1)) (code2 (char-code c2))
      (val1 (b64-value-from-code code1))
      (val2 (b64-value-from-code code2))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> val1 val2)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil #\0))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) b1) &amp; &amp;) (b64-bytes-from-vals val1 val2 <span class="number">0</span> <span class="number">0</span>))
      (char1 (code-char b1)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> char1))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-dec1-of-b64-enc1
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (characterp c1)
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> e1 e2) (b64-enc1 c1)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1) (b64-dec1 e1 e2)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp (equal x1 c1))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-enc1)))))</pre>
  </div>

<div class="form-block other" id="form-32" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-decode-last-group
  (c1 c2 c3 c4)
  (declare (type character c1 c2 c3 c4))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (ans <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Decode the final group of base-64 encoded characters into 1-3 characters."</span>
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> c4 #\=)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp char1 char2 char3) (b64-dec3 c1 c2 c3 c4)))
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> char1 char2 char3))))
    ((<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> c3 #\=)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp char1 char2) (b64-dec2 c1 c2 c3)))
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> char1 char2))))
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp char1) (b64-dec1 c1 c2)))
        (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> char1)))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l1
      (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">3</span> (b64-enc3 c1 c2 c3))
          #\=))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-enc3)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l2
      (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">2</span> (b64-enc2 c1 c2)) #\=))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-enc2)))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-decode-last-group-of-b64-encode-last-group
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> x)
        (consp x)
        (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x)))
      (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-encode-last-group x)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp result) (b64-decode-last-group c1 c2 c3 c4)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp (equal result x))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-encode-last-group
         b64-decode-last-group)))))</pre>
  </div>

<div class="form-block other" id="form-33" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-decode-list-impl
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>) (acc))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (acc <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>
      <span class="keyword">:hyp</span> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> acc)))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Tail-recursive version of @(see base64-decode-list)."</span>
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> x)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> acc)) ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil acc))
      (c1 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x))
      (c2 (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x))
      (c3 (<a class="sym-link system" href="../../../axioms.html#def-third" data-sym="THIRD">third</a> x))
      (c4 (<a class="sym-link system" href="../../../axioms.html#def-fourth" data-sym="FOURTH">fourth</a> x))
      (<a class="sym-link system" href="../../../axioms.html#def-rest" data-sym="REST">rest</a> (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> x))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> <a class="sym-link system" href="../../../axioms.html#def-rest" data-sym="REST">rest</a>)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp <a class="sym-link system" href="../../../axioms.html#def-last" data-sym="LAST">last</a>) (b64-decode-last-group c1 c2 c3 c4)))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> <a class="sym-link system" href="../../../axioms.html#def-last" data-sym="LAST">last</a> acc))))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1 x2 x3) (b64-dec3 c1 c2 c3 c4))
      ((unless okp) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil acc))
      (acc (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> x3 x2 x1 acc)))
    (b64-decode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> x) acc)))</pre>
  </div>

<div class="form-block other" id="form-34" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-decode-list
  ((x <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> <span class="string">"Character list to decode."</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Was decoding successful?  It can fail if we encounter non
                     Base-64 alphabetic characters in the input, or if the
                     input is not of the proper length (a multiple of 4), or if
                     there is incorrect padding."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (ans <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>
      <span class="string">"On success, the decoded version of @(&#39;x&#39;).  On failure,
                     it is some nonsensical character list that should not be
                     relied on."</span>))
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Base64 decode a character list."</span>
  <span class="keyword">:verify-guards</span> nil
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> x)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)) ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> x))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil))
        (c1 (<a class="sym-link system" href="../../../axioms.html#def-first" data-sym="FIRST">first</a> x))
        (c2 (<a class="sym-link system" href="../../../axioms.html#def-second" data-sym="SECOND">second</a> x))
        (c3 (<a class="sym-link system" href="../../../axioms.html#def-third" data-sym="THIRD">third</a> x))
        (c4 (<a class="sym-link system" href="../../../axioms.html#def-fourth" data-sym="FOURTH">fourth</a> x))
        (<a class="sym-link system" href="../../../axioms.html#def-rest" data-sym="REST">rest</a> (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> x))
        ((when (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> <a class="sym-link system" href="../../../axioms.html#def-rest" data-sym="REST">rest</a>)) (b64-decode-last-group c1 c2 c3 c4))
        ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1 x2 x3) (b64-dec3 c1 c2 c3 c4))
        ((unless okp) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil))
        ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> rest-ok rest-ans) (base64-decode-list (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> x))))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp rest-ok)
        (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> x1 x2 x3 rest-ans)))
    <span class="keyword">:exec</span> (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp acc) (b64-decode-list-impl x nil)))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-reverse" data-sym="REVERSE">reverse</a> acc))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable b64-decode-list-impl)))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (equal (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">0</span> (b64-decode-list-impl x acc))
        (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">0</span> (base64-decode-list x)))))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l1
      (equal (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">1</span> (b64-decode-list-impl x acc))
        (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">1</span> (base64-decode-list x))
          acc))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-decode-list-impl-removal
    (equal (b64-decode-list-impl x acc)
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">0</span> (base64-decode-list x))
        (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">1</span> (base64-decode-list x))
          acc))))
  (<a class="sym-link system" href="../../../axioms.html#def-verify-guards" data-sym="VERIFY-GUARDS">verify-guards</a> base64-decode-list
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable b64-decode-last-group))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> base64-decode-list-of-base64-encode-list
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> x)
      (b* ((encoded (base64-encode-list x)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp decoded) (base64-decode-list encoded)))
        (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> okp (equal decoded x))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:induct</span> (base64-encode-list x)
       <span class="keyword">:in-theory</span> (enable base64-encode-list
         base64-decode-list)))))</pre>
  </div>

<div class="form-block other" id="form-35" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (defsection nthcdr-lemmas
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cadr-of-nthcdr
      (equal (<a class="sym-link system" href="../../../axioms.html#def-cadr" data-sym="CADR">cadr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
        (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)) x)))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> nth-of-inc2-and-list*
        (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
          (equal (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n) (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> a b c))
            (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> n c)))
        <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable <a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a>)
           <span class="keyword">:expand</span> (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n) (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> a b c))))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> caddr-of-nthcdr
      (equal (<a class="sym-link system" href="../../../axioms.html#def-caddr" data-sym="CADDR">caddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
        (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)) x)))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cadddr-of-nthcdr
      (equal (<a class="sym-link system" href="../../../axioms.html#def-cadddr" data-sym="CADDDR">cadddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
        (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)) x)))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cddr-nthcdr-under-iff
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n))
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-cddr" data-sym="CDDR">cddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
          (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cdddr-nthcdr-under-iff
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n))
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
          (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cddddr-nthcdr-under-iff
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n))
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
          (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">4</span> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cdr-nthcdr-under-iff
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n))
        (<a class="sym-link system" href="../../../axioms.html#def-iff" data-sym="IFF">iff</a> (cdr (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))
          (&lt; (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> n) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cdr-nthcdr-inc2
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
        (equal (cdr (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n) x))
          (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:expand</span> ((<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n) x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> cdr-nthcdr-inc3
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
        (equal (cdr (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> n) x))
          (<a class="sym-link system" href="../../../axioms.html#def-cddddr" data-sym="CDDDDR">cddddr</a> (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n x))))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:expand</span> ((<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> n) x)))))
    (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> nthcdr-of-len
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x)
        (equal (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x) x) nil)))))</pre>
  </div>

<div class="form-block other" id="form-36" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-encode-last-group-str
  ((x stringp) (n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
    (xl (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))))
  <span class="keyword">:guard</span> (&lt; n xl)
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"String-based version of @(see b64-encode-last-group)."</span>
  (declare (type (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) n xl)
    (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) left) (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
         <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> xl n))) ((when (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> left <span class="number">1</span>)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2) (b64-enc1 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n))))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 #\= #\=)))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> left <span class="number">2</span>)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3) (b64-enc2 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n)
               (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> n)))))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 #\=))))
    (b64-enc3 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n)
      (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> n))
      (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-encode-last-group-str-correct
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (stringp x))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x)))
        (<a class="sym-link system" href="../../../axioms.html#def-force" data-sym="FORCE">force</a> (&lt; n xl)))
      (equal (b64-encode-last-group-str x n xl)
        (b64-encode-last-group (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x)))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (b64-encode-last-group <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a>) (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> <a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a>))
       <span class="keyword">:do-not</span> '(generalize fertilize)
       <span class="keyword">:do-not-induct</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))))</pre>
  </div>

<div class="form-block other" id="form-37" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-encode-str-impl
  ((x stringp) (n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
    (xl (<a class="sym-link system" href="../../../axioms.html#def-eql" data-sym="EQL">eql</a> xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (acc))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl)
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Efficient, string-based version of @(see b64-encode-list-impl)."</span>
  <span class="keyword">:measure</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
  (declare (type (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) n xl)
    (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) left) (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
         <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> xl n))) ((when (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> left)) acc)
      ((when (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> left <span class="number">3</span>)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-encode-last-group-str x n xl)))
          (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> c4 c3 c2 c1 acc)))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> c1 c2 c3 c4) (b64-enc3 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n)
          (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> n))
          (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n))))
      (acc (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> c4 c3 c2 c1 acc)))
    (b64-encode-str-impl x
      (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> (lnfix n))
      xl
      acc))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp x)
          (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
          (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
          (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl))
        (equal (b64-encode-str-impl x n xl acc)
          (b64-encode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x))
            acc)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:induct</span> (b64-encode-str-impl x n xl acc)
         <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (b64-encode-list-impl <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a>)
           (b64-encode-list-impl-removal))
         <span class="keyword">:expand</span> ((b64-encode-str-impl x n xl acc) (b64-encode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x))
             acc))
         <span class="keyword">:do-not</span> '(generalize fertilize)
         <span class="keyword">:do-not-induct</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-encode-str-impl-removal
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp x)
        (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
        (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
        (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl))
      (equal (b64-encode-str-impl x n xl acc)
        (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> (base64-encode-list (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x)))
          acc)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable b64-encode-str-impl)))))</pre>
  </div>

<div class="form-block other" id="form-38" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-encode
  ((x stringp <span class="string">"String to be encoded."</span>))
  <span class="keyword">:returns</span> (encoded stringp
    <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span> <span class="string">"Encoded version of @(&#39;x&#39;)."</span>)
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Base64 encode a string."</span>
  (declare (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (implode (base64-encode-list (explode x)))
    <span class="keyword">:exec</span> (rchars-to-string (b64-encode-str-impl x <span class="number">0</span> (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x) nil))))</pre>
  </div>

<div class="form-block other" id="form-39" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-revappend-encode
  ((x stringp <span class="string">"String to be encoded."</span>) (acc <span class="string">"Accumulator for encoded characters (in reverse order)."</span>))
  <span class="keyword">:enabled</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Efficient @(&#39;(revappend-chars (base64-encode x) acc)&#39;)."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;We leave this enabled; it would be odd to reason about it.&lt;/p&gt;"</span>
  <span class="keyword">:prepwork</span> ((<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable base64-encode revappend-chars))))
  (declare (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (revappend-chars (base64-encode x) acc)
    <span class="keyword">:exec</span> (b64-encode-str-impl x <span class="number">0</span> (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x) acc)))</pre>
  </div>

<div class="form-block other" id="form-40" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define b64-decode-str-impl
  ((x stringp) (n <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
    (xl (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (acc))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl)
  <span class="keyword">:measure</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a> <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (acc <a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a>
      <span class="keyword">:hyp</span> (<a class="sym-link system" href="../../../axioms.html#def-character-listp" data-sym="CHARACTER-LISTP">character-listp</a> acc)))
  <span class="keyword">:parents</span> (base64-impl)
  <span class="keyword">:short</span> <span class="string">"Efficient, string-based version of @(see b64-decode-list-impl)."</span>
  (declare (type (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) n xl)
    (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-the" data-sym="THE">the</a> (integer <span class="number">0</span> <a class="sym-link system" href="../../../axioms.html#def-_2A" data-sym="*">*</a>) left) (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> xl) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> n)))
         <span class="keyword">:exec</span> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> xl n))) ((when (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> left)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> acc))
      ((when (&lt; left <span class="number">4</span>)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil acc))
      (c1 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x n))
      (c2 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> n)))
      (c3 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> n)))
      (c4 (<a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a> x (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">3</span> n)))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-int_3D" data-sym="INT=">int=</a> left <span class="number">4</span>)) (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp <a class="sym-link system" href="../../../axioms.html#def-last" data-sym="LAST">last</a>) (b64-decode-last-group c1 c2 c3 c4)))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> <a class="sym-link system" href="../../../axioms.html#def-last" data-sym="LAST">last</a> acc))))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp x1 x2 x3) (b64-dec3 c1 c2 c3 c4))
      ((unless okp) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil acc))
      (acc (<a class="sym-link system" href="../../../axioms.html#def-list_2A" data-sym="LIST*">list*</a> x3 x2 x1 acc)))
    (b64-decode-str-impl x
      (<a class="sym-link system" href="../../../axioms.html#def-_2B" data-sym="+">+</a> <span class="number">4</span> (lnfix n))
      xl
      acc))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> l0
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp x)
          (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
          (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
          (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl))
        (equal (b64-decode-str-impl x n xl acc)
          (b64-decode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x))
            acc)))
      <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:induct</span> (b64-decode-str-impl x n xl acc)
         <span class="keyword">:in-theory</span> (<a class="sym-link system" href="../../../axioms.html#def-e_2Fd" data-sym="E/D">e/d</a> (b64-decode-list-impl <a class="sym-link system" href="../../../axioms.html#def-char" data-sym="CHAR">char</a>)
           (b64-decode-list-impl-removal))
         <span class="keyword">:expand</span> ((b64-decode-str-impl x n xl acc) (b64-decode-list-impl (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x))
             acc))
         <span class="keyword">:do-not</span> '(generalize fertilize)
         <span class="keyword">:do-not-induct</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>))))
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> b64-decode-str-impl-removal
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (stringp x)
        (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> n)
        (equal xl (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x))
        (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> n xl))
      (equal (b64-decode-str-impl x n xl acc)
        (let ((chars (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> n (explode x))))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">0</span> (base64-decode-list chars))
            (<a class="sym-link system" href="../../../axioms.html#def-revappend" data-sym="REVAPPEND">revappend</a> (<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a> <span class="number">1</span> (base64-decode-list chars))
              acc)))))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (disable b64-decode-str-impl)))))</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-decode
  ((x stringp <span class="string">"String to be decoded."</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Was decoding successful?  It can fail if we encounter non
                     Base-64 alphabetic characters in the input, or if the
                     input is not of the proper length (a multiple of 4), or if
                     there is incorrect padding."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>)
    (ans stringp
      <span class="string">"On success, the decoded version of @(&#39;x&#39;).  On failure,
                     it is some nonsensical string that should not be relied
                     on."</span>
      <span class="keyword">:rule-classes</span> <span class="keyword">:type-prescription</span>))
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Base64 decode a string."</span>
  (declare (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp chars) (base64-decode-list (explode x))))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (implode chars)))
    <span class="keyword">:exec</span> (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp rchars) (b64-decode-str-impl x <span class="number">0</span> (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x) nil)))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (rchars-to-string rchars))))
  ///
  (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> base64-decode-of-base64-encode
    (equal (base64-decode (base64-encode x))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
        (if (stringp x)
          x
          <span class="string">""</span>)))
    <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable base64-encode base64-decode)))))</pre>
  </div>

<div class="form-block other" id="form-42" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define base64-revappend-decode
  ((x stringp <span class="string">"String to be decoded."</span>) (acc <span class="string">"Accumulator for decoded characters (in reverse order)."</span>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (okp <span class="string">"Was decoding successful?"</span>) (acc))
  <span class="keyword">:enabled</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:parents</span> (base64)
  <span class="keyword">:short</span> <span class="string">"Efficiently revappend the characters from @(see base64-decode) onto
an accumulator."</span>
  <span class="keyword">:long</span> <span class="string">"&lt;p&gt;We leave this enabled; it would be odd to reason about it.&lt;/p&gt;"</span>
  <span class="keyword">:prepwork</span> ((<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (enable base64-decode revappend-chars))))
  (declare (type <a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> x))
  (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp str) (base64-decode x)))
      (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp (revappend-chars str acc)))
    <span class="keyword">:exec</span> (b64-decode-str-impl x <span class="number">0</span> (<a class="sym-link system" href="../../../axioms.html#def-length" data-sym="LENGTH">length</a> x) acc)))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>