<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>check-mv-let-call - ACL2 Book</title>
  <meta property="name" content="check-mv-let-call">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">‚òÄÔ∏è</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">check-mv-let-call</h1>
    <div class="path"><a href="check-mv-let-call.lisp" class="source-link">books/std/system/check-mv-let-call</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="dumb-occur-var-open.html" title="dumb-occur-var-open">dumb-occur-var-open</a>
      <a class="include-link" href="remove-trivial-vars.html" title="remove-trivial-vars">remove-trivial-vars</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="dumb-occur-var-open.html" title="Open dumb-occur-var-open">"dumb-occur-var-open"</a>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="remove-trivial-vars.html" title="Open remove-trivial-vars">"remove-trivial-vars"</a>)</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define check-mv-let-call
  ((term <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (yes/no <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (mv-var symbolp <span class="keyword">:hyp</span> <span class="keyword">:guard</span>)
    (vars <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> <span class="keyword">:hyp</span> <span class="keyword">:guard</span>)
    (indices <a class="sym-link system" href="../../../axioms.html#def-nat-listp" data-sym="NAT-LISTP">nat-listp</a>)
    (hides <a class="sym-link system" href="../../../axioms.html#def-boolean-listp" data-sym="BOOLEAN-LISTP">boolean-listp</a>)
    (mv-term <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a> <span class="keyword">:hyp</span> <span class="keyword">:guard</span>)
    (body-term <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a> <span class="keyword">:hyp</span> <span class="keyword">:guard</span>))
  <span class="keyword">:parents</span> (std/system/term-queries)
  <span class="keyword">:short</span> <span class="string">"Check if a term is a (translated) call of @(tsee mv-let)."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"In translated form, @(&#39;(mv-let (var1 ... varn) mv-term body-term)&#39;) is"</span>)
    (codeblock <span class="string">"((lambda (mv)"</span>
      <span class="string">"         ((lambda (var1 ... varn) body-term-trans)"</span>
      <span class="string">"          (mv-nth &#39;0 mv)"</span>
      <span class="string">"          ..."</span>
      <span class="string">"          (mv-nth &#39;n-1 mv)))"</span>
      <span class="string">" mv-term-trans)"</span>)
    (p <span class="string">"where @(&#39;mv-term-trans&#39;) and @(&#39;body-term-trans&#39;) are
     the translations of @(&#39;mv-term&#39;) and @(&#39;body-term&#39;)."</span>)
    (p <span class="string">"This utility checks if a translated term has the form above;
     it also checks that @(&#39;mv&#39;) does not occur free in @(&#39;body-term&#39;)
     (via @(tsee dumb-occur-var-open) for greater flexibility).
     If all these checks pass, it returns @(&#39;t&#39;) as first result,
     and additionally the variable @(&#39;mv&#39;),
     the list @(&#39;(var1 ... varn)&#39;),
     the term @(&#39;mv-term-trans&#39;),
     and the term @(&#39;body-term-trans&#39;).
     If the input term does not have that form,
     this utility returns @(&#39;nil&#39;) for each result."</span>)
    (p <span class="string">"If the input term has the form above,
     it is not necessarily the result of translating @(tsee mv-let).
     It could be the translation of
     @(&#39;(let ((mv mv-term))
          (let ((var1 (mv-nth 0 mv)) ... (varn (mv-nth n-1 mv)))
            mv-body))&#39;)
     instead;
     it depends on whether @(&#39;mv-term&#39;) is single-valued or multi-valued,
     and also on whether the term is translated for execution or not.
     However, the result of translating @(tsee mv-let)
     necessarily has the form above."</span>)
    (p <span class="string">"Note, however, that lambda expressions are always closed
     in translated terms directly obtained from untranslated terms.
     ACL2 accomplishes this closure
     by adding formal parameters to the lambda expressions
     for the otherwise free variables,
     and adding actual arguments identical to those variables;
     see @(tsee remove-trivial-vars).
     This means that the lambda expressions above may have extra variables.
     To ``correct&#39;&#39; for this, before examining the two lambda expressions,
     we remove all their formal parameters
     that are identical to the corresponding arguments,
     via @(tsee remove-trivial-vars)&#39;s auxiliary function
     @(tsee remove-equal-formals-actuals), which does exactly that.
     We do not use @(tsee remove-trivial-vars) because that one
     removes the trivial variables at all levels,
     while here we only want to remove the ones
     from the two lambda expressions being examined."</span>)
    (p <span class="string">"Note also that, due to this lambda expression closure,
     the @(&#39;mv&#39;) variable is not always the symbol `@(&#39;mv&#39;)&#39;:
     if that symbol happens to be a free variable,
     ACL2&#39;s translation picks a different symbol
     for the first formal argument of the outer lambda expression above.
     For instance,"</span>)
    (codeblock <span class="string">":trans (let ((mv 0)) (mv-let (x y) (f mv) (list x y mv)))"</span>)
    (p <span class="string">"produces a translated term with the symbol `@(&#39;mv0&#39;)&#39;
     as the variable bound to the multiple value.
     This is why this utility returns this variable
     as one of its results."</span>)
    (p <span class="string">"In translated terms directly obtained from untranslated terms,
     @(tsee mv-let)s always have @(&#39;(mv-nth i ...)&#39;) calls
     for all contiguous indices @(&#39;i&#39;) from 0 to
     the number of @(tsee mv-let)-bound variables minus 1,
     corresponding to all the bound variables (0-based).
     However, if a term is subjected to
     transformations like @(tsee remove-unused-vars),
     some of those @(tsee mv-nth) calls may disappear
     (if they are not used in the body of the @(tsee mv-let)).
     Thus, for wider usability,
     this utility does not require all the @(tsee mv-nth) calls to be present.
     It only requires calls with strictly increasing indices, allowing gaps.
     The ordered list of indices actually present is returned,
     so that a caller can indipendently check that there are no gaps,
     if the term is not supposed to have any such gaps."</span>)
    (p <span class="string">"An additional complication derives from the fact that @(tsee mv-let)
     allows the declaration of ignored variables within, e.g.
     @(&#39;(mv-let (x y z) (mv 1 2 3) (declare (ignore x y)) z)&#39;).
     In translated terms, this manifests in the addition of @(tsee hide)
     around the @(tsee mv-nth) terms, which in this example is"</span>)
    (codeblock <span class="string">"((lambda (mv)"</span>
      <span class="string">"         ((lambda (x y z) z)"</span>
      <span class="string">"          (hide (mv-nth &#39;0 mv))"</span>
      <span class="string">"          (hide (mv-nth &#39;1 mv))"</span>
      <span class="string">"          (mv-nth &#39;2 mv)))"</span>
      <span class="string">" (cons &#39;1 (cons &#39;2 (cons &#39;3 &#39;nil))))"</span>)
    (p <span class="string">"This utility takes this possibility into account,
     and returns, as an additional result,
     a list of booleans, of the same length as variables and indices,
     that says whether the corresponding @(tsee mv-nth)
     is wrapped by @(tsee hide) or not.
     This way, the utility returns all the information about the term,
     which the caller may use as desired."</span>)
    (p <span class="string">"@(tsee mv-let) also support the declaration of ignorable variables.
     But these declarations do not introduce any @(tsee hide) wrapper
     or other change into the translated term."</span>)
    (p <span class="string">"This utility is a left inverse of @(tsee make-mv-let-call)."</span>))
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-variablep" data-sym="VARIABLEP">variablep</a> term)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil)) ((when (<a class="sym-link system" href="../../../axioms.html#def-fquotep" data-sym="FQUOTEP">fquotep</a> term)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      ((unless (<a class="sym-link system" href="../../../basis-b.html#def-flambda-applicationp" data-sym="FLAMBDA-APPLICATIONP">flambda-applicationp</a> term)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      (outer-lambda-expr (<a class="sym-link system" href="../../../axioms.html#def-ffn-symb" data-sym="FFN-SYMB">ffn-symb</a> term))
      (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> outer-lambda-expr))
      (actuals (<a class="sym-link system" href="../../../axioms.html#def-fargs" data-sym="FARGS">fargs</a> term))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> list-mv list-mv-term) (remove-equal-formals-actuals <a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> actuals))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp list-mv) (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (consp (cdr list-mv))))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      (mv-var (car list-mv))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (consp list-mv-term) (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (consp (cdr list-mv-term))))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      (mv-term (car list-mv-term))
      (inner-lambda-expr-call (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> outer-lambda-expr))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-variablep" data-sym="VARIABLEP">variablep</a> inner-lambda-expr-call)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-fquotep" data-sym="FQUOTEP">fquotep</a> inner-lambda-expr-call)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      ((unless (<a class="sym-link system" href="../../../basis-b.html#def-flambda-applicationp" data-sym="FLAMBDA-APPLICATIONP">flambda-applicationp</a> inner-lambda-expr-call)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      (inner-lambda-expr (<a class="sym-link system" href="../../../axioms.html#def-ffn-symb" data-sym="FFN-SYMB">ffn-symb</a> inner-lambda-expr-call))
      (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> inner-lambda-expr))
      (actuals (<a class="sym-link system" href="../../../axioms.html#def-fargs" data-sym="FARGS">fargs</a> inner-lambda-expr-call))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> vars mv-nths) (remove-equal-formals-actuals <a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> actuals))
      (body-term (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> inner-lambda-expr))
      ((when (dumb-occur-var-open mv-var body-term)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> okp indices hides) (check-mv-let-call-aux mv-nths <span class="number">0</span> mv-var))
      ((unless okp) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil nil nil nil nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> mv-var vars indices hides mv-term body-term))
  <span class="keyword">:prepwork</span> ((define check-mv-let-call-aux
     ((terms pseudo-term-listp) (min-index <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>)
       (mv-var symbolp))
     <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (yes/no <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
       (indices <a class="sym-link system" href="../../../axioms.html#def-nat-listp" data-sym="NAT-LISTP">nat-listp</a>)
       (hides <a class="sym-link system" href="../../../axioms.html#def-boolean-listp" data-sym="BOOLEAN-LISTP">boolean-listp</a>))
     (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> terms)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil nil)) (term (car terms))
         ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-hide" data-sym="HIDE">hide</a> term) (if (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> term)
               (consp term)
               (consp (cdr term))
               (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cddr" data-sym="CDDR">cddr</a> term))
               (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> (car term) '<a class="sym-link system" href="../../../axioms.html#def-hide" data-sym="HIDE">hide</a>))
             (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../axioms.html#def-cadr" data-sym="CADR">cadr</a> term))
             (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil term)))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> term)
              (consp term)
              (consp (cdr term))
              (consp (<a class="sym-link system" href="../../../axioms.html#def-cddr" data-sym="CDDR">cddr</a> term))
              (<a class="sym-link system" href="../../../axioms.html#def-atom" data-sym="ATOM">atom</a> (<a class="sym-link system" href="../../../axioms.html#def-cdddr" data-sym="CDDDR">cdddr</a> term)))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> (car term) '<a class="sym-link system" href="../../../axioms.html#def-mv-nth" data-sym="MV-NTH">mv-nth</a>)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         (index-term (<a class="sym-link system" href="../../../axioms.html#def-cadr" data-sym="CADR">cadr</a> term))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> (<a class="sym-link system" href="../../../axioms.html#def-caddr" data-sym="CADDR">caddr</a> term) mv-var)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-quotep" data-sym="QUOTEP">quotep</a> index-term)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         (index (<a class="sym-link system" href="../../../axioms.html#def-unquote" data-sym="UNQUOTE">unquote</a> index-term))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> index)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> index min-index)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil))
         ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> yes/no indices hides) (check-mv-let-call-aux (cdr terms) (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> index) mv-var))
         ((unless yes/no) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil nil)))
       (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (cons index indices) (cons <a class="sym-link system" href="../../../axioms.html#def-hide" data-sym="HIDE">hide</a> hides)))
     ///
     (defret len-of-check-mv-let-call-aux.indices
       (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> indices) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> terms))))
     (defret len-of-check-mv-let-call-aux.hides
       (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> hides) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> terms))))) (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/typed-lists/symbol-listp.html" title="Open std/typed-lists/symbol-listp">"std/typed-lists/symbol-listp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>))
    (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/typed-lists/pseudo-term-listp.html" title="Open std/typed-lists/pseudo-term-listp">"std/typed-lists/pseudo-term-listp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)))
  ///
  (defret len-of-check-mv-let-call.indices/vars
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> indices) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> vars)))
    <span class="keyword">:hyp</span> <span class="keyword">:guard</span> <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable remove-equal-formals-actuals-same-len))))
  (defret len-of-check-mv-let-call.hides/vars
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> hides) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> vars)))
    <span class="keyword">:hyp</span> <span class="keyword">:guard</span> <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> (enable remove-equal-formals-actuals-same-len))))
  (<a class="sym-link system" href="../../../axioms.html#def-in-theory" data-sym="IN-THEORY">in-theory</a> (disable len-of-check-mv-let-call.indices/vars
      len-of-check-mv-let-call.hides/vars))
  (<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> acl2-count-of-check-mv-let-call.mv-term-lemma
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (consp x) (&lt; (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> (car x)) (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> x)))
      <span class="keyword">:rule-classes</span> <span class="keyword">:linear</span>))
  (defret acl2-count-of-check-mv-let-call.mv-term
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no (&lt; (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> mv-term) (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> term)))
    <span class="keyword">:rule-classes</span> <span class="keyword">:linear</span>)
  (defret acl2-count-of-check-mv-let-call.body-term
    (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> yes/no
      (&lt; (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> body-term) (<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> term)))
    <span class="keyword">:rule-classes</span> <span class="keyword">:linear</span>))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = 'üåô';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>