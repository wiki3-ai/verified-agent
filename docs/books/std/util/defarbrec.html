<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>defarbrec - ACL2 Book</title>
  <meta property="name" content="defarbrec">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">defarbrec</h1>
    <div class="path"><a href="defarbrec.lisp" class="source-link">books/std/util/defarbrec</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="../../kestrel/error-checking/ensure-list-has-no-duplicates.html" title="kestrel/error-checking/ensure-list-has-no-duplicates">ensure-list-has-no-duplicates</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-boolean.html" title="kestrel/error-checking/ensure-value-is-boolean">ensure-value-is-boolean</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-not-in-list.html" title="kestrel/error-checking/ensure-value-is-not-in-list">ensure-value-is-not-in-list</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-symbol.html" title="kestrel/error-checking/ensure-value-is-symbol">ensure-value-is-symbol</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-symbol-list.html" title="kestrel/error-checking/ensure-value-is-symbol-list">ensure-value-is-symbol-list</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-untranslated-term.html" title="kestrel/error-checking/ensure-value-is-untranslated-term">ensure-value-is-untranslated-term</a>
      <a class="include-link" href="../../kestrel/event-macros/cw-event.html" title="kestrel/event-macros/cw-event">cw-event</a>
      <a class="include-link" href="../../kestrel/event-macros/make-event-terse.html" title="kestrel/event-macros/make-event-terse">make-event-terse</a>
      <a class="include-link" href="../../kestrel/event-macros/proof-preparation.html" title="kestrel/event-macros/proof-preparation">proof-preparation</a>
      <a class="include-link" href="../../kestrel/event-macros/restore-output.html" title="kestrel/event-macros/restore-output">restore-output</a>
      <a class="include-link" href="../../std/system/apply-terms-same-args.html" title="std/system/apply-terms-same-args">apply-terms-same-args</a>
      <a class="include-link" href="../../std/system/fresh-logical-name-with-dollars-suffix.html" title="std/system/fresh-logical-name-with-dollars-suffix">fresh-logical-name-with-dollars-suffix</a>
      <a class="include-link" href="../../std/system/pseudo-event-form-listp.html" title="std/system/pseudo-event-form-listp">pseudo-event-form-listp</a>
      <a class="include-link" href="../../std/system/recursive-calls.html" title="std/system/recursive-calls">recursive-calls</a>
      <a class="include-link" href="../../std/system/ubody.html" title="std/system/ubody">ubody</a>
      <a class="include-link" href="../../kestrel/utilities/error-checking/top.html" title="kestrel/utilities/error-checking/top">top</a>
      <a class="include-link" href="../../kestrel/utilities/trans-eval-error-triple.html" title="kestrel/utilities/trans-eval-error-triple">trans-eval-error-triple</a>
      <a class="include-link" href="../../std/util/defaggregate.html" title="std/util/defaggregate">defaggregate</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-list-has-no-duplicates.html" title="Open kestrel/error-checking/ensure-list-has-no-duplicates">"kestrel/error-checking/ensure-list-has-no-duplicates"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-boolean.html" title="Open kestrel/error-checking/ensure-value-is-boolean">"kestrel/error-checking/ensure-value-is-boolean"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-not-in-list.html" title="Open kestrel/error-checking/ensure-value-is-not-in-list">"kestrel/error-checking/ensure-value-is-not-in-list"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-symbol.html" title="Open kestrel/error-checking/ensure-value-is-symbol">"kestrel/error-checking/ensure-value-is-symbol"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-symbol-list.html" title="Open kestrel/error-checking/ensure-value-is-symbol-list">"kestrel/error-checking/ensure-value-is-symbol-list"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-untranslated-term.html" title="Open kestrel/error-checking/ensure-value-is-untranslated-term">"kestrel/error-checking/ensure-value-is-untranslated-term"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/cw-event.html" title="Open kestrel/event-macros/cw-event">"kestrel/event-macros/cw-event"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/make-event-terse.html" title="Open kestrel/event-macros/make-event-terse">"kestrel/event-macros/make-event-terse"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/proof-preparation.html" title="Open kestrel/event-macros/proof-preparation">"kestrel/event-macros/proof-preparation"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/restore-output.html" title="Open kestrel/event-macros/restore-output">"kestrel/event-macros/restore-output"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/apply-terms-same-args.html" title="Open std/system/apply-terms-same-args">"std/system/apply-terms-same-args"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/fresh-logical-name-with-dollars-suffix.html" title="Open std/system/fresh-logical-name-with-dollars-suffix">"std/system/fresh-logical-name-with-dollars-suffix"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/pseudo-event-form-listp.html" title="Open std/system/pseudo-event-form-listp">"std/system/pseudo-event-form-listp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/recursive-calls.html" title="Open std/system/recursive-calls">"std/system/recursive-calls"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/ubody.html" title="Open std/system/ubody">"std/system/ubody"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/utilities/error-checking/top.html" title="Open kestrel/utilities/error-checking/top">"kestrel/utilities/error-checking/top"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/utilities/trans-eval-error-triple.html" title="Open kestrel/utilities/trans-eval-error-triple">"kestrel/utilities/trans-eval-error-triple"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/util/defaggregate.html" title="Open std/util/defaggregate">"std/util/defaggregate"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ defarbrec-implementation
  <span class="keyword">:parents</span> (defarbrec)
  <span class="keyword">:short</span> <span class="string">"Implementation of @(tsee defarbrec)."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"The implementation functions have formal parameters
     consistently named as follows:"</span>)
    (ul (li <span class="string">"@(&#39;state&#39;) is the ACL2&#39;s @(see state)."</span>)
      (li <span class="string">"@(&#39;wrld&#39;) is the ACL2&#39;s @(see world)."</span>)
      (li <span class="string">"@(&#39;ctx&#39;) is the context used for errors."</span>)
      (li <span class="string">"@(&#39;fn&#39;),
      @(&#39;x1...xn&#39;),
      @(&#39;body&#39;),
      @(&#39;update-names&#39;),
      @(&#39;terminates-name&#39;),
      @(&#39;measure-name&#39;),
      @(&#39;nonterminating&#39;),
      @(&#39;print&#39;), and
      @(&#39;show-only&#39;)
      are the homonymous inputs to @(tsee defarbrec)
      (where @(&#39;x1...xn&#39;) is for the input @(&#39;(x1 ... xn)&#39;))
      before being processed.
      These formal parameters have no types because they may be any values."</span>)
      (li <span class="string">"@(&#39;call&#39;) is the call of @(tsee defarbrec) supplied by the user."</span>)
      (li <span class="string">"@(&#39;call$&#39;) is the result of removing
      @(&#39;:print&#39;) and @(&#39;:show-only&#39;) from @(&#39;call&#39;)."</span>)
      (li <span class="string">"@(&#39;fn$&#39;),
      @(&#39;x1...xn$&#39;),
      @(&#39;update-names$&#39;),
      @(&#39;terminates-name$&#39;),
      @(&#39;measure-name$&#39;),
      @(&#39;nonterminating$&#39;),
      @(&#39;print$&#39;), and
      @(&#39;show-only$&#39;)
      are the results of processing
      the homonymous (without the @(&#39;$&#39;)) inputs to @(tsee defarbrec).
      Some are identical to the corresponding inputs,
      but they have types implied by their successful validation,
      performed when they are processed."</span>)
      (li <span class="string">"@(&#39;terminates-witness-name&#39;) is the name of the witness function
      generated along with the termination testing predicate,
      via @(tsee defun-sk)."</span>)
      (li <span class="string">"@(&#39;terminated-rewrite-name&#39;) is the name of the rewrite rule
      generated along with the termination testing predicate,
      via @(tsee defun-sk)."</span>)
      (li <span class="string">"@(&#39;xi...xn$&#39;) is a suffix of @(&#39;x1...xn$&#39;),
      while @(tsee cdr)ing down the list in a recursion."</span>)
      (li <span class="string">"@(&#39;body$&#39;) is the unnormalized body that defines
      the program-mode function temporarily recorded in the @(see world).
      It is a translated term."</span>)
      (li <span class="string">"@(&#39;test&#39;) is the exit test of the program-mode function."</span>)
      (li <span class="string">"@(&#39;updates&#39;) is the list of
      argument updates in the recursive call of the program-mode function."</span>)
      (li <span class="string">"@(&#39;k&#39;) is a variable that counts the number of iterated argument udpates,
      used as a formal parameter of the iterated argument update functions,
      as a bound variable of the termination testing predicate,
      and as a formal parameter of the measure function.
      It is also used in generated local lemmas."</span>)
      (li <span class="string">"@(&#39;l&#39;) is another variable that counts
      the number of iterated argument udpates,
      used in generated local lemmas."</span>)
      (li <span class="string">"@(&#39;update-fns-lemma-name&#39;) is
      the name of the generated local lemma
      about the iterated argument update functions."</span>)
      (li <span class="string">"@(&#39;measure-fn-natp-lemma-name&#39;) is
      the name of the first generated local lemma
      about the generated measure function."</span>)
      (li <span class="string">"@(&#39;measure-fn-end-lemma-name&#39;) is
      the name of the second generated local lemma
      about the generated measure function."</span>)
      (li <span class="string">"@(&#39;measure-fn-min-lemma-name&#39;) is
      the name of the third generated local lemma
      about the generated measure function."</span>)
      (li <span class="string">"@(&#39;names-to-avoid&#39;) is a list of symbols already committed
      to use for some functions and theorems to be generated;
      symbols to use for additional functions and theorems to be generated
      must be therefore distinct from them."</span>)
      (li <span class="string">"@(&#39;expansion&#39;) is the @(tsee encapsulate)
      generated by @(tsee defarbrec)."</span>))
    (p <span class="string">"The parameters of implementation functions that are not listed above
    are described in, or clear from, those functions&#39; documentation."</span>))
  <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ defarbrec-table
  <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"@(csee table) of @(tsee defarbrec) functions."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"For each successful call of @(tsee defarbrec)
     whose @(&#39;:show-only&#39;) is not @(&#39;t&#39;),
     this table includes a pair
     whose key is the name of the generated logic-mode function
     and whose value contains information about the call
     (see @(tsee defarbrec-infop))."</span>)
    (p <span class="string">"This table is used to support the redundancy check
     in @(tsee defarbrec-check-redundancy)."</span>))
  <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defval *defarbrec-table-name*
  'defarbrec-table
  <span class="keyword">:short</span> <span class="string">"Name of the @(tsee defarbrec) table."</span>)</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defaggregate defarbrec-info
  <span class="keyword">:short</span> <span class="string">"Information about a @(tsee defarbrec) call,
          recorded as a pair&#39;s value in the @(tsee defarbrec) table."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"The name of the generated recursive logic-mode function
     is the key of the pair in the table."</span>)
    (p <span class="string">"The call of @(tsee defarbrec) is stored
     without any @(&#39;:print&#39;) and @(&#39;:show-only&#39;) options
     because, as explained in the documentation,
     redundancy checking ignores those options."</span>))
  ((call$ <span class="string">"The call of @(tsee defarbrec), after @(tsee defarbrec-filter-call)."</span>
     pseudo-event-formp) (expansion <span class="string">"The @(tsee encapsulate) generated from
               the call of @(tsee defarbrec)."</span>
      pseudo-event-formp)
    (x1...xn <span class="string">"Formal arguments of the function."</span>)
    (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> <span class="string">"Translated unnormalized body of the program-mode function."</span>)
    (update-fns <span class="string">"The names of the generated iterated argument update functions."</span>
      <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-fn <span class="string">"The name of the generated termination testing predicate."</span>
      symbolp)
    (measure-fn <span class="string">"The name of the generated measure function."</span>
      symbolp))
  <span class="keyword">:pred</span> defarbrec-infop)</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-make-event" data-sym="MAKE-EVENT">make-event</a> `(<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> ,*DEFARBREC-TABLE-NAME*
    nil
    nil
    <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (symbolp key) (defarbrec-infop val))))</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-filter-call
  ((call pseudo-event-formp))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> call) <span class="number">4</span>) (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> 'defarbrec (car call)))
  <span class="keyword">:returns</span> (call$ <span class="string">"A @(tsee pseudo-event-formp)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Remove any @(&#39;:print&#39;) and @(&#39;:show-only&#39;) options
          from a call of @(tsee defarbrec)."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"As explained in the documentation,
    these two options are ignored when checking redundancy."</span>)
  (b* ((number-of-required-args <span class="number">3</span>) (number-of-elements-before-options (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> number-of-required-args))
      (options (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> number-of-elements-before-options call))
      (options (remove-keyword <span class="keyword">:print</span> options))
      (options (remove-keyword <span class="keyword">:show-only</span> options))
      (call$ (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-take" data-sym="TAKE">take</a> number-of-elements-before-options call)
          options)))
    call$))</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ defarbrec-input-processing
  <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"Input processing performed by @(tsee defarbrec)."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This involves validating the inputs.
    When validation fails, "</span>
    (seetopic <span class="string">"er"</span> <span class="string">"soft errors"</span>)
    <span class="string">" occur. Thus, generally the input processing functions return "</span>
    (seetopic <span class="string">"acl2::error-triple"</span> <span class="string">"error triples"</span>)
    <span class="string">"."</span>)
  <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-fn
  (fn ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;fn&#39;) input."</span>
  (b* ((description <span class="string">"The first input"</span>) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol$ fn description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ fn description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-x1...xn
  (x1...xn ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;(x1 ... xn)&#39;) input."</span>
  (b* ((description <span class="string">"The second input"</span>) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol-list$ x1...xn description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-has-no-duplicates$ x1...xn description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-body
  (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> fn$ x1...xn$ ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple @(&#39;(body$ test updates)&#39;)
                        satisfying
                        @(&#39;(typed-tuplep pseudo-termp
                                         pseudo-termp
                                         pseudo-term-listp
                                         result)&#39;)."</span>)
    state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process the @(&#39;body&#39;) input."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"We submit the program-mode function to ACL2,
     so that any errors in the body will be caught
     and will stop execution with an error.
     If the submission succeeds, the ACL2 state now includes the function,
     which we further validate and decompose."</span>)
    (p <span class="string">"If the function has the form
     assumed in the documentation of @(tsee defarbrec),
     the exit test is @(&#39;test&lt;x1,...,xn&gt;&#39;)
     and the updated arguments are
     @(&#39;update-x1&lt;x1,...,xn&gt;&#39;), ..., @(&#39;update-xn&lt;x1,...xn&gt;&#39;).
     If the function has a different form,
     the exit test is the negation of the conjunction of
     the tests that control the recursive call."</span>)
    (p <span class="string">"Note that the @(&#39;wrld&#39;) variable is bound
     after calling @(tsee trans-eval-error-triple),
     to ensure that the program-mode function is in that world."</span>))
  (b* ((program-mode-fn `(<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,FN$
         ,X1...XN$
         (declare (xargs <span class="keyword">:mode</span> <span class="keyword">:program</span>))
         ,BODY)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (<a class="sym-link external" href="../../kestrel/utilities/trans-eval-error-triple.html#def-trans-eval-error-triple" data-sym="TRANS-EVAL-ERROR-TRIPLE">trans-eval-error-triple</a> program-mode-fn ctx state))
      (wrld (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state))
      (body$ (ubody fn$ wrld))
      (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The function ~x0"</span> fn$))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function-number-of-results$ fn$ <span class="number">1</span> description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function-no-stobjs$ fn$ description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      (rec-calls-with-tests (recursive-calls fn$ wrld))
      (num-rec-calls (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> rec-calls-with-tests))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-_2F_3D" data-sym="/=">/=</a> num-rec-calls <span class="number">1</span>)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The function ~x0 must make exactly one recursive call, ~
                   but it makes ~x1 recursive calls instead."</span>
          fn$
          num-rec-calls))
      (program-mode-fns (all-program-ffn-symbs body$ nil wrld))
      (program-mode-fns (<a class="sym-link system" href="../../../axioms.html#def-remove-eq" data-sym="REMOVE-EQ">remove-eq</a> fn$ program-mode-fns))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a> program-mode-fns)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The function ~x0 must call ~
                   only logic-mode functions besides itself, ~
                   but it also calls the program-mode ~@1 instead."</span>
          fn$
          (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> program-mode-fns) <span class="number">1</span>)
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"function ~x0"</span> (car program-mode-fns))
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"functions ~&amp;0"</span> program-mode-fns))))
      (rec-call-with-tests (car rec-calls-with-tests))
      (tests (<a class="sym-link system" href="../../../axioms.html#def-access" data-sym="ACCESS">access</a> tests-and-call rec-call-with-tests <span class="keyword">:tests</span>))
      (rec-call (<a class="sym-link system" href="../../../axioms.html#def-access" data-sym="ACCESS">access</a> tests-and-call rec-call-with-tests <span class="keyword">:call</span>))
      (test (<a class="sym-link system" href="../../../basis-b.html#def-dumb-negate-lit" data-sym="DUMB-NEGATE-LIT">dumb-negate-lit</a> (<a class="sym-link system" href="../../../axioms.html#def-conjoin" data-sym="CONJOIN">conjoin</a> tests)))
      (updates (<a class="sym-link system" href="../../../axioms.html#def-fargs" data-sym="FARGS">fargs</a> rec-call)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> body$ test updates))))</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-default-update-names
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (fn$ symbolp))
  <span class="keyword">:returns</span> (names <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
  <span class="keyword">:short</span> <span class="string">"Default names of the iterated argument update functions."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"These are used when the @(&#39;:update-names&#39;) input is @(&#39;nil&#39;).
     They are as described in the documentation."</span>)
  (defarbrec-default-update-names-aux x1...xn$ fn$)
  <span class="keyword">:prepwork</span> ((define defarbrec-default-update-names-aux
     ((xi...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (fn$ symbolp))
     <span class="keyword">:returns</span> (names <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
     <span class="keyword">:parents</span> nil
     (if (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> xi...xn$)
       nil
       (cons (add-suffix-to-fn fn$
           (cat <span class="string">"-"</span> (symbol-name (car xi...xn$)) <span class="string">"*"</span>))
         (defarbrec-default-update-names-aux (cdr xi...xn$) fn$))))))</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-update-names
  (update-names (fn$ symbolp)
    (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (update-names$ <span class="string">"A @(tsee symbol-listp)."</span>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:update-names&#39;) input."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"Return the names to use for the iterated argument update functions,
    in the same order as the function&#39;s formal arguments."</span>)
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol-list$ update-names
         <span class="string">"The :UPDATE-NAMES input"</span>
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) (symbols (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> update-names
          (defarbrec-default-update-names x1...xn$ fn$)))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-has-no-duplicates$ symbols
          <span class="string">"The list of symbols supplied as the :UPDATE-NAMES input"</span>
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-_2F_3D" data-sym="/=">/=</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> symbols) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> x1...xn$))) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The length of the list of symbols ~
                   supplied as the :UPDATE-NAME input ~
                   must be equal to the arity of the function ~x0."</span>
          fn$))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-update-names-aux symbols
          fn$
          x1...xn$
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-not-in-list$ fn$
          symbols
          (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> symbols))
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of ~
                          the iterated argument update function, ~
                          determined (perhaps by default) by ~
                          the :UPDATE-NAMES input"</span>
              (car symbols))
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"any of the names ~&amp;0 of ~
                        the iterated argument update functions, ~
                        determined (perhaps by default) by ~
                        the :UPDATE-NAMES input"</span>
              symbols))
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the function to generate"</span> fn$)
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> symbols))
  <span class="keyword">:prepwork</span> ((define defarbrec-process-update-names-aux
     ((symbols <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (fn$ symbolp)
       (xi...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
       ctx
       state)
     <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a>) state)
     <span class="keyword">:verify-guards</span> nil
     <span class="keyword">:parents</span> nil
     (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> symbols)) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)) (symbol (car symbols))
         ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ symbol
             (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of ~
                         the iterated argument update function for ~
                         the ~x1 argument of ~x2, ~
                         determined (perhaps by default) by ~
                         the :UPDATE-NAMES input,"</span>
               symbol
               (car xi...xn$)
               fn$)
             <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
             nil)))
       (defarbrec-process-update-names-aux (cdr symbols)
         fn$
         (cdr xi...xn$)
         ctx
         state)))))</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-terminates-name
  (terminates-name (fn$ symbolp)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple
                 @(&#39;(terminates-name$
                     terminates-witness-name
                     terminates-rewrite-name)&#39;)
                 satisfying
                 @(&#39;(typed-tuplep symbolp symbolp symbolp result)&#39;)."</span>)
    state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:terminates-name&#39;) input."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Return the names to use for
     the termination testing predicate,
     the associated witness,
     and the associated rewrite rule."</span>)
    (p <span class="string">"Since the predicate is introduced via a @(tsee defun-sk),
     we must ensure that the associated witness name and rewrite rule name
     are also new and distinct from other names
     introduced by @(tsee defarbrec)."</span>)
    (p <span class="string">"For now we use, for witness and rewrite rule,
     the same names that @(tsee defun-sk) would generate by default.
     But this might change in the future."</span>))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol$ terminates-name
         <span class="string">"The :TERMINATES-NAME input"</span>
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) (symbol (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> terminates-name (add-suffix-to-fn fn$ <span class="string">"-TERMINATES"</span>)))
      (symbol-witness (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> symbol <span class="string">"-WITNESS"</span>))
      (symbol-rewrite (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> symbol <span class="string">"-SUFF"</span>))
      (symbol-description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the termination testing predicate, ~
              determined (perhaps by default) by the :TERMINATES-NAME input,"</span>
          symbol))
      (symbol-witness-description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the witness function associated to ~
              the termination testing predicate, ~
              determined (perhaps by default) by the :TERMINATES-NAME input,"</span>
          symbol-witness))
      (symbol-rewrite-description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the rewrite rule associated to ~
              the termination testing predicate, ~
              determined (perhaps by default) by the :TERMINATES-NAME input,"</span>
          symbol-rewrite))
      (fn-description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the function to generate."</span> fn$))
      (update-names$-description (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$))
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the iterated argument update function, ~
                  determined (perhaps by default) by the :UPDATE-NAMES input"</span>
            (car update-names$))
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the names ~&amp;0 of the iterated argument update functions, ~
                determined (perhaps by default) by the :UPDATE-NAMES input"</span>
            update-names$)))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ symbol
          symbol-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ symbol-witness
          symbol-witness-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ symbol-rewrite
          symbol-rewrite-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol
          fn$
          fn-description
          symbol-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol-witness
          fn$
          fn-description
          symbol-witness-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol-rewrite
          fn$
          fn-description
          symbol-rewrite-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-not-in-list$ symbol
          update-names$
          update-names$-description
          symbol-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-not-in-list$ symbol-witness
          update-names$
          update-names$-description
          symbol-witness-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-not-in-list$ symbol-rewrite
          update-names$
          update-names$-description
          symbol-rewrite-description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> symbol symbol-witness symbol-rewrite))))</pre>
  </div>

<div class="form-block other" id="form-32" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-measure-name
  (measure-name (fn$ symbolp)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (terminates-witness-name symbolp)
    (terminates-rewrite-name symbolp)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (measure-name$ <span class="string">"A @(tsee symbolp)."</span>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:measure-name&#39;) input."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"Return the name to use for the measure function."</span>)
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol$ measure-name
         <span class="string">"The :MEASURE-NAME input"</span>
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) (symbol (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> measure-name (add-suffix-to-fn fn$ <span class="string">"-MEASURE"</span>)))
      (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the measure function, ~
                          determined (perhaps by default) by ~
                          the :MEASURE-NAME input,"</span>
          symbol))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ symbol description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol
          fn$
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the function to generate"</span> fn$)
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-not-in-list$ symbol
          update-names$
          (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> <span class="number">1</span> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$))
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of ~
                          the iterated argument update function, ~
                          determined (perhaps by default) by ~
                          the :UPDATE-NAMES input"</span>
              (car update-names$))
            (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~&amp;0 of ~
                        the iterated argument update functions, ~
                        determined (perhaps by default) by ~
                        the :UPDATE-NAMES input"</span>
              update-names$))
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol
          terminates-name$
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the termination testing predicate, ~
                      determined (perhaps by default) by ~
                      the :TERMINATES-NAME input"</span>
            terminates-name$)
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol
          terminates-witness-name
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the witness function associated to ~
                      the termination testing predicate, ~
                      determined (perhaps by default) by ~
                      the :TERMINATES-NAME input"</span>
            terminates-witness-name)
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-different$ symbol
          terminates-rewrite-name
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the name ~x0 of the rewrite rule associated to ~
                      the termination testing predicate, ~
                      determined (perhaps by default) by ~
                      the :TERMINATES-NAME input"</span>
            terminates-rewrite-name)
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> symbol)))</pre>
  </div>

<div class="form-block other" id="form-33" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-nonterminating
  (nonterminating (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nonterminating$ <span class="string">"A @(tsee pseudo-termp)."</span>) state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:nonterminating&#39;) input."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Return the translated form of the term."</span>)
    (p <span class="string">"Note that the check that the term calls only logic-mode functions
     ensures that the term does not call the program-mode function @(&#39;fn&#39;)."</span>))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> term <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)) (ensure-value-is-untranslated-term$ nonterminating
         <span class="string">"The :NONTERMINATING input"</span>
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The term ~x0 supplied as the :NONTERMINATING input"</span>
          nonterminating))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-term-free-vars-subset$ term
          x1...xn$
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-term-logic-mode$ term description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function/lambda/term-number-of-results$ <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>
          <span class="number">1</span>
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-term-no-stobjs$ <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> term)))</pre>
  </div>

<div class="form-block other" id="form-34" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defenum defarbrec-printp
  (nil <span class="keyword">:error</span> <span class="keyword">:result</span> <span class="keyword">:all</span>)
  <span class="keyword">:short</span> <span class="string">"Recognize the allowed values of the @(&#39;:print&#39;) input."</span>)</pre>
  </div>

<div class="form-block other" id="form-35" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-print
  (print ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a>) state)
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:print&#39;) input."</span>
  (if (defarbrec-printp print)
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)
    (er-soft+ ctx
      <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
      nil
      <span class="string">"The :PRINT input must be NIL, :ERROR, :RESULT, or :ALL."</span>)))</pre>
  </div>

<div class="form-block other" id="form-36" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-show-only
  (show-only ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <span class="string">"Always @(&#39;nil&#39;)."</span>) state)
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:show-only&#39;) input."</span>
  (ensure-value-is-boolean$ show-only
    <span class="string">"The :SHOW-ONLY input"</span>
    <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
    nil))</pre>
  </div>

<div class="form-block other" id="form-37" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-process-inputs
  (fn x1...xn
    <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a>
    update-names
    terminates-name
    measure-name
    nonterminating
    print
    show-only
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple @(&#39;(body$
                                    test
                                    updates
                                    update-names$
                                    terminates-name$
                                    terminates-witness-name
                                    terminates-rewrite-name
                                    measure-name$
                                    nonterminating$)&#39;)
                        satisfying
                        @(&#39;(typed-tuplep pseudo-termp
                                         pseudo-termp
                                         pseudo-term-listp
                                         symbol-listp
                                         symbolp
                                         symbolp
                                         symbolp
                                         symbolp
                                         pseudo-termp
                                         result)&#39;)."</span>)
    state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process all the inputs."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"If validation is successful,
     return the results from the input validation functions called."</span>)
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-fn fn ctx state)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-x1...xn x1...xn ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> body$ test updates)) (defarbrec-process-body <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> fn x1...xn ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> update-names$) (defarbrec-process-update-names update-names
          fn
          x1...xn
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> terminates-name$
           terminates-witness-name
           terminates-rewrite-name)) (defarbrec-process-terminates-name terminates-name
          fn
          update-names$
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> measure-name$) (defarbrec-process-measure-name measure-name
          fn
          update-names$
          terminates-name$
          terminates-witness-name
          terminates-rewrite-name
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> nonterminating$) (defarbrec-process-nonterminating nonterminating
          x1...xn
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-print print ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-show-only show-only ctx state)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> body$
        test
        updates
        update-names$
        terminates-name$
        terminates-witness-name
        terminates-rewrite-name
        measure-name$
        nonterminating$))))</pre>
  </div>

<div class="form-block other" id="form-38" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ defarbrec-event-generation
  <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"Event generation performed by @(tsee defarbrec)."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Some events are generated in two slightly different forms:
     a form that is local to the generated @(tsee encapsulate),
     and a form that is exported from the @(tsee encapsulate).
     Proof hints are in the former but not in the latter,
     thus keeping the ACL2 history ``clean&#39;&#39;."</span>)
    (p <span class="string">"Other events are generated only locally in the @(tsee encapsulate),
     without any exported counterparts.
     These have automatically generated fresh names:
     the names used so far
     are threaded through the event generation functions below."</span>)
    (p <span class="string">"Other events are only exported from the @(tsee encapsulate),
     without any local counterparts."</span>)
    (p <span class="string">"The generated events, and particularly the proofs hints,
     follow the template in the file @(&#39;defarbrec-template.lisp&#39;),
     which is referred to as `template&#39;
     in the documentation of the event generation functions below."</span>))
  <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-39" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-var-k
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>))
  <span class="keyword">:returns</span> (k <span class="string">"A @(tsee symbolp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the variable @(&#39;k&#39;) that counts
          the iterated updates of the arguments."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This is used as
    a formal parameter of the iterated argument update functions,
    the bound variable in the termination testing predicate,
    and a formal parameter of the measure function.
    This variable must be distinct from the formal parameters of @(&#39;fn&#39;)."</span>)
  (<a class="sym-link system" href="../../../basis-b.html#def-genvar" data-sym="GENVAR">genvar</a> fn$ <span class="string">"K"</span> nil x1...xn$))</pre>
  </div>

<div class="form-block other" id="form-40" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-var-l
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (k symbolp))
  <span class="keyword">:returns</span> (l <span class="string">"A @(tsee symbolp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the variable @(&#39;l&#39;) that counts
          the iterated updates of the arguments."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This is used in one of the generated local lemmas
    about the measure function.
    This variable must be distinct from the formal parameters of @(&#39;fn&#39;)
    as well as from the variable @(&#39;k&#39;)."</span>)
  (<a class="sym-link system" href="../../../basis-b.html#def-genvar" data-sym="GENVAR">genvar</a> fn$ <span class="string">"L"</span> nil (cons k x1...xn$)))</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-test-of-updates-term
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (iterations <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>))
  <span class="keyword">:returns</span> (terms <span class="string">"A @(tsee pseudo-termp)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Generate the instantiation of the exit test of @(&#39;fn&#39;)
          with calls to the iterated argument update functions."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This is the term
    @(&#39;test&lt;(update*-x1 iterations x1 ... xn),
            ...,
            (update*-xn iterations x1 ... xn)&gt;&#39;),
    where the @(&#39;iterations&#39;) term is passed as argument to this function."</span>)
  (<a class="sym-link system" href="../../../basis-b.html#def-subcor-var" data-sym="SUBCOR-VAR">subcor-var</a> x1...xn$
    (apply-terms-same-args update-names$
      (cons iterations x1...xn$))
    test))</pre>
  </div>

<div class="form-block other" id="form-42" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-update-fns
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (updates pseudo-term-listp)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (k symbolp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:guard</span> (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> updates) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>)
    (exported-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the iterated argument update function definitions."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"These are the functions @(&#39;update*-x1&#39;), ..., @(&#39;update*-xn&#39;)
    in the documentation.
    They correspond to the function @(&#39;d*&#39;) in the template,
    where @(&#39;f&#39;) has just one argument."</span>)
  (defarbrec-gen-update-fns-aux x1...xn$
    updates
    update-names$
    k
    <span class="number">0</span>
    wrld)
  <span class="keyword">:prepwork</span> ((define defarbrec-gen-update-fns-aux
     ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (updates pseudo-term-listp)
       (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
       (k symbolp)
       (i (<a class="sym-link system" href="../../../axioms.html#def-integer-range-p" data-sym="INTEGER-RANGE-P">integer-range-p</a> <span class="number">0</span> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$) i))
       (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
     <span class="keyword">:guard</span> (equal (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> updates) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$))
     <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-events exported-events)
     <span class="keyword">:parents</span> nil
     <span class="keyword">:mode</span> <span class="keyword">:program</span> (b* ((i (<a class="sym-link system" href="../../../axioms.html#def-mbe" data-sym="MBE">mbe</a> <span class="keyword">:logic</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> i) <span class="keyword">:exec</span> i)) ((when (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> i (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$))) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil))
         (name (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> i update-names$))
         (xi (<a class="sym-link system" href="../../../axioms.html#def-nth" data-sym="NTH">nth</a> i x1...xn$))
         (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> `(,K ,@X1...XN$))
         (updates (untranslate-lst updates nil wrld))
         (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> `(if (<a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> ,K)
             ,XI
             (,NAME (<a class="sym-link system" href="../../../axioms.html#def-1-" data-sym="1-">1-</a> ,K) ,@UPDATES)))
         (measure `(<a class="sym-link system" href="../../../axioms.html#def-acl2-count" data-sym="ACL2-COUNT">acl2-count</a> ,K))
         (hints '((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> nil)))
         (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,NAME
               ,FORMALS
               (declare (xargs <span class="keyword">:measure</span> ,MEASURE
                   <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>
                   <span class="keyword">:hints</span> ,HINTS))
               ,BODY)))
         (exported-event `(<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,NAME
             ,FORMALS
             (declare (xargs <span class="keyword">:measure</span> ,MEASURE <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>))
             ,BODY))
         ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-events exported-events) (defarbrec-gen-update-fns-aux x1...xn$
             updates
             update-names$
             k
             (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> i)
             wrld)))
       (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (cons local-event local-events)
         (cons exported-event exported-events)))
     <span class="keyword">:measure</span> (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> update-names$) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> i))))))</pre>
  </div>

<div class="form-block other" id="form-43" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-update-fns-lemma
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (k symbolp)
    (names-to-avoid <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (name <span class="string">"A @(tsee symbolp) that is the name of the lemma."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the local lemma
          about the iterated argument udpate functions."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This corresponds to the theorem @(&#39;d*-lemma&#39;) in the template.
     Its formula has the following form in general:"</span>)
    (codeblock <span class="string">"(implies (and test&lt;(update*-x1 k x1 ... xn),...,(update*-xn k x1 ... xn)&gt;"</span>
      <span class="string">"              (not (natp k)))"</span>
      <span class="string">"         test&lt;(update*-x1 0 x1 ... xn),...,(update*-xn 0 x1 ... xn)&gt;)"</span>))
  (b* ((name (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> fn$ <span class="string">"-UPDATE*-LEMMA"</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> name &amp;) (fresh-logical-name-with-$s-suffix name
          nil
          names-to-avoid
          wrld))
      (test-of-updates-k (defarbrec-gen-test-of-updates-term x1...xn$
          test
          update-names$
          k))
      (test-of-updates-0 (defarbrec-gen-test-of-updates-term x1...xn$
          test
          update-names$
          '<span class="number">0</span>))
      (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> `(<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> ,TEST-OF-UPDATES-K (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> ,K)))
          ,TEST-OF-UPDATES-0))
      (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (untranslate <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> wrld))
      (event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ,NAME
            ,FORMULA
            <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(,@UPDATE-NAMES$ <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a>)))
            <span class="keyword">:rule-classes</span> nil))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> event name)))</pre>
  </div>

<div class="form-block other" id="form-44" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-terminates-fn
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (terminates-witness-name$ symbolp)
    (terminates-rewrite-name$ symbolp)
    (k symbolp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the termination testing predicate definition."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is the predicate @(&#39;terminates&#39;) in the documentation.
     It corresponds to the function @(&#39;tt&#39;) in the template."</span>)
    (p <span class="string">"The names of the witness and rewrite rule
     calculated by @(tsee defarbrec-process-terminates-name)
     are the same as the @(tsee defun-sk) default ones.
     But by setting them explicitly,
     we make them easier to change in the future."</span>)
    (p <span class="string">"We set @(&#39;:quant-ok&#39;) to @(&#39;t&#39;), in case."</span>))
  (b* ((test-of-updates-k (defarbrec-gen-test-of-updates-term x1...xn$
         test
         update-names$
         k)) (test-of-updates-k (untranslate test-of-updates-k nil wrld)))
    `(defun-sk ,TERMINATES-NAME$
      ,X1...XN$
      (exists ,K ,TEST-OF-UPDATES-K)
      <span class="keyword">:skolem-name</span> ,TERMINATES-WITNESS-NAME$
      <span class="keyword">:thm-name</span> ,TERMINATES-REWRITE-NAME$
      <span class="keyword">:quant-ok</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>

<div class="form-block other" id="form-45" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-measure-fn
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-witness-name$ symbolp)
    (measure-name$ symbolp)
    (k symbolp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (exported-event <span class="string">"A @(tsee pseudo-event-formp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the measure function definition."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is the function @(&#39;measure&#39;) in the documentation.
     It corresponds to the function @(&#39;nu&#39;) in the template."</span>)
    (p <span class="string">"We do not generate a function corresponding to @(&#39;mu&#39;) in the template.
     We directly use the equivalent of @(&#39;(nu x 0)&#39;)
     for the measure of the logic-mode @(&#39;fn&#39;)
     (see @(tsee defarbrec-gen-fn-fn))."</span>))
  (b* ((test-of-updates-k (defarbrec-gen-test-of-updates-term x1...xn$
         test
         update-names$
         k)) (test-of-updates-k (untranslate test-of-updates-k nil wrld))
      (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> `(,@X1...XN$ ,K))
      (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> `(let ((,K (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> ,K)))
          (if (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> ,TEST-OF-UPDATES-K
              (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> ,K (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (,TERMINATES-WITNESS-NAME$ ,@X1...XN$))))
            ,K
            (,MEASURE-NAME$ ,@X1...XN$ (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> ,K)))))
      (measure `(<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (<a class="sym-link system" href="../../../axioms.html#def--" data-sym="-">-</a> (,TERMINATES-WITNESS-NAME$ ,@X1...XN$) (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> ,K))))
      (hints '((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(<a class="sym-link system" href="../../../axioms.html#def-o-p" data-sym="O-P">o-p</a> <a class="sym-link system" href="../../../axioms.html#def-o-finp" data-sym="O-FINP">o-finp</a> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a> <a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a>))))
      (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,MEASURE-NAME$
            ,FORMALS
            (declare (xargs <span class="keyword">:measure</span> ,MEASURE
                <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>
                <span class="keyword">:hints</span> ,HINTS))
            ,BODY)))
      (exported-event `(<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,MEASURE-NAME$
          ,FORMALS
          (declare (xargs <span class="keyword">:measure</span> ,MEASURE <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>))
          ,BODY)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event)))</pre>
  </div>

<div class="form-block other" id="form-46" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-measure-fn-natp-lemma
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (measure-name$ symbolp)
    (k symbolp)
    (names-to-avoid <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (name <span class="string">"A @(tsee symbolp) that is the name of the lemma."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the local lemma about the generated measure function
          that asserts that the measure function returns a natural number."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This corresponds to the theorem @(&#39;nu-natp&#39;) in the template.
     Its formula has the following form in general:"</span>)
    (codeblock <span class="string">"(natp (measure x1 ... xn k))"</span>)
    (p <span class="string">"We generate this theorem without rule classes
     (instead of a rewrite rule as in the template)
     because we do not generate a function corresponding to @(&#39;mu&#39;) here
     and we use this theorem only with @(&#39;:use&#39;) hints."</span>))
  (b* ((name (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> measure-name$ <span class="string">"-NATP"</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> name &amp;) (fresh-logical-name-with-$s-suffix name
          nil
          names-to-avoid
          wrld))
      (event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ,NAME
            (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> (,MEASURE-NAME$ ,@X1...XN$ ,K))
            <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '((<span class="keyword">:type-prescription</span> ,MEASURE-NAME$) (<span class="keyword">:compound-recognizer</span> <a class="sym-link system" href="../../../axioms.html#def-natp-compound-recognizer" data-sym="NATP-COMPOUND-RECOGNIZER">natp-compound-recognizer</a>))))
            <span class="keyword">:rule-classes</span> nil))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> event name)))</pre>
  </div>

<div class="form-block other" id="form-47" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-measure-fn-end-lemma
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (terminates-witness-name$ symbolp)
    (measure-name$ symbolp)
    (k symbolp)
    (update-fns-lemma-name symbolp)
    (names-to-avoid <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (name <span class="string">"A @(tsee symbolp) that is the name of the lemma."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the local lemma about the generated measure function
          that asserts that
          iterating the argument updates on terminating arguments
          for the number indicated by the generated measure function
          yields values satisfying the exit test."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This corresponds to the theorem @(&#39;nu-end&#39;) in the template.
     Its formula has the following form in general:"</span>)
    (codeblock <span class="string">"(implies (and (terminates x1 ... xn)"</span>
      <span class="string">"              (natp k)"</span>
      <span class="string">"              (&lt;= k (nfix (terminates-witness x1 ... xn))))"</span>
      <span class="string">"         test&lt;(update*-x1 (measure x1 ... xn k) x1 ... xn),"</span>
      <span class="string">"              ...,"</span>
      <span class="string">"              (update*-xn (measure x1 ... xn k) x1 ... xn)&gt;)"</span>)
    (p <span class="string">"We generate this theorem without rule classes
     (instead of a rewrite rule as in the template)
     because we do not generate a function corresponding to @(&#39;mu&#39;) here
     and we use this theorem only with @(&#39;:use&#39;) hints."</span>))
  (b* ((name (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> measure-name$ <span class="string">"-END"</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> name &amp;) (fresh-logical-name-with-$s-suffix name
          nil
          names-to-avoid
          wrld))
      (iterations (apply-term measure-name$ `(,@X1...XN$ ,K)))
      (test-of-updates-measure (defarbrec-gen-test-of-updates-term x1...xn$
          test
          update-names$
          iterations))
      (test-of-updates-measure (untranslate test-of-updates-measure nil wrld))
      (event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ,NAME
            (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (,TERMINATES-NAME$ ,@X1...XN$)
                (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> ,K)
                (<a class="sym-link system" href="../../../axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> ,K (<a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> (,TERMINATES-WITNESS-NAME$ ,@X1...XN$))))
              ,TEST-OF-UPDATES-MEASURE)
            <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(,MEASURE-NAME$ ,TERMINATES-NAME$ <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a>)
               <span class="keyword">:induct</span> (,MEASURE-NAME$ ,@X1...XN$ ,K)) '(<span class="keyword">:use</span> (<span class="keyword">:instance</span> ,UPDATE-FNS-LEMMA-NAME
                  (,K (,TERMINATES-WITNESS-NAME$ ,@X1...XN$)))))
            <span class="keyword">:rule-classes</span> nil))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> event name)))</pre>
  </div>

<div class="form-block other" id="form-48" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-measure-fn-min-lemma
  ((x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (measure-name$ symbolp)
    (k symbolp)
    (l symbolp)
    (names-to-avoid <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (name <span class="string">"A @(tsee symbolp) that is the name of the lemma."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the local lemma about the generated measure function
          that asserts that the value of the measure function is
          the minimum number of iterations of the argument update functions
          that turn terminating arguments into values satisfying the exit test."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This corresponds to the theorem @(&#39;nu-min&#39;) in the template.
     Its formula has the following form in general:"</span>)
    (codeblock <span class="string">"(implies (and (natp l)"</span>
      <span class="string">"              (natp k)"</span>
      <span class="string">"              (&gt;= l k)"</span>
      <span class="string">"              test&lt;(update*-x1 l x1 ... xn),"</span>
      <span class="string">"                   ...,"</span>
      <span class="string">"                   (update*-xn l x1 ... xn)&gt;)"</span>
      <span class="string">"         (&gt;= l (measure x1 ... xn k)))"</span>)
    (p <span class="string">"We generate this theorem without rule classes
     (instead of a rewrite rule as in the template)
     because we do not generate a function corresponding to @(&#39;mu&#39;) here
     and we use this theorem only with @(&#39;:use&#39;) hints."</span>))
  (b* ((name (<a class="sym-link system" href="../../../axioms.html#def-add-suffix" data-sym="ADD-SUFFIX">add-suffix</a> measure-name$ <span class="string">"-MIN"</span>)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> name &amp;) (fresh-logical-name-with-$s-suffix name
          nil
          names-to-avoid
          wrld))
      (test-of-updates-l (defarbrec-gen-test-of-updates-term x1...xn$
          test
          update-names$
          l))
      (test-of-updates-l (untranslate test-of-updates-l nil wrld))
      (event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defthm" data-sym="DEFTHM">defthm</a> ,NAME
            (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> ,L) (<a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> ,K) (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> ,L ,K) ,TEST-OF-UPDATES-L)
              (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> l (,MEASURE-NAME$ ,@X1...XN$ ,K)))
            <span class="keyword">:hints</span> ((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(,MEASURE-NAME$ <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a>)
               <span class="keyword">:induct</span> (,MEASURE-NAME$ ,@X1...XN$ ,K)))
            <span class="keyword">:rule-classes</span> nil))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> event name)))</pre>
  </div>

<div class="form-block other" id="form-49" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-fn-fn
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (body$ <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (updates pseudo-term-listp)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (measure-name$ symbolp)
    (nonterminating$ <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (k symbolp)
    (l symbolp)
    (measure-fn-natp-lemma-name symbolp)
    (measure-fn-end-lemma-name symbolp)
    (measure-fn-min-lemma-name symbolp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (exported-event <span class="string">"A @(tsee pseudo-event-formp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the definition of the @(&#39;lfn&#39;) function."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is as described in the documentation.
     We wrap the body of the program-mode function
     into a check with the termination testing predicate."</span>)
    (p <span class="string">"This corresponds to the function @(&#39;f^&#39;) in the template,
     but we directly use @(&#39;measure&#39;), which corresponds to @(&#39;nu&#39;).
     The termination proof hints are adapted accordingly,
     by instantiating the argument @(&#39;k&#39;) of @(&#39;measure&#39;) with @(&#39;0&#39;)
     and by including @(tsee nfix) in the theory
     (since it is included in the theories that prove
     @(&#39;mu-end&#39;) and @(&#39;mu-min&#39;) in the template)."</span>))
  (b* ((measure `(,MEASURE-NAME$ ,@X1...XN$ <span class="number">0</span>)) (doublets (alist-to-doublets (<a class="sym-link system" href="../../../axioms.html#def-pairlis_24" data-sym="PAIRLIS$">pairlis$</a> x1...xn$ updates)))
      (hints `((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> '(<a class="sym-link system" href="../../../axioms.html#def-o-p" data-sym="O-P">o-p</a> <a class="sym-link system" href="../../../axioms.html#def-o-finp" data-sym="O-FINP">o-finp</a> <a class="sym-link system" href="../../../axioms.html#def-natp" data-sym="NATP">natp</a> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a> <a class="sym-link system" href="../../../axioms.html#def-zp" data-sym="ZP">zp</a> <a class="sym-link system" href="../../../axioms.html#def-nfix" data-sym="NFIX">nfix</a> ,@UPDATE-NAMES$)
           <span class="keyword">:use</span> ((<span class="keyword">:instance</span> ,MEASURE-FN-NATP-LEMMA-NAME (,K <span class="number">0</span>)) (<span class="keyword">:instance</span> ,MEASURE-FN-NATP-LEMMA-NAME ,@DOUBLETS (,K <span class="number">0</span>))
             (<span class="keyword">:instance</span> ,MEASURE-FN-END-LEMMA-NAME (,K <span class="number">0</span>))
             (<span class="keyword">:instance</span> ,MEASURE-FN-MIN-LEMMA-NAME
               (,L (<a class="sym-link system" href="../../../axioms.html#def-1-" data-sym="1-">1-</a> (,MEASURE-NAME$ ,@X1...XN$ <span class="number">0</span>)))
               ,@DOUBLETS
               (,K <span class="number">0</span>))))))
      (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> `(if (,TERMINATES-NAME$ ,@X1...XN$)
          ,BODY$
          ,NONTERMINATING$))
      (<a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> (untranslate <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a> nil wrld))
      (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,FN$
            ,X1...XN$
            (declare (xargs <span class="keyword">:measure</span> ,MEASURE
                <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>
                <span class="keyword">:hints</span> ,HINTS))
            ,BODY)))
      (exported-event `(<a class="sym-link system" href="../../../axioms.html#def-defun" data-sym="DEFUN">defun</a> ,FN$
          ,X1...XN$
          (declare (xargs <span class="keyword">:measure</span> ,MEASURE <span class="keyword">:well-founded-relation</span> <a class="sym-link system" href="../../../axioms.html#def-o_3C" data-sym="O&lt;">o&lt;</a>))
          ,BODY)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event)))</pre>
  </div>

<div class="form-block other" id="form-50" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-extend-table
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (body$ <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (measure-name$ symbolp)
    (call$ pseudo-event-formp)
    (expansion pseudo-event-formp))
  <span class="keyword">:returns</span> (event pseudo-event-formp)
  <span class="keyword">:short</span> <span class="string">"Generate the event that extends the @(tsee defarbrec) table."</span>
  (b* ((info (make-defarbrec-info <span class="keyword">:call$</span> call$
         <span class="keyword">:expansion</span> expansion
         <span class="keyword">:x1...xn</span> x1...xn$
         <span class="keyword">:body</span> body$
         <span class="keyword">:update-fns</span> update-names$
         <span class="keyword">:terminates-fn</span> terminates-name$
         <span class="keyword">:measure-fn</span> measure-name$)))
    `(<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> ,*DEFARBREC-TABLE-NAME* ',FN$ ',INFO)))</pre>
  </div>

<div class="form-block other" id="form-51" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-print-result
  ((events pseudo-event-form-listp))
  <span class="keyword">:returns</span> (cw-events pseudo-event-form-listp)
  <span class="keyword">:short</span> <span class="string">"Generate the events that print the results."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This is used when @(&#39;:print&#39;) is @(&#39;:result&#39;) or @(&#39;:all&#39;)."</span>)
  (if (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> events)
    nil
    (cons `(cw-event <span class="string">"~x0~|"</span> ',(CAR EVENTS))
      (defarbrec-gen-print-result (cdr events)))))</pre>
  </div>

<div class="form-block other" id="form-52" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-gen-everything
  ((fn$ symbolp) (x1...xn$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (body$ <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (test <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (updates pseudo-term-listp)
    (update-names$ <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (terminates-name$ symbolp)
    (terminates-witness-name$ symbolp)
    (terminates-rewrite-name$ symbolp)
    (measure-name$ symbolp)
    (nonterminating$ <a class="sym-link system" href="../../../axioms.html#def-pseudo-termp" data-sym="PSEUDO-TERMP">pseudo-termp</a>)
    (print$ defarbrec-printp)
    (show-only$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (call pseudo-event-formp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the top-level event."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is a @(tsee progn) that consists of
     the expansion of @(tsee defarbrec) (the @(tsee encapsulate)),
     followed by an event to extend the @(tsee defarbrec) table,
     optionally followed by events to print the exported functions
     (if specified by the @(&#39;:print&#39;) input).
     The @(tsee progn) ends with @(&#39;:invisible&#39;)
     to avoid printing a return value."</span>)
    (p <span class="string">"The expansion starts with some implicitly local events to
     ensure logic mode,
     avoid errors due to ignored or irrelevant formals
     in the generated functions,
     and prevent default and override hints from sabotaging the generated proofs.
     Then all the local and exported function and lemma events are introduced.
     The @(&#39;names-to-avoid&#39;) variable is
     initialized with the names of the exported events
     and extended as local names are generated."</span>)
    (p <span class="string">"If the @(&#39;:print&#39;) input is @(&#39;:all&#39;),
     the expansion is wrapped to show ACL2&#39;s output
     in response to the submitted events.
     In this case, a blank line is printed before printing the result,
     for visual separation."</span>)
    (p <span class="string">"If @(&#39;:show-only&#39;) is @(&#39;t&#39;),
     the expansion is printed on the screen
     and not returned as part of the event to submit,
     which is in this case is just an @(&#39;:invisible&#39;) form."</span>))
  (b* ((names-to-avoid `(,FN$ ,@UPDATE-NAMES$
         terminates-name$
         terminates-witness-name$
         terminates-rewrite-name$
         measure-name$)) (k (defarbrec-gen-var-k fn$ x1...xn$))
      (l (defarbrec-gen-var-l fn$ x1...xn$ k))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-update-fns exported-update-fns) (defarbrec-gen-update-fns x1...xn$
          updates
          update-names$
          k
          wrld))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> update-fns-lemma update-fns-lemma-name) (defarbrec-gen-update-fns-lemma fn$
          x1...xn$
          test
          update-names$
          k
          names-to-avoid
          wrld))
      (names-to-avoid (cons update-fns-lemma-name names-to-avoid))
      (terminates-fn (defarbrec-gen-terminates-fn x1...xn$
          test
          update-names$
          terminates-name$
          terminates-witness-name$
          terminates-rewrite-name$
          k
          wrld))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-measure-fn exported-measure-fn) (defarbrec-gen-measure-fn x1...xn$
          test
          update-names$
          terminates-witness-name$
          measure-name$
          k
          wrld))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> measure-fn-natp-lemma measure-fn-natp-lemma-name) (defarbrec-gen-measure-fn-natp-lemma x1...xn$
          measure-name$
          k
          names-to-avoid
          wrld))
      (names-to-avoid (cons measure-fn-natp-lemma-name names-to-avoid))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> measure-fn-end-lemma measure-fn-end-lemma-name) (defarbrec-gen-measure-fn-end-lemma x1...xn$
          test
          update-names$
          terminates-name$
          terminates-witness-name$
          measure-name$
          k
          update-fns-lemma-name
          names-to-avoid
          wrld))
      (names-to-avoid (cons measure-fn-end-lemma-name names-to-avoid))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> measure-fn-min-lemma measure-fn-min-lemma-name) (defarbrec-gen-measure-fn-min-lemma x1...xn$
          test
          update-names$
          measure-name$
          k
          l
          names-to-avoid
          wrld))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-fn-fn exported-fn-fn) (defarbrec-gen-fn-fn fn$
          x1...xn$
          body$
          updates
          update-names$
          terminates-name$
          measure-name$
          nonterminating$
          k
          l
          measure-fn-natp-lemma-name
          measure-fn-end-lemma-name
          measure-fn-min-lemma-name
          wrld))
      (expansion `(<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
          (<a class="sym-link system" href="../../../axioms.html#def-logic" data-sym="LOGIC">logic</a>)
          (<a class="sym-link system" href="../../../axioms.html#def-set-ignore-ok" data-sym="SET-IGNORE-OK">set-ignore-ok</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
          (<a class="sym-link system" href="../../../axioms.html#def-set-irrelevant-formals-ok" data-sym="SET-IRRELEVANT-FORMALS-OK">set-irrelevant-formals-ok</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
          (evmac-prepare-proofs)
          ,@LOCAL-UPDATE-FNS
          ,@EXPORTED-UPDATE-FNS
          ,UPDATE-FNS-LEMMA
          ,TERMINATES-FN
          ,LOCAL-MEASURE-FN
          ,EXPORTED-MEASURE-FN
          ,MEASURE-FN-NATP-LEMMA
          ,MEASURE-FN-END-LEMMA
          ,MEASURE-FN-MIN-LEMMA
          ,LOCAL-FN-FN
          ,EXPORTED-FN-FN))
      ((when show-only$) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~x0~|"</span> expansion)
        '(<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>))
      (expansion-output-p (if (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> print$ <span class="keyword">:all</span>)
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      (expansion+ (restore-output? expansion-output-p expansion))
      (call$ (defarbrec-filter-call call))
      (extend-table (defarbrec-gen-extend-table fn$
          x1...xn$
          body$
          update-names$
          terminates-name$
          measure-name$
          call$
          expansion))
      (print-result (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> print$ '(<span class="keyword">:result</span> <span class="keyword">:all</span>))
          (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> expansion-output-p '((cw-event <span class="string">"~%"</span>)))
            (defarbrec-gen-print-result `(,@EXPORTED-UPDATE-FNS ,TERMINATES-FN
                ,EXPORTED-MEASURE-FN
                ,EXPORTED-FN-FN))))))
    `(<a class="sym-link system" href="../../../axioms.html#def-progn" data-sym="PROGN">progn</a> ,EXPANSION+
      ,EXTEND-TABLE
      ,@PRINT-RESULT
      (<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>))))</pre>
  </div>

<div class="form-block other" id="form-53" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-check-redundancy
  (fn print show-only (call pseudo-event-formp) ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (yes/no <span class="string">"A @(tsee booleanp)."</span>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"Check if a call of @(tsee defarbrec) is redundant."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"If the @(tsee defarbrec) table has no entry for @(&#39;fn&#39;),
     we return @(&#39;nil&#39;); the call is not redundant."</span>)
    (p <span class="string">"If the table has an entry for @(&#39;fn&#39;) but the call differs,
     an error occurs."</span>)
    (p <span class="string">"If the call is redundant,
     we know that all the inputs except possibly @(&#39;:print&#39;) and @(&#39;:show-only&#39;)
     are valid
     (because they are the same as the ones of the recorded successful call);
     we validate these two inputs, for better error checking.
     If @(&#39;:show-only&#39;) is @(&#39;t&#39;),
     we print the recorded expansion of the call.
     Unless @(&#39;:print&#39;) is @(&#39;nil&#39;),
     we print a message saying that the call is redundant."</span>))
  (b* ((<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> (<a class="sym-link system" href="../../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> *defarbrec-table-name* (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state))) (pair (<a class="sym-link system" href="../../../axioms.html#def-assoc-equal" data-sym="ASSOC-EQUAL">assoc-equal</a> fn <a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a>))
      ((unless pair) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
      (info (cdr pair))
      (call$ (defarbrec-filter-call call))
      ((unless (equal call$ (defarbrec-info-&gt;call$ info))) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The function ~x0 has already been defined ~
                   by a different call of DEFARBREC."</span>
          fn))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-print print ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defarbrec-process-show-only show-only ctx state))
      ((run-when show-only) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~x0~|"</span> (defarbrec-info-&gt;expansion info)))
      ((run-when print) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~%The call ~x0 is redundant.~%"</span> call)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>

<div class="form-block other" id="form-54" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defarbrec-fn
  (fn x1...xn
    <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a>
    update-names
    terminates-name
    measure-name
    nonterminating
    print
    show-only
    (call pseudo-event-formp)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (event <span class="string">"A @(tsee pseudo-event-formp)."</span>) state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"Check redundancy,
          process the inputs,
          and generate the event to submit."</span>
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> redundant?) (defarbrec-check-redundancy fn
         print
         show-only
         call
         ctx
         state)) ((when redundant?) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> '(<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>)))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> body$
           test
           updates
           update-names$
           terminates-name$
           teminates-witness-name$
           terminates-rewrite-name$
           measure-name$
           nonterminating$)) (defarbrec-process-inputs fn
          x1...xn
          <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a>
          update-names
          terminates-name
          measure-name
          nonterminating
          print
          show-only
          ctx
          state))
      (event (defarbrec-gen-everything fn
          x1...xn
          body$
          test
          updates
          update-names$
          terminates-name$
          teminates-witness-name$
          terminates-rewrite-name$
          measure-name$
          nonterminating$
          print
          show-only
          call
          (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state))))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> event)))</pre>
  </div>

<div class="form-block other" id="form-55" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection defarbrec-macro-definition
  <span class="keyword">:parents</span> (defarbrec-implementation)
  <span class="keyword">:short</span> <span class="string">"Definition of the @(tsee defarbrec) macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Submit the event form generated by @(tsee defarbrec-fn)."</span>)
    (@def <span class="string">"defarbrec"</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> defarbrec
    (&amp;whole call
      fn
      x1...xn
      <a class="sym-link system" href="../../../basis-b.html#def-body" data-sym="BODY">body</a>
      &amp;key
      update-names
      terminates-name
      measure-name
      (nonterminating '<span class="keyword">:nonterminating</span>)
      (print '<span class="keyword">:result</span>)
      show-only)
    `(make-event-terse (defarbrec-fn ',FN
        ',X1...XN
        ',BODY
        ',UPDATE-NAMES
        ',TERMINATES-NAME
        ',MEASURE-NAME
        ',NONTERMINATING
        ',PRINT
        ',SHOW-ONLY
        ',CALL
        (cons 'defarbrec ',FN)
        state)
      <span class="keyword">:suppress-errors</span> ,(NOT PRINT))))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>