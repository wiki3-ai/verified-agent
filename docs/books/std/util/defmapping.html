<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>defmapping - ACL2 Book</title>
  <meta property="name" content="defmapping">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">defmapping</h1>
    <div class="path"><a href="defmapping.lisp" class="source-link">books/std/util/defmapping</a></div>
  </div>
  
  <main property="text">
  <div class="includes-section">
    <h2>Included Books</h2>
    <div class="includes-list">
      <a class="include-link" href="../../kestrel/error-checking/ensure-list-has-no-duplicates.html" title="kestrel/error-checking/ensure-list-has-no-duplicates">ensure-list-has-no-duplicates</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-boolean.html" title="kestrel/error-checking/ensure-value-is-boolean">ensure-value-is-boolean</a>
      <a class="include-link" href="../../kestrel/error-checking/ensure-value-is-symbol.html" title="kestrel/error-checking/ensure-value-is-symbol">ensure-value-is-symbol</a>
      <a class="include-link" href="../../kestrel/event-macros/applicability-conditions.html" title="kestrel/event-macros/applicability-conditions">applicability-conditions</a>
      <a class="include-link" href="../../kestrel/event-macros/input-processing.html" title="kestrel/event-macros/input-processing">input-processing</a>
      <a class="include-link" href="../../kestrel/event-macros/proof-preparation.html" title="kestrel/event-macros/proof-preparation">proof-preparation</a>
      <a class="include-link" href="../../kestrel/event-macros/restore-output.html" title="kestrel/event-macros/restore-output">restore-output</a>
      <a class="include-link" href="../../kestrel/event-macros/xdoc-constructors.html" title="kestrel/event-macros/xdoc-constructors">xdoc-constructors</a>
      <a class="include-link" href="../../std/system/apply-term.html" title="std/system/apply-term">apply-term</a>
      <a class="include-link" href="../../std/system/conjoin-equalities.html" title="std/system/conjoin-equalities">conjoin-equalities</a>
      <a class="include-link" href="../../std/system/make-mv-let-call.html" title="std/system/make-mv-let-call">make-mv-let-call</a>
      <a class="include-link" href="../../std/system/make-mv-nth-calls.html" title="std/system/make-mv-nth-calls">make-mv-nth-calls</a>
      <a class="include-link" href="../../std/system/pseudo-event-form-listp.html" title="std/system/pseudo-event-form-listp">pseudo-event-form-listp</a>
      <a class="include-link" href="../../std/system/term-guard-obligation.html" title="std/system/term-guard-obligation">term-guard-obligation</a>
      <a class="include-link" href="../../std/system/uguard.html" title="std/system/uguard">uguard</a>
      <a class="include-link" href="../../kestrel/utilities/defthmr.html" title="kestrel/utilities/defthmr">defthmr</a>
      <a class="include-link" href="../../kestrel/utilities/error-checking/top.html" title="kestrel/utilities/error-checking/top">top</a>
      <a class="include-link" href="../../kestrel/utilities/keyword-value-lists.html" title="kestrel/utilities/keyword-value-lists">keyword-value-lists</a>
      <a class="include-link" href="../../std/typed-alists/symbol-symbol-alistp.html" title="std/typed-alists/symbol-symbol-alistp">symbol-symbol-alistp</a>
      <a class="include-link" href="../../std/util/defaggregate.html" title="std/util/defaggregate">defaggregate</a>
    </div>
  </div>

<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block include-book" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-list-has-no-duplicates.html" title="Open kestrel/error-checking/ensure-list-has-no-duplicates">"kestrel/error-checking/ensure-list-has-no-duplicates"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-boolean.html" title="Open kestrel/error-checking/ensure-value-is-boolean">"kestrel/error-checking/ensure-value-is-boolean"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/error-checking/ensure-value-is-symbol.html" title="Open kestrel/error-checking/ensure-value-is-symbol">"kestrel/error-checking/ensure-value-is-symbol"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/applicability-conditions.html" title="Open kestrel/event-macros/applicability-conditions">"kestrel/event-macros/applicability-conditions"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-5" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/input-processing.html" title="Open kestrel/event-macros/input-processing">"kestrel/event-macros/input-processing"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-6" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/proof-preparation.html" title="Open kestrel/event-macros/proof-preparation">"kestrel/event-macros/proof-preparation"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-7" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/restore-output.html" title="Open kestrel/event-macros/restore-output">"kestrel/event-macros/restore-output"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-8" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/event-macros/xdoc-constructors.html" title="Open kestrel/event-macros/xdoc-constructors">"kestrel/event-macros/xdoc-constructors"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-9" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/apply-term.html" title="Open std/system/apply-term">"std/system/apply-term"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-10" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/conjoin-equalities.html" title="Open std/system/conjoin-equalities">"std/system/conjoin-equalities"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-11" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/make-mv-let-call.html" title="Open std/system/make-mv-let-call">"std/system/make-mv-let-call"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-12" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/make-mv-nth-calls.html" title="Open std/system/make-mv-nth-calls">"std/system/make-mv-nth-calls"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-13" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/pseudo-event-form-listp.html" title="Open std/system/pseudo-event-form-listp">"std/system/pseudo-event-form-listp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/term-guard-obligation.html" title="Open std/system/term-guard-obligation">"std/system/term-guard-obligation"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/system/uguard.html" title="Open std/system/uguard">"std/system/uguard"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/utilities/defthmr.html" title="Open kestrel/utilities/defthmr">"kestrel/utilities/defthmr"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/utilities/error-checking/top.html" title="Open kestrel/utilities/error-checking/top">"kestrel/utilities/error-checking/top"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../kestrel/utilities/keyword-value-lists.html" title="Open kestrel/utilities/keyword-value-lists">"kestrel/utilities/keyword-value-lists"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/typed-alists/symbol-symbol-alistp.html" title="Open std/typed-alists/symbol-symbol-alistp">"std/typed-alists/symbol-symbol-alistp"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block include-book" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">include-book</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-include-book" data-sym="INCLUDE-BOOK">include-book</a> <a class="include-path" href="../../../std/util/defaggregate.html" title="Open std/util/defaggregate">"std/util/defaggregate"</a> <span class="keyword">:dir</span> <span class="keyword">:system</span>)</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(evmac-topic-implementation defmapping
  <span class="keyword">:items</span> (*evmac-topic-implementation-item-state* *evmac-topic-implementation-item-wrld*
    *evmac-topic-implementation-item-ctx*
    <span class="string">"@(&#39;name&#39;),
   @(&#39;doma&#39;),
   @(&#39;domb&#39;),
   @(&#39;alpha&#39;),
   @(&#39;beta&#39;),
   @(&#39;beta-of-alpha-thm&#39;),
   @(&#39;alpha-of-beta-thm&#39;),
   @(&#39;guard-thms&#39;),
   @(&#39;unconditional&#39;),
   @(&#39;thm-names&#39;),
   @(&#39;thm-enable&#39;),
   @(&#39;hints&#39;),
   @(&#39;print&#39;), and
   @(&#39;show-only&#39;)
   are the homonymous inputs to @(tsee defmapping),
   before being validated.
   These variables have no types because they may be any values."</span>
    <span class="string">"@(&#39;name$&#39;),
   @(&#39;doma$&#39;),
   @(&#39;domb$&#39;),
   @(&#39;alpha$&#39;),
   @(&#39;beta$&#39;),
   @(&#39;beta-of-alpha-thm$&#39;),
   @(&#39;alpha-of-beta-thm$&#39;),
   @(&#39;guard-thms$&#39;),
   @(&#39;unconditional$&#39;),
   @(&#39;thm-name$&#39;),
   @(&#39;thm-enable$&#39;),
   @(&#39;hints$&#39;),
   @(&#39;print$&#39;), and
   @(&#39;show-only$&#39;)
   are the results of processing
   the homonymous inputs (without the @(&#39;$&#39;)) to @(tsee defmapping).
   Some are identical to the corresponding inputs,
   but they have types implied by their successful validation,
   performed when they are processed."</span>
    <span class="string">"@(&#39;call&#39;) is the call of @(tsee defmapping) supplied by the user."</span>
    <span class="string">"@(&#39;call$&#39;) is the result of removing
   @(&#39;:print&#39;) and @(&#39;:show-only&#39;) from @(&#39;call&#39;)."</span>
    <span class="string">"@(&#39;expansion&#39;) is the @(tsee encapsulate) generated by @(tsee defmapping)."</span>
    <span class="string">"@(&#39;a1...an&#39;) is the list of variables @(&#39;a1&#39;), ..., @(&#39;an&#39;)
   described in the documentation."</span>
    <span class="string">"@(&#39;b1...bm&#39;) is the list of variables @(&#39;b1&#39;), ..., @(&#39;bm&#39;)
   described in the documentation."</span>
    <span class="string">"@(&#39;stobjp&#39;) is a flag saying whether
   any of the domains has input or output stobjs."</span>))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defxdoc+ defmapping-table
  <span class="keyword">:parents</span> (defmapping-implementation)
  <span class="keyword">:short</span> <span class="string">"@(csee table) of recorded @(tsee defmapping) information."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"For each successful call of @(tsee defmapping)
     whose @(&#39;:show-only&#39;) input is not @(&#39;t&#39;),
     this table includes a pair
     whose key is the name supplied as first input to @(tsee defmapping)
     and whose value includes the information about
     the domains, conversions, and theorems
     (see @(tsee defmapping-infop))."</span>)
    (p <span class="string">"This table is used
     not only to record the @(tsee defmapping) information,
     but also to support the redundancy check
     in @(tsee defmapping-check-redundancy)."</span>))
  <span class="keyword">:order-subtopics</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
  <span class="keyword">:default-parent</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defval *defmapping-table-name*
  'defmapping-table
  <span class="keyword">:short</span> <span class="string">"Name of the @(tsee defmapping) table."</span>)</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defaggregate defmapping-info
  <span class="keyword">:short</span> <span class="string">"Information about a @(tsee defmapping) call,
          recorded as a pair&#39;s value in the @(tsee defmapping) table."</span>
  ((call$ <span class="string">"The call to @(tsee defmapping),
           without @(&#39;:print&#39;) and @(&#39;:show-only&#39;)."</span>
     pseudo-event-formp) (expansion <span class="string">"The @(tsee encapsulate) generated from
               the call to @(tsee defmapping)."</span>
      pseudo-event-formp)
    (doma pseudo-termfnp <span class="string">"Domain @($A$), in translated form."</span>)
    (domb pseudo-termfnp <span class="string">"Domain @($B$), in translated form."</span>)
    (alpha pseudo-termfnp
      <span class="string">"Conversion @($\alpha$), in translated form."</span>)
    (beta pseudo-termfnp
      <span class="string">"Conversion @($\beta$), in translated form."</span>)
    (<a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a> <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Whether @($A$) or @($B$) has any input or output stobjs."</span>)
    (alpha-image symbolp
      <span class="string">"Name of the @(&#39;:alpha-image&#39;) theorem."</span>)
    (beta-image symbolp <span class="string">"Name of the @(&#39;:beta-image&#39;) theorem."</span>)
    (beta-of-alpha symbolp
      <span class="string">"Name of the @(&#39;:beta-of-alpha&#39;) theorem,
                           if present (otherwise @(&#39;nil&#39;)."</span>)
    (alpha-of-beta symbolp
      <span class="string">"Name of the @(&#39;:alpha-of-beta&#39;) theorem,
                           if present (otherwise @(&#39;nil&#39;)."</span>)
    (alpha-injective symbolp
      <span class="string">"Name of the @(&#39;:alpha-injective&#39;) theorem,
                             if present (otherwise @(&#39;nil&#39;)."</span>)
    (beta-injective symbolp
      <span class="string">"Name of the @(&#39;:beta-injective&#39;) theorem,
                            if present (otherwise @(&#39;nil&#39;)."</span>)
    (doma-guard symbolp
      <span class="string">"Name of the @(&#39;:doma-guard&#39;) theorem,
                        if present (otherwise @(&#39;nil&#39;))."</span>)
    (domb-guard symbolp
      <span class="string">"Name of the @(&#39;:domb-guard&#39;) theorem,
                        if present (otherwise @(&#39;nil&#39;))."</span>)
    (alpha-guard symbolp
      <span class="string">"Name of the @(&#39;:alpha-guard&#39;) theorem,
                         if present (otherwise @(&#39;nil&#39;))."</span>)
    (beta-guard symbolp
      <span class="string">"Name of the @(&#39;:beta-guard&#39;) theorem,
                        if present (otherwise @(&#39;nil&#39;))."</span>)
    (unconditional <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>
      <span class="string">"Value of the @(&#39;:unconditional&#39;) input,
                            i.e. whether some of the theorems
                            are unconditional or not."</span>))
  <span class="keyword">:pred</span> defmapping-infop)</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="../../../axioms.html#def-make-event" data-sym="MAKE-EVENT">make-event</a> `(<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> ,*DEFMAPPING-TABLE-NAME*
    nil
    nil
    <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (symbolp key) (defmapping-infop val))))</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define maybe-defmapping-infop
  (x)
  <span class="keyword">:returns</span> (yes/no <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
  <span class="keyword">:short</span> <span class="string">"Recognize information about a @(tsee defmapping) call, and @(&#39;nil&#39;)."</span>
  (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (defmapping-infop x) (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> x nil)))</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-lookup
  ((name symbolp) (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (info? <span class="string">"A @(tsee maybe-defmapping-infop)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Return the information for the @(tsee defmapping) specified by name,
          or @(&#39;nil&#39;) if there is no @(tsee defmapping) with that name."</span>
  (b* ((defmapping-table (<a class="sym-link system" href="../../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> *defmapping-table-name* wrld)) (pair? (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> name defmapping-table))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a> pair?)) nil)
      (info (cdr pair?)))
    info))</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-filter-call
  ((call pseudo-event-formp))
  <span class="keyword">:guard</span> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> call) <span class="number">6</span>)
    (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> (car call) '(defmapping defiso defsurj definj)))
  <span class="keyword">:returns</span> (call$ <span class="string">"A @(tsee pseudo-event-formp)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Remove any @(&#39;:print&#39;) and @(&#39;:show-only&#39;) inputs
          from a call of @(tsee defmapping) or its wrappers."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"As explained in the documentation,
    these two options are ignored when checking redundancy."</span>)
  (b* ((number-of-required-args <span class="number">5</span>) (number-of-elements-before-options (<a class="sym-link system" href="../../../axioms.html#def-1_2B" data-sym="1+">1+</a> number-of-required-args))
      (options (<a class="sym-link system" href="../../../axioms.html#def-nthcdr" data-sym="NTHCDR">nthcdr</a> number-of-elements-before-options call))
      (options (remove-keyword <span class="keyword">:print</span> options))
      (options (remove-keyword <span class="keyword">:show-only</span> options))
      (call$ (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-take" data-sym="TAKE">take</a> number-of-elements-before-options call)
          options)))
    call$))</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(evmac-topic-input-processing defmapping)</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-name
  (name ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (nothing <a class="sym-link system" href="../../../axioms.html#def-null" data-sym="NULL">null</a>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;name&#39;) input."</span>
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol$ name <span class="string">"The first input"</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-not-keyword$ name <span class="string">"The first input"</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)))</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-function
  ((function <span class="string">"The @(&#39;doma&#39;), @(&#39;domb&#39;), @(&#39;alpha&#39;), or @(&#39;beta&#39;)
              input to @(tsee defmapping)."</span>) (<a class="sym-link system" href="../../../axioms.html#def-position" data-sym="POSITION">position</a> (<a class="sym-link system" href="../../../axioms.html#def-member" data-sym="MEMBER">member</a> <a class="sym-link system" href="../../../axioms.html#def-position" data-sym="POSITION">position</a> '(<span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>))
      <span class="string">"Position of the input in
              the ordered inputs to @(tsee defmapping)."</span>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple @(&#39;(function$
                                    arity
                                    numres
                                    stobjp)&#39;)
                        satisfying
                        @(&#39;(typed-tuplep pseudo-termfnp
                                         natp
                                         posp
                                         booleanp
                                         result)&#39;)."</span>)
    state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process one of the input functions
          (i.e. @(&#39;doma&#39;), @(&#39;domb&#39;), @(&#39;alpha&#39;), or @(&#39;beta&#39;))."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"Return either the input unchanged (if it is a function name)
    or its translation (if it is a lambda expression).
    Also return the arity and the number of results."</span>)
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> fn/lambda <a class="sym-link system" href="../../../axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> description)) (ensure-function/macro/lambda$ function
         (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The ~n0 input"</span> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <a class="sym-link system" href="../../../axioms.html#def-position" data-sym="POSITION">position</a>))
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function/lambda-logic-mode$ fn/lambda
          description
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function/lambda-closed$ fn/lambda description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      (<a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a> (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal <a class="sym-link system" href="../../../axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> (repeat (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>) nil)))
          (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> (equal <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> (repeat (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>) nil)))))
      ((unless guard-thms$) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> fn/lambda (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>) <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>)))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-function/lambda-guard-verified-exec-fns$ fn/lambda
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"Since the :GUARD-THMS input is (perhaps by default) T, ~@0"</span>
            (msg-downcase-first description))
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> fn/lambda (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>) (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="../../../axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>) <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>))))</pre>
  </div>

<div class="form-block other" id="form-32" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-functions
  (doma domb alpha beta guard-thms$ ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple @(&#39;(doma$ domb$ alpha$ beta$ stobjp)&#39;)
                        satisfying @(&#39;(typed-tuplep pseudo-termfnp
                                                    pseudo-termfnp
                                                    pseudo-termfnp
                                                    pseudo-termfnp
                                                    booleanp
                                                    result)&#39;)."</span>)
    state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process the @(&#39;doma&#39;), @(&#39;domb&#39;), @(&#39;alpha&#39;), and @(&#39;beta&#39;) inputs."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"We call @(tsee defmapping-process-function) on each
    and then we check the constraints on the arities and numbers of results."</span>)
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> doma$ doma-arity doma-numres doma-stobjp)) (defmapping-process-function doma <span class="number">2</span> guard-thms$ ctx state)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> domb$ domb-arity domb-numres domb-stobjp)) (defmapping-process-function domb <span class="number">3</span> guard-thms$ ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> alpha$ alpha-arity alpha-numres &amp;)) (defmapping-process-function alpha <span class="number">4</span> guard-thms$ ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> beta$ beta-arity beta-numres &amp;)) (defmapping-process-function beta <span class="number">5</span> guard-thms$ ctx state))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> doma-numres <span class="number">1</span>)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The number of results returned by the domain ~x0 ~
                   must be 1, but it is ~x1 instead."</span>
          doma
          doma-numres))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> domb-numres <span class="number">1</span>)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The number of results returned by the domain ~x0 ~
                   must be 1, but it is ~x1 instead."</span>
          domb
          domb-numres))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> alpha-arity doma-arity)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The arity of the conversion ~x0 ~
                   must equal the arity ~x1 of the domain ~x2, ~
                   but it is ~x3 instead."</span>
          alpha
          doma-arity
          doma
          alpha-arity))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> alpha-numres domb-arity)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The number of results of the conversion ~x0 ~
                   must equal the arity ~x1 of the domain ~x2, ~
                   but it is ~x3 instead."</span>
          alpha
          domb-arity
          domb
          alpha-numres))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> beta-arity domb-arity)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The arity of the conversion ~x0 ~
                   must equal the arity ~x1 of the domain ~x2, ~
                   but it is ~x3 instead."</span>
          beta
          domb-arity
          domb
          beta-arity))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> beta-numres doma-arity)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The number of results of the conversion ~x0 ~
                   must equal the arity ~x1 of the domain ~x2, ~
                   but it is ~x3 instead."</span>
          beta
          doma-arity
          doma
          beta-numres)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> doma$ domb$ alpha$ beta$ (<a class="sym-link system" href="../../../axioms.html#def-or" data-sym="OR">or</a> doma-stobjp domb-stobjp)))))</pre>
  </div>

<div class="form-block other" id="form-33" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-thm-keywords
  ((beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>) (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>))
  <span class="keyword">:returns</span> (thm-keywords keyword-listp)
  <span class="keyword">:short</span> <span class="string">"Keywords that identify all the theorems to generate."</span>
  (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:alpha-image</span> <span class="keyword">:beta-image</span>)
    (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> beta-of-alpha-thm$
      (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:beta-of-alpha</span> <span class="keyword">:alpha-injective</span>))
    (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> alpha-of-beta-thm$
      (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:alpha-of-beta</span> <span class="keyword">:beta-injective</span>))
    (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> guard-thms$
      (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:doma-guard</span> <span class="keyword">:domb-guard</span> <span class="keyword">:alpha-guard</span> <span class="keyword">:beta-guard</span>)))
  ///
  (more-returns (thm-keywords <a class="sym-link system" href="../../../axioms.html#def-no-duplicatesp-equal" data-sym="NO-DUPLICATESP-EQUAL">no-duplicatesp-equal</a>
      <span class="keyword">:name</span> no-duplicatesp-equal-of-defmapping-thm-keywords)))</pre>
  </div>

<div class="form-block other" id="form-34" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-thm-names
  (thm-names (name$ symbolp)
    (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (thm-names$ <span class="string">"A @(tsee symbol-symbol-alistp)."</span>)
    state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:thm-names&#39;) input."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"We compute the names of all the theorems to generate,
     and we return them as a complete alist
     from the keywords that identify the theorems
     to the corresponding theorem names.
     The alist has unique keys."</span>)
    (p <span class="string">"If an explicit theorem name is supplied in the @(&#39;:thm-names&#39;) input,
     it is used;
     otherwise, the theorem name is generated as explained in the documentation.
     The theorem names, whether generated or supplied,
     must be valid fresh theorem names.
     They must also be all distinct;
     this is always the case if the theorem names are all generated,
     because the keywords used in their names are all distinct."</span>))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-keyword-value-list$ thm-names
         <span class="string">"The :THM-NAMES input"</span>
         <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
         nil)) (thm-names-alist (keyword-value-list-to-alist thm-names))
      (keys (<a class="sym-link system" href="../../../axioms.html#def-strip-cars" data-sym="STRIP-CARS">strip-cars</a> thm-names-alist))
      (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The list ~x0 of keywords of the :THM-NAMES input"</span>
          keys))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-has-no-duplicates$ keys description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      (thm-keywords (defmapping-thm-keywords beta-of-alpha-thm$
          alpha-of-beta-thm$
          guard-thms$))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-subset$ keys thm-keywords description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> thm-names$) (defmapping-process-thm-names-aux thm-keywords
          thm-names-alist
          name$
          ctx
          state))
      (names (<a class="sym-link system" href="../../../axioms.html#def-strip-cdrs" data-sym="STRIP-CDRS">strip-cdrs</a> thm-names$))
      (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The list ~x0 of theorem names, ~
                          some of which may be supplied ~
                          in the :THM-NAMES input,"</span>
          names))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-has-no-duplicates$ names description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> thm-names$))
  <span class="keyword">:prepwork</span> ((define defmapping-process-thm-names-aux
     ((thm-keywords <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (thm-names-alist symbol-symbol-alistp)
       (name$ symbolp)
       ctx
       state)
     <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp alist state)
     <span class="keyword">:verify-guards</span> nil
     <span class="keyword">:parents</span> nil
     (if (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> thm-keywords)
       (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil)
       (b* ((thm-keyword (car thm-keywords)) (pair (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> thm-keyword thm-names-alist))
           (thm-name (if pair
               (cdr pair)
               (add-suffix-to-fn name$
                 (<a class="sym-link system" href="../../../axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="../../../axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"."</span> (symbol-name thm-keyword)))))
           (description (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The name ~x0 of the ~x1 theorem, ~@2,"</span>
               thm-name
               thm-keyword
               (if pair
                 <span class="string">"supplied in the :THM-NAMES input"</span>
                 <span class="string">"automatically generated"</span>)))
           ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-symbol$ thm-name description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
           ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-symbol-new-event-name$ thm-name description <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> nil))
           ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> alist) (defmapping-process-thm-names-aux (cdr thm-keywords)
               thm-names-alist
               name$
               ctx
               state)))
         (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-acons" data-sym="ACONS">acons</a> thm-keyword thm-name alist)))))))</pre>
  </div>

<div class="form-block other" id="form-35" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-thm-enable
  (thm-enable (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (thm-enable$ keyword-listp) state)
  <span class="keyword">:short</span> <span class="string">"Process the @(&#39;:thm-enable&#39;) input."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"If the processing is successful,
     we return a normalized version of this input,
     namely a list of keywords that specifies which theorems must be enabled,
     among the ones that are generated."</span>))
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> thm-enable <span class="keyword">:all</span>)) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (defmapping-thm-keywords beta-of-alpha-thm$
           alpha-of-beta-thm$
           guard-thms$))) ((when (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> thm-enable <span class="keyword">:all-nonguard</span>)) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-set-difference-eq" data-sym="SET-DIFFERENCE-EQ">set-difference-eq</a> (defmapping-thm-keywords beta-of-alpha-thm$
              alpha-of-beta-thm$
              guard-thms$)
            '(<span class="keyword">:doma-guard</span> <span class="keyword">:domb-guard</span> <span class="keyword">:alpha-guard</span> <span class="keyword">:beta-guard</span>))))
      ((unless (keyword-listp thm-enable)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The :THM-ENABLE input, ~x0, is not ~
                   :ALL, :ALL-NOGUARD, or a list of keywords."</span>
          thm-enable))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-list-has-no-duplicates$ thm-enable
          (<a class="sym-link system" href="../../../axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"The :THM-ENABLE list, ~x0,"</span> thm-enable)
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      (thms (defmapping-thm-keywords beta-of-alpha-thm$
          alpha-of-beta-thm$
          guard-thms$))
      ((unless (<a class="sym-link system" href="../../../axioms.html#def-subsetp-eq" data-sym="SUBSETP-EQ">subsetp-eq</a> thm-enable thms)) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The :THM-ENABLE input, ~x0, is not a subset of ~
                   the keywords ~x1 for the generated theorems."</span>
          thm-enable
          thms)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> thm-enable))
  <span class="keyword">:prepwork</span> ((defrulel returns-lemma
     (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (keyword-listp x)
       (keyword-listp (<a class="sym-link system" href="../../../axioms.html#def-set-difference-equal" data-sym="SET-DIFFERENCE-EQUAL">set-difference-equal</a> x y)))) (defrulel verify-guards-lemma1
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (keyword-listp x) (<a class="sym-link system" href="../../../axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x)))
    (defrulel verify-guards-lemma2
      (<a class="sym-link system" href="../../../axioms.html#def-implies" data-sym="IMPLIES">implies</a> (keyword-listp x) (<a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> x)))))</pre>
  </div>

<div class="form-block other" id="form-36" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-process-inputs
  (name doma
    domb
    alpha
    beta
    beta-of-alpha-thm
    alpha-of-beta-thm
    guard-thms
    unconditional
    thm-names
    thm-enable
    hints
    print
    show-only
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp
    (result <span class="string">"A tuple @(&#39;(doma$
                                    domb$
                                    alpha$
                                    beta$
                                    stobjp
                                    thm-names$
                                    thm-enable$
                                    hints$)&#39;)
                        satisfying
                        @(&#39;(typed-tuplep pseudo-termfnp
                                         pseudo-termfnp
                                         pseudo-termfnp
                                         pseudo-termfnp
                                         booleanp
                                         symbol-symbol-alistp
                                         keyword-listp
                                         symbol-truelist-alistp
                                         result)&#39;)."</span>)
    state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Process all the inputs."</span>
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (defmapping-process-name name ctx state)) ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-boolean$ guard-thms
          <span class="string">"The :GUARD-THMS input"</span>
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> doma$ domb$ alpha$ beta$ <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>)) (defmapping-process-functions doma
          domb
          alpha
          beta
          guard-thms
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-boolean$ beta-of-alpha-thm
          <span class="string">"The :BETA-OF-ALPHA-THM input"</span>
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-boolean$ alpha-of-beta-thm
          <span class="string">"The :ALPHA-OF-BETA-THM input"</span>
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (ensure-value-is-boolean$ unconditional
          <span class="string">"The :UNCONDITIONAL input"</span>
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil))
      ((when (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> unconditional
           (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> beta-of-alpha-thm)
           (<a class="sym-link system" href="../../../axioms.html#def-not" data-sym="NOT">not</a> alpha-of-beta-thm))) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"The :UNCONDITIONAL input cannot be T when ~
                   both :BETA-OF-ALPHA-THM and :ALPHA-OF-BETA-THM are NIL."</span>))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> thm-names$) (defmapping-process-thm-names thm-names
          name
          beta-of-alpha-thm
          alpha-of-beta-thm
          guard-thms
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> thm-enable$) (defmapping-process-thm-enable thm-enable
          beta-of-alpha-thm
          alpha-of-beta-thm
          guard-thms
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> hints$) (evmac-process-input-hints hints ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (evmac-process-input-print print ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (evmac-process-input-show-only show-only ctx state)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> doma$
        domb$
        alpha$
        beta$
        <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>
        thm-names$
        thm-enable$
        hints$))))</pre>
  </div>

<div class="form-block other" id="form-37" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(evmac-topic-event-generation defmapping
  <span class="keyword">:some-local-nonlocal-p</span> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-38" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-var-a1...an
  ((alpha$ pseudo-termfnp) (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (a1...an <span class="string">"A @(tsee symbol-listp)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Generate the list of variables @(&#39;(a1 ... an)&#39;)
          described in the documentation."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"We use the formal parameters of the conversion @($\alpha$)."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp alpha$) (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> alpha$ wrld))
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> alpha$))))</pre>
  </div>

<div class="form-block other" id="form-39" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-var-b1...bm
  ((beta$ pseudo-termfnp) (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (b1...bm <span class="string">"A @(tsee symbol-listp)."</span>)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Generate the list of variables @(&#39;(b1 ... bm)&#39;)
          described in the documentation."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"We use the formal parameters of the conversion @($\beta$)."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp beta$) (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> beta$ wrld))
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> beta$))))</pre>
  </div>

<div class="form-block other" id="form-40" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-differentiate-a/b-vars
  ((a1/b1...an/bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>) (b1/a1...bm/an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>))
  <span class="keyword">:returns</span> (a1/b1...an/bm-differentiated <span class="string">"A @(tsee symbol-listp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Ensure that the variables
          @(&#39;a1&#39;), ..., @(&#39;an&#39;) or @(&#39;b1&#39;), ..., @(&#39;bm&#39;)
          do not overlap with
          @(&#39;b1&#39;), ..., @(&#39;bm&#39;) or @(&#39;a1&#39;), ..., @(&#39;an&#39;)."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"In the formula of the @(&#39;:alpha-of-beta&#39;) applicability condition,
     in certain cases @(&#39;a1&#39;), ..., @(&#39;an&#39;) are bound by @(tsee mv-let),
     and @(&#39;b1&#39;), ..., @(&#39;bm&#39;) are used in the body of the @(tsee mv-let):
     if any @(&#39;bj&#39;) were identical to any @(&#39;ai&#39;),
     the formula would be incorrect in general.
     A similar situation occurs
     with the @(&#39;:beta-of-alpha&#39;) applicability condition,
     with the roles of @(&#39;a1&#39;), ..., @(&#39;an&#39;) and @(&#39;b1&#39;), ..., @(&#39;bm&#39;) swapped.
     Thus, in these cases we may need to differentiate
     @(&#39;a1&#39;), ..., @(&#39;an&#39;) apart from @(&#39;b1&#39;), ..., @(&#39;bm&#39;) or vice versa.
     We do that here, using @(tsee genvar)."</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> a1/b1...an/bm) nil)
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (b* ((a2/b2...an/bm-differentiated (defmapping-differentiate-a/b-vars (cdr a1/b1...an/bm)
             b1/a1...bm/an)) (a1/b1 (car a1/b1...an/bm))
          (a1/b1-differentiated (<a class="sym-link system" href="../../../basis-b.html#def-genvar" data-sym="GENVAR">genvar</a> a1/b1
              (symbol-name a1/b1)
              nil
              (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> b1/a1...bm/an a2/b2...an/bm-differentiated))))
        (cons a1/b1-differentiated a2/b2...an/bm-differentiated)))))</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-var-aa/bb
  ((a1/b1...an/bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>))
  <span class="keyword">:returns</span> (aa1/bb1...aan/bbm <span class="string">"A @(tsee symbol-listp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the list of variables
          @(&#39;(aa1 ... aan)&#39;) or @(&#39;(bb1 ... bbm)&#39;)
          described in the documentation."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"We generate these by appending @(&#39;$&#39;) to each of
    @(&#39;(a1 ... an)&#39;) or @(&#39;(b1 ... bm)&#39;),
    using @(tsee genvar) to ensure that we do not introduce clashes."</span>)
  (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> a1/b1...an/bm) nil)
    (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (b* ((aa2/bb2...aan/bbm (defmapping-gen-var-aa/bb (cdr a1/b1...an/bm))) (a1/b1 (car a1/b1...an/bm))
          (aa1/bb1 (<a class="sym-link system" href="../../../basis-b.html#def-genvar" data-sym="GENVAR">genvar</a> a1/b1
              (cat (symbol-name a1/b1) <span class="string">"$"</span>)
              nil
              (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> a1/b1...an/bm aa2/bb2...aan/bbm))))
        (cons aa1/bb1 aa2/bb2...aan/bbm)))))</pre>
  </div>

<div class="form-block other" id="form-42" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-appconds
  ((doma$ pseudo-termfnp) (domb$ pseudo-termfnp)
    (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (a1...an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (b1...bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    state)
  <span class="keyword">:returns</span> (appconds <span class="string">"A @(tsee evmac-appcond-listp)."</span>)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the applicability conditions."</span>
  (b* ((wrld (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state)) (n (<a class="sym-link system" href="../../../basis-b.html#def-arity" data-sym="ARITY">arity</a> doma$ wrld))
      (m (<a class="sym-link system" href="../../../basis-b.html#def-arity" data-sym="ARITY">arity</a> domb$ wrld)))
    (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (make-evmac-appcond? <span class="keyword">:alpha-image</span> (b* ((antecedent (apply-term doma$ a1...an)) (consequent (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                (apply-term* domb$ (apply-term alpha$ a1...an))
                (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                  b1...bm
                  <span class="keyword">:all</span> (apply-term alpha$ a1...an)
                  (apply-term domb$ b1...bm)))))
          (implicate antecedent consequent)))
      (make-evmac-appcond? <span class="keyword">:beta-image</span> (b* ((antecedent (apply-term domb$ b1...bm)) (consequent (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> n <span class="number">1</span>)
                (apply-term* doma$ (apply-term beta$ b1...bm))
                (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                  a1...an
                  <span class="keyword">:all</span> (apply-term beta$ b1...bm)
                  (apply-term doma$ a1...an)))))
          (implicate antecedent consequent)))
      (make-evmac-appcond? <span class="keyword">:beta-of-alpha</span> (b* ((antecedent (if unconditional$
               <a class="sym-link system" href="../../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>
               (apply-term doma$ a1...an))) (consequent (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> n <span class="number">1</span>)
                (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                  (b* ((a (car a1...an)))
                    `(equal ,(APPLY-TERM* BETA$ (APPLY-TERM* ALPHA$ A)) ,A))
                  (b* ((b1...bm (defmapping-differentiate-a/b-vars b1...bm a1...an)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      b1...bm
                      <span class="keyword">:all</span> (apply-term* alpha$ (car a1...an))
                      `(equal ,(APPLY-TERM BETA$ B1...BM) ,(CAR A1...AN)))))
                (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                  (b* ((aa1...aan (defmapping-gen-var-aa/bb a1...an)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      aa1...aan
                      <span class="keyword">:all</span> (apply-term* beta$ (apply-term alpha$ a1...an))
                      (conjoin-equalities aa1...aan a1...an)))
                  (b* ((aa1...aan (defmapping-gen-var-aa/bb a1...an)) (b1...bm (defmapping-differentiate-a/b-vars b1...bm a1...an)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      b1...bm
                      <span class="keyword">:all</span> (apply-term alpha$ a1...an)
                      (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                        aa1...aan
                        <span class="keyword">:all</span> (apply-term beta$ b1...bm)
                        (conjoin-equalities aa1...aan a1...an))))))))
          (implicate antecedent consequent))
        <span class="keyword">:when</span> beta-of-alpha-thm$)
      (make-evmac-appcond? <span class="keyword">:alpha-of-beta</span> (b* ((antecedent (if unconditional$
               <a class="sym-link system" href="../../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>
               (apply-term domb$ b1...bm))) (consequent (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> n <span class="number">1</span>)
                (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                  (b* ((b (car b1...bm)))
                    `(equal ,(APPLY-TERM* ALPHA$ (APPLY-TERM* BETA$ B)) ,B))
                  (b* ((bb1...bbm (defmapping-gen-var-aa/bb b1...bm)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      bb1...bbm
                      <span class="keyword">:all</span> (apply-term* alpha$ (apply-term beta$ b1...bm))
                      (conjoin-equalities bb1...bbm b1...bm))))
                (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                  (b* ((b (car b1...bm)) (a1...an (defmapping-differentiate-a/b-vars a1...an b1...bm)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      a1...an
                      <span class="keyword">:all</span> (apply-term* beta$ b)
                      `(equal ,(APPLY-TERM ALPHA$ A1...AN) ,B)))
                  (b* ((bb1...bbm (defmapping-gen-var-aa/bb b1...bm)) (a1...an (defmapping-differentiate-a/b-vars a1...an b1...bm)))
                    (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                      a1...an
                      <span class="keyword">:all</span> (apply-term beta$ b1...bm)
                      (make-mv-let-call '<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a>
                        bb1...bbm
                        <span class="keyword">:all</span> (apply-term alpha$ a1...an)
                        (conjoin-equalities bb1...bbm b1...bm))))))))
          (implicate antecedent consequent))
        <span class="keyword">:when</span> alpha-of-beta-thm$)
      (make-evmac-appcond? <span class="keyword">:doma-guard</span> (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp doma$) (uguard doma$ wrld))
          (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (term-guard-obligation (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> doma$) <span class="keyword">:limited</span> state)))
        <span class="keyword">:when</span> guard-thms$)
      (make-evmac-appcond? <span class="keyword">:domb-guard</span> (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp domb$) (uguard domb$ wrld))
          (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (term-guard-obligation (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> domb$) <span class="keyword">:limited</span> state)))
        <span class="keyword">:when</span> guard-thms$)
      (make-evmac-appcond? <span class="keyword">:alpha-guard</span> (b* ((alpha-formals (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp alpha$) (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> alpha$ wrld))
               (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> alpha$)))) (alpha-guard (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp alpha$) (uguard alpha$ wrld))
                (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (term-guard-obligation (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> alpha$) <span class="keyword">:limited</span> state)))))
          (implicate (apply-term doma$ a1...an)
            (<a class="sym-link system" href="../../../basis-b.html#def-subcor-var" data-sym="SUBCOR-VAR">subcor-var</a> alpha-formals a1...an alpha-guard)))
        <span class="keyword">:when</span> guard-thms$)
      (make-evmac-appcond? <span class="keyword">:beta-guard</span> (b* ((beta-formals (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp beta$) (<a class="sym-link system" href="../../../basis-b.html#def-formals" data-sym="FORMALS">formals</a> beta$ wrld))
               (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="../../../basis-b.html#def-lambda-formals" data-sym="LAMBDA-FORMALS">lambda-formals</a> beta$)))) (beta-guard (<a class="sym-link system" href="../../../axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp beta$) (uguard beta$ wrld))
                (<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> (term-guard-obligation (<a class="sym-link system" href="../../../basis-b.html#def-lambda-body" data-sym="LAMBDA-BODY">lambda-body</a> beta$) <span class="keyword">:limited</span> state)))))
          (implicate (apply-term domb$ b1...bm)
            (<a class="sym-link system" href="../../../basis-b.html#def-subcor-var" data-sym="SUBCOR-VAR">subcor-var</a> beta-formals b1...bm beta-guard)))
        <span class="keyword">:when</span> guard-thms$))))</pre>
  </div>

<div class="form-block other" id="form-43" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-appcond-thm
  ((appcond evmac-appcondp) (appcond-thm-names symbol-symbol-alistp)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (exported-event <span class="string">"A @(tsee pseudo-event-formp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate a theorem event from an applicability condition."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"All the applicability conditions
     that must hold for the @(tsee defmapping) call
     are turned into theorems exported from the @(tsee encapsulate).
     To keep the ACL2 history ``clean&#39;&#39;,
     we generate the theorem in local form with a @(&#39;:by&#39;) hint
     (the references the local theorem name of the applicability condition;
     this name generally differs from
     the theorem name determined by @(&#39;:thm-names&#39;)),
     and in non-local, redundant form without hints."</span>))
  (b* (((evmac-appcond appcond) appcond) (thm-name (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> appcond.name thm-names$)))
      (thm-formula (untranslate appcond.formula <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> wrld))
      (thm-hints `((<span class="string">"Goal"</span> <span class="keyword">:by</span> ,(CDR (ASSOC-EQ APPCOND.NAME APPCOND-THM-NAMES)))))
      (defthmr/defthmdr (if (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> appcond.name thm-enable$)
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmr" data-sym="DEFTHMR">defthmr</a>
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmdr" data-sym="DEFTHMDR">defthmdr</a>))
      (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (,DEFTHMR/DEFTHMDR ,THM-NAME ,THM-FORMULA <span class="keyword">:hints</span> ,THM-HINTS)))
      (exported-event `(,DEFTHMR/DEFTHMDR ,THM-NAME ,THM-FORMULA)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event)))</pre>
  </div>

<div class="form-block other" id="form-44" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-appcond-thms
  ((appconds evmac-appcond-listp) (appcond-thm-names symbol-symbol-alistp)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>)
    (exported-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Lift @(tsee defmapping-gen-appcond-thm) to
          lists of applicability conditions."</span>
  (b* (((when (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> appconds)) (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event) (defmapping-gen-appcond-thm (car appconds)
          appcond-thm-names
          thm-names$
          thm-enable$
          wrld))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-events exported-events) (defmapping-gen-appcond-thms (cdr appconds)
          appcond-thm-names
          thm-names$
          thm-enable$
          wrld)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (cons local-event local-events)
      (cons exported-event exported-events))))</pre>
  </div>

<div class="form-block other" id="form-45" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-alpha-injective
  ((doma$ pseudo-termfnp) (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (a1...an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (b1...bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (appcond-thm-names symbol-symbol-alistp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (exported-event <span class="string">"A @(tsee pseudo-event-formp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the @(&#39;:alpha-injective&#39;) theorem."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This function is called if only if
     the @(&#39;:beta-of-alpha-thm&#39;) input is @(&#39;t&#39;)."</span>)
    (p <span class="string">"We generate hints based on the proofs in the design notes.
     The @(&#39;:cases&#39;) hints correspond, in the proof in the design notes,
     to the inference step that applies @($\beta$)
     to both sides of the equality @($\alpha(a)=\alpha(a&#39;)$).
     The hints for these proofs are the same
     whether @(&#39;:unconditional&#39;) is @(&#39;t&#39;) or @(&#39;nil&#39;)."</span>))
  (b* ((aa1...aan (defmapping-gen-var-aa/bb a1...an)) (name (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-injective</span> thm-names$)))
      (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (b* ((antecedent (if unconditional$
               <a class="sym-link system" href="../../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>
               (<a class="sym-link system" href="../../../axioms.html#def-conjoin2" data-sym="CONJOIN2">conjoin2</a> (apply-term doma$ a1...an)
                 (apply-term doma$ aa1...aan)))) (consequent `(equal (equal ,(APPLY-TERM ALPHA$ A1...AN)
                  ,(APPLY-TERM ALPHA$ AA1...AAN))
                ,(CONJOIN-EQUALITIES A1...AN AA1...AAN)))
            (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (implicate antecedent consequent)))
          (untranslate <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> wrld)))
      (hints (b* ((beta-of-alpha (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-of-alpha</span> appcond-thm-names))) (beta-of-alpha-instance `(<span class="keyword">:instance</span> ,BETA-OF-ALPHA
                ,@(ALIST-TO-DOUBLETS (PAIRLIS$ A1...AN AA1...AAN))))
            (m (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> b1...bm))
            (cases-hints-formula (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> m <span class="number">1</span>)
                `(equal ,(APPLY-TERM* BETA$ (APPLY-TERM ALPHA$ A1...AN))
                  ,(APPLY-TERM* BETA$ (APPLY-TERM ALPHA$ AA1...AAN)))
                `(equal ,(APPLY-TERM BETA$ (MAKE-MV-NTH-CALLS (APPLY-TERM ALPHA$ A1...AN) M))
                  ,(APPLY-TERM BETA$ (MAKE-MV-NTH-CALLS (APPLY-TERM ALPHA$ AA1...AAN) M))))))
          `((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> nil
             <span class="keyword">:cases</span> (,CASES-HINTS-FORMULA)
             <span class="keyword">:use</span> (,BETA-OF-ALPHA ,BETA-OF-ALPHA-INSTANCE)))))
      (defthmr/defthmdr (if (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> <span class="keyword">:alpha-injective</span> thm-enable$)
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmr" data-sym="DEFTHMR">defthmr</a>
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmdr" data-sym="DEFTHMDR">defthmdr</a>))
      (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (,DEFTHMR/DEFTHMDR ,NAME ,FORMULA <span class="keyword">:hints</span> ,HINTS)))
      (exported-event `(,DEFTHMR/DEFTHMDR ,NAME ,FORMULA)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event)))</pre>
  </div>

<div class="form-block other" id="form-46" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-beta-injective
  ((domb$ pseudo-termfnp) (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (a1...an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (b1...bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (appcond-thm-names symbol-symbol-alistp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-event <span class="string">"A @(tsee pseudo-event-formp)."</span>)
    (exported-event <span class="string">"A @(tsee pseudo-event-formp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the @(&#39;:beta-injective&#39;) theorem."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This function is called if only if
     the @(&#39;:alpha-of-beta-thm&#39;) input is @(&#39;t&#39;)."</span>)
    (p <span class="string">"We generate hints based on the proofs in the design notes.
     The @(&#39;:cases&#39;) hints correspond, in the proof in the design notes,
     to the inference step that applies @($\alpha$)
     to both sides of the equality @($\beta(b)=\beta(b&#39;)$).
     The hints for these proofs are the same
     whether @(&#39;:unconditional&#39;) is @(&#39;t&#39;) or @(&#39;nil&#39;)."</span>))
  (b* ((bb1...bbm (defmapping-gen-var-aa/bb b1...bm)) (name (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-injective</span> thm-names$)))
      (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (b* ((antecedent (if unconditional$
               <a class="sym-link system" href="../../../axioms.html#def-_2At_2A" data-sym="*T*">*t*</a>
               (<a class="sym-link system" href="../../../axioms.html#def-conjoin2" data-sym="CONJOIN2">conjoin2</a> (apply-term domb$ b1...bm)
                 (apply-term domb$ bb1...bbm)))) (consequent `(equal (equal ,(APPLY-TERM BETA$ B1...BM)
                  ,(APPLY-TERM BETA$ BB1...BBM))
                ,(CONJOIN-EQUALITIES B1...BM BB1...BBM)))
            (<a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> (implicate antecedent consequent)))
          (untranslate <a class="sym-link system" href="../../../history-management.html#def-formula" data-sym="FORMULA">formula</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a> wrld)))
      (hints (b* ((alpha-of-beta (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-of-beta</span> appcond-thm-names))) (alpha-of-beta-instance `(<span class="keyword">:instance</span> ,ALPHA-OF-BETA
                ,@(ALIST-TO-DOUBLETS (PAIRLIS$ B1...BM BB1...BBM))))
            (n (<a class="sym-link system" href="../../../axioms.html#def-len" data-sym="LEN">len</a> a1...an))
            (cases-hints-formula (if (<a class="sym-link system" href="../../../axioms.html#def-_3D" data-sym="=">=</a> n <span class="number">1</span>)
                `(equal ,(APPLY-TERM* ALPHA$ (APPLY-TERM BETA$ B1...BM))
                  ,(APPLY-TERM* ALPHA$ (APPLY-TERM BETA$ BB1...BBM)))
                `(equal ,(APPLY-TERM ALPHA$ (MAKE-MV-NTH-CALLS (APPLY-TERM BETA$ B1...BM) N))
                  ,(APPLY-TERM ALPHA$ (MAKE-MV-NTH-CALLS (APPLY-TERM BETA$ BB1...BBM) N))))))
          `((<span class="string">"Goal"</span> <span class="keyword">:in-theory</span> nil
             <span class="keyword">:cases</span> (,CASES-HINTS-FORMULA)
             <span class="keyword">:use</span> (,ALPHA-OF-BETA ,ALPHA-OF-BETA-INSTANCE)))))
      (defthmr/defthmdr (if (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> <span class="keyword">:beta-injective</span> thm-enable$)
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmr" data-sym="DEFTHMR">defthmr</a>
          '<a class="sym-link external" href="../../kestrel/utilities/defthmr.html#def-defthmdr" data-sym="DEFTHMDR">defthmdr</a>))
      (local-event `(<a class="sym-link system" href="../../../axioms.html#def-local" data-sym="LOCAL">local</a> (,DEFTHMR/DEFTHMDR ,NAME ,FORMULA <span class="keyword">:hints</span> ,HINTS)))
      (exported-event `(,DEFTHMR/DEFTHMDR ,NAME ,FORMULA)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event)))</pre>
  </div>

<div class="form-block other" id="form-47" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-nonappcond-thms
  ((doma$ pseudo-termfnp) (domb$ pseudo-termfnp)
    (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (a1...an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (b1...bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (appcond-thm-names symbol-symbol-alistp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>)
    (exported-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate the theorems that are not applicability conditions."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"These can be no, one, or two injectivity theorems,
     based on the @(&#39;:beta-of-alpha-thm&#39;) and @(&#39;:alpha-of-beta-thm&#39;) inputs."</span>))
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> alpha-inj-local-event-singleton-list-or-nil
        alpha-inj-exported-event-singleton-list-or-nil) (if beta-of-alpha-thm$
         (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event) (defmapping-gen-alpha-injective doma$
                alpha$
                beta$
                a1...an
                b1...bm
                unconditional$
                thm-names$
                thm-enable$
                appcond-thm-names
                wrld)))
           (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> local-event) (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> exported-event)))
         (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil))) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> beta-inj-local-event-singleton-list-or-nil
         beta-inj-exported-event-singleton-list-or-nil) (if alpha-of-beta-thm$
          (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-event exported-event) (defmapping-gen-beta-injective domb$
                 alpha$
                 beta$
                 a1...an
                 b1...bm
                 unconditional$
                 thm-names$
                 thm-enable$
                 appcond-thm-names
                 wrld)))
            (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> local-event) (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> exported-event)))
          (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nil nil))))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> alpha-inj-local-event-singleton-list-or-nil
        beta-inj-local-event-singleton-list-or-nil)
      (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> alpha-inj-exported-event-singleton-list-or-nil
        beta-inj-exported-event-singleton-list-or-nil))))</pre>
  </div>

<div class="form-block other" id="form-48" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-thms
  ((doma$ pseudo-termfnp) (domb$ pseudo-termfnp)
    (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (a1...an <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (b1...bm <a class="sym-link system" href="../../../axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a>)
    (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (appconds evmac-appcond-listp)
    (appcond-thm-names symbol-symbol-alistp)
    (wrld <a class="sym-link system" href="../../../axioms.html#def-plist-worldp" data-sym="PLIST-WORLDP">plist-worldp</a>))
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (local-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>)
    (exported-events <span class="string">"A @(tsee pseudo-event-form-listp)."</span>))
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Generate all the theorems."</span>
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> appcond-local-events appcond-exported-events) (defmapping-gen-appcond-thms appconds
         appcond-thm-names
         thm-names$
         thm-enable$
         wrld)) ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> nonappcond-local-events nonappcond-exporte-events) (defmapping-gen-nonappcond-thms doma$
          domb$
          alpha$
          beta$
          a1...an
          b1...bm
          beta-of-alpha-thm$
          alpha-of-beta-thm$
          unconditional$
          thm-names$
          thm-enable$
          appcond-thm-names
          wrld)))
    (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> appcond-local-events nonappcond-local-events)
      (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> appcond-exported-events nonappcond-exporte-events))))</pre>
  </div>

<div class="form-block other" id="form-49" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-ext-table
  ((name$ symbolp) (doma$ pseudo-termfnp)
    (domb$ pseudo-termfnp)
    (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (<a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a> <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (call$ pseudo-event-formp)
    (expansion pseudo-event-formp))
  <span class="keyword">:returns</span> (event pseudo-event-formp)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Generate the event that extends the @(tsee defmapping) table."</span>
  (b* ((alpha-image (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-image</span> thm-names$))) (beta-image (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-image</span> thm-names$)))
      (beta-of-alpha (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-of-alpha</span> thm-names$)))
      (alpha-of-beta (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-of-beta</span> thm-names$)))
      (alpha-injective (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-injective</span> thm-names$)))
      (beta-injective (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-injective</span> thm-names$)))
      (doma-guard (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:doma-guard</span> thm-names$)))
      (domb-guard (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:domb-guard</span> thm-names$)))
      (alpha-guard (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:alpha-guard</span> thm-names$)))
      (beta-guard (cdr (<a class="sym-link system" href="../../../axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> <span class="keyword">:beta-guard</span> thm-names$)))
      (info (make-defmapping-info <span class="keyword">:call$</span> call$
          <span class="keyword">:expansion</span> expansion
          <span class="keyword">:doma</span> doma$
          <span class="keyword">:domb</span> domb$
          <span class="keyword">:alpha</span> alpha$
          <span class="keyword">:beta</span> beta$
          <span class="keyword">:stobjp</span> <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>
          <span class="keyword">:alpha-image</span> alpha-image
          <span class="keyword">:beta-image</span> beta-image
          <span class="keyword">:beta-of-alpha</span> beta-of-alpha
          <span class="keyword">:alpha-of-beta</span> alpha-of-beta
          <span class="keyword">:alpha-injective</span> alpha-injective
          <span class="keyword">:beta-injective</span> beta-injective
          <span class="keyword">:doma-guard</span> doma-guard
          <span class="keyword">:domb-guard</span> domb-guard
          <span class="keyword">:alpha-guard</span> alpha-guard
          <span class="keyword">:beta-guard</span> beta-guard
          <span class="keyword">:unconditional</span> unconditional$)))
    `(<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> ,*DEFMAPPING-TABLE-NAME* ',NAME$ ',INFO)))</pre>
  </div>

<div class="form-block other" id="form-50" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-print-result
  ((thms pseudo-event-form-listp))
  <span class="keyword">:returns</span> (cw-events pseudo-event-form-listp)
  <span class="keyword">:short</span> <span class="string">"Generate the events that print the result."</span>
  <span class="keyword">:long</span> (topstring-p <span class="string">"This refers to the @(&#39;:result&#39;) value of the @(&#39;:print&#39;) input.
    The result to print consists of the generated theorems.
    These theorems are printed only if
    @(&#39;:print&#39;) is @(&#39;:result&#39;) or @(&#39;:info&#39;) or @(&#39;:all&#39;)."</span>)
  (if (<a class="sym-link system" href="../../../axioms.html#def-endp" data-sym="ENDP">endp</a> thms)
    nil
    (cons `(cw-event <span class="string">"~x0~|"</span> ',(CAR THMS))
      (defmapping-gen-print-result (cdr thms)))))</pre>
  </div>

<div class="form-block other" id="form-51" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-gen-everything
  ((name$ symbolp) (doma$ pseudo-termfnp)
    (domb$ pseudo-termfnp)
    (alpha$ pseudo-termfnp)
    (beta$ pseudo-termfnp)
    (<a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a> <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (beta-of-alpha-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (alpha-of-beta-thm$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (guard-thms$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (unconditional$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (thm-names$ symbol-symbol-alistp)
    (thm-enable$ keyword-listp)
    (hints$ symbol-truelist-alistp)
    (print$ evmac-input-print-p)
    (show-only$ <a class="sym-link system" href="../../../axioms.html#def-booleanp" data-sym="BOOLEANP">booleanp</a>)
    (call pseudo-event-formp)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (event <span class="string">"A @(tsee pseudo-event-formp)."</span>) state)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:short</span> <span class="string">"Generate the top-level event."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"This is a @(tsee progn) that consists of
     the expansion of @(tsee defmapping) (the @(tsee encapsulate)),
     followed by an event to extend the @(tsee defmapping) table,
     optionally followed by events to print the generated theorems.
     The @(tsee progn) ends with @(&#39;:invisible&#39;)
     to avoid printing a return value."</span>)
    (p <span class="string">"The expansion starts with an implicitly local event to
     ensure logic mode.
     After the events to proof
     Other implicitly local event forms remove any default and override hints,
     to prevent such hints from sabotaging the generated proofs
     for the theorems that are not applicability conditions;
     this removal is done after proving the applicability conditions,
     in case their proofs rely on the default or override hints.
     We also add an explicitly local event to prevent @(tsee mv-nth)
     from being expanded in the generated proofs,
     which is accomplished via a system attachment."</span>)
    (p <span class="string">"If @(&#39;:print&#39;) is @(&#39;:all&#39;),
     the expansion is wrapped to show ACL2&#39;s output
     in response to the submitted events.
     If @(&#39;:print&#39;) is @(&#39;:info&#39;) or @(&#39;:all&#39;),
     a blank line is printed just before the result, for visual separation;
     if @(&#39;:print&#39;) is @(&#39;:result&#39;),
     the blank line is not printed."</span>)
    (p <span class="string">"If @(&#39;:show-only&#39;) is @(&#39;t&#39;),
     the expansion is printed on the screen
     and not returned as part of the event to submit,
     which is in this case is just an @(&#39;:invisible&#39;) form.
     In this case, if @(&#39;:print&#39;) is @(&#39;:info&#39;) or @(&#39;:all&#39;),
     a blank line is printed just before the @(tsee encapsulate),
     for visual separation."</span>))
  (b* ((wrld (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state)) (a1...an (defmapping-gen-var-a1...an alpha$ wrld))
      (b1...bm (defmapping-gen-var-b1...bm beta$ wrld))
      (appconds (defmapping-gen-appconds doma$
          domb$
          alpha$
          beta$
          a1...an
          b1...bm
          beta-of-alpha-thm$
          alpha-of-beta-thm$
          guard-thms$
          unconditional$
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> appcond-events appcond-thm-names &amp;)) (evmac-appcond-theorems-no-extra-hints appconds
          hints$
          nil
          print$
          ctx
          state))
      ((<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> local-thm-events exported-thm-events) (defmapping-gen-thms doma$
          domb$
          alpha$
          beta$
          a1...an
          b1...bm
          beta-of-alpha-thm$
          alpha-of-beta-thm$
          unconditional$
          thm-names$
          thm-enable$
          appconds
          appcond-thm-names
          wrld))
      (expansion `(<a class="sym-link system" href="../../../axioms.html#def-encapsulate" data-sym="ENCAPSULATE">encapsulate</a> nil
          (<a class="sym-link system" href="../../../axioms.html#def-logic" data-sym="LOGIC">logic</a>)
          (<a class="sym-link system" href="../../../axioms.html#def-set-ignore-ok" data-sym="SET-IGNORE-OK">set-ignore-ok</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
          ,@APPCOND-EVENTS
          (evmac-prepare-proofs)
          ,@LOCAL-THM-EVENTS
          ,@EXPORTED-THM-EVENTS))
      ((when show-only$) (if (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> print$ '(<span class="keyword">:info</span> <span class="keyword">:all</span>))
          (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~%~x0~|"</span> expansion)
          (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~x0~|"</span> expansion))
        (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> '(<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>)))
      (expansion+ (restore-output? (<a class="sym-link system" href="../../../axioms.html#def-eq" data-sym="EQ">eq</a> print$ <span class="keyword">:all</span>) expansion))
      (call$ (defmapping-filter-call call))
      (extend-table (defmapping-gen-ext-table name$
          doma$
          domb$
          alpha$
          beta$
          <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>
          unconditional$
          thm-names$
          call$
          expansion))
      (print-result (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> print$ '(<span class="keyword">:result</span> <span class="keyword">:info</span> <span class="keyword">:all</span>))
          (<a class="sym-link system" href="../../../axioms.html#def-append" data-sym="APPEND">append</a> (<a class="sym-link system" href="../../../axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="../../../axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> print$ '(<span class="keyword">:info</span> <span class="keyword">:all</span>)) '((cw-event <span class="string">"~%"</span>)))
            (defmapping-gen-print-result exported-thm-events)))))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> `(<a class="sym-link system" href="../../../axioms.html#def-progn" data-sym="PROGN">progn</a> ,EXPANSION+
        ,EXTEND-TABLE
        ,@PRINT-RESULT
        (<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>)))))</pre>
  </div>

<div class="form-block other" id="form-52" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-check-redundancy
  (name print show-only (call pseudo-event-formp) ctx state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (yes/no <span class="string">"A @(tsee booleanp)."</span>) state)
  <span class="keyword">:verify-guards</span> nil
  <span class="keyword">:parents</span> (defmapping-implementation)
  <span class="keyword">:short</span> <span class="string">"Check if a call to @(tsee defmapping) is redundant."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"If the @(tsee defmapping) table has no entry for @(&#39;name&#39;),
     we return @(&#39;nil&#39;): the call is not redundant."</span>)
    (p <span class="string">"If the table has an entry for @(&#39;name&#39;) but the call differs
     (after removing any @(&#39;:print&#39;) and @(&#39;:show-only&#39;)),
     an error occurs."</span>)
    (p <span class="string">"If the call is redundant,
     we know that all the inputs except possibly @(&#39;:print&#39;) and @(&#39;:show-only&#39;)
     are valid
     (because they are the same as the ones of the recorded successful call);
     we validate these two inputs, for better error checking.
     If @(&#39;:show-only&#39;) is @(&#39;t&#39;),
     we print the recorded expansion of the call.
     Unless @(&#39;:print&#39;) is @(&#39;nil&#39;),
     we print a message saying that the call is redundant."</span>))
  (b* ((<a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a> (<a class="sym-link system" href="../../../axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> *defmapping-table-name* (<a class="sym-link system" href="../../../axioms.html#def-w" data-sym="W">w</a> state))) (pair (<a class="sym-link system" href="../../../axioms.html#def-assoc-equal" data-sym="ASSOC-EQUAL">assoc-equal</a> name <a class="sym-link system" href="../../../axioms.html#def-table" data-sym="TABLE">table</a>))
      ((unless pair) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> nil))
      (info (cdr pair))
      (call$ (defmapping-filter-call call))
      ((unless (equal call$ (defmapping-info-&gt;call$ info))) (er-soft+ ctx
          <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>
          nil
          <span class="string">"A different call to DEFMAPPING with name ~x0 ~
                   has already been performed."</span>
          name))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (evmac-process-input-print print ctx state))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> &amp;) (evmac-process-input-show-only show-only ctx state))
      ((run-when show-only) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~x0~|"</span> (defmapping-info-&gt;expansion info)))
      ((run-when print) (<a class="sym-link system" href="../../../axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"~%The call ~x0 is redundant.~%"</span> call)))
    (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> <a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)))</pre>
  </div>

<div class="form-block other" id="form-53" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(define defmapping-fn
  (name doma
    domb
    alpha
    beta
    beta-of-alpha-thm
    alpha-of-beta-thm
    guard-thms
    unconditional
    thm-names
    thm-enable
    hints
    print
    show-only
    (call pseudo-event-formp)
    ctx
    state)
  <span class="keyword">:returns</span> (<a class="sym-link system" href="../../../axioms.html#def-mv" data-sym="MV">mv</a> erp (event <span class="string">"A @(tsee pseudo-event-formp)."</span>) state)
  <span class="keyword">:parents</span> (defmapping-implementation)
  <span class="keyword">:mode</span> <span class="keyword">:program</span> <span class="keyword">:short</span> <span class="string">"Check redundancy,
          process the inputs,
          and generate the event to submit."</span>
  (b* (((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> redundant?) (defmapping-check-redundancy name
         print
         show-only
         call
         ctx
         state)) ((when redundant?) (<a class="sym-link system" href="../../../axioms.html#def-value" data-sym="VALUE">value</a> '(<a class="sym-link system" href="../../../axioms.html#def-value-triple" data-sym="VALUE-TRIPLE">value-triple</a> <span class="keyword">:invisible</span>)))
      ((<a class="sym-link system" href="../../../axioms.html#def-er" data-sym="ER">er</a> (<a class="sym-link system" href="../../../axioms.html#def-list" data-sym="LIST">list</a> doma$
           domb$
           alpha$
           beta$
           <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>
           thm-names$
           thm-enable$
           hints$)) (defmapping-process-inputs name
          doma
          domb
          alpha
          beta
          beta-of-alpha-thm
          alpha-of-beta-thm
          guard-thms
          unconditional
          thm-names
          thm-enable
          hints
          print
          show-only
          ctx
          state)))
    (defmapping-gen-everything name
      doma$
      domb$
      alpha$
      beta$
      <a class="sym-link system" href="../../../basis-a.html#def-stobjp" data-sym="STOBJP">stobjp</a>
      beta-of-alpha-thm
      alpha-of-beta-thm
      guard-thms
      unconditional
      thm-names$
      thm-enable$
      hints$
      print
      show-only
      call
      ctx
      state)))</pre>
  </div>

<div class="form-block other" id="form-54" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defsection defmapping-macro-definition
  <span class="keyword">:parents</span> (defmapping-implementation)
  <span class="keyword">:short</span> <span class="string">"Definition of the @(tsee defmapping) macro."</span>
  <span class="keyword">:long</span> (topstring (p <span class="string">"Submit the event form generated by @(tsee defmapping-fn)."</span>)
    (@def <span class="string">"defmapping"</span>))
  (<a class="sym-link system" href="../../../axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> defmapping
    (&amp;whole call
      name
      doma
      domb
      alpha
      beta
      &amp;key
      (beta-of-alpha-thm 'nil)
      (alpha-of-beta-thm 'nil)
      (guard-thms '<a class="sym-link system" href="../../../axioms.html#def-t" data-sym="T">t</a>)
      (unconditional 'nil)
      (thm-names 'nil)
      (thm-enable 'nil)
      (hints 'nil)
      (print '<span class="keyword">:result</span>)
      (show-only 'nil))
    `(make-event-terse (defmapping-fn ',NAME
        ',DOMA
        ',DOMB
        ',ALPHA
        ',BETA
        ',BETA-OF-ALPHA-THM
        ',ALPHA-OF-BETA-THM
        ',GUARD-THMS
        ',UNCONDITIONAL
        ',THM-NAMES
        ',THM-ENABLE
        ',HINTS
        ',PRINT
        ',SHOW-ONLY
        ',CALL
        (cons 'defmapping ',NAME)
        state)
      <span class="keyword">:suppress-errors</span> ,(NOT PRINT))))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>