<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>serialize-raw - ACL2 Book</title>
  <meta property="name" content="serialize-raw">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">serialize-raw</h1>
    <div class="path"><a href="serialize-raw.lisp" class="source-link">serialize-raw</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *ser-verbose* nil)</pre>
  </div>

<div class="form-block macro" id="def-ser-time_3F" data-defines="SER-TIME?" data-references="TIME,*SER-VERBOSE*,IF,QUASIQUOTE,FORM,DEFMACRO" data-used-by="SER-DECODE-FROM-STREAM,SER-ENCODE-TO-STREAM" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-TIME?">ser-time?</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a>
  (form)
  `(if *ser-verbose*
    (time ,FORM)
    ,FORM))</pre>
  </div>

<div class="form-block macro" id="def-ser-print_3F" data-defines="SER-PRINT?" data-references="T,FORMAT,*SER-VERBOSE*,WHEN,QUASIQUOTE,ARGS,&REST,MSG,DEFMACRO" data-used-by="SER-DECODE-FROM-STREAM,SER-DECODE-AND-LOAD-CONSES,SER-DECODE-AND-LOAD-PACKAGES,SER-ENCODE-PACKAGES,SER-DECODE-AND-LOAD-PACKAGE,SER-ENCODE-PACKAGE,SER-DECODE-AND-LOAD-STRS,SER-ENCODE-STRS,SER-DECODE-AND-LOAD-CHARS,SER-ENCODE-CHARS,SER-DECODE-AND-LOAD-COMPLEXES,SER-ENCODE-COMPLEXES,SER-DECODE-AND-LOAD-RATS,SER-ENCODE-RATS,SER-DECODE-AND-LOAD-NATS,SER-ENCODE-NATS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-PRINT?">ser-print?</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a>
  (<a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> &amp;rest <a class="sym-link system" href="defuns.html#def-args" data-sym="ARGS">args</a>)
  `(when *ser-verbose* (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> ,MSG . ,ARGS)))</pre>
  </div>

<div class="form-block macro" id="def-ser-write-char" data-defines="SER-WRITE-CHAR" data-references="CHARACTER,THE,WRITE-CHAR,QUASIQUOTE,STREAM,X,DEFMACRO" data-used-by="SER-ENCODE-CHARS,SER-ENCODE-STR,SER-WRITE-BYTE" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-WRITE-CHAR">ser-write-char</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-write-char" data-sym="SER-WRITE-CHAR" title="(defmacro ser-write-char (x stream) `(write-char (the character ,x) ,stream))">ser-write-char</a>
  (x stream)
  `(write-char (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> character ,X) ,STREAM))</pre>
  </div>

<div class="form-block macro" id="def-ser-write-byte" data-defines="SER-WRITE-BYTE" data-references="UNSIGNED-BYTE,THE,CODE-CHAR,SER-WRITE-CHAR,QUASIQUOTE,STREAM,X,DEFMACRO" data-used-by="SER-ENCODE-NAT-LARGE,SER-ENCODE-NAT-FIXNUM,SER-ENCODE-MAGIC" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-WRITE-BYTE">ser-write-byte</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a>
  (x stream)
  `(<a class="sym-link local-def" href="#def-ser-write-char" data-sym="SER-WRITE-CHAR" title="(defmacro ser-write-char (x stream) `(write-char (the character ,x) ,stream))">ser-write-char</a> (code-char (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) ,X))
    ,STREAM))</pre>
  </div>

<div class="form-block macro" id="def-ser-read-char" data-defines="SER-READ-CHAR" data-references="READ-CHAR,CHARACTER,THE,QUASIQUOTE,STREAM,DEFMACRO" data-used-by="SER-DECODE-AND-LOAD-CHARS,SER-DECODE-STR,SER-READ-BYTE" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-READ-CHAR">ser-read-char</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-read-char" data-sym="SER-READ-CHAR" title="(defmacro ser-read-char (stream) `(the character (read-char ,stream)))">ser-read-char</a>
  (stream)
  `(<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> character (read-char ,STREAM)))</pre>
  </div>

<div class="form-block macro" id="def-ser-read-byte" data-defines="SER-READ-BYTE" data-references="SER-READ-CHAR,CHAR-CODE,UNSIGNED-BYTE,THE,QUASIQUOTE,STREAM,DEFMACRO" data-used-by="SER-DECODE-NAT,SER-DECODE-NAT-BODY,SER-DECODE-NAT-LARGE,SER-DECODE-MAGIC" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-READ-BYTE">ser-read-byte</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a>
  (stream)
  `(<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> (unsigned-byte <span class="number">8</span>) (char-code (<a class="sym-link local-def" href="#def-ser-read-char" data-sym="SER-READ-CHAR" title="(defmacro ser-read-char (stream) `(the character (read-char ,stream)))">ser-read-char</a> ,STREAM))))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-magic" data-defines="SER-ENCODE-MAGIC" data-references="SER-WRITE-BYTE,STREAM,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-ENCODE-MAGIC" data-part-args="STREAM" data-part-body="STREAM,SER-WRITE-BYTE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-MAGIC">ser-encode-magic</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-magic" data-sym="SER-ENCODE-MAGIC" title="(defun ser-encode-magic (stream)
  (ser-write-byte 172 stream)
  (ser-write-byte 18 stream)
  (ser-write-byte 11 stream)
  (ser-write-byte 201 stream))">ser-encode-magic</a>
  (stream)
  (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> <span class="number">172</span> stream)
  (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> <span class="number">18</span> stream)
  (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> <span class="number">11</span> stream)
  (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> <span class="number">201</span> stream))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-magic" data-defines="SER-DECODE-MAGIC" data-references="ERROR,UNLESS,T,COND,=,AND,VERSION,LET,UNSIGNED-BYTE,TYPE,DECLARE,MAGIC-4,MAGIC-3,MAGIC-2,SER-READ-BYTE,MAGIC-1,LET*,STREAM,DEFUN" data-used-by="SER-DECODE-FROM-STREAM" data-part-name="SER-DECODE-MAGIC" data-part-args="STREAM" data-part-body="ERROR,UNLESS,T,COND,=,AND,VERSION,LET,UNSIGNED-BYTE,TYPE,DECLARE,MAGIC-4,MAGIC-3,MAGIC-2,STREAM,SER-READ-BYTE,MAGIC-1,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-MAGIC">ser-decode-magic</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-magic" data-sym="SER-DECODE-MAGIC" title="(defun ser-decode-magic (stream)
  (let* ((magic-1 (ser-read-byte stream))
         (magic-2 (ser-read-byte stream))
         (magic-3 (ser-read-byte stream))
         (magic-4 (ser-read-byte stream)))
...">ser-decode-magic</a>
  (stream)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((magic-1 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream)) (magic-2 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream))
      (magic-3 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream))
      (magic-4 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream)))
    (declare (type (unsigned-byte <span class="number">8</span>) magic-1 magic-2 magic-3 magic-4))
    (let ((version (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-1 <span class="number">172</span>)
           (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-2 <span class="number">18</span>)
           (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-3 <span class="number">11</span>)
           (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-4 <span class="number">199</span>) <span class="keyword">:v1</span>)
             ((<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-4 <span class="number">200</span>) <span class="keyword">:v2</span>)
             ((<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> magic-4 <span class="number">201</span>) <span class="keyword">:v3</span>)
             (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> nil)))))
      (unless version
        (error <span class="string">"Invalid serialized object, magic number incorrect: ~X ~X ~X ~X"</span>
          magic-1
          magic-2
          magic-3
          magic-4))
      version)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-nat-fixnum" data-defines="SER-ENCODE-NAT-FIXNUM" data-references="ASH,SETQ,LOGAND,THE,LOGIOR,SER-WRITE-BYTE,DO,>=,WHILE,LOOP,FIXNUM,TYPE,DECLARE,STREAM,N,DEFUN" data-used-by="SER-ENCODE-NAT,SER-ENCODE-NAT-LARGE" data-part-name="SER-ENCODE-NAT-FIXNUM" data-part-args="STREAM,N" data-part-declare="N,FIXNUM,TYPE,DECLARE" data-part-body="ASH,SETQ,STREAM,LOGAND,FIXNUM,THE,LOGIOR,SER-WRITE-BYTE,DO,N,>=,WHILE,LOOP" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-NAT-FIXNUM">ser-encode-nat-fixnum</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-nat-fixnum" data-sym="SER-ENCODE-NAT-FIXNUM" title="(defun ser-encode-nat-fixnum (n stream)
  (declare (type fixnum n))
  (loop while (&gt;= n 128)
        do (ser-write-byte (logior (the fixnum (logand n 127)) 128)
                           stream) (setq n (the fixnum (ash n -7))))">ser-encode-nat-fixnum</a>
  (n stream)
  (declare (type fixnum n))
  (loop while
    (<a class="sym-link system" href="axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> n <span class="number">128</span>)
    do
    (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> (<a class="sym-link system" href="axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-logand" data-sym="LOGAND">logand</a> n <span class="number">127</span>)) <span class="number">128</span>)
      stream)
    (setq n (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash n <span class="number">-7</span>))))
  (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> n stream))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-nat-large" data-defines="SER-ENCODE-NAT-LARGE" data-references="SER-ENCODE-NAT-FIXNUM,ASH,SETQ,LOGAND,THE,LOGIOR,SER-WRITE-BYTE,DO,FIXNUM,QUOTE,TYPEP,UNTIL,LOOP,*,INTEGER,TYPE,DECLARE,STREAM,N,DEFUN" data-used-by="SER-ENCODE-NAT" data-part-name="SER-ENCODE-NAT-LARGE" data-part-args="STREAM,N" data-part-declare="N,*,INTEGER,TYPE,DECLARE" data-part-body="ASH,SETQ,STREAM,INTEGER,LOGAND,THE,LOGIOR,SER-WRITE-BYTE,DO,FIXNUM,QUOTE,N,TYPEP,UNTIL,LOOP" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-NAT-LARGE">ser-encode-nat-large</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-nat-large" data-sym="SER-ENCODE-NAT-LARGE" title="(defun ser-encode-nat-large (n stream)
  (declare (type (integer 0 *) n))
  (loop until (typep n &#39;fixnum)
        do (ser-write-byte
            (logior (the fixnum (logand (the integer n) 127)) 128)
...">ser-encode-nat-large</a>
  (n stream)
  (declare (type (integer <span class="number">0</span> <a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>) n))
  (loop until
    (typep n 'fixnum)
    do
    (<a class="sym-link local-def" href="#def-ser-write-byte" data-sym="SER-WRITE-BYTE" title="(defmacro ser-write-byte (x stream)
  `(ser-write-char (code-char (the (unsigned-byte 8) ,x)) ,stream))">ser-write-byte</a> (<a class="sym-link system" href="axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-logand" data-sym="LOGAND">logand</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> integer n) <span class="number">127</span>)) <span class="number">128</span>)
      stream)
    (setq n (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> integer (ash n <span class="number">-7</span>))))
  (<a class="sym-link local-def" href="#def-ser-encode-nat-fixnum" data-sym="SER-ENCODE-NAT-FIXNUM" title="(defun ser-encode-nat-fixnum (n stream)
  (declare (type fixnum n))
  (loop while (&gt;= n 128)
        do (ser-write-byte (logior (the fixnum (logand n 127)) 128)
                           stream) (setq n (the fixnum (ash n -7))))">ser-encode-nat-fixnum</a> n stream))</pre>
  </div>

<div class="form-block macro" id="def-ser-encode-nat" data-defines="SER-ENCODE-NAT" data-references="SER-ENCODE-NAT-LARGE,SER-ENCODE-NAT-FIXNUM,FIXNUM,TYPEP,IF,LET,QUASIQUOTE,ERROR,QUOTE,EQ,WHEN,STREAM,N,DEFMACRO" data-used-by="SER-ENCODE-TO-STREAM,SER-ENCODE-FALS,SER-ENCODE-CONSES,SER-ENCODE-PACKAGES,SER-ENCODE-PACKAGE,SER-ENCODE-STRS,SER-ENCODE-CHARS,SER-ENCODE-COMPLEXES,SER-ENCODE-RATS,SER-ENCODE-NATS,SER-ENCODE-STR,SER-ENCODE-RAT" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-NAT">ser-encode-nat</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a>
  (n stream)
  (when (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> stream 'n)
    (error <span class="string">"~s called with stream = N, which would cause capture!"</span>
      '<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a>))
  `(let ((n ,N))
    (if (typep n 'fixnum)
      (<a class="sym-link local-def" href="#def-ser-encode-nat-fixnum" data-sym="SER-ENCODE-NAT-FIXNUM" title="(defun ser-encode-nat-fixnum (n stream)
  (declare (type fixnum n))
  (loop while (&gt;= n 128)
        do (ser-write-byte (logior (the fixnum (logand n 127)) 128)
                           stream) (setq n (the fixnum (ash n -7))))">ser-encode-nat-fixnum</a> n ,STREAM)
      (<a class="sym-link local-def" href="#def-ser-encode-nat-large" data-sym="SER-ENCODE-NAT-LARGE" title="(defun ser-encode-nat-large (n stream)
  (declare (type (integer 0 *) n))
  (loop until (typep n &#39;fixnum)
        do (ser-write-byte
            (logior (the fixnum (logand (the integer n) 127)) 128)
...">ser-encode-nat-large</a> n ,STREAM))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-nat-large" data-defines="SER-DECODE-NAT-LARGE" data-references="SETF,-,ASH,INCF,DO,>=,WHILE,LOOP,FIXNUM,SER-READ-BYTE,X1,LET,INTEGER,TYPE,DECLARE,STREAM,VALUE,SHIFT,DEFUN" data-used-by="SER-DECODE-NAT-BODY" data-part-name="SER-DECODE-NAT-LARGE" data-part-args="STREAM,VALUE,SHIFT" data-part-declare="SHIFT,VALUE,INTEGER,TYPE,DECLARE" data-part-body="SETF,SHIFT,-,ASH,VALUE,INCF,DO,>=,WHILE,LOOP,FIXNUM,TYPE,DECLARE,STREAM,SER-READ-BYTE,X1,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-NAT-LARGE">ser-decode-nat-large</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-nat-large" data-sym="SER-DECODE-NAT-LARGE" title="(defun ser-decode-nat-large (shift value stream)
  (declare (type integer value shift))
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (loop while (&gt;= x1 128)
...">ser-decode-nat-large</a>
  (shift <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> stream)
  (declare (type integer <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> shift))
  (let ((x1 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream)))
    (declare (type fixnum x1))
    (loop while
      (<a class="sym-link system" href="axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> x1 <span class="number">128</span>)
      do
      (incf <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> (ash (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> x1 <span class="number">128</span>) shift))
      (incf shift <span class="number">7</span>)
      (setf x1 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream)))
    (incf <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> (ash x1 shift))
    <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a>))</pre>
  </div>

<div class="form-block macro" id="def-ser-decode-nat-body" data-defines="SER-DECODE-NAT-BODY" data-references="-,T,ASH,FIXNUM,THE,<,COND,SER-READ-BYTE,X1,SETQ,PROGN,STREAM,VALUE,SER-DECODE-NAT-LARGE,QUASIQUOTE,MOST-POSITIVE-FIXNUM,+,EXPT,>,IF,SHIFT,DEFMACRO" data-used-by="SER-DECODE-NAT" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-NAT-BODY">ser-decode-nat-body</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-decode-nat-body" data-sym="SER-DECODE-NAT-BODY" title="(defmacro ser-decode-nat-body (shift)
  (if (&gt; (expt 2 (+ 7 shift)) most-positive-fixnum)
      `(ser-decode-nat-large ,shift value stream)
      `(progn
        (setq x1 (ser-read-byte stream))
...">ser-decode-nat-body</a>
  (shift)
  (if (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> (expt <span class="number">2</span> (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <span class="number">7</span> shift)) most-positive-fixnum)
    `(<a class="sym-link local-def" href="#def-ser-decode-nat-large" data-sym="SER-DECODE-NAT-LARGE" title="(defun ser-decode-nat-large (shift value stream)
  (declare (type integer value shift))
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (loop while (&gt;= x1 128)
...">ser-decode-nat-large</a> ,SHIFT <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> stream)
    `(<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (setq x1 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream))
      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((&lt; x1 <span class="number">128</span>) (setq x1 (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash x1 ,SHIFT)))
          (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> x1)))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (setq x1 (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> x1 <span class="number">128</span>)))
          (setq x1 (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash x1 ,SHIFT)))
          (setq <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> x1)))
          (<a class="sym-link local-def" href="#def-ser-decode-nat-body" data-sym="SER-DECODE-NAT-BODY" title="(defmacro ser-decode-nat-body (shift)
  (if (&gt; (expt 2 (+ 7 shift)) most-positive-fixnum)
      `(ser-decode-nat-large ,shift value stream)
      `(progn
        (setq x1 (ser-read-byte stream))
...">ser-decode-nat-body</a> ,(+ 7 SHIFT)))))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-nat" data-defines="SER-DECODE-NAT" data-references="SER-DECODE-NAT-BODY,VALUE,-,SETQ,RETURN-FROM,THE,<,WHEN,FIXNUM,TYPE,DECLARE,SER-READ-BYTE,X1,LET,STREAM,DEFUN" data-used-by="SER-DECODE-FROM-STREAM,SER-DECODE-AND-RESTORE-FALS,SER-DECODE-AND-LOAD-CONSES,SER-DECODE-LOOP,SER-DECODE-AND-LOAD-PACKAGES,SER-DECODE-AND-LOAD-PACKAGE,SER-DECODE-AND-LOAD-STRS,SER-DECODE-AND-LOAD-CHARS,SER-DECODE-AND-LOAD-COMPLEXES,SER-DECODE-AND-LOAD-RATS,SER-DECODE-AND-LOAD-NATS,SER-DECODE-STR,SER-DECODE-RAT" data-part-name="SER-DECODE-NAT" data-part-args="STREAM" data-part-body="SER-DECODE-NAT-BODY,VALUE,-,SETQ,SER-DECODE-NAT,RETURN-FROM,THE,<,WHEN,FIXNUM,TYPE,DECLARE,STREAM,SER-READ-BYTE,X1,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-NAT">ser-decode-nat</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a>
  (stream)
  (let ((x1 (<a class="sym-link local-def" href="#def-ser-read-byte" data-sym="SER-READ-BYTE" title="(defmacro ser-read-byte (stream)
  `(the (unsigned-byte 8) (char-code (ser-read-char ,stream))))">ser-read-byte</a> stream)))
    (declare (type fixnum x1))
    (when (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum x1) <span class="number">128</span>)
      (return-from <a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> x1))
    (setq x1 (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> x1 <span class="number">128</span>)))
    (let ((<a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a> x1))
      (declare (type fixnum <a class="sym-link system" href="axioms.html#def-value" data-sym="VALUE">value</a>))
      (<a class="sym-link local-def" href="#def-ser-decode-nat-body" data-sym="SER-DECODE-NAT-BODY" title="(defmacro ser-decode-nat-body (shift)
  (if (&gt; (expt 2 (+ 7 shift)) most-positive-fixnum)
      `(ser-decode-nat-large ,shift value stream)
      `(progn
        (setq x1 (ser-read-byte stream))
...">ser-decode-nat-body</a> <span class="number">7</span>))))</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (inline <a class="sym-link local-def" href="#def-ser-encode-rat" data-sym="SER-ENCODE-RAT" title="(defun ser-encode-rat (x stream)
  (declare (type rational x))
  (ser-encode-nat
   (if (&lt; x 0)
       1
...">ser-encode-rat</a> <a class="sym-link local-def" href="#def-ser-decode-rat" data-sym="SER-DECODE-RAT" title="(defun ser-decode-rat (stream)
  (let* ((sign (ser-decode-nat stream))
         (numerator (ser-decode-nat stream))
         (denominator (ser-decode-nat stream)))
    (declare (type integer sign numerator denominator))
...">ser-decode-rat</a>))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-rat" data-defines="SER-ENCODE-RAT" data-references="DENOMINATOR,NUMERATOR,ABS,<,IF,SER-ENCODE-NAT,RATIONAL,TYPE,DECLARE,STREAM,X,DEFUN" data-used-by="SER-ENCODE-RATS,SER-ENCODE-COMPLEX" data-part-name="SER-ENCODE-RAT" data-part-args="STREAM,X" data-part-declare="X,RATIONAL,TYPE,DECLARE" data-part-body="STREAM,X,<,IF,SER-ENCODE-NAT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-RAT">ser-encode-rat</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-rat" data-sym="SER-ENCODE-RAT" title="(defun ser-encode-rat (x stream)
  (declare (type rational x))
  (ser-encode-nat
   (if (&lt; x 0)
       1
...">ser-encode-rat</a>
  (x stream)
  (declare (type rational x))
  (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (if (&lt; x <span class="number">0</span>)
      <span class="number">1</span>
      <span class="number">0</span>)
    stream)
  (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (abs (numerator x)) stream)
  (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (denominator x) stream))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-rat" data-defines="SER-DECODE-RAT" data-references="/,RATIONAL,THE,WHEN,ERROR,T,-,SETQ,=,COND,INTEGER,TYPE,DECLARE,DENOMINATOR,NUMERATOR,SER-DECODE-NAT,SIGN,LET*,STREAM,DEFUN" data-used-by="SER-DECODE-AND-LOAD-RATS,SER-DECODE-COMPLEX" data-part-name="SER-DECODE-RAT" data-part-args="STREAM" data-part-body="/,RATIONAL,THE,WHEN,ERROR,T,-,SETQ,=,COND,INTEGER,TYPE,DECLARE,DENOMINATOR,NUMERATOR,STREAM,SER-DECODE-NAT,SIGN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-RAT">ser-decode-rat</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-rat" data-sym="SER-DECODE-RAT" title="(defun ser-decode-rat (stream)
  (let* ((sign (ser-decode-nat stream))
         (numerator (ser-decode-nat stream))
         (denominator (ser-decode-nat stream)))
    (declare (type integer sign numerator denominator))
...">ser-decode-rat</a>
  (stream)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((sign (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (numerator (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream))
      (denominator (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
    (declare (type integer sign numerator denominator))
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> sign <span class="number">1</span>) (setq numerator (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> numerator)))
      ((<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> sign <span class="number">0</span>) nil)
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (error <span class="string">"Trying to decode rational, but the sign is invalid."</span>)))
    (when (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> denominator <span class="number">0</span>)
      (error <span class="string">"Trying to decode rational, but the denominator is zero."</span>))
    (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> rational (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> numerator denominator))))</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (inline <a class="sym-link local-def" href="#def-ser-encode-complex" data-sym="SER-ENCODE-COMPLEX" title="(defun ser-encode-complex (x stream)
  (declare (type complex x))
  (ser-encode-rat (realpart x) stream)
  (ser-encode-rat (imagpart x) stream))">ser-encode-complex</a> <a class="sym-link local-def" href="#def-ser-decode-complex" data-sym="SER-DECODE-COMPLEX" title="(defun ser-decode-complex (stream)
  (let* ((realpart (ser-decode-rat stream)) (imagpart (ser-decode-rat stream)))
    (declare (type rational realpart imagpart))
    (when (= imagpart 0)
      (error &quot;Trying to decode complex, but the imagpart is zero.&quot;))">ser-decode-complex</a>))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-complex" data-defines="SER-ENCODE-COMPLEX" data-references="IMAGPART,REALPART,SER-ENCODE-RAT,COMPLEX,TYPE,DECLARE,STREAM,X,DEFUN" data-used-by="SER-ENCODE-COMPLEXES" data-part-name="SER-ENCODE-COMPLEX" data-part-args="STREAM,X" data-part-declare="X,COMPLEX,TYPE,DECLARE" data-part-body="STREAM,X,REALPART,SER-ENCODE-RAT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-COMPLEX">ser-encode-complex</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-complex" data-sym="SER-ENCODE-COMPLEX" title="(defun ser-encode-complex (x stream)
  (declare (type complex x))
  (ser-encode-rat (realpart x) stream)
  (ser-encode-rat (imagpart x) stream))">ser-encode-complex</a>
  (x stream)
  (declare (type complex x))
  (<a class="sym-link local-def" href="#def-ser-encode-rat" data-sym="SER-ENCODE-RAT" title="(defun ser-encode-rat (x stream)
  (declare (type rational x))
  (ser-encode-nat
   (if (&lt; x 0)
       1
...">ser-encode-rat</a> (realpart x) stream)
  (<a class="sym-link local-def" href="#def-ser-encode-rat" data-sym="SER-ENCODE-RAT" title="(defun ser-encode-rat (x stream)
  (declare (type rational x))
  (ser-encode-nat
   (if (&lt; x 0)
       1
...">ser-encode-rat</a> (imagpart x) stream))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-complex" data-defines="SER-DECODE-COMPLEX" data-references="COMPLEX,ERROR,=,WHEN,RATIONAL,TYPE,DECLARE,IMAGPART,SER-DECODE-RAT,REALPART,LET*,STREAM,DEFUN" data-used-by="SER-DECODE-AND-LOAD-COMPLEXES" data-part-name="SER-DECODE-COMPLEX" data-part-args="STREAM" data-part-body="COMPLEX,ERROR,=,WHEN,RATIONAL,TYPE,DECLARE,IMAGPART,STREAM,SER-DECODE-RAT,REALPART,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-COMPLEX">ser-decode-complex</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-complex" data-sym="SER-DECODE-COMPLEX" title="(defun ser-decode-complex (stream)
  (let* ((realpart (ser-decode-rat stream)) (imagpart (ser-decode-rat stream)))
    (declare (type rational realpart imagpart))
    (when (= imagpart 0)
      (error &quot;Trying to decode complex, but the imagpart is zero.&quot;))">ser-decode-complex</a>
  (stream)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((realpart (<a class="sym-link local-def" href="#def-ser-decode-rat" data-sym="SER-DECODE-RAT" title="(defun ser-decode-rat (stream)
  (let* ((sign (ser-decode-nat stream))
         (numerator (ser-decode-nat stream))
         (denominator (ser-decode-nat stream)))
    (declare (type integer sign numerator denominator))
...">ser-decode-rat</a> stream)) (imagpart (<a class="sym-link local-def" href="#def-ser-decode-rat" data-sym="SER-DECODE-RAT" title="(defun ser-decode-rat (stream)
  (let* ((sign (ser-decode-nat stream))
         (numerator (ser-decode-nat stream))
         (denominator (ser-decode-nat stream)))
    (declare (type integer sign numerator denominator))
...">ser-decode-rat</a> stream)))
    (declare (type rational realpart imagpart))
    (when (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> imagpart <span class="number">0</span>)
      (error <span class="string">"Trying to decode complex, but the imagpart is zero."</span>))
    (complex realpart imagpart)))</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (inline <a class="sym-link local-def" href="#def-ser-encode-str" data-sym="SER-ENCODE-STR" title="(defun ser-encode-str (x stream)
  (declare (type string x))
  (let* ((len (length x))
         (normedp (hl-hspace-normedp-wrapper x))
         (header
...">ser-encode-str</a> <a class="sym-link local-def" href="#def-ser-decode-str" data-sym="SER-DECODE-STR" title="(defun ser-decode-str (version hons-mode stream)
  (let* ((header (ser-decode-nat stream))
         (len
          (if (eq version :v3)
              (ash header -1)
...">ser-decode-str</a>))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-str" data-defines="SER-ENCODE-STR" data-references="CHAR,SER-WRITE-CHAR,DO,THE,BELOW,FROM,FIXNUM,N,FOR,LOOP,SER-ENCODE-NAT,IF,ASH,LOGIOR,HEADER,HL-HSPACE-NORMEDP-WRAPPER,NORMEDP,LENGTH,LEN,LET*,STRING,TYPE,DECLARE,STREAM,X,DEFUN" data-used-by="SER-ENCODE-PACKAGE,SER-ENCODE-STRS" data-part-name="SER-ENCODE-STR" data-part-args="STREAM,X" data-part-declare="X,STRING,TYPE,DECLARE" data-part-body="CHAR,SER-WRITE-CHAR,DO,THE,BELOW,FROM,FIXNUM,N,FOR,LOOP,STREAM,SER-ENCODE-NAT,IF,ASH,LOGIOR,HEADER,HL-HSPACE-NORMEDP-WRAPPER,NORMEDP,X,LENGTH,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-STR">ser-encode-str</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-str" data-sym="SER-ENCODE-STR" title="(defun ser-encode-str (x stream)
  (declare (type string x))
  (let* ((len (length x))
         (normedp (hl-hspace-normedp-wrapper x))
         (header
...">ser-encode-str</a>
  (x stream)
  (declare (type <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> x))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)) (normedp (hl-hspace-normedp-wrapper x))
      (<a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a> (<a class="sym-link system" href="axioms.html#def-logior" data-sym="LOGIOR">logior</a> (ash <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> <span class="number">1</span>)
          (if normedp
            <span class="number">1</span>
            <span class="number">0</span>))))
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a> stream)
    (loop for
      n
      fixnum
      from
      <span class="number">0</span>
      below
      (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
      do
      (<a class="sym-link local-def" href="#def-ser-write-char" data-sym="SER-WRITE-CHAR" title="(defmacro ser-write-char (x stream) `(write-char (the character ,x) ,stream))">ser-write-char</a> (<a class="sym-link system" href="axioms.html#def-char" data-sym="CHAR">char</a> x n) stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-str" data-defines="SER-DECODE-STR" data-references="HONS-COPY,SER-READ-CHAR,SCHAR,SETF,DO,BELOW,FROM,I,FOR,LOOP,VECTOR,TYPE,DECLARE,MAKE-STRING,STR,LET,ERROR,ARRAY-DIMENSION-LIMIT,<,FIXNUM,QUOTE,TYPEP,UNLESS,NOT,LOGAND,BIT,THE,=,AND,NORMP,ASH,EQ,IF,LEN,SER-DECODE-NAT,HEADER,LET*,STREAM,HONS-MODE,VERSION,DEFUN" data-used-by="SER-DECODE-AND-LOAD-PACKAGE,SER-DECODE-AND-LOAD-STRS" data-part-name="SER-DECODE-STR" data-part-args="STREAM,HONS-MODE,VERSION" data-part-body="HONS-COPY,SER-READ-CHAR,SCHAR,SETF,DO,BELOW,FROM,I,FOR,LOOP,VECTOR,TYPE,DECLARE,MAKE-STRING,STR,LET,ERROR,ARRAY-DIMENSION-LIMIT,<,FIXNUM,QUOTE,TYPEP,UNLESS,HONS-MODE,NOT,LOGAND,BIT,THE,=,AND,NORMP,ASH,VERSION,EQ,IF,LEN,STREAM,SER-DECODE-NAT,HEADER,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-STR">ser-decode-str</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-str" data-sym="SER-DECODE-STR" title="(defun ser-decode-str (version hons-mode stream)
  (let* ((header (ser-decode-nat stream))
         (len
          (if (eq version :v3)
              (ash header -1)
...">ser-decode-str</a>
  (version hons-mode stream)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>)
          (ash <a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a> <span class="number">-1</span>)
          <a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a>))
      (normp (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>)
          (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> bit (<a class="sym-link system" href="axioms.html#def-logand" data-sym="LOGAND">logand</a> <a class="sym-link system" href="axioms.html#def-header" data-sym="HEADER">header</a> <span class="number">1</span>)) <span class="number">1</span>)
          (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> hons-mode <span class="keyword">:never</span>)))))
    (unless (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (typep <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> 'fixnum)
        (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>) array-dimension-limit))
      (error <span class="string">"Trying to decode a string, but the length is too long."</span>))
    (let ((str (make-string (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>))))
      (declare (type vector str))
      (loop for
        i
        fixnum
        from
        <span class="number">0</span>
        below
        (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
        do
        (setf (schar str i) (<a class="sym-link local-def" href="#def-ser-read-char" data-sym="SER-READ-CHAR" title="(defmacro ser-read-char (stream) `(the character (read-char ,stream)))">ser-read-char</a> stream)))
      (if normp
        (hons-copy str)
        str))))</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defstruct ser-decoder
  (array (make-array <span class="number">0</span>) <span class="keyword">:type</span> simple-vector)
  (free <span class="number">0</span> <span class="keyword">:type</span> fixnum)
  (version nil))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-nats" data-defines="SER-ENCODE-NATS" data-references="ELEM,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,X,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-NATS" data-part-args="STREAM,X" data-part-body="ELEM,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-NATS">ser-encode-nats</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-nats" data-sym="SER-ENCODE-NATS" title="(defun ser-encode-nats (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a naturals.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-nat elem stream))))">ser-encode-nats</a>
  (x stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a naturals.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> elem stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-nats" data-defines="SER-DECODE-AND-LOAD-NATS" data-references="INCF,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-NATS" data-part-args="STREAM,DECODER" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-NATS">ser-decode-and-load-nats</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-nats" data-sym="SER-DECODE-AND-LOAD-NATS" title="(defun ser-decode-and-load-nats (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-nats</a>
  (decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a naturals.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many naturals."</span>))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free) (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-rats" data-defines="SER-ENCODE-RATS" data-references="SER-ENCODE-RAT,ELEM,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,X,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-RATS" data-part-args="STREAM,X" data-part-body="SER-ENCODE-RAT,ELEM,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-RATS">ser-encode-rats</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-rats" data-sym="SER-ENCODE-RATS" title="(defun ser-encode-rats (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a rationals.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-rat elem stream))))">ser-encode-rats</a>
  (x stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a rationals.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-encode-rat" data-sym="SER-ENCODE-RAT" title="(defun ser-encode-rat (x stream)
  (declare (type rational x))
  (ser-encode-nat
   (if (&lt; x 0)
       1
...">ser-encode-rat</a> elem stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-rats" data-defines="SER-DECODE-AND-LOAD-RATS" data-references="INCF,SER-DECODE-RAT,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-RATS" data-part-args="STREAM,DECODER" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,SER-DECODE-RAT,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-RATS">ser-decode-and-load-rats</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-rats" data-sym="SER-DECODE-AND-LOAD-RATS" title="(defun ser-decode-and-load-rats (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-rats</a>
  (decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a rationals.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many rationals."</span>))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free) (<a class="sym-link local-def" href="#def-ser-decode-rat" data-sym="SER-DECODE-RAT" title="(defun ser-decode-rat (stream)
  (let* ((sign (ser-decode-nat stream))
         (numerator (ser-decode-nat stream))
         (denominator (ser-decode-nat stream)))
    (declare (type integer sign numerator denominator))
...">ser-decode-rat</a> stream))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-complexes" data-defines="SER-ENCODE-COMPLEXES" data-references="SER-ENCODE-COMPLEX,ELEM,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,X,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-COMPLEXES" data-part-args="STREAM,X" data-part-body="SER-ENCODE-COMPLEX,ELEM,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-COMPLEXES">ser-encode-complexes</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-complexes" data-sym="SER-ENCODE-COMPLEXES" title="(defun ser-encode-complexes (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a complexes.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-complex elem stream))))">ser-encode-complexes</a>
  (x stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a complexes.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-encode-complex" data-sym="SER-ENCODE-COMPLEX" title="(defun ser-encode-complex (x stream)
  (declare (type complex x))
  (ser-encode-rat (realpart x) stream)
  (ser-encode-rat (imagpart x) stream))">ser-encode-complex</a> elem stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-complexes" data-defines="SER-DECODE-AND-LOAD-COMPLEXES" data-references="INCF,SER-DECODE-COMPLEX,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-COMPLEXES" data-part-args="STREAM,DECODER" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,SER-DECODE-COMPLEX,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-COMPLEXES">ser-decode-and-load-complexes</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-complexes" data-sym="SER-DECODE-AND-LOAD-COMPLEXES" title="(defun ser-decode-and-load-complexes (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-complexes</a>
  (decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a complexes.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many complexes."</span>))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free) (<a class="sym-link local-def" href="#def-ser-decode-complex" data-sym="SER-DECODE-COMPLEX" title="(defun ser-decode-complex (stream)
  (let* ((realpart (ser-decode-rat stream)) (imagpart (ser-decode-rat stream)))
    (declare (type rational realpart imagpart))
    (when (= imagpart 0)
      (error &quot;Trying to decode complex, but the imagpart is zero.&quot;))">ser-decode-complex</a> stream))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-chars" data-defines="SER-ENCODE-CHARS" data-references="SER-WRITE-CHAR,ELEM,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,X,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-CHARS" data-part-args="STREAM,X" data-part-body="SER-WRITE-CHAR,ELEM,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-CHARS">ser-encode-chars</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-chars" data-sym="SER-ENCODE-CHARS" title="(defun ser-encode-chars (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a characters.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-write-char elem stream))))">ser-encode-chars</a>
  (x stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a characters.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-write-char" data-sym="SER-WRITE-CHAR" title="(defmacro ser-write-char (x stream) `(write-char (the character ,x) ,stream))">ser-write-char</a> elem stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-chars" data-defines="SER-DECODE-AND-LOAD-CHARS" data-references="INCF,SER-READ-CHAR,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-CHARS" data-part-args="STREAM,DECODER" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,SER-READ-CHAR,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-CHARS">ser-decode-and-load-chars</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-chars" data-sym="SER-DECODE-AND-LOAD-CHARS" title="(defun ser-decode-and-load-chars (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-chars</a>
  (decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a characters.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many characters."</span>))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free) (<a class="sym-link local-def" href="#def-ser-read-char" data-sym="SER-READ-CHAR" title="(defmacro ser-read-char (stream) `(the character (read-char ,stream)))">ser-read-char</a> stream))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-strs" data-defines="SER-ENCODE-STRS" data-references="SER-ENCODE-STR,ELEM,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,X,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-STRS" data-part-args="STREAM,X" data-part-body="SER-ENCODE-STR,ELEM,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-STRS">ser-encode-strs</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-strs" data-sym="SER-ENCODE-STRS" title="(defun ser-encode-strs (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a strings.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-str elem stream))))">ser-encode-strs</a>
  (x stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a strings.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-encode-str" data-sym="SER-ENCODE-STR" title="(defun ser-encode-str (x stream)
  (declare (type string x))
  (let* ((len (length x))
         (normedp (hl-hspace-normedp-wrapper x))
         (header
...">ser-encode-str</a> elem stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-strs" data-defines="SER-DECODE-AND-LOAD-STRS" data-references="INCF,SER-DECODE-STR,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-VERSION,VERSION,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,HONS-MODE,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-STRS" data-part-args="STREAM,DECODER,HONS-MODE" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,HONS-MODE,SER-DECODE-STR,SVREF,SETF,DO,THE,=,UNTIL,LOOP,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-VERSION,VERSION,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-STRS">ser-decode-and-load-strs</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-strs" data-sym="SER-DECODE-AND-LOAD-STRS" title="(defun ser-decode-and-load-strs (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-strs</a>
  (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (version (ser-decoder-version decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a strings.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many strings."</span>))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free)
        (<a class="sym-link local-def" href="#def-ser-decode-str" data-sym="SER-DECODE-STR" title="(defun ser-decode-str (version hons-mode stream)
  (let* ((header (ser-decode-nat stream))
         (len
          (if (eq version :v3)
              (ash header -1)
...">ser-decode-str</a> version hons-mode stream))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-package" data-defines="SER-ENCODE-PACKAGE" data-references="SYMBOL-NAME,ELEM,DOLIST,SER-ENCODE-NAT,SER-ENCODE-STR,SER-PRINT?,LENGTH,LEN,LET,STRING,TYPE,DECLARE,STREAM,X,PKG,DEFUN" data-used-by="SER-ENCODE-PACKAGES" data-part-name="SER-ENCODE-PACKAGE" data-part-args="STREAM,X,PKG" data-part-declare="PKG,STRING,TYPE,DECLARE" data-part-body="SYMBOL-NAME,ELEM,DOLIST,SER-ENCODE-NAT,STREAM,SER-ENCODE-STR,PKG,SER-PRINT?,X,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-PACKAGE">ser-encode-package</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-package" data-sym="SER-ENCODE-PACKAGE" title="(defun ser-encode-package (pkg x stream)
  (declare (type string pkg))
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a symbols for ~a package.~%&quot; len pkg)
    (ser-encode-str pkg stream)
...">ser-encode-package</a>
  (pkg x stream)
  (declare (type <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> pkg))
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding ~a symbols for ~a package.~%"</span>
      <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>
      pkg)
    (<a class="sym-link local-def" href="#def-ser-encode-str" data-sym="SER-ENCODE-STR" title="(defun ser-encode-str (x stream)
  (declare (type string x))
  (let* ((len (length x))
         (normedp (hl-hspace-normedp-wrapper x))
         (header
...">ser-encode-str</a> pkg stream)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x) stream)
    (dolist (elem x) (<a class="sym-link local-def" href="#def-ser-encode-str" data-sym="SER-ENCODE-STR" title="(defun ser-encode-str (x stream)
  (declare (type string x))
  (let* ((len (length x))
         (normedp (hl-hspace-normedp-wrapper x))
         (header
...">ser-encode-str</a> (symbol-name elem) stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-package" data-defines="SER-DECODE-AND-LOAD-PACKAGE" data-references="INCF,INTERN,*READ-SUPPRESS*,IF,TEMP,LET,SVREF,SETF,DO,THE,=,UNTIL,LOOP,PKG-WITNESS,WHEN,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODE-NAT,LEN,SER-DECODE-STR,PKG-NAME,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODER-VERSION,VERSION,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,CHECK-PACKAGESP,DEFUN" data-used-by="SER-DECODE-AND-LOAD-PACKAGES" data-part-name="SER-DECODE-AND-LOAD-PACKAGE" data-part-args="STREAM,DECODER,CHECK-PACKAGESP" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="INCF,INTERN,*READ-SUPPRESS*,IF,TEMP,LET,SVREF,SETF,DO,THE,=,UNTIL,LOOP,PKG-WITNESS,CHECK-PACKAGESP,WHEN,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODE-NAT,LEN,STREAM,SER-DECODE-STR,PKG-NAME,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,DECODER,SER-DECODER-VERSION,VERSION,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-PACKAGE">ser-decode-and-load-package</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-package" data-sym="SER-DECODE-AND-LOAD-PACKAGE" title="(defun ser-decode-and-load-package (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((version (ser-decoder-version decoder))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-package</a>
  (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((version (ser-decoder-version decoder)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (pkg-name (<a class="sym-link local-def" href="#def-ser-decode-str" data-sym="SER-DECODE-STR" title="(defun ser-decode-str (version hons-mode stream)
  (let* ((header (ser-decode-nat stream))
         (len
          (if (eq version :v3)
              (ash header -1)
...">ser-decode-str</a> version <span class="keyword">:never</span> stream))
      (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a symbols for ~a package.~%"</span>
      <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>
      pkg-name)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many symbols."</span>))
    (when check-packagesp (pkg-witness pkg-name))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
      do
      (setf (svref arr free)
        (let ((temp (<a class="sym-link local-def" href="#def-ser-decode-str" data-sym="SER-DECODE-STR" title="(defun ser-decode-str (version hons-mode stream)
  (let* ((header (ser-decode-nat stream))
         (len
          (if (eq version :v3)
              (ash header -1)
...">ser-decode-str</a> version <span class="keyword">:never</span> stream)))
          (if *read-suppress*
            nil
            (<a class="sym-link system" href="axioms.html#def-intern" data-sym="INTERN">intern</a> temp pkg-name))))
      (incf free))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-packages" data-defines="SER-ENCODE-PACKAGES" data-references="CDR,CAR,SER-ENCODE-PACKAGE,ENTRY,DOLIST,SER-ENCODE-NAT,SER-PRINT?,LENGTH,LEN,LET,STREAM,ALIST,DEFUN" data-used-by="SER-ENCODE-ATOMS" data-part-name="SER-ENCODE-PACKAGES" data-part-args="STREAM,ALIST" data-part-body="CDR,CAR,SER-ENCODE-PACKAGE,ENTRY,DOLIST,STREAM,SER-ENCODE-NAT,SER-PRINT?,ALIST,LENGTH,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-PACKAGES">ser-encode-packages</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-packages" data-sym="SER-ENCODE-PACKAGES" title="(defun ser-encode-packages (alist stream)
  (let ((len (length alist)))
    (ser-print? &quot;; Encoding symbols for ~a packages.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (entry alist) (ser-encode-package (car entry) (cdr entry) stream))))">ser-encode-packages</a>
  (alist stream)
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> alist)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Encoding symbols for ~a packages.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> stream)
    (dolist (entry alist)
      (<a class="sym-link local-def" href="#def-ser-encode-package" data-sym="SER-ENCODE-PACKAGE" title="(defun ser-encode-package (pkg x stream)
  (declare (type string pkg))
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a symbols for ~a package.~%&quot; len pkg)
    (ser-encode-str pkg stream)
...">ser-encode-package</a> (car entry) (cdr entry) stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-packages" data-defines="SER-DECODE-AND-LOAD-PACKAGES" data-references="SER-DECODE-AND-LOAD-PACKAGE,DO,TO,FROM,I,FOR,LOOP,SER-PRINT?,SER-DECODE-NAT,LEN,LET,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,CHECK-PACKAGESP,DEFUN" data-used-by="SER-DECODE-AND-LOAD-ATOMS" data-part-name="SER-DECODE-AND-LOAD-PACKAGES" data-part-args="STREAM,DECODER,CHECK-PACKAGESP" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="DECODER,CHECK-PACKAGESP,SER-DECODE-AND-LOAD-PACKAGE,DO,TO,FROM,I,FOR,LOOP,SER-PRINT?,STREAM,SER-DECODE-NAT,LEN,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-PACKAGES">ser-decode-and-load-packages</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-packages" data-sym="SER-DECODE-AND-LOAD-PACKAGES" title="(defun ser-decode-and-load-packages (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (let ((len (ser-decode-nat stream)))
    (ser-print? &quot;; Decoding symbols for ~a packages.~%&quot; len)
    (loop for i from 1 to len">ser-decode-and-load-packages</a>
  (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding symbols for ~a packages.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (loop for
      i
      from
      <span class="number">1</span>
      to
      <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>
      do
      (<a class="sym-link local-def" href="#def-ser-decode-and-load-package" data-sym="SER-DECODE-AND-LOAD-PACKAGE" title="(defun ser-decode-and-load-package (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((version (ser-decoder-version decoder))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-package</a> check-packagesp decoder stream))))</pre>
  </div>

<div class="form-block function" id="def-ser-hashtable-init" data-defines="SER-HASHTABLE-INIT" data-references="MAKE-HASH-TABLE,TEST,SIZE,DEFUN" data-part-name="SER-HASHTABLE-INIT" data-part-args="TEST,SIZE" data-part-body="TEST,SIZE,MAKE-HASH-TABLE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-HASHTABLE-INIT">ser-hashtable-init</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a>
  (size test)
  (make-hash-table <span class="keyword">:size</span> size <span class="keyword">:test</span> test <span class="keyword">:rehash-size</span> <span class="number">2.2</span>))</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defstruct ser-encoder
  (seen-sym (<a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a> <span class="number">1000</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>) <span class="keyword">:type</span> hash-table)
  (seen-eql (<a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a> <span class="number">1000</span> '<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a>) <span class="keyword">:type</span> hash-table)
  (seen-str (<a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a> <span class="number">1000</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>) <span class="keyword">:type</span> hash-table)
  (seen-cons (<a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a> <span class="number">2000</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>) <span class="keyword">:type</span> hash-table)
  (naturals nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (rationals nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (complexes nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (chars nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (strings nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (symbol-ht (<a class="sym-link local-def" href="#def-ser-hashtable-init" data-sym="SER-HASHTABLE-INIT" title="(defun ser-hashtable-init (size test)
  (make-hash-table :size size :test test :rehash-size 2.2))">ser-hashtable-init</a> <span class="number">60</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>) <span class="keyword">:type</span> hash-table)
  (symbol-al nil <span class="keyword">:type</span> <a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>)
  (free-index <span class="number">0</span> <span class="keyword">:type</span> (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (integer <span class="number">0</span> <a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>) fixnum))
  (stream nil))</pre>
  </div>

<div class="form-block macro" id="def-ser-see-obj" data-defines="SER-SEE-OBJ" data-references="SETF,T,GETHASH,COND,TBL,LET,QUASIQUOTE,TABLE,X,DEFMACRO" data-used-by="SER-GATHER-ATOMS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-SEE-OBJ">ser-see-obj</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a>
  (x <a class="sym-link system" href="axioms.html#def-table" data-sym="TABLE">table</a>)
  `(let ((x ,X) (tbl ,TABLE))
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((gethash x tbl) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (setf (gethash x tbl) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) nil))))</pre>
  </div>

<div class="form-block function" id="def-ser-gather-atoms" data-defines="SER-GATHER-ATOMS" data-references="ERROR,SER-ENCODER-COMPLEXES,COMPLEX-RATIONALP,RATIONALP,INTEGER,SER-ENCODER-CHARS,CHARACTER,SER-ENCODER-STRINGS,SER-ENCODER-SEEN-STR,ARRAY,SER-ENCODER-NATURALS,SER-ENCODER-RATIONALS,THE,<,IF,SER-ENCODER-SEEN-EQL,FIXNUM,QUOTE,TYPEP,SER-ENCODER-SYMBOL-HT,SYMBOL-PACKAGE,GETHASH,PUSH,SER-ENCODER-SEEN-SYM,T,EQ,OR,SYMBOLP,CDR,CAR,SER-ENCODER-SEEN-CONS,SER-SEE-OBJ,UNLESS,CONSP,COND,SER-ENCODER,TYPE,DECLARE,ENCODER,X,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-GATHER-ATOMS" data-part-args="ENCODER,X" data-part-declare="ENCODER,SER-ENCODER,TYPE,DECLARE" data-part-body="ERROR,SER-ENCODER-COMPLEXES,COMPLEX-RATIONALP,RATIONALP,INTEGER,SER-ENCODER-CHARS,CHARACTER,SER-ENCODER-STRINGS,SER-ENCODER-SEEN-STR,ARRAY,SER-ENCODER-NATURALS,SER-ENCODER-RATIONALS,THE,<,IF,SER-ENCODER-SEEN-EQL,FIXNUM,QUOTE,TYPEP,SER-ENCODER-SYMBOL-HT,SYMBOL-PACKAGE,GETHASH,PUSH,SER-ENCODER-SEEN-SYM,T,EQ,OR,SYMBOLP,CDR,CAR,SER-GATHER-ATOMS,ENCODER,SER-ENCODER-SEEN-CONS,SER-SEE-OBJ,UNLESS,X,CONSP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-GATHER-ATOMS">ser-gather-atoms</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-gather-atoms" data-sym="SER-GATHER-ATOMS" title="(defun ser-gather-atoms (x encoder)
  (declare (type ser-encoder encoder))
  (cond
   ((consp x)
    (unless (ser-see-obj x (ser-encoder-seen-cons encoder))
...">ser-gather-atoms</a>
  (x encoder)
  (declare (type ser-encoder encoder))
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((consp x) (unless (<a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a> x (ser-encoder-seen-cons encoder))
        (<a class="sym-link local-def" href="#def-ser-gather-atoms" data-sym="SER-GATHER-ATOMS" title="(defun ser-gather-atoms (x encoder)
  (declare (type ser-encoder encoder))
  (cond
   ((consp x)
    (unless (ser-see-obj x (ser-encoder-seen-cons encoder))
...">ser-gather-atoms</a> (car x) encoder)
        (<a class="sym-link local-def" href="#def-ser-gather-atoms" data-sym="SER-GATHER-ATOMS" title="(defun ser-gather-atoms (x encoder)
  (declare (type ser-encoder encoder))
  (cond
   ((consp x)
    (unless (ser-see-obj x (ser-encoder-seen-cons encoder))
...">ser-gather-atoms</a> (cdr x) encoder)))
    ((symbolp x) (unless (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> x <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
          (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> x nil)
          (<a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a> x (ser-encoder-seen-sym encoder)))
        (push x
          (gethash (symbol-package x) (ser-encoder-symbol-ht encoder)))))
    ((typep x 'fixnum) (unless (<a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a> x (ser-encoder-seen-eql encoder))
        (if (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum x) <span class="number">0</span>)
          (push x (ser-encoder-rationals encoder))
          (push x (ser-encoder-naturals encoder)))))
    ((typep x 'array) (unless (<a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a> x (ser-encoder-seen-str encoder))
        (push x (ser-encoder-strings encoder))))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (unless (<a class="sym-link local-def" href="#def-ser-see-obj" data-sym="SER-SEE-OBJ" title="(defmacro ser-see-obj (x table)
  `(let ((x ,x) (tbl ,table))
     (cond ((gethash x tbl) t) (t (setf (gethash x tbl) t) nil))))">ser-see-obj</a> x (ser-encoder-seen-eql encoder))
        (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((typep x 'character) (push x (ser-encoder-chars encoder)))
          ((typep x 'integer) (if (&lt; x <span class="number">0</span>)
              (push x (ser-encoder-rationals encoder))
              (push x (ser-encoder-naturals encoder))))
          ((rationalp x) (push x (ser-encoder-rationals encoder)))
          ((complex-rationalp x) (push x (ser-encoder-complexes encoder)))
          (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (error <span class="string">"ser-gather-atoms-types given non-ACL2 object."</span>)))))))</pre>
  </div>

<div class="form-block function" id="def-ser-make-atom-map" data-defines="SER-MAKE-ATOM-MAP" data-references="SER-ENCODER-FREE-INDEX,T,CDR,SYM,SER-ENCODER-SYMBOL-AL,SER-ENCODER-SYMBOL-HT,PACKAGE-NAME,CONS,PUSH,VAL,KEY,LAMBDA,MAPHASH,AL,SER-ENCODER-STRINGS,SER-ENCODER-CHARS,SER-ENCODER-COMPLEXES,SER-ENCODER-RATIONALS,INCF,GETHASH,SETF,SER-ENCODER-NATURALS,ELEM,DOLIST,HASH-TABLE,FIXNUM,TYPE,DECLARE,SER-ENCODER-SEEN-STR,SEEN-STR,SER-ENCODER-SEEN-EQL,SEEN-EQL,SER-ENCODER-SEEN-SYM,SEEN-SYM,FREE-INDEX,LET,ENCODER,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-MAKE-ATOM-MAP" data-part-args="ENCODER" data-part-body="SER-ENCODER-FREE-INDEX,T,CDR,SYM,SER-ENCODER-SYMBOL-AL,SER-ENCODER-SYMBOL-HT,PACKAGE-NAME,CONS,PUSH,VAL,KEY,LAMBDA,MAPHASH,AL,SER-ENCODER-STRINGS,SER-ENCODER-CHARS,SER-ENCODER-COMPLEXES,SER-ENCODER-RATIONALS,INCF,GETHASH,SETF,SER-ENCODER-NATURALS,ELEM,DOLIST,HASH-TABLE,FIXNUM,TYPE,DECLARE,SER-ENCODER-SEEN-STR,SEEN-STR,SER-ENCODER-SEEN-EQL,SEEN-EQL,ENCODER,SER-ENCODER-SEEN-SYM,SEEN-SYM,FREE-INDEX,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-MAKE-ATOM-MAP">ser-make-atom-map</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-make-atom-map" data-sym="SER-MAKE-ATOM-MAP" title="(defun ser-make-atom-map (encoder)
  (let ((free-index 2)
        (seen-sym (ser-encoder-seen-sym encoder))
        (seen-eql (ser-encoder-seen-eql encoder))
        (seen-str (ser-encoder-seen-str encoder)))
...">ser-make-atom-map</a>
  (encoder)
  (let ((free-index <span class="number">2</span>) (seen-sym (ser-encoder-seen-sym encoder))
      (seen-eql (ser-encoder-seen-eql encoder))
      (seen-str (ser-encoder-seen-str encoder)))
    (declare (type fixnum free-index)
      (type hash-table seen-sym seen-eql seen-str))
    (dolist (elem (ser-encoder-naturals encoder))
      (setf (gethash elem seen-eql) free-index)
      (incf free-index))
    (dolist (elem (ser-encoder-rationals encoder))
      (setf (gethash elem seen-eql) free-index)
      (incf free-index))
    (dolist (elem (ser-encoder-complexes encoder))
      (setf (gethash elem seen-eql) free-index)
      (incf free-index))
    (dolist (elem (ser-encoder-chars encoder))
      (setf (gethash elem seen-eql) free-index)
      (incf free-index))
    (dolist (elem (ser-encoder-strings encoder))
      (setf (gethash elem seen-str) free-index)
      (incf free-index))
    (let ((al nil))
      (maphash (lambda (key val) (push (cons (package-name key) val) al))
        (ser-encoder-symbol-ht encoder))
      (setf (ser-encoder-symbol-al encoder) al))
    (dolist (elem (ser-encoder-symbol-al encoder))
      (dolist (sym (cdr elem))
        (setf (gethash sym seen-sym) free-index)
        (incf free-index)))
    (setf (gethash nil seen-sym) <span class="number">0</span>)
    (setf (gethash <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> seen-sym) <span class="number">1</span>)
    (setf (ser-encoder-free-index encoder) free-index)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-conses" data-defines="SER-ENCODE-CONSES" data-references="+,SER-ENCODE-NAT,SETF,ASH,LOGIOR,THE,HL-HSPACE-HONSP-WRAPPER,V2-CAR-INDEX,SER-ENCODER-STREAM,STREAM,SER-ENCODER-FREE-INDEX,FREE-INDEX,CDR,CDR-INDEX,CAR,CAR-INDEX,FIXNUM,QUOTE,TYPEP,IDX,SER-ENCODER-SEEN-CONS,SEEN-CONS,LET*,SER-ENCODER-SEEN-EQL,T,SER-ENCODER-SEEN-STR,STRINGP,SER-ENCODER-SEEN-SYM,GETHASH,SYMBOLP,COND,ATOM,IF,SER-ENCODER,TYPE,DECLARE,ENCODER,X,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-ENCODE-CONSES" data-part-args="ENCODER,X" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-CONSES">ser-encode-conses</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-conses" data-sym="SER-ENCODE-CONSES" title="(defun ser-encode-conses (x encoder)
  &quot;Returns X-INDEX&quot;
  (declare (type ser-encoder encoder))
  (if (atom x)
      (cond ((symbolp x) (gethash x (ser-encoder-seen-sym encoder)))
...">ser-encode-conses</a>
  (x encoder)
  <span class="string">"Returns X-INDEX"</span>
  (declare (type ser-encoder encoder))
  (if (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> x)
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((symbolp x) (gethash x (ser-encoder-seen-sym encoder)))
      ((stringp x) (gethash x (ser-encoder-seen-str encoder)))
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (gethash x (ser-encoder-seen-eql encoder))))
    (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((seen-cons (ser-encoder-seen-cons encoder)) (idx (gethash x seen-cons)))
      (if (typep idx 'fixnum)
        idx
        (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((car-index (<a class="sym-link local-def" href="#def-ser-encode-conses" data-sym="SER-ENCODE-CONSES" title="(defun ser-encode-conses (x encoder)
  &quot;Returns X-INDEX&quot;
  (declare (type ser-encoder encoder))
  (if (atom x)
      (cond ((symbolp x) (gethash x (ser-encoder-seen-sym encoder)))
...">ser-encode-conses</a> (car x) encoder)) (cdr-index (<a class="sym-link local-def" href="#def-ser-encode-conses" data-sym="SER-ENCODE-CONSES" title="(defun ser-encode-conses (x encoder)
  &quot;Returns X-INDEX&quot;
  (declare (type ser-encoder encoder))
  (if (atom x)
      (cond ((symbolp x) (gethash x (ser-encoder-seen-sym encoder)))
...">ser-encode-conses</a> (cdr x) encoder))
            (free-index (ser-encoder-free-index encoder))
            (stream (ser-encoder-stream encoder))
            (v2-car-index (if (hl-hspace-honsp-wrapper x)
                (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-logior" data-sym="LOGIOR">logior</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash car-index <span class="number">1</span>)) <span class="number">1</span>))
                (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash car-index <span class="number">1</span>)))))
          (declare (type fixnum car-index cdr-index v2-car-index free-index))
          (setf (gethash x seen-cons) free-index)
          (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> v2-car-index stream)
          (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> cdr-index stream)
          (setf (ser-encoder-free-index encoder)
            (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> free-index)))
          free-index)))))</pre>
  </div>

<div class="form-block macro" id="def-ser-decode-loop" data-defines="SER-DECODE-LOOP" data-references="INCF,CONS,HONS,IF,SETF,CDR-OBJ,ARR,SVREF,CAR-OBJ,<,AND,CDR-INDEX,HONSP,CAR-INDEX,ERROR,QUOTE,TYPEP,UNLESS,STREAM,SER-DECODE-NAT,FIRST-INDEX,LET,DO,FREE,STOP,FIXNUM,THE,=,UNTIL,LOOP,QUASIQUOTE,HONS-MODE,VERSION,DEFMACRO" data-used-by="SER-DECODE-AND-LOAD-CONSES" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-LOOP">ser-decode-loop</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a>
  (version hons-mode)
  `(loop until
    (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum stop) free)
    do
    (let ((first-index (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
      (unless (typep first-index 'fixnum)
        (error <span class="string">"Consing instruction has non-fixnum first-index."</span>))
      (let ((car-index ,(IF (EQ VERSION :V1)
     &#39;FIRST-INDEX
     &#39;(THE FIXNUM (ASH (THE FIXNUM FIRST-INDEX) -1)))) (honsp ,(COND ((EQ HONS-MODE :ALWAYS) &#39;T)
       ((AND (EQ HONS-MODE :SMART) (NOT (EQ VERSION :V1)))
        &#39;(LOGBITP 0 (THE FIXNUM FIRST-INDEX)))
       (T NIL)))
          (cdr-index (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
        (unless (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (typep cdr-index 'fixnum)
            (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum car-index) free)
            (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum cdr-index) free))
          (error <span class="string">"Consing instruction has index out of bounds."</span>))
        (let ((car-obj (svref arr (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum car-index))) (cdr-obj (svref arr (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum cdr-index))))
          (setf (svref arr free)
            (if honsp
              (hons car-obj cdr-obj)
              (cons car-obj cdr-obj)))
          (incf free))))))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-conses" data-defines="SER-DECODE-AND-LOAD-CONSES" data-references="SETF,T,COND,SER-DECODE-LOOP,EQ,IF,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,+,STOP,SER-DECODER-VERSION,VERSION,SER-DECODER-FREE,FREE,SER-DECODER-ARRAY,ARR,SER-DECODE-NAT,LEN,LET*,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,HONS-MODE,DEFUN" data-used-by="SER-DECODE-FROM-STREAM" data-part-name="SER-DECODE-AND-LOAD-CONSES" data-part-args="STREAM,DECODER,HONS-MODE" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="SETF,T,COND,SER-DECODE-LOOP,HONS-MODE,EQ,IF,ERROR,LENGTH,<=,UNLESS,SER-PRINT?,FIXNUM,TYPE,DECLARE,+,STOP,SER-DECODER-VERSION,VERSION,SER-DECODER-FREE,FREE,DECODER,SER-DECODER-ARRAY,ARR,STREAM,SER-DECODE-NAT,LEN,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-CONSES">ser-decode-and-load-conses</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-conses" data-sym="SER-DECODE-AND-LOAD-CONSES" title="(defun ser-decode-and-load-conses (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-conses</a>
  (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)) (arr (ser-decoder-array decoder))
      (free (ser-decoder-free decoder))
      (version (ser-decoder-version decoder))
      (stop (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> free <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)))
    (declare (type fixnum free))
    (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding ~a consing instructions.~%"</span> <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>)
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> stop (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> arr))
      (error <span class="string">"Invalid serialized object, too many conses."</span>))
    (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v1</span>)
      (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> hons-mode <span class="keyword">:always</span>)
        (<a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a> <span class="keyword">:v1</span> <span class="keyword">:always</span>)
        (<a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a> <span class="keyword">:v1</span> <span class="keyword">:never</span>))
      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> hons-mode <span class="keyword">:always</span>) (<a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a> <span class="keyword">:v2</span> <span class="keyword">:always</span>))
        ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> hons-mode <span class="keyword">:never</span>) (<a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a> <span class="keyword">:v2</span> <span class="keyword">:never</span>))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-ser-decode-loop" data-sym="SER-DECODE-LOOP" title="(defmacro ser-decode-loop (version hons-mode)
  `(loop until (= (the fixnum stop) free)
         do (let ((first-index (ser-decode-nat stream)))
              (unless (typep first-index &#39;fixnum)
                (error &quot;Consing instruction has non-fixnum first-index.&quot;))
...">ser-decode-loop</a> <span class="keyword">:v2</span> <span class="keyword">:smart</span>))))
    (setf (ser-decoder-free decoder) stop)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-fals" data-defines="SER-ENCODE-FALS" data-references="HL-HSPACE-FALTABLE-WRAPPER,HL-FALTABLE-MAPHASH,HASH-TABLE-COUNT,SER-ENCODE-NAT,WHEN,GETHASH,IDX,LET,BACKING-HASH-TABLE,ALIST,LAMBDA,FN,SER-ENCODER-SEEN-CONS,SEEN-CONS,SER-ENCODER-STREAM,STREAM,LET*,SER-ENCODER,TYPE,DECLARE,ENCODER,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-ENCODE-FALS" data-part-args="ENCODER" data-part-declare="ENCODER,SER-ENCODER,TYPE,DECLARE" data-part-body="HL-HSPACE-FALTABLE-WRAPPER,HL-FALTABLE-MAPHASH,HASH-TABLE-COUNT,SER-ENCODE-NAT,WHEN,GETHASH,IDX,LET,BACKING-HASH-TABLE,ALIST,LAMBDA,FN,SER-ENCODER-SEEN-CONS,SEEN-CONS,ENCODER,SER-ENCODER-STREAM,STREAM,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-FALS">ser-encode-fals</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-fals" data-sym="SER-ENCODE-FALS" title="(defun ser-encode-fals (encoder)
  (declare (type ser-encoder encoder))
  (let* ((stream (ser-encoder-stream encoder))
         (seen-cons (ser-encoder-seen-cons encoder))
         (fn
...">ser-encode-fals</a>
  (encoder)
  (declare (type ser-encoder encoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((stream (ser-encoder-stream encoder)) (seen-cons (ser-encoder-seen-cons encoder))
      (fn (lambda (alist backing-hash-table)
          (let ((idx (gethash alist seen-cons)))
            (when idx
              (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> idx stream)
              (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (hash-table-count backing-hash-table)
                stream))))))
    (hl-faltable-maphash fn (hl-hspace-faltable-wrapper))
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> <span class="number">0</span> stream)))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-restore-fals" data-defines="SER-DECODE-AND-RESTORE-FALS" data-references="SETQ,HL-RESTORE-FAL-FOR-SERIALIZE,COUNT,SVREF,ALIST,LET,EQ,ERROR,<,UNLESS,DO,=,UNTIL,LOOP,SER-DECODE-NAT,INDEX,LENGTH,MAX,SER-DECODER-ARRAY,ARRAY,LET*,SER-DECODER,TYPE,DECLARE,STREAM,HONS-MODE,DECODER,DEFUN" data-used-by="SER-DECODE-FROM-STREAM" data-part-name="SER-DECODE-AND-RESTORE-FALS" data-part-args="STREAM,HONS-MODE,DECODER" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="SETQ,HL-RESTORE-FAL-FOR-SERIALIZE,COUNT,SVREF,ALIST,LET,HONS-MODE,EQ,ERROR,<,UNLESS,DO,=,UNTIL,LOOP,STREAM,SER-DECODE-NAT,INDEX,LENGTH,MAX,DECODER,SER-DECODER-ARRAY,ARRAY,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-RESTORE-FALS">ser-decode-and-restore-fals</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-restore-fals" data-sym="SER-DECODE-AND-RESTORE-FALS" title="(defun ser-decode-and-restore-fals (decoder hons-mode stream)
  (declare (type ser-decoder decoder))
  (let* ((array (ser-decoder-array decoder))
         (max (length array))
         (index (ser-decode-nat stream)))
...">ser-decode-and-restore-fals</a>
  (decoder hons-mode stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((array (ser-decoder-array decoder)) (max (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> array))
      (index (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
    (loop until
      (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> index <span class="number">0</span>)
      do
      (unless (&lt; index max)
        (error <span class="string">"FAL index to restore is too large!"</span>))
      (unless (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> hons-mode <span class="keyword">:never</span>)
        (let ((alist (svref array index)) (<a class="sym-link system" href="axioms.html#def-count" data-sym="COUNT">count</a> (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))
          (hl-restore-fal-for-serialize alist <a class="sym-link system" href="axioms.html#def-count" data-sym="COUNT">count</a>)))
      (setq index (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream)))))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-atoms" data-defines="SER-ENCODE-ATOMS" data-references="SER-ENCODER-SYMBOL-AL,SER-ENCODE-PACKAGES,SER-ENCODER-STRINGS,SER-ENCODE-STRS,SER-ENCODER-CHARS,SER-ENCODE-CHARS,SER-ENCODER-COMPLEXES,SER-ENCODE-COMPLEXES,SER-ENCODER-RATIONALS,SER-ENCODE-RATS,SER-ENCODER-NATURALS,SER-ENCODE-NATS,SER-ENCODER-STREAM,STREAM,LET,SER-ENCODER,TYPE,DECLARE,ENCODER,DEFUN" data-used-by="SER-ENCODE-TO-STREAM" data-part-name="SER-ENCODE-ATOMS" data-part-args="ENCODER" data-part-declare="ENCODER,SER-ENCODER,TYPE,DECLARE" data-part-body="SER-ENCODER-SYMBOL-AL,SER-ENCODE-PACKAGES,SER-ENCODER-STRINGS,SER-ENCODE-STRS,SER-ENCODER-CHARS,SER-ENCODE-CHARS,SER-ENCODER-COMPLEXES,SER-ENCODE-COMPLEXES,SER-ENCODER-RATIONALS,SER-ENCODE-RATS,SER-ENCODER-NATURALS,SER-ENCODE-NATS,ENCODER,SER-ENCODER-STREAM,STREAM,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-ATOMS">ser-encode-atoms</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-atoms" data-sym="SER-ENCODE-ATOMS" title="(defun ser-encode-atoms (encoder)
  (declare (type ser-encoder encoder))
  (let ((stream (ser-encoder-stream encoder)))
    (ser-encode-nats (ser-encoder-naturals encoder) stream)
    (ser-encode-rats (ser-encoder-rationals encoder) stream)
...">ser-encode-atoms</a>
  (encoder)
  (declare (type ser-encoder encoder))
  (let ((stream (ser-encoder-stream encoder)))
    (<a class="sym-link local-def" href="#def-ser-encode-nats" data-sym="SER-ENCODE-NATS" title="(defun ser-encode-nats (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a naturals.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-nat elem stream))))">ser-encode-nats</a> (ser-encoder-naturals encoder) stream)
    (<a class="sym-link local-def" href="#def-ser-encode-rats" data-sym="SER-ENCODE-RATS" title="(defun ser-encode-rats (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a rationals.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-rat elem stream))))">ser-encode-rats</a> (ser-encoder-rationals encoder) stream)
    (<a class="sym-link local-def" href="#def-ser-encode-complexes" data-sym="SER-ENCODE-COMPLEXES" title="(defun ser-encode-complexes (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a complexes.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-complex elem stream))))">ser-encode-complexes</a> (ser-encoder-complexes encoder)
      stream)
    (<a class="sym-link local-def" href="#def-ser-encode-chars" data-sym="SER-ENCODE-CHARS" title="(defun ser-encode-chars (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a characters.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-write-char elem stream))))">ser-encode-chars</a> (ser-encoder-chars encoder) stream)
    (<a class="sym-link local-def" href="#def-ser-encode-strs" data-sym="SER-ENCODE-STRS" title="(defun ser-encode-strs (x stream)
  (let ((len (length x)))
    (ser-print? &quot;; Encoding ~a strings.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (elem x) (ser-encode-str elem stream))))">ser-encode-strs</a> (ser-encoder-strings encoder) stream)
    (<a class="sym-link local-def" href="#def-ser-encode-packages" data-sym="SER-ENCODE-PACKAGES" title="(defun ser-encode-packages (alist stream)
  (let ((len (length alist)))
    (ser-print? &quot;; Encoding symbols for ~a packages.~%&quot; len)
    (ser-encode-nat len stream)
    (dolist (entry alist) (ser-encode-package (car entry) (cdr entry) stream))))">ser-encode-packages</a> (ser-encoder-symbol-al encoder) stream)))</pre>
  </div>

<div class="form-block function" id="def-ser-encode-to-stream" data-defines="SER-ENCODE-TO-STREAM" data-references="OR,EQUAL,AND,SER-ENCODE-FALS,SER-ENCODE-CONSES,SER-ENCODE-ATOMS,-,T,EQ,COND,SER-ENCODE-NAT,THE,SER-ENCODE-MAGIC,SER-ENCODER-FREE-INDEX,SER-MAKE-ATOM-MAP,ERROR,FIXNUM,QUOTE,SER-ENCODER-SEEN-STR,SER-ENCODER-SEEN-EQL,SER-ENCODER-SEEN-SYM,+,ASH,TYPEP,UNLESS,SER-ENCODER-SEEN-CONS,HASH-TABLE-COUNT,SETQ,SER-GATHER-ATOMS,SER-TIME?,HL-MAYBE-INITIALIZE-DEFAULT-HS-WRAPPER,DYNAMIC-EXTENT,DECLARE,NCONSES,MAX-INDEX,TOTAL-NUMBER-OF-OBJECTS,STARTING-FREE-INDEX-FOR-CONSES,MAKE-SER-ENCODER,ENCODER,LET,STREAM,OBJ,DEFUN" data-part-name="SER-ENCODE-TO-STREAM" data-part-args="STREAM,OBJ" data-part-body="OR,EQUAL,AND,SER-ENCODE-FALS,SER-ENCODE-CONSES,SER-ENCODE-ATOMS,-,T,EQ,COND,SER-ENCODE-NAT,THE,SER-ENCODE-MAGIC,SER-ENCODER-FREE-INDEX,SER-MAKE-ATOM-MAP,ERROR,FIXNUM,QUOTE,SER-ENCODER-SEEN-STR,SER-ENCODER-SEEN-EQL,SER-ENCODER-SEEN-SYM,+,ASH,TYPEP,UNLESS,SER-ENCODER-SEEN-CONS,HASH-TABLE-COUNT,SETQ,OBJ,SER-GATHER-ATOMS,SER-TIME?,HL-MAYBE-INITIALIZE-DEFAULT-HS-WRAPPER,DYNAMIC-EXTENT,DECLARE,NCONSES,MAX-INDEX,TOTAL-NUMBER-OF-OBJECTS,STARTING-FREE-INDEX-FOR-CONSES,STREAM,MAKE-SER-ENCODER,ENCODER,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-ENCODE-TO-STREAM">ser-encode-to-stream</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-encode-to-stream" data-sym="SER-ENCODE-TO-STREAM" title="(defun ser-encode-to-stream (obj stream)
  (let ((encoder (make-ser-encoder :stream stream))
        starting-free-index-for-conses
        total-number-of-objects
        max-index
...">ser-encode-to-stream</a>
  (obj stream)
  (let ((encoder (make-ser-encoder <span class="keyword">:stream</span> stream)) starting-free-index-for-conses
      total-number-of-objects
      max-index
      nconses)
    (declare (dynamic-extent encoder))
    (hl-maybe-initialize-default-hs-wrapper)
    (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-gather-atoms" data-sym="SER-GATHER-ATOMS" title="(defun ser-gather-atoms (x encoder)
  (declare (type ser-encoder encoder))
  (cond
   ((consp x)
    (unless (ser-see-obj x (ser-encoder-seen-cons encoder))
...">ser-gather-atoms</a> obj encoder))
    (setq nconses
      (hash-table-count (ser-encoder-seen-cons encoder)))
    (unless (typep (ash (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span>
            (hash-table-count (ser-encoder-seen-sym encoder))
            (hash-table-count (ser-encoder-seen-eql encoder))
            (hash-table-count (ser-encoder-seen-str encoder))
            nconses)
          <span class="number">1</span>)
        'fixnum)
      (error <span class="string">"Maximum index exceeded."</span>))
    (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-make-atom-map" data-sym="SER-MAKE-ATOM-MAP" title="(defun ser-make-atom-map (encoder)
  (let ((free-index 2)
        (seen-sym (ser-encoder-seen-sym encoder))
        (seen-eql (ser-encoder-seen-eql encoder))
        (seen-str (ser-encoder-seen-str encoder)))
...">ser-make-atom-map</a> encoder))
    (setq starting-free-index-for-conses
      (ser-encoder-free-index encoder))
    (<a class="sym-link local-def" href="#def-ser-encode-magic" data-sym="SER-ENCODE-MAGIC" title="(defun ser-encode-magic (stream)
  (ser-write-byte 172 stream)
  (ser-write-byte 18 stream)
  (ser-write-byte 11 stream)
  (ser-write-byte 201 stream))">ser-encode-magic</a> stream)
    (setq total-number-of-objects
      (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> starting-free-index-for-conses nconses)))
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> obj nil) <span class="number">0</span>) (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> total-number-of-objects <span class="number">1</span>)))
      stream)
    (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-encode-atoms" data-sym="SER-ENCODE-ATOMS" title="(defun ser-encode-atoms (encoder)
  (declare (type ser-encoder encoder))
  (let ((stream (ser-encoder-stream encoder)))
    (ser-encode-nats (ser-encoder-naturals encoder) stream)
    (ser-encode-rats (ser-encoder-rationals encoder) stream)
...">ser-encode-atoms</a> encoder))
    (<a class="sym-link local-def" href="#def-ser-encode-nat" data-sym="SER-ENCODE-NAT" title="(defmacro ser-encode-nat (n stream)
  (when (eq stream &#39;n)
    (error &quot;~s called with stream = N, which would cause capture!&quot;
           &#39;ser-encode-nat))
  `(let ((n ,n))
...">ser-encode-nat</a> nconses stream)
    (setq max-index (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-encode-conses" data-sym="SER-ENCODE-CONSES" title="(defun ser-encode-conses (x encoder)
  &quot;Returns X-INDEX&quot;
  (declare (type ser-encoder encoder))
  (if (atom x)
      (cond ((symbolp x) (gethash x (ser-encoder-seen-sym encoder)))
...">ser-encode-conses</a> obj encoder)))
    (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-encode-fals" data-sym="SER-ENCODE-FALS" title="(defun ser-encode-fals (encoder)
  (declare (type ser-encoder encoder))
  (let* ((stream (ser-encoder-stream encoder))
         (seen-cons (ser-encoder-seen-cons encoder))
         (fn
...">ser-encode-fals</a> encoder))
    (unless (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (equal (ser-encoder-free-index encoder)
          total-number-of-objects)
        (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (equal max-index (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> (ser-encoder-free-index encoder) <span class="number">1</span>))
          (equal max-index <span class="number">0</span>)))
      (error <span class="string">"Sanity check failed in ser-encode-to-stream!~% ~
                - final-free-index is ~a~% ~
                - total-number-of-objects is ~a~% ~
                - max-index is ~a~%"</span>
        (ser-encoder-free-index encoder)
        total-number-of-objects
        max-index))
    (<a class="sym-link local-def" href="#def-ser-encode-magic" data-sym="SER-ENCODE-MAGIC" title="(defun ser-encode-magic (stream)
  (ser-write-byte 172 stream)
  (ser-write-byte 18 stream)
  (ser-write-byte 11 stream)
  (ser-write-byte 201 stream))">ser-encode-magic</a> stream)))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-and-load-atoms" data-defines="SER-DECODE-AND-LOAD-ATOMS" data-references="SER-DECODE-AND-LOAD-PACKAGES,SER-DECODE-AND-LOAD-STRS,SER-DECODE-AND-LOAD-CHARS,SER-DECODE-AND-LOAD-COMPLEXES,SER-DECODE-AND-LOAD-RATS,SER-DECODE-AND-LOAD-NATS,SER-DECODER,TYPE,DECLARE,STREAM,DECODER,HONS-MODE,CHECK-PACKAGESP,DEFUN" data-used-by="SER-DECODE-FROM-STREAM" data-part-name="SER-DECODE-AND-LOAD-ATOMS" data-part-args="STREAM,DECODER,HONS-MODE,CHECK-PACKAGESP" data-part-declare="DECODER,SER-DECODER,TYPE,DECLARE" data-part-body="STREAM,DECODER,SER-DECODE-AND-LOAD-NATS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-AND-LOAD-ATOMS">ser-decode-and-load-atoms</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-and-load-atoms" data-sym="SER-DECODE-AND-LOAD-ATOMS" title="(defun ser-decode-and-load-atoms (check-packagesp hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (ser-decode-and-load-nats decoder stream)
  (ser-decode-and-load-rats decoder stream)
  (ser-decode-and-load-complexes decoder stream)
...">ser-decode-and-load-atoms</a>
  (check-packagesp hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-nats" data-sym="SER-DECODE-AND-LOAD-NATS" title="(defun ser-decode-and-load-nats (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-nats</a> decoder stream)
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-rats" data-sym="SER-DECODE-AND-LOAD-RATS" title="(defun ser-decode-and-load-rats (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-rats</a> decoder stream)
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-complexes" data-sym="SER-DECODE-AND-LOAD-COMPLEXES" title="(defun ser-decode-and-load-complexes (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-complexes</a> decoder stream)
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-chars" data-sym="SER-DECODE-AND-LOAD-CHARS" title="(defun ser-decode-and-load-chars (decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-chars</a> decoder stream)
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-strs" data-sym="SER-DECODE-AND-LOAD-STRS" title="(defun ser-decode-and-load-strs (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-strs</a> hons-mode decoder stream)
  (<a class="sym-link local-def" href="#def-ser-decode-and-load-packages" data-sym="SER-DECODE-AND-LOAD-PACKAGES" title="(defun ser-decode-and-load-packages (check-packagesp decoder stream)
  (declare (type ser-decoder decoder))
  (let ((len (ser-decode-nat stream)))
    (ser-print? &quot;; Decoding symbols for ~a packages.~%&quot; len)
    (loop for i from 1 to len">ser-decode-and-load-packages</a> check-packagesp
    decoder
    stream))</pre>
  </div>

<div class="form-block function" id="def-ser-make-array-wrapper" data-defines="SER-MAKE-ARRAY-WRAPPER" data-references="MAKE-ARRAY,SAFETY,OPTIMIZE,DECLARE,SIZE,DEFUN" data-used-by="SER-DECODE-FROM-STREAM" data-part-name="SER-MAKE-ARRAY-WRAPPER" data-part-args="SIZE" data-part-declare="SAFETY,OPTIMIZE,DECLARE" data-part-body="SIZE,MAKE-ARRAY" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-MAKE-ARRAY-WRAPPER">ser-make-array-wrapper</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-make-array-wrapper" data-sym="SER-MAKE-ARRAY-WRAPPER" title="(defun ser-make-array-wrapper (size)
  (declare (optimize (safety 3)))
  (make-array size))">ser-make-array-wrapper</a>
  (size)
  (declare (optimize (safety <span class="number">3</span>)))
  (make-array size))</pre>
  </div>

<div class="form-block function" id="def-ser-decode-from-stream" data-defines="SER-DECODE-FROM-STREAM" data-references="SVREF,=,SER-DECODE-AND-RESTORE-FALS,SER-DECODE-AND-LOAD-CONSES,SER-DECODE-AND-LOAD-ATOMS,SER-TIME?,SER-PRINT?,SER-DECODER-FREE,AREF,SETF,WHEN,SER-DECODER,TYPE,DYNAMIC-EXTENT,DECLARE,MAKE-SER-DECODER,DECODER,SER-MAKE-ARRAY-WRAPPER,ARR,ERROR,FIXNUM,QUOTE,TYPEP,UNLESS,-,FINAL-OBJ,+,T,COND,EQ,OR,IF,ARR-SIZE,SER-DECODE-NAT,SIZE/IDX,SER-DECODE-MAGIC,VERSION,LET*,STREAM,HONS-MODE,CHECK-PACKAGESP,DEFUN" data-part-name="SER-DECODE-FROM-STREAM" data-part-args="STREAM,HONS-MODE,CHECK-PACKAGESP" data-part-body="SVREF,=,SER-DECODE-AND-RESTORE-FALS,SER-DECODE-AND-LOAD-CONSES,HONS-MODE,CHECK-PACKAGESP,SER-DECODE-AND-LOAD-ATOMS,SER-TIME?,SER-PRINT?,SER-DECODER-FREE,AREF,SETF,WHEN,SER-DECODER,TYPE,DYNAMIC-EXTENT,DECLARE,MAKE-SER-DECODER,DECODER,SER-MAKE-ARRAY-WRAPPER,ARR,ERROR,FIXNUM,QUOTE,TYPEP,UNLESS,-,FINAL-OBJ,+,T,COND,EQ,OR,IF,ARR-SIZE,SER-DECODE-NAT,SIZE/IDX,STREAM,SER-DECODE-MAGIC,VERSION,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SER-DECODE-FROM-STREAM">ser-decode-from-stream</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-ser-decode-from-stream" data-sym="SER-DECODE-FROM-STREAM" title="(defun ser-decode-from-stream (check-packagesp hons-mode stream)
  (let* ((version (ser-decode-magic stream))
         (size/idx (ser-decode-nat stream))
         (arr-size
          (if (or (eq version :v2) (eq version :v3))
...">ser-decode-from-stream</a>
  (check-packagesp hons-mode stream)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((version (<a class="sym-link local-def" href="#def-ser-decode-magic" data-sym="SER-DECODE-MAGIC" title="(defun ser-decode-magic (stream)
  (let* ((magic-1 (ser-read-byte stream))
         (magic-2 (ser-read-byte stream))
         (magic-3 (ser-read-byte stream))
         (magic-4 (ser-read-byte stream)))
...">ser-decode-magic</a> stream)) (size/idx (<a class="sym-link local-def" href="#def-ser-decode-nat" data-sym="SER-DECODE-NAT" title="(defun ser-decode-nat (stream)
  (let ((x1 (ser-read-byte stream)))
    (declare (type fixnum x1))
    (when (&lt; (the fixnum x1) 128) (return-from ser-decode-nat x1))
    (setq x1 (the fixnum (- x1 128)))
...">ser-decode-nat</a> stream))
      (arr-size (if (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v2</span>) (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> size/idx <span class="number">0</span>) <span class="number">2</span>) (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> size/idx <span class="number">1</span>)))
          size/idx))
      (final-obj (if (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v2</span>) (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>))
          size/idx
          (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> arr-size <span class="number">1</span>))))
    (unless (typep arr-size 'fixnum)
      (error <span class="string">"Serialized object is too large."</span>))
    (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((arr (<a class="sym-link local-def" href="#def-ser-make-array-wrapper" data-sym="SER-MAKE-ARRAY-WRAPPER" title="(defun ser-make-array-wrapper (size)
  (declare (optimize (safety 3)))
  (make-array size))">ser-make-array-wrapper</a> arr-size)) (decoder (make-ser-decoder <span class="keyword">:array</span> arr <span class="keyword">:free</span> <span class="number">0</span> <span class="keyword">:version</span> version)))
      (declare (dynamic-extent arr decoder)
        (type ser-decoder decoder))
      (when (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v2</span>) (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>))
        (setf (aref arr <span class="number">0</span>) nil)
        (setf (aref arr <span class="number">1</span>) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
        (setf (ser-decoder-free decoder) <span class="number">2</span>))
      (<a class="sym-link local-def" href="#def-ser-print_3F" data-sym="SER-PRINT?" title="(defmacro ser-print? (msg &amp;rest args)
  `(when *ser-verbose* (format t ,msg . ,args)))">ser-print?</a> <span class="string">"; Decoding serialized object of size ~a.~%"</span>
        arr-size)
      (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-decode-and-load-atoms" data-sym="SER-DECODE-AND-LOAD-ATOMS" title="(defun ser-decode-and-load-atoms (check-packagesp hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (ser-decode-and-load-nats decoder stream)
  (ser-decode-and-load-rats decoder stream)
  (ser-decode-and-load-complexes decoder stream)
...">ser-decode-and-load-atoms</a> check-packagesp
          hons-mode
          decoder
          stream))
      (<a class="sym-link local-def" href="#def-ser-time_3F" data-sym="SER-TIME?" title="(defmacro ser-time? (form)
  `(if *ser-verbose*
       (time ,form)
       ,form))">ser-time?</a> (<a class="sym-link local-def" href="#def-ser-decode-and-load-conses" data-sym="SER-DECODE-AND-LOAD-CONSES" title="(defun ser-decode-and-load-conses (hons-mode decoder stream)
  (declare (type ser-decoder decoder))
  (let* ((len (ser-decode-nat stream))
         (arr (ser-decoder-array decoder))
         (free (ser-decoder-free decoder))
...">ser-decode-and-load-conses</a> hons-mode decoder stream))
      (when (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> version <span class="keyword">:v3</span>)
        (<a class="sym-link local-def" href="#def-ser-decode-and-restore-fals" data-sym="SER-DECODE-AND-RESTORE-FALS" title="(defun ser-decode-and-restore-fals (decoder hons-mode stream)
  (declare (type ser-decoder decoder))
  (let* ((array (ser-decoder-array decoder))
         (max (length array))
         (index (ser-decode-nat stream)))
...">ser-decode-and-restore-fals</a> decoder hons-mode stream))
      (unless (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (<a class="sym-link local-def" href="#def-ser-decode-magic" data-sym="SER-DECODE-MAGIC" title="(defun ser-decode-magic (stream)
  (let* ((magic-1 (ser-read-byte stream))
         (magic-2 (ser-read-byte stream))
         (magic-3 (ser-read-byte stream))
         (magic-4 (ser-read-byte stream)))
...">ser-decode-magic</a> stream) version)
        (error <span class="string">"Invalid serialized object, magic number mismatch."</span>))
      (unless (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> (ser-decoder-free decoder) arr-size)
        (error <span class="string">"Invalid serialized object.~% ~
                 - Decode-free is ~a~%
                 - Arr-size is ~a."</span>
          (ser-decoder-free decoder)
          arr-size))
      (svref arr final-obj))))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>