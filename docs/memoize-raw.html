<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>memoize-raw - ACL2 Book</title>
  <meta property="name" content="memoize-raw">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">memoize-raw</h1>
    <div class="path"><a href="memoize-raw.lisp" class="source-link">memoize-raw</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(eval-when (<span class="keyword">:execute</span> <span class="keyword">:compile-toplevel</span> <span class="keyword">:load-toplevel</span>)
  (when (ignore-errors (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (x y)
        (funcall (<a class="sym-link system" href="axioms.html#def-intern" data-sym="INTERN">intern</a> <span class="string">"READ-CYCLE-COUNTER"</span> <span class="string">"SB-IMPL"</span>))
        (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> x <span class="number">0</span>) (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> y <span class="number">0</span>)))))
    (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"; Note: pushing :RDTSC onto *features*.~&amp;"</span>)
    (finish-output)
    (pushnew <span class="keyword">:rdtsc</span> *features*)))</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *enable-multithreaded-memoization* nil)</pre>
  </div>

<div class="form-block function" id="def-mf-multiprocessing" data-defines="MF-MULTIPROCESSING" data-references="REMEMOIZE-ALL,SETQ,UNWIND-PROTECT,T,IF,*STANDARD-OUTPUT*,FORMAT,NOT,WHEN,*ENABLE-MULTITHREADED-MEMOIZATION*,IFF,COND,QUIET,&OPTIONAL,FLG,DEFUN" data-part-name="MF-MULTIPROCESSING" data-part-args="QUIET,&OPTIONAL,FLG" data-part-body="REMEMOIZE-ALL,SETQ,UNWIND-PROTECT,T,IF,*STANDARD-OUTPUT*,FORMAT,QUIET,NOT,WHEN,FLG,*ENABLE-MULTITHREADED-MEMOIZATION*,IFF,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-MULTIPROCESSING">mf-multiprocessing</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mf-multiprocessing" data-sym="MF-MULTIPROCESSING" title="(defun mf-multiprocessing (flg &amp;optional quiet)
  (cond
   ((iff *enable-multithreaded-memoization* flg)
    (when (not quiet)
      (format *standard-output* &quot;~%; Note: Multiprocessing is already ~a.~%&quot;
...">mf-multiprocessing</a>
  (flg &amp;optional quiet)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-iff" data-sym="IFF">iff</a> *enable-multithreaded-memoization* flg) (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> quiet)
        (format *standard-output*
          <span class="string">"~%; Note: Multiprocessing is already ~a.~%"</span>
          (if *enable-multithreaded-memoization*
            <span class="string">"on"</span>
            <span class="string">"off"</span>))))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (unwind-protect (setq *enable-multithreaded-memoization* flg)
        (rememoize-all <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))))
  flg)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *global-memoize-lock*
  (make-lock <span class="string">"*GLOBAL-MEMOIZE-LOCK*"</span>))</pre>
  </div>

<div class="form-block macro" id="def-with-global-memoize-lock" data-defines="WITH-GLOBAL-MEMOIZE-LOCK" data-references="PROGN,*GLOBAL-MEMOIZE-LOCK*,WITH-LOCK-RAW,*ENABLE-MULTITHREADED-MEMOIZATION*,IF,QUASIQUOTE,FORMS,&REST,DEFMACRO" data-used-by="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS,CLEAR-MEMOIZE-STATISTICS,CLEAR-MEMOIZE-CALL-ARRAY,CLEAR-ONE-MEMO-AND-PONS-HASH,COMPUTE-CALLS-AND-TIMES,PRINT-CALL-STACK,MEMOIZED-VALUES,MEMOIZE-FN,MEMOIZE-FN-INIT,MEMOIZE-CALL-ARRAY-GROW,SYNC-MEMOIZE-CALL-ARRAY,MEMOIZE-FLUSH1,PRINT-MEMO-MAX-SIZES,UPDATE-MEMO-MAX-SIZES,MAKE-INITIAL-MEMOIZE-PONS-TABLE,MAKE-INITIAL-MEMOIZE-HASH-TABLE" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="WITH-GLOBAL-MEMOIZE-LOCK">with-global-memoize-lock</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a>
  (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
    (with-lock-raw *global-memoize-lock* ,@FORMS)
    (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> ,@FORMS)))</pre>
  </div>

<div class="form-block macro" id="def-with-global-memoize-lock-static" data-defines="WITH-GLOBAL-MEMOIZE-LOCK-STATIC" data-references="PROGN,*GLOBAL-MEMOIZE-LOCK*,WITH-LOCK-RAW,QUASIQUOTE,*ENABLE-MULTITHREADED-MEMOIZATION*,IF,FORMS,&REST,DEFMACRO" data-used-by="MEMOIZE-FN-DEF" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="WITH-GLOBAL-MEMOIZE-LOCK-STATIC">with-global-memoize-lock-static</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-with-global-memoize-lock-static" data-sym="WITH-GLOBAL-MEMOIZE-LOCK-STATIC" title="(defmacro with-global-memoize-lock-static (&amp;rest forms)
  (if *enable-multithreaded-memoization*
      `(with-lock-raw *global-memoize-lock* . ,forms)
      `(progn . ,forms)))">with-global-memoize-lock-static</a>
  (&amp;rest forms)
  (if *enable-multithreaded-memoization*
    `(with-lock-raw *global-memoize-lock* . ,FORMS)
    `(<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> . ,FORMS)))</pre>
  </div>

<div class="form-block macro" id="def-mf-mht" data-defines="MF-MHT" data-references="*ENABLE-MULTITHREADED-MEMOIZATION*,HL-MHT,QUASIQUOTE,ASSOC-KEYWORD,IF,ARGS,&REST,DEFMACRO" data-used-by="MAKE-INITIAL-MEMOIZE-PONS-TABLE,MAKE-INITIAL-MEMOIZE-HASH-TABLE,INITIALIZE-NEVER-MEMOIZE-HT,INITIAL-MEMOIZE-INFO-HT" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-MHT">mf-mht</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a>
  (&amp;rest <a class="sym-link system" href="defuns.html#def-args" data-sym="ARGS">args</a>)
  (if (<a class="sym-link system" href="axioms.html#def-assoc-keyword" data-sym="ASSOC-KEYWORD">assoc-keyword</a> <span class="keyword">:shared</span> <a class="sym-link system" href="defuns.html#def-args" data-sym="ARGS">args</a>)
    `(hl-mht ,@ARGS)
    `(if *enable-multithreaded-memoization*
      (hl-mht <span class="keyword">:shared</span> <span class="keyword">:default</span> ,@ARGS)
      (hl-mht ,@ARGS))))</pre>
  </div>

<div class="form-block macro" id="def-mf-gethash" data-defines="MF-GETHASH" data-references="HASH-TABLE,THE,GETHASH,QUASIQUOTE,HT,KEY,DEFMACRO" data-used-by="MEMOIZED-VALUES,MF-SHORTEN,UPDATE-MEMO-MAX-SIZES,PONS-TABLE-DESIRED-SIZE,MEMOIZE-TABLE-DESIRED-SIZE,NEVER-MEMOIZE-P,PONS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-GETHASH">mf-gethash</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a>
  (key ht)
  `(gethash ,KEY (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> hash-table ,HT)))</pre>
  </div>

<div class="form-block macro" id="def-mf-sethash" data-defines="MF-SETHASH" data-references="HASH-TABLE,THE,GETHASH,SETF,QUASIQUOTE,HT,VAL,KEY,DEFMACRO" data-used-by="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS,MF-SHORTEN,MEMOIZE-FN,UPDATE-MEMO-MAX-SIZES,NEVER-MEMOIZE-FN,PONS,MF-NOTE-ARITY" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-SETHASH">mf-sethash</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a>
  (key val ht)
  `(setf (gethash ,KEY (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> hash-table ,HT)) ,VAL))</pre>
  </div>

<div class="form-block macro" id="def-mf-flex-acons" data-defines="MF-FLEX-ACONS" data-references="*ENABLE-MULTITHREADED-MEMOIZATION*,HL-FLEX-ACONS,QUASIQUOTE,AL,ELEM,DEFMACRO" data-used-by="PONS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-FLEX-ACONS">mf-flex-acons</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-flex-acons" data-sym="MF-FLEX-ACONS" title="(defmacro mf-flex-acons (elem al)
  `(hl-flex-acons ,elem ,al *enable-multithreaded-memoization*))">mf-flex-acons</a>
  (elem al)
  `(hl-flex-acons ,ELEM ,AL *enable-multithreaded-memoization*))</pre>
  </div>

<div class="form-block macro" id="def-mf-hash-table-count" data-defines="MF-HASH-TABLE-COUNT" data-references="HASH-TABLE,THE,HASH-TABLE-COUNT,QUASIQUOTE,HT,DEFMACRO" data-used-by="CLEAR-ONE-MEMO-AND-PONS-HASH,MEMOIZED-VALUES,MEMOIZE-FLUSH1,PRINT-MEMO-MAX-SIZES" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-HASH-TABLE-COUNT">mf-hash-table-count</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a>
  (ht)
  `(hash-table-count (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> hash-table ,HT)))</pre>
  </div>

<div class="form-block macro" id="def-mf-hash-table-size" data-defines="MF-HASH-TABLE-SIZE" data-references="HASH-TABLE,THE,HASH-TABLE-SIZE,QUASIQUOTE,HT,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-HASH-TABLE-SIZE">mf-hash-table-size</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-hash-table-size" data-sym="MF-HASH-TABLE-SIZE" title="(defmacro mf-hash-table-size (ht) `(hash-table-size (the hash-table ,ht)))">mf-hash-table-size</a>
  (ht)
  `(hash-table-size (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> hash-table ,HT)))</pre>
  </div>

<div class="form-block macro" id="def-mf-maphash" data-defines="MF-MAPHASH" data-references="HASH-TABLE,THE,MAPHASH,QUASIQUOTE,HT,LAM,DEFMACRO" data-used-by="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS,PRINT-CALL-STACK,MEMOIZED-VALUES,PRINT-MEMO-MAX-SIZES,INITIALIZE-NEVER-MEMOIZE-HT" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-MAPHASH">mf-maphash</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a>
  (lam ht)
  `(maphash ,LAM (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> hash-table ,HT)))</pre>
  </div>

<div class="form-block other" id="form-14" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-bytes*
  (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> <span class="keyword">:ccl</span> *features*)
      (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> <span class="keyword">:sbcl</span> *features*)
      (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> <span class="keyword">:lispworks</span> *features*))
    (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> most-positive-fixnum (expt <span class="number">2</span> <span class="number">32</span>))))</pre>
  </div>

<div class="form-block other" id="form-15" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-16" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-hits* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-17" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-mht-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-18" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-pons-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-19" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *record-time* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-20" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *mf-print-right-margin* <span class="number">79</span>)</pre>
  </div>

<div class="form-block other" id="form-21" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-bytes* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-22" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-23" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-calls-from* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-24" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-calls-to* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-25" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-hits* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-26" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-mht-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-27" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-pons-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-28" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-time* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-29" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-on-memo-tables* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-30" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *report-on-pons-tables* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-31" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *sort-to-from-by-calls* nil)</pre>
  </div>

<div class="form-block other" id="form-32" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-summary-order-reversed* nil)</pre>
  </div>

<div class="form-block other" id="form-33" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *mf-print-alist-width* <span class="number">45</span>)</pre>
  </div>

<div class="form-block other" id="form-34" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-summary-order-list*
  '(total-time number-of-calls))</pre>
  </div>

<div class="form-block other" id="form-35" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-summary-limit* <span class="number">100</span>)</pre>
  </div>

<div class="form-block other" id="form-36" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *condition-nil-as-hit* nil)</pre>
  </div>

<div class="form-block other" id="form-37" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defvar *never-memoize-ht*
  (let ((ht (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:test</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>)))
    (loop for
      x
      in
      <a class="sym-link system" href="axioms.html#def-_2Astobjs-out-invalid_2A" data-sym="*STOBJS-OUT-INVALID*">*stobjs-out-invalid*</a>
      do
      (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> x <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> ht))
    ht))</pre>
  </div>

<div class="form-block other" id="form-38" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *float-ticks/second* (float (expt <span class="number">2</span> <span class="number">31</span>)))</pre>
  </div>

<div class="form-block other" id="form-39" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *float-ticks/second-initialized* nil)</pre>
  </div>

<div class="form-block other" id="form-40" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (float *float-ticks/second*))</pre>
  </div>

<div class="form-block other" id="form-41" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *pons-call-counter* <span class="number">0</span>)</pre>
  </div>

<div class="form-block other" id="form-42" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *pons-misses-counter* <span class="number">0</span>)</pre>
  </div>

<div class="form-block other" id="form-43" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type mfixnum *pons-call-counter*))</pre>
  </div>

<div class="form-block other" id="form-44" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type mfixnum *pons-misses-counter*))</pre>
  </div>

<div class="form-block other" id="form-45" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *mf-shorten-ht* (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:test</span> '<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>))</pre>
  </div>

<div class="form-block function" id="def-initial-memoize-info-ht" data-defines="INITIAL-MEMOIZE-INFO-HT" data-references="MF-MHT,*ENABLE-MULTITHREADED-MEMOIZATION*,IF,DEFUN" data-part-name="INITIAL-MEMOIZE-INFO-HT" data-part-body="MF-MHT,*ENABLE-MULTITHREADED-MEMOIZATION*,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="INITIAL-MEMOIZE-INFO-HT">initial-memoize-info-ht</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-initial-memoize-info-ht" data-sym="INITIAL-MEMOIZE-INFO-HT" title="(defun initial-memoize-info-ht ()
  (if *enable-multithreaded-memoization*
      (mf-mht :shared :default)
      (mf-mht)))">initial-memoize-info-ht</a>
  nil
  (if *enable-multithreaded-memoization*
    (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>)
    (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a>)))</pre>
  </div>

<div class="form-block other" id="form-47" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-info-ht* (<a class="sym-link local-def" href="#def-initial-memoize-info-ht" data-sym="INITIAL-MEMOIZE-INFO-HT" title="(defun initial-memoize-info-ht ()
  (if *enable-multithreaded-memoization*
      (mf-mht :shared :default)
      (mf-mht)))">initial-memoize-info-ht</a>))</pre>
  </div>

<div class="form-block other" id="form-48" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (hash-table *memoize-info-ht*))</pre>
  </div>

<div class="form-block other" id="form-49" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *memo-max-sizes* (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>))</pre>
  </div>

<div class="form-block function" id="def-initial-memoize-call-array" data-defines="INITIAL-MEMOIZE-CALL-ARRAY" data-references="MFIXNUM,QUOTE,MAKE-ARRAY,N,DEFUN" data-used-by="SYNC-MEMOIZE-CALL-ARRAY" data-part-name="INITIAL-MEMOIZE-CALL-ARRAY" data-part-args="N" data-part-body="MFIXNUM,QUOTE,N,MAKE-ARRAY" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="INITIAL-MEMOIZE-CALL-ARRAY">initial-memoize-call-array</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-initial-memoize-call-array" data-sym="INITIAL-MEMOIZE-CALL-ARRAY" title="(defun initial-memoize-call-array (n)
  (make-array n :element-type &#39;mfixnum :initial-element 0))">initial-memoize-call-array</a>
  (n)
  (make-array n <span class="keyword">:element-type</span> 'mfixnum <span class="keyword">:initial-element</span> <span class="number">0</span>))</pre>
  </div>

<div class="form-block other" id="form-51" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-call-array* (<a class="sym-link local-def" href="#def-initial-memoize-call-array" data-sym="INITIAL-MEMOIZE-CALL-ARRAY" title="(defun initial-memoize-call-array (n)
  (make-array n :element-type &#39;mfixnum :initial-element 0))">initial-memoize-call-array</a> <span class="number">1</span>))</pre>
  </div>

<div class="form-block other" id="form-52" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) *memoize-call-array*))</pre>
  </div>

<div class="form-block other" id="form-53" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *callers-array* (make-array <span class="number">0</span>))</pre>
  </div>

<div class="form-block other" id="form-54" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type (simple-array <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) *callers-array*))</pre>
  </div>

<div class="form-block other" id="form-55" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *ma-bytes-index* <span class="number">0</span>)</pre>
  </div>

<div class="form-block other" id="form-56" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *ma-hits-index* <span class="number">1</span>)</pre>
  </div>

<div class="form-block other" id="form-57" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *ma-mht-index* <span class="number">2</span>)</pre>
  </div>

<div class="form-block other" id="form-58" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *ma-pons-index* <span class="number">4</span>)</pre>
  </div>

<div class="form-block other" id="form-59" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> mfixnum fixnum)
    *max-symbol-to-fixnum*
    *initial-2max-memoize-fns*
    *2max-memoize-fns*))</pre>
  </div>

<div class="form-block other" id="form-60" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *initial-max-symbol-to-fixnum* <span class="number">4</span>)</pre>
  </div>

<div class="form-block other" id="form-61" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *max-symbol-to-fixnum* *initial-max-symbol-to-fixnum*)</pre>
  </div>

<div class="form-block other" id="form-62" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *initial-2max-memoize-fns* <span class="number">1000</span>)</pre>
  </div>

<div class="form-block other" id="form-63" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *2max-memoize-fns* *initial-2max-memoize-fns*)</pre>
  </div>

<div class="form-block other" id="form-64" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-init-done* nil)</pre>
  </div>

<div class="form-block other" id="form-65" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *hons-gentemp-counter* <span class="number">0</span>)</pre>
  </div>

<div class="form-block other" id="form-66" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-use-attachment-warning-p* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-67" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defv *number-of-arguments-and-values-ht*
  (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>))</pre>
  </div>

<div class="form-block other" id="form-68" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (hash-table *number-of-arguments-and-values-ht*))</pre>
  </div>

<div class="form-block macro" id="def-our-syntax" data-defines="OUR-SYNTAX" data-references="*ACL2-READTABLE*,*READTABLE*,*THE-LIVE-STATE*,CURRENT-PACKAGE,QUOTE,F-GET-GLOBAL,FIND-PACKAGE-FAST,*PACKAGE*,LET,OUR-WITH-STANDARD-IO-SYNTAX,QUASIQUOTE,ARGS,&REST,DEFMACRO" data-used-by="PRINT-CALL-STACK,MF-MAKE-SYMBOL,OUR-SYNTAX-NICE" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="OUR-SYNTAX">our-syntax</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a>
  (&amp;rest <a class="sym-link system" href="defuns.html#def-args" data-sym="ARGS">args</a>)
  `(our-with-standard-io-syntax (let ((*package* (find-package-fast (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> '<a class="sym-link system" href="axioms.html#def-current-package" data-sym="CURRENT-PACKAGE">current-package</a> *the-live-state*))) (*readtable* *acl2-readtable*))
      ,@ARGS)))</pre>
  </div>

<div class="form-block macro" id="def-our-syntax-nice" data-defines="OUR-SYNTAX-NICE" data-references="*PRINT-MISER-WIDTH*,*PRINT-RIGHT-MARGIN*,*PRINT-READABLY*,T,*PRINT-PRETTY*,*PRINT-CASE*,SETQ,OUR-SYNTAX,QUASIQUOTE,ARGS,&REST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="OUR-SYNTAX-NICE">our-syntax-nice</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-our-syntax-nice" data-sym="OUR-SYNTAX-NICE" title="(defmacro our-syntax-nice (&amp;rest args)
  `(our-syntax (setq *print-case* :downcase) (setq *print-pretty* t)
               (setq *print-readably* nil)
               (setq *print-right-margin* ,*mf-print-right-margin*)
               (setq *print-miser-width* 100) ,@args))">our-syntax-nice</a>
  (&amp;rest <a class="sym-link system" href="defuns.html#def-args" data-sym="ARGS">args</a>)
  `(<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (setq *print-case* <span class="keyword">:downcase</span>)
    (setq *print-pretty* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
    (setq *print-readably* nil)
    (setq *print-right-margin* ,*MF-PRINT-RIGHT-MARGIN*)
    (setq *print-miser-width* <span class="number">100</span>)
    ,@ARGS))</pre>
  </div>

<div class="form-block function" id="def-mf-note-arity" data-defines="MF-NOTE-ARITY" data-references="*NUMBER-OF-ARGUMENTS-AND-VALUES-HT*,CONS,MF-SETHASH,NVALS,NARGS,FN,DEFUN" data-part-name="MF-NOTE-ARITY" data-part-args="NVALS,NARGS,FN" data-part-body="*NUMBER-OF-ARGUMENTS-AND-VALUES-HT*,NVALS,NARGS,CONS,FN,MF-SETHASH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-NOTE-ARITY">mf-note-arity</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mf-note-arity" data-sym="MF-NOTE-ARITY" title="(defun mf-note-arity (fn nargs nvals)
  (mf-sethash fn (cons nargs nvals) *number-of-arguments-and-values-ht*))">mf-note-arity</a>
  (fn nargs nvals)
  (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn
    (cons nargs nvals)
    *number-of-arguments-and-values-ht*))</pre>
  </div>

<div class="form-block function" id="def-memoize-look-up-def-raw" data-defines="MEMOIZE-LOOK-UP-DEF-RAW" data-references="SAVE-DEF,ERROR,NAMED-LAMBDA,LAMBDA,CAR,EQ,OR,ASSERT,FUNCTION-LAMBDA-EXPRESSION,AND,LAM,SYMBOL-FUNCTION,FN,LET*,T,CDR,COND,ACL2-SAVED-DEF,QUOTE,GET,TEMP,LET,QUIET-P,SYM,DEFUN" data-used-by="MEMOIZE-LOOK-UP-DEF" data-part-name="MEMOIZE-LOOK-UP-DEF-RAW" data-part-args="QUIET-P,SYM" data-part-body="SAVE-DEF,ERROR,QUIET-P,NAMED-LAMBDA,LAMBDA,CAR,EQ,OR,ASSERT,FUNCTION-LAMBDA-EXPRESSION,AND,LAM,SYMBOL-FUNCTION,FN,LET*,T,CDR,COND,ACL2-SAVED-DEF,QUOTE,SYM,GET,TEMP,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-LOOK-UP-DEF-RAW">memoize-look-up-def-raw</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-look-up-def-raw" data-sym="MEMOIZE-LOOK-UP-DEF-RAW" title="(defun memoize-look-up-def-raw (sym quiet-p)
  (let ((temp (get sym &#39;acl2-saved-def)))
    (cond (temp (cdr temp))
          (t
           (let* ((fn (symbol-function sym))
...">memoize-look-up-def-raw</a>
  (sym quiet-p)
  (let ((temp (get sym 'acl2-saved-def)))
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (temp (cdr temp))
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((fn (symbol-function sym)) (lam (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> fn (function-lambda-expression fn))))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (lam (assert (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car lam) 'lambda)
                  (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car lam) 'named-lambda)))
              lam)
            (quiet-p nil)
            (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (error <span class="string">"Lisp cannot find a definition for ~
                                ~s.~%Consider using ~s or supplying to ~
                                ~%memoize(-fn) an explicit :CL-DEFUN ~
                                argument.~a"</span>
                sym
                'save-def
                <span class="string">""</span>))))))))</pre>
  </div>

<div class="form-block other" id="form-73" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mf-len-inputs
  (fn)
  (assert (symbolp fn))
  (assert (fboundp fn))
  (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (macro-function fn)))
  (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (special-operator-p fn)))
  (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (let ((pair (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *number-of-arguments-and-values-ht*)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (consp pair) (integerp (car pair)) (car pair)))
    (let ((<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn '<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a> *the-live-state*))))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)) (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)))
    (let ((def (<a class="sym-link local-def" href="#def-memoize-look-up-def-raw" data-sym="MEMOIZE-LOOK-UP-DEF-RAW" title="(defun memoize-look-up-def-raw (sym quiet-p)
  (let ((temp (get sym &#39;acl2-saved-def)))
    (cond (temp (cdr temp))
          (t
           (let* ((fn (symbol-function sym))
...">memoize-look-up-def-raw</a> fn <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> def (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> def))))))</pre>
  </div>

<div class="form-block other" id="form-74" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mf-len-outputs
  (fn)
  (assert (symbolp fn))
  (assert (fboundp fn))
  (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (macro-function fn)))
  (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (special-operator-p fn)))
  (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (let ((pair (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *number-of-arguments-and-values-ht*)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (consp pair) (integerp (cdr pair)) (cdr pair)))
    (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((state *the-live-state*) (<a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a> (<a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a> state)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn '<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a>)))
        (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> fn <a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a>))))
    (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (get fn 'acl2-saved-def) <span class="number">1</span>)))</pre>
  </div>

<div class="form-block other" id="form-75" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defconstant *10-days-in-seconds* (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">10</span> <span class="number">24</span> <span class="number">60</span> <span class="number">60</span>))</pre>
  </div>

<div class="form-block function" id="def-10-days" data-defines="10-DAYS" data-references="*FLOAT-TICKS/SECOND*,CEILING,*10-DAYS-IN-SECONDS*,*,N,LET,DEFUN" data-part-name="10-DAYS" data-part-body="*FLOAT-TICKS/SECOND*,CEILING,*10-DAYS-IN-SECONDS*,*,N,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="10-DAYS">10-days</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-10-days" data-sym="10-DAYS" title="(defun 10-days ()
  (let ((n (* *10-days-in-seconds* (ceiling *float-ticks/second*))))
    n))">10-days</a>
  nil
  (let ((n (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> *10-days-in-seconds* (ceiling *float-ticks/second*))))
    n))</pre>
  </div>

<div class="form-block other" id="form-77" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *10-days* (<a class="sym-link local-def" href="#def-10-days" data-sym="10-DAYS" title="(defun 10-days ()
  (let ((n (* *10-days-in-seconds* (ceiling *float-ticks/second*))))
    n))">10-days</a>))</pre>
  </div>

<div class="form-block other" id="form-78" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type mfixnum *10-days*))</pre>
  </div>

<div class="form-block other" id="form-79" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *float-internal-time-units-per-second*
  (float internal-time-units-per-second))</pre>
  </div>

<div class="form-block other" id="form-80" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (float *float-internal-time-units-per-second*))</pre>
  </div>

<div class="form-block macro" id="def-internal-real-ticks" data-defines="INTERNAL-REAL-TICKS" data-references="MOST-POSITIVE-MFIXNUM,GET-INTERNAL-REAL-TIME,LOGAND,THE-MFIXNUM,QUOTE,DEFMACRO" data-used-by="PRINT-CALL-STACK" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="INTERNAL-REAL-TICKS">internal-real-ticks</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-internal-real-ticks" data-sym="INTERNAL-REAL-TICKS" title="(defmacro internal-real-ticks ()
  &#39;(the-mfixnum
    (logand (the-mfixnum (get-internal-real-time)) most-positive-mfixnum)))">internal-real-ticks</a>
  nil
  '(the-mfixnum (<a class="sym-link system" href="axioms.html#def-logand" data-sym="LOGAND">logand</a> (the-mfixnum (get-internal-real-time))
      most-positive-mfixnum)))</pre>
  </div>

<div class="form-block other" id="form-82" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output float-ticks/second-init
  nil
  (unless *float-ticks/second-initialized*
    (setq *float-ticks/second*
      *float-internal-time-units-per-second*)
    (setq *10-days* (<a class="sym-link local-def" href="#def-10-days" data-sym="10-DAYS" title="(defun 10-days ()
  (let ((n (* *10-days-in-seconds* (ceiling *float-ticks/second*))))
    n))">10-days</a>))
    (setq *float-ticks/second-initialized* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
    (check-type *float-ticks/second*
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> float (satisfies plusp)))))</pre>
  </div>

<div class="form-block macro" id="def-safe-incf-aux-error" data-defines="SAFE-INCF-AUX-ERROR" data-references="MOST-POSITIVE-MFIXNUM,MFIXNUM,THE,SETF,PROGN,T,LIST,ERROR,QUOTE,COND,QUASIQUOTE,WHERE,INC,X,DEFMACRO" data-used-by="SAFE-INCF-AUX" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SAFE-INCF-AUX-ERROR">safe-incf-aux-error</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-safe-incf-aux-error" data-sym="SAFE-INCF-AUX-ERROR" title="(defmacro safe-incf-aux-error (x inc where)
  `(cond
    (&#39;,where
     (error &quot;~%; SAFE-INCF-AUX: ** Error: ~a.&quot;
            (list :x ,x :inc ,inc :where &#39;,where)))">safe-incf-aux-error</a>
  (x inc where)
  `(<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (',WHERE (error <span class="string">"~%; SAFE-INCF-AUX: ** Error: ~a."</span>
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> <span class="keyword">:x</span> ,X <span class="keyword">:inc</span> ,INC <span class="keyword">:where</span> ',WHERE)))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (setf (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> mfixnum ,X) most-positive-mfixnum) nil))))</pre>
  </div>

<div class="form-block macro" id="def-safe-incf-aux" data-defines="SAFE-INCF-AUX" data-references="+,THE,SETF,-,<=,V,T,SAFE-INCF,MFIXNUM,TYPE,DECLARE,THE-MFIXNUM,QUASIQUOTE,MAKE-SYMBOL,IDX,LET,CONSP,NTH,SVREF,AREF,QUOTE,CAR,MEMBER,LEN,EQUAL,TRUE-LISTP,SAFE-INCF-AUX-ERROR,>,MOST-POSITIVE-MFIXNUM,<,AND,SYMBOLP,OR,NOT,COND,WHERE,&OPTIONAL,INC,X,DEFMACRO" data-used-by="SAFE-INCF" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SAFE-INCF-AUX">safe-incf-aux</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-safe-incf-aux" data-sym="SAFE-INCF-AUX" title="(defmacro safe-incf-aux (x inc &amp;optional where)
  (cond
   ((not (or (symbolp inc) (and (&lt; inc most-positive-mfixnum) (&gt; inc 0))))
    (safe-incf-aux-error x inc where))
   ((and (true-listp x) (equal (len x) 3) (member (car x) &#39;(aref svref))
...">safe-incf-aux</a>
  (x inc &amp;optional where)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (symbolp inc)
         (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (&lt; inc most-positive-mfixnum) (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> inc <span class="number">0</span>)))) (<a class="sym-link local-def" href="#def-safe-incf-aux-error" data-sym="SAFE-INCF-AUX-ERROR" title="(defmacro safe-incf-aux-error (x inc where)
  `(cond
    (&#39;,where
     (error &quot;~%; SAFE-INCF-AUX: ** Error: ~a.&quot;
            (list :x ,x :inc ,inc :where &#39;,where)))">safe-incf-aux-error</a> x inc where))
    ((<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-true-listp" data-sym="TRUE-LISTP">true-listp</a> x)
       (equal (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> x) <span class="number">3</span>)
       (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> (car x) '(aref svref))
       (symbolp (<a class="sym-link system" href="axioms.html#def-nth" data-sym="NTH">nth</a> <span class="number">1</span> x))
       (consp (<a class="sym-link system" href="axioms.html#def-nth" data-sym="NTH">nth</a> <span class="number">2</span> x))) (let ((idx (make-symbol <span class="string">"IDX"</span>)))
        `(let ((,IDX (the-mfixnum ,(NTH 2 X))))
          (declare (type mfixnum ,IDX))
          (<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> (,(NTH 0 X) ,(NTH 1 X) ,IDX) ,INC ,WHERE))))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((v (make-symbol <span class="string">"V"</span>)))
        `(let ((,V (the-mfixnum ,X)))
          (declare (type mfixnum ,V))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> ,V
               (the-mfixnum (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> most-positive-mfixnum (the-mfixnum ,INC)))) (setf (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> mfixnum ,X)
                (the-mfixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> ,V (the-mfixnum ,INC))))
              nil)
            (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-safe-incf-aux-error" data-sym="SAFE-INCF-AUX-ERROR" title="(defmacro safe-incf-aux-error (x inc where)
  `(cond
    (&#39;,where
     (error &quot;~%; SAFE-INCF-AUX: ** Error: ~a.&quot;
            (list :x ,x :inc ,inc :where &#39;,where)))">safe-incf-aux-error</a> ,X ,INC ,WHERE))))))))</pre>
  </div>

<div class="form-block macro" id="def-safe-incf" data-defines="SAFE-INCF" data-references="MFIXNUM,TYPE,DECLARE,MAKE-SYMBOL,INCV,LET,T,THE-MFIXNUM,>=,SYMBOLP,SAFE-INCF-AUX,QUASIQUOTE,<=,IF,INTEGERP,COND,WHERE,&OPTIONAL,INC,X,DEFMACRO" data-used-by="COMPUTE-CALLS-AND-TIMES,SAFE-INCF-PONS,MEMOIZE-FN-INNER-BODY,INCF-PONS-MISSES,INCF-PONS-CALLS,SAFE-INCF-AUX" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SAFE-INCF">safe-incf</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a>
  (x inc &amp;optional where)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((integerp inc) (if (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> inc <span class="number">0</span>)
        nil
        `(<a class="sym-link local-def" href="#def-safe-incf-aux" data-sym="SAFE-INCF-AUX" title="(defmacro safe-incf-aux (x inc &amp;optional where)
  (cond
   ((not (or (symbolp inc) (and (&lt; inc most-positive-mfixnum) (&gt; inc 0))))
    (safe-incf-aux-error x inc where))
   ((and (true-listp x) (equal (len x) 3) (member (car x) &#39;(aref svref))
...">safe-incf-aux</a> ,X ,INC ,WHERE)))
    ((symbolp inc) `(if (<a class="sym-link system" href="axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> <span class="number">0</span> (the-mfixnum ,INC))
        nil
        (<a class="sym-link local-def" href="#def-safe-incf-aux" data-sym="SAFE-INCF-AUX" title="(defmacro safe-incf-aux (x inc &amp;optional where)
  (cond
   ((not (or (symbolp inc) (and (&lt; inc most-positive-mfixnum) (&gt; inc 0))))
    (safe-incf-aux-error x inc where))
   ((and (true-listp x) (equal (len x) 3) (member (car x) &#39;(aref svref))
...">safe-incf-aux</a> ,X ,INC ,WHERE)))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((incv (make-symbol <span class="string">"INCV"</span>)))
        `(let ((,INCV (the-mfixnum ,INC)))
          (declare (type mfixnum ,INCV))
          (if (<a class="sym-link system" href="axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> <span class="number">0</span> ,INCV)
            nil
            (<a class="sym-link local-def" href="#def-safe-incf-aux" data-sym="SAFE-INCF-AUX" title="(defmacro safe-incf-aux (x inc &amp;optional where)
  (cond
   ((not (or (symbolp inc) (and (&lt; inc most-positive-mfixnum) (&gt; inc 0))))
    (safe-incf-aux-error x inc where))
   ((and (true-listp x) (equal (len x) 3) (member (car x) &#39;(aref svref))
...">safe-incf-aux</a> ,X ,INCV ,WHERE)))))))</pre>
  </div>

<div class="form-block macro" id="def-incf-pons-calls" data-defines="INCF-PONS-CALLS" data-references="*PONS-CALL-COUNTER*,SAFE-INCF,QUOTE,DEFMACRO" data-used-by="PONS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="INCF-PONS-CALLS">incf-pons-calls</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-incf-pons-calls" data-sym="INCF-PONS-CALLS" title="(defmacro incf-pons-calls () &#39;(safe-incf *pons-call-counter* 1))">incf-pons-calls</a>
  nil
  '(<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> *pons-call-counter* <span class="number">1</span>))</pre>
  </div>

<div class="form-block macro" id="def-incf-pons-misses" data-defines="INCF-PONS-MISSES" data-references="*PONS-MISSES-COUNTER*,SAFE-INCF,QUOTE,DEFMACRO" data-used-by="PONS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="INCF-PONS-MISSES">incf-pons-misses</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-incf-pons-misses" data-sym="INCF-PONS-MISSES" title="(defmacro incf-pons-misses () &#39;(safe-incf *pons-misses-counter* 1))">incf-pons-misses</a>
  nil
  '(<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> *pons-misses-counter* <span class="number">1</span>))</pre>
  </div>

<div class="form-block function" id="def-pons" data-defines="PONS" data-references="MF-SETHASH,WHEN,MF-FLEX-ACONS,NEW-FLEX-ALIST,CONS,NEW-CONS,LISTP,WAS-ALISTP,INCF-PONS-MISSES,T,COND,HL-FLEX-ASSOC,ENTRY,MF-GETHASH,FLEX-ALIST,LET*,INCF-PONS-CALLS,HASH-TABLE,DECLARE,HT,Y,X,DEFUN" data-used-by="PIST*" data-part-name="PONS" data-part-args="HT,Y,X" data-part-declare="HT,HASH-TABLE,DECLARE" data-part-body="INCF-PONS-CALLS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PONS">pons</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-pons" data-sym="PONS" title="(defun pons (x y ht)
  (declare (hash-table ht))
  (incf-pons-calls)
  (let* ((flex-alist (mf-gethash y ht)) (entry (hl-flex-assoc x flex-alist)))
    (cond (entry)
...">pons</a>
  (x y ht)
  (declare (hash-table ht))
  (<a class="sym-link local-def" href="#def-incf-pons-calls" data-sym="INCF-PONS-CALLS" title="(defmacro incf-pons-calls () &#39;(safe-incf *pons-call-counter* 1))">incf-pons-calls</a>)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((flex-alist (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> y ht)) (entry (hl-flex-assoc x flex-alist)))
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (entry)
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-incf-pons-misses" data-sym="INCF-PONS-MISSES" title="(defmacro incf-pons-misses () &#39;(safe-incf *pons-misses-counter* 1))">incf-pons-misses</a>)
        (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((was-alistp (<a class="sym-link system" href="axioms.html#def-listp" data-sym="LISTP">listp</a> flex-alist)) (new-cons (cons x y))
            (new-flex-alist (<a class="sym-link local-def" href="#def-mf-flex-acons" data-sym="MF-FLEX-ACONS" title="(defmacro mf-flex-acons (elem al)
  `(hl-flex-acons ,elem ,al *enable-multithreaded-memoization*))">mf-flex-acons</a> new-cons flex-alist)))
          (when was-alistp (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> y new-flex-alist ht))
          new-cons)))))</pre>
  </div>

<div class="form-block macro" id="def-pist_2A" data-defines="PIST*" data-references="CONS,PONS,QUOTE,LIST,T,CAR,CDR,ATOM,COND,X,&REST,TABLE,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="PIST*">pist*</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-pist_2A" data-sym="PIST*" title="(defmacro pist* (table &amp;rest x)
  (cond ((atom x) x) ((atom (cdr x)) (car x))
        (t (list &#39;pons (car x) (cons &#39;pist* (cons table (cdr x))) table))))">pist*</a>
  (<a class="sym-link system" href="axioms.html#def-table" data-sym="TABLE">table</a> &amp;rest x)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> x) x)
    ((<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> (cdr x)) (car x))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-pons" data-sym="PONS" title="(defun pons (x y ht)
  (declare (hash-table ht))
  (incf-pons-calls)
  (let* ((flex-alist (mf-gethash y ht)) (entry (hl-flex-assoc x flex-alist)))
    (cond (entry)
...">pons</a>
        (car x)
        (cons '<a class="sym-link local-def" href="#def-pist_2A" data-sym="PIST*" title="(defmacro pist* (table &amp;rest x)
  (cond ((atom x) x) ((atom (cdr x)) (car x))
        (t (list &#39;pons (car x) (cons &#39;pist* (cons table (cdr x))) table))))">pist*</a> (cons <a class="sym-link system" href="axioms.html#def-table" data-sym="TABLE">table</a> (cdr x)))
        <a class="sym-link system" href="axioms.html#def-table" data-sym="TABLE">table</a>))))</pre>
  </div>

<div class="form-block function" id="def-initialize-never-memoize-ht" data-defines="INITIALIZE-NEVER-MEMOIZE-HT" data-references="DO,*COMMON-LISP-SYMBOLS-FROM-MAIN-LISP-PACKAGE*,IN,FOR,LOOP,IGNORE,DECLARE,VAL,KEY,LAMBDA,MF-MAPHASH,NEVER-MEMOIZE-FN,MACRO-FUNCTION,NOT,FBOUNDP,AND,WHEN,FN,UPDATE-NMHT,FLET,NOTE-FNS-IN-FILE,EQ,QUOTE,MF-MHT,HT,LET,DEFUN" data-part-name="INITIALIZE-NEVER-MEMOIZE-HT" data-part-body="DO,*COMMON-LISP-SYMBOLS-FROM-MAIN-LISP-PACKAGE*,IN,FOR,LOOP,IGNORE,DECLARE,VAL,KEY,LAMBDA,MF-MAPHASH,NEVER-MEMOIZE-FN,MACRO-FUNCTION,NOT,FBOUNDP,AND,WHEN,FN,UPDATE-NMHT,FLET,NOTE-FNS-IN-FILE,EQ,QUOTE,MF-MHT,HT,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="INITIALIZE-NEVER-MEMOIZE-HT">initialize-never-memoize-ht</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-initialize-never-memoize-ht" data-sym="INITIALIZE-NEVER-MEMOIZE-HT" title="(defun initialize-never-memoize-ht ()
  (let ((ht (mf-mht :test &#39;eq :shared :default)))
    (note-fns-in-file &quot;hons-raw.lisp&quot; ht)
    (note-fns-in-file &quot;memoize-raw.lisp&quot; ht)
    (flet ((update-nmht (fn)
...">initialize-never-memoize-ht</a>
  nil
  (let ((ht (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:test</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>)))
    (note-fns-in-file <span class="string">"hons-raw.lisp"</span> ht)
    (note-fns-in-file <span class="string">"memoize-raw.lisp"</span> ht)
    (flet ((update-nmht (fn)
         (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (fboundp fn) (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (macro-function fn)))
           (<a class="sym-link local-def" href="#def-never-memoize-fn" data-sym="NEVER-MEMOIZE-FN" title="(defun never-memoize-fn (fn) (mf-sethash fn t *never-memoize-ht*) nil)">never-memoize-fn</a> fn))))
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (key val) (declare (ignore val)) (update-nmht key))
        ht)
      (loop for
        fn
        in
        <a class="sym-link system" href="axioms.html#def-_2Acommon-lisp-symbols-from-main-lisp-package_2A" data-sym="*COMMON-LISP-SYMBOLS-FROM-MAIN-LISP-PACKAGE*">*common-lisp-symbols-from-main-lisp-package*</a>
        do
        (update-nmht fn))))
  nil)</pre>
  </div>

<div class="form-block function" id="def-never-memoize-fn" data-defines="NEVER-MEMOIZE-FN" data-references="*NEVER-MEMOIZE-HT*,T,MF-SETHASH,FN,DEFUN" data-used-by="INITIALIZE-NEVER-MEMOIZE-HT" data-part-name="NEVER-MEMOIZE-FN" data-part-args="FN" data-part-body="*NEVER-MEMOIZE-HT*,T,FN,MF-SETHASH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NEVER-MEMOIZE-FN">never-memoize-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-never-memoize-fn" data-sym="NEVER-MEMOIZE-FN" title="(defun never-memoize-fn (fn) (mf-sethash fn t *never-memoize-ht*) nil)">never-memoize-fn</a>
  (fn)
  (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> *never-memoize-ht*)
  nil)</pre>
  </div>

<div class="form-block function" id="def-never-memoize-p" data-defines="NEVER-MEMOIZE-P" data-references="*NEVER-MEMOIZE-HT*,MF-GETHASH,FN,DEFUN" data-used-by="MEMOIZE-FN-INIT" data-part-name="NEVER-MEMOIZE-P" data-part-args="FN" data-part-body="*NEVER-MEMOIZE-HT*,FN,MF-GETHASH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NEVER-MEMOIZE-P">never-memoize-p</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-never-memoize-p" data-sym="NEVER-MEMOIZE-P" title="(defun never-memoize-p (fn) (mf-gethash fn *never-memoize-ht*))">never-memoize-p</a>
  (fn)
  (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *never-memoize-ht*))</pre>
  </div>

<div class="form-block other" id="form-93" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="basis-a.html#def-defrec" data-sym="DEFREC">defrec</a> memoize-info-ht-entry
  (ext-anc-attachments start-ticks
    num
    tablename
    ponstablename
    condition
    inline
    memoized-fn
    old-fn
    fn
    sts
    cl-defun
    <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
    commutative
    specials
    <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>
    <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>
    record-bytes
    record-calls
    record-hits
    record-mht-calls
    record-pons-calls
    record-time
    forget
    memo-table-init-size
    aokp
    invoke)
  <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block macro" id="def-ma-index" data-defines="MA-INDEX" data-references="MA-INDEX-FROM-COL-BASE,EQL,IF,THE-MFIXNUM,*,QUASIQUOTE,COL-BASE,LET,*2MAX-MEMOIZE-FNS*,QUOTE,2MMF,ROW,&OPTIONAL,COL,DEFMACRO" data-used-by="COMPUTE-CALLS-AND-TIMES,MEMOIZE-FN,SYNC-MEMOIZE-CALL-ARRAY,OUTSIDE-CALLER-COL-BASE,MA-INDEX-TICKS,MA-INDEX-CALLS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MA-INDEX">ma-index</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a>
  (col &amp;optional (row <span class="number">0</span>) (2mmf '*2max-memoize-fns*))
  (let ((col-base `(<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> ,2MMF (the-mfixnum ,COL))))
    (if (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> row <span class="number">0</span>)
      `(the-mfixnum ,COL-BASE)
      `(<a class="sym-link local-def" href="#def-ma-index-from-col-base" data-sym="MA-INDEX-FROM-COL-BASE" title="(defmacro ma-index-from-col-base (col-base row)
  `(the-mfixnum (+ (the-mfixnum ,col-base) (the-mfixnum ,row))))">ma-index-from-col-base</a> ,COL-BASE ,ROW))))</pre>
  </div>

<div class="form-block macro" id="def-ma-index-from-col-base" data-defines="MA-INDEX-FROM-COL-BASE" data-references="+,THE-MFIXNUM,QUASIQUOTE,ROW,COL-BASE,DEFMACRO" data-used-by="COMPUTE-CALLS-AND-TIMES,MEMOIZE-FN,MA-INDEX" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MA-INDEX-FROM-COL-BASE">ma-index-from-col-base</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ma-index-from-col-base" data-sym="MA-INDEX-FROM-COL-BASE" title="(defmacro ma-index-from-col-base (col-base row)
  `(the-mfixnum (+ (the-mfixnum ,col-base) (the-mfixnum ,row))))">ma-index-from-col-base</a>
  (col-base row)
  `(the-mfixnum (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (the-mfixnum ,COL-BASE) (the-mfixnum ,ROW))))</pre>
  </div>

<div class="form-block macro" id="def-ma-index-calls" data-defines="MA-INDEX-CALLS" data-references="MA-INDEX,EQL,IF,*,THE-MFIXNUM,QUASIQUOTE,2CHILD,LET,*2MAX-MEMOIZE-FNS*,QUOTE,2MMF,PARENT,&OPTIONAL,CHILD,DEFMACRO" data-used-by="COMPUTE-CALLS-AND-TIMES" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MA-INDEX-CALLS">ma-index-calls</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ma-index-calls" data-sym="MA-INDEX-CALLS" title="(defmacro ma-index-calls
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child `(the-mfixnum (* 2 (the-mfixnum ,child)))))
    (if (eql parent 0)
        2child">ma-index-calls</a>
  (child &amp;optional (parent <span class="number">0</span>) (2mmf '*2max-memoize-fns*))
  (let ((2child `(the-mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">2</span> (the-mfixnum ,CHILD)))))
    (if (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> parent <span class="number">0</span>)
      2child
      `(<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> ,PARENT ,2CHILD ,2MMF))))</pre>
  </div>

<div class="form-block macro" id="def-ma-index-ticks" data-defines="MA-INDEX-TICKS" data-references="MA-INDEX,EQL,IF,*,1+,THE-MFIXNUM,QUASIQUOTE,2CHILD+1,LET,*2MAX-MEMOIZE-FNS*,QUOTE,2MMF,PARENT,&OPTIONAL,CHILD,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MA-INDEX-TICKS">ma-index-ticks</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-ma-index-ticks" data-sym="MA-INDEX-TICKS" title="(defmacro ma-index-ticks
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child+1 `(the-mfixnum (1+ (the-mfixnum (* 2 (the-mfixnum ,child)))))))
    (if (eql parent 0)
        2child+1">ma-index-ticks</a>
  (child &amp;optional (parent <span class="number">0</span>) (2mmf '*2max-memoize-fns*))
  (let ((2child+1 `(the-mfixnum (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> (the-mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">2</span> (the-mfixnum ,CHILD)))))))
    (if (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> parent <span class="number">0</span>)
      2child+1
      `(<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> ,PARENT ,2CHILD+1 ,2MMF))))</pre>
  </div>

<div class="form-block function" id="def-outside-caller-col-base" data-defines="OUTSIDE-CALLER-COL-BASE" data-references="*INITIAL-MAX-SYMBOL-TO-FIXNUM*,MA-INDEX,DEFUN" data-used-by="MEMOIZE-CALL-ARRAY-GROW,SYNC-MEMOIZE-CALL-ARRAY" data-part-name="OUTSIDE-CALLER-COL-BASE" data-part-body="*INITIAL-MAX-SYMBOL-TO-FIXNUM*,MA-INDEX" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="OUTSIDE-CALLER-COL-BASE">outside-caller-col-base</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-outside-caller-col-base" data-sym="OUTSIDE-CALLER-COL-BASE" title="(defun outside-caller-col-base () (ma-index *initial-max-symbol-to-fixnum*))">outside-caller-col-base</a>
  nil
  (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> *initial-max-symbol-to-fixnum*))</pre>
  </div>

<div class="form-block other" id="form-99" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defvar *caller*
  (let ((val (<a class="sym-link local-def" href="#def-outside-caller-col-base" data-sym="OUTSIDE-CALLER-COL-BASE" title="(defun outside-caller-col-base () (ma-index *initial-max-symbol-to-fixnum*))">outside-caller-col-base</a>)))
    (check-type val mfixnum)
    val))</pre>
  </div>

<div class="form-block other" id="form-100" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(declaim (type mfixnum *caller*))</pre>
  </div>

<div class="form-block other" id="form-101" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="basis-a.html#def-defrec" data-sym="DEFREC">defrec</a> memo-max-sizes-entry
  (num-clears max-pt-size max-mt-size avg-pt-size avg-mt-size)
  <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block other" id="form-102" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *memoize-verbose* nil)</pre>
  </div>

<div class="form-block function" id="def-memoize-table-desired-size" data-defines="MEMOIZE-TABLE-DESIRED-SIZE" data-references="T,FORMAT,*MEMOIZE-VERBOSE*,-,INTEGER-LENGTH,<,AND,WHEN,*MHT-DEFAULT-SIZE*,MAX,FINAL-GUESS,MIN,CAPPED-GUESS,*,CEILING,OUR-GUESS,AVG-MT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NCLEARS,NOT,IF,*MEMO-MAX-SIZES*,MF-GETHASH,MAX-SIZES,LET*,MIN-SIZE,FN,DEFUN" data-used-by="CLEAR-ONE-MEMO-AND-PONS-HASH,MAKE-INITIAL-MEMOIZE-HASH-TABLE" data-part-name="MEMOIZE-TABLE-DESIRED-SIZE" data-part-args="MIN-SIZE,FN" data-part-body="T,FORMAT,*MEMOIZE-VERBOSE*,-,INTEGER-LENGTH,<,AND,WHEN,*MHT-DEFAULT-SIZE*,MAX,FINAL-GUESS,MIN,CAPPED-GUESS,*,CEILING,OUR-GUESS,AVG-MT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NCLEARS,MIN-SIZE,NOT,IF,*MEMO-MAX-SIZES*,FN,MF-GETHASH,MAX-SIZES,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-TABLE-DESIRED-SIZE">memoize-table-desired-size</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-table-desired-size" data-sym="MEMOIZE-TABLE-DESIRED-SIZE" title="(defun memoize-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        min-size
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">memoize-table-desired-size</a>
  (fn min-size)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((max-sizes (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memo-max-sizes*)))
    (if (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> max-sizes)
      min-size
      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((nclears (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry max-sizes <span class="keyword">:num-clears</span>)) (avg-mt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry max-sizes <span class="keyword">:avg-mt-size</span>))
          (our-guess (ceiling (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">1.2</span> avg-mt-size)))
          (capped-guess (min our-guess (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> nclears <span class="number">44000</span>)))
          (final-guess (max *mht-default-size* min-size capped-guess)))
        (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (&lt; (<a class="sym-link system" href="axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> nclears <span class="number">1</span>)) (<a class="sym-link system" href="axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> nclears))
            *memoize-verbose*)
          (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
            <span class="string">"; ~s memo table: ~s clears, avg size ~s, guess ~s, final ~
                     ~s~%"</span>
            fn
            nclears
            avg-mt-size
            our-guess
            final-guess))
        final-guess))))</pre>
  </div>

<div class="form-block function" id="def-pons-table-desired-size" data-defines="PONS-TABLE-DESIRED-SIZE" data-references="T,FORMAT,*MEMOIZE-VERBOSE*,-,INTEGER-LENGTH,<,AND,WHEN,MAX,FINAL-GUESS,MIN,CAPPED-GUESS,*,CEILING,OUR-GUESS,AVG-PT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NCLEARS,*MHT-DEFAULT-SIZE*,NOT,IF,*MEMO-MAX-SIZES*,MF-GETHASH,MAX-SIZES,LET*,MIN-SIZE,FN,DEFUN" data-used-by="CLEAR-ONE-MEMO-AND-PONS-HASH,MAKE-INITIAL-MEMOIZE-PONS-TABLE" data-part-name="PONS-TABLE-DESIRED-SIZE" data-part-args="MIN-SIZE,FN" data-part-body="T,FORMAT,*MEMOIZE-VERBOSE*,-,INTEGER-LENGTH,<,AND,WHEN,MIN-SIZE,MAX,FINAL-GUESS,MIN,CAPPED-GUESS,*,CEILING,OUR-GUESS,AVG-PT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NCLEARS,*MHT-DEFAULT-SIZE*,NOT,IF,*MEMO-MAX-SIZES*,FN,MF-GETHASH,MAX-SIZES,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PONS-TABLE-DESIRED-SIZE">pons-table-desired-size</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-pons-table-desired-size" data-sym="PONS-TABLE-DESIRED-SIZE" title="(defun pons-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        *mht-default-size*
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">pons-table-desired-size</a>
  (fn min-size)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((max-sizes (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memo-max-sizes*)))
    (if (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> max-sizes)
      *mht-default-size*
      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((nclears (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry max-sizes <span class="keyword">:num-clears</span>)) (avg-pt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry max-sizes <span class="keyword">:avg-pt-size</span>))
          (our-guess (ceiling (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">1.2</span> avg-pt-size)))
          (capped-guess (min our-guess (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> nclears <span class="number">44000</span>)))
          (final-guess (max *mht-default-size* min-size capped-guess)))
        (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (&lt; (<a class="sym-link system" href="axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> nclears <span class="number">1</span>)) (<a class="sym-link system" href="axioms.html#def-integer-length" data-sym="INTEGER-LENGTH">integer-length</a> nclears))
            *memoize-verbose*)
          (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
            <span class="string">"; ~s pons table: ~s clears, avg size ~s, guess ~s, final ~
                     ~s~%"</span>
            fn
            nclears
            avg-pt-size
            our-guess
            final-guess))
        final-guess))))</pre>
  </div>

<div class="form-block function" id="def-make-initial-memoize-hash-table" data-defines="MAKE-INITIAL-MEMOIZE-HASH-TABLE" data-references="MEMOIZE-TABLE-DESIRED-SIZE,MF-MHT,WITH-GLOBAL-MEMOIZE-LOCK,INIT-SIZE,FN,DEFUN" data-part-name="MAKE-INITIAL-MEMOIZE-HASH-TABLE" data-part-args="INIT-SIZE,FN" data-part-body="INIT-SIZE,FN,MEMOIZE-TABLE-DESIRED-SIZE,MF-MHT,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MAKE-INITIAL-MEMOIZE-HASH-TABLE">make-initial-memoize-hash-table</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-make-initial-memoize-hash-table" data-sym="MAKE-INITIAL-MEMOIZE-HASH-TABLE" title="(defun make-initial-memoize-hash-table (fn init-size)
  (with-global-memoize-lock
   (mf-mht :size (memoize-table-desired-size fn init-size))))">make-initial-memoize-hash-table</a>
  (fn init-size)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:size</span> (<a class="sym-link local-def" href="#def-memoize-table-desired-size" data-sym="MEMOIZE-TABLE-DESIRED-SIZE" title="(defun memoize-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        min-size
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">memoize-table-desired-size</a> fn init-size))))</pre>
  </div>

<div class="form-block function" id="def-make-initial-memoize-pons-table" data-defines="MAKE-INITIAL-MEMOIZE-PONS-TABLE" data-references="PONS-TABLE-DESIRED-SIZE,MF-MHT,WITH-GLOBAL-MEMOIZE-LOCK,INIT-SIZE,FN,DEFUN" data-part-name="MAKE-INITIAL-MEMOIZE-PONS-TABLE" data-part-args="INIT-SIZE,FN" data-part-body="INIT-SIZE,FN,PONS-TABLE-DESIRED-SIZE,MF-MHT,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MAKE-INITIAL-MEMOIZE-PONS-TABLE">make-initial-memoize-pons-table</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-make-initial-memoize-pons-table" data-sym="MAKE-INITIAL-MEMOIZE-PONS-TABLE" title="(defun make-initial-memoize-pons-table (fn init-size)
  (with-global-memoize-lock
   (mf-mht :size (pons-table-desired-size fn init-size))))">make-initial-memoize-pons-table</a>
  (fn init-size)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:size</span> (<a class="sym-link local-def" href="#def-pons-table-desired-size" data-sym="PONS-TABLE-DESIRED-SIZE" title="(defun pons-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        *mht-default-size*
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">pons-table-desired-size</a> fn init-size))))</pre>
  </div>

<div class="form-block function" id="def-update-memo-max-sizes" data-defines="UPDATE-MEMO-MAX-SIZES" data-references="*,/,MAX,+,NEW.NUM-CLEARS,OLD.AVG-MT-SIZE,OLD.AVG-PT-SIZE,OLD.MAX-MT-SIZE,OLD.MAX-PT-SIZE,ACCESS,OLD.NUM-CLEARS,LET*,FLOAT,QUOTE,COERCE,MEMO-MAX-SIZES-ENTRY,MAKE,MF-SETHASH,NOT,IF,*MEMO-MAX-SIZES*,MF-GETHASH,OLD,LET,WITH-GLOBAL-MEMOIZE-LOCK,<,OR,WHEN,MT-SIZE,PT-SIZE,FN,DEFUN" data-used-by="CLEAR-ONE-MEMO-AND-PONS-HASH" data-part-name="UPDATE-MEMO-MAX-SIZES" data-part-args="MT-SIZE,PT-SIZE,FN" data-part-body="*,/,MAX,+,NEW.NUM-CLEARS,OLD.AVG-MT-SIZE,OLD.AVG-PT-SIZE,OLD.MAX-MT-SIZE,OLD.MAX-PT-SIZE,ACCESS,OLD.NUM-CLEARS,LET*,FLOAT,QUOTE,COERCE,MEMO-MAX-SIZES-ENTRY,MAKE,MF-SETHASH,NOT,IF,*MEMO-MAX-SIZES*,FN,MF-GETHASH,OLD,LET,WITH-GLOBAL-MEMOIZE-LOCK,PT-SIZE,MT-SIZE,<,OR,WHEN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="UPDATE-MEMO-MAX-SIZES">update-memo-max-sizes</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-update-memo-max-sizes" data-sym="UPDATE-MEMO-MAX-SIZES" title="(defun update-memo-max-sizes (fn pt-size mt-size)
  (when (or (&lt; 0 mt-size) (&lt; 0 pt-size))
    (with-global-memoize-lock
     (let ((old (mf-gethash fn *memo-max-sizes*)))
       (if (not old)
...">update-memo-max-sizes</a>
  (fn pt-size mt-size)
  (when (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (&lt; <span class="number">0</span> mt-size) (&lt; <span class="number">0</span> pt-size))
    (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((old (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memo-max-sizes*)))
        (if (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> old)
          (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn
            (<a class="sym-link system" href="basis-a.html#def-make" data-sym="MAKE">make</a> memo-max-sizes-entry
              <span class="keyword">:num-clears</span> <span class="number">1</span>
              <span class="keyword">:max-pt-size</span> pt-size
              <span class="keyword">:max-mt-size</span> mt-size
              <span class="keyword">:avg-pt-size</span> (coerce pt-size 'float)
              <span class="keyword">:avg-mt-size</span> (coerce mt-size 'float))
            *memo-max-sizes*)
          (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((old.num-clears (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry old <span class="keyword">:num-clears</span>)) (old.max-pt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry old <span class="keyword">:max-pt-size</span>))
              (old.max-mt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry old <span class="keyword">:max-mt-size</span>))
              (old.avg-pt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry old <span class="keyword">:avg-pt-size</span>))
              (old.avg-mt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry old <span class="keyword">:avg-mt-size</span>))
              (new.num-clears (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <span class="number">1</span> old.num-clears)))
            (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn
              (<a class="sym-link system" href="basis-a.html#def-make" data-sym="MAKE">make</a> memo-max-sizes-entry
                <span class="keyword">:num-clears</span> new.num-clears
                <span class="keyword">:max-pt-size</span> (max pt-size old.max-pt-size)
                <span class="keyword">:max-mt-size</span> (max mt-size old.max-mt-size)
                <span class="keyword">:avg-pt-size</span> (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> pt-size (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> old.avg-pt-size old.num-clears))
                  new.num-clears)
                <span class="keyword">:avg-mt-size</span> (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> mt-size (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> old.avg-mt-size old.num-clears))
                  new.num-clears))
              *memo-max-sizes*))))))
  nil)</pre>
  </div>

<div class="form-block function" id="def-print-memo-max-sizes" data-defines="PRINT-MEMO-MAX-SIZES" data-references="FLOOR,AVG-MT-SIZE,AVG-PT-SIZE,MAX-MT-SIZE,MAX-PT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NUM-CLEARS,LET*,STRING,QUOTE,CONCATENATE,+,SYMBOL-NAME,LENGTH,MAX,SETQ,IGNORE,DECLARE,ENTRY,FN,LAMBDA,MF-MAPHASH,INDENT-STR,INDENT,LET,T,FORMAT,RETURN-FROM,*MEMO-MAX-SIZES*,MF-HASH-TABLE-COUNT,EQUAL,WHEN,WITH-GLOBAL-MEMOIZE-LOCK,DEFUN" data-part-name="PRINT-MEMO-MAX-SIZES" data-part-body="FLOOR,AVG-MT-SIZE,AVG-PT-SIZE,MAX-MT-SIZE,MAX-PT-SIZE,MEMO-MAX-SIZES-ENTRY,ACCESS,NUM-CLEARS,LET*,STRING,QUOTE,CONCATENATE,+,SYMBOL-NAME,LENGTH,MAX,SETQ,IGNORE,DECLARE,ENTRY,FN,LAMBDA,MF-MAPHASH,INDENT-STR,INDENT,LET,T,FORMAT,PRINT-MEMO-MAX-SIZES,RETURN-FROM,*MEMO-MAX-SIZES*,MF-HASH-TABLE-COUNT,EQUAL,WHEN,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PRINT-MEMO-MAX-SIZES">print-memo-max-sizes</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-print-memo-max-sizes" data-sym="PRINT-MEMO-MAX-SIZES" title="(defun print-memo-max-sizes ()
  (with-global-memoize-lock
   (when (equal (mf-hash-table-count *memo-max-sizes*) 0)
     (return-from print-memo-max-sizes nil))
   (format t &quot;Memo table statistics gathered at each from when they were ~
...">print-memo-max-sizes</a>
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (when (equal (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> *memo-max-sizes*) <span class="number">0</span>)
      (return-from <a class="sym-link local-def" href="#def-print-memo-max-sizes" data-sym="PRINT-MEMO-MAX-SIZES" title="(defun print-memo-max-sizes ()
  (with-global-memoize-lock
   (when (equal (mf-hash-table-count *memo-max-sizes*) 0)
     (return-from print-memo-max-sizes nil))
   (format t &quot;Memo table statistics gathered at each from when they were ~
...">print-memo-max-sizes</a> nil))
    (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
      <span class="string">"Memo table statistics gathered at each from when they were ~
             cleared:~%~%"</span>)
    (let ((indent <span class="number">8</span>) indent-str)
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (fn entry)
          (declare (ignore entry))
          (setq indent (max indent (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (symbol-name fn)))))
        *memo-max-sizes*)
      (setq indent-str (format nil <span class="string">"~a"</span> (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> <span class="number">2</span> indent)))
      (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
        (<a class="sym-link system" href="axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> <span class="string">"~"</span> indent-str <span class="string">":@a"</span>)
        <span class="string">"Function"</span>)
      (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
        <span class="string">" ~10:@a | ~15:@a ~15:@a | ~15:@a ~15:@a~%"</span>
        <span class="string">"Clears"</span>
        <span class="string">"PT Max"</span>
        <span class="string">"PT Avg"</span>
        <span class="string">"MT Max"</span>
        <span class="string">"MT Avg"</span>)
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (fn entry)
          (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((num-clears (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry entry <span class="keyword">:num-clears</span>)) (max-pt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry entry <span class="keyword">:max-pt-size</span>))
              (max-mt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry entry <span class="keyword">:max-mt-size</span>))
              (avg-pt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry entry <span class="keyword">:avg-pt-size</span>))
              (avg-mt-size (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memo-max-sizes-entry entry <span class="keyword">:avg-mt-size</span>)))
            (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
              (<a class="sym-link system" href="axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a>
                <span class="string">"~"</span>
                indent-str
                <span class="string">":@a ~10:D | ~15:D ~15:D | ~15:D ~15:D~%"</span>)
              fn
              num-clears
              max-pt-size
              (floor avg-pt-size)
              max-mt-size
              (floor avg-mt-size))))
        *memo-max-sizes*)
      (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%"</span>)))
  nil)</pre>
  </div>

<div class="form-block function" id="def-memoize-flush1" data-defines="MEMOIZE-FLUSH1" data-references="SETF,MF-HASH-TABLE-COUNT,EQL,NULL,OR,UNLESS,SYMBOL-VALUE,OLD,LET,SYMBOL,THE,BOUNDP,WHEN,DO,IN,SYM,FOR,LOOP,WITH-GLOBAL-MEMOIZE-LOCK,LST,DEFUN" data-used-by="MEMOIZE-FLUSH" data-part-name="MEMOIZE-FLUSH1" data-part-args="LST" data-part-body="SETF,MF-HASH-TABLE-COUNT,EQL,NULL,OR,UNLESS,SYMBOL-VALUE,OLD,LET,SYMBOL,THE,BOUNDP,WHEN,DO,LST,IN,SYM,FOR,LOOP,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FLUSH1">memoize-flush1</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-flush1" data-sym="MEMOIZE-FLUSH1" title="(defun memoize-flush1 (lst)
  (with-global-memoize-lock
   (loop for sym in lst
         do (when (boundp (the symbol sym))
              (let ((old (symbol-value (the symbol sym))))
...">memoize-flush1</a>
  (lst)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (loop for
      sym
      in
      lst
      do
      (when (boundp (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol sym))
        (let ((old (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol sym))))
          (unless (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> old) (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span> (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> old)))
            (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol sym)) nil)))))))</pre>
  </div>

<div class="form-block macro" id="def-memoize-flush" data-defines="MEMOIZE-FLUSH" data-references="MEMOIZE-FLUSH1,WHEN,QUASIQUOTE,ST-LST,S,LET,AND,ST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FLUSH">memoize-flush</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-memoize-flush" data-sym="MEMOIZE-FLUSH" title="(defmacro memoize-flush (st)
  (and st
       (let ((s (st-lst st)))
         `(when ,s (memoize-flush1 ,s)))))">memoize-flush</a>
  (st)
  (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> st
    (let ((s (st-lst st)))
      `(when ,S (<a class="sym-link local-def" href="#def-memoize-flush1" data-sym="MEMOIZE-FLUSH1" title="(defun memoize-flush1 (lst)
  (with-global-memoize-lock
   (loop for sym in lst
         do (when (boundp (the symbol sym))
              (let ((old (symbol-value (the symbol sym))))
...">memoize-flush1</a> ,S)))))</pre>
  </div>

<div class="form-block function" id="def-sync-memoize-call-array" data-defines="SYNC-MEMOIZE-CALL-ARRAY" data-references="OUTSIDE-CALLER-COL-BASE,*CALLER*,GC$,MAKE-ARRAY,*CALLERS-ARRAY*,INITIAL-MEMOIZE-CALL-ARRAY,*MEMOIZE-CALL-ARRAY*,SETQ,MFIXNUM,FIXNUM,AND,TYPE,DECLARE,*MAX-SYMBOL-TO-FIXNUM*,1+,N2,*2MAX-MEMOIZE-FNS*,MA-INDEX,N1,LET,WITH-GLOBAL-MEMOIZE-LOCK,DEFUN" data-used-by="MEMOIZE-CALL-ARRAY-GROW" data-part-name="SYNC-MEMOIZE-CALL-ARRAY" data-part-body="OUTSIDE-CALLER-COL-BASE,*CALLER*,GC$,MAKE-ARRAY,*CALLERS-ARRAY*,INITIAL-MEMOIZE-CALL-ARRAY,*MEMOIZE-CALL-ARRAY*,SETQ,MFIXNUM,FIXNUM,AND,TYPE,DECLARE,*MAX-SYMBOL-TO-FIXNUM*,1+,N2,*2MAX-MEMOIZE-FNS*,MA-INDEX,N1,LET,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SYNC-MEMOIZE-CALL-ARRAY">sync-memoize-call-array</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-sync-memoize-call-array" data-sym="SYNC-MEMOIZE-CALL-ARRAY" title="(defun sync-memoize-call-array ()
  (with-global-memoize-lock
   (let ((n1 (ma-index *2max-memoize-fns*)) (n2 (1+ *max-symbol-to-fixnum*)))
     (declare (type (and fixnum mfixnum) n1 n2))
     (setq *memoize-call-array* (initial-memoize-call-array 1))
...">sync-memoize-call-array</a>
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((n1 (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> *2max-memoize-fns*)) (n2 (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> *max-symbol-to-fixnum*)))
      (declare (type (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> fixnum mfixnum) n1 n2))
      (setq *memoize-call-array* (<a class="sym-link local-def" href="#def-initial-memoize-call-array" data-sym="INITIAL-MEMOIZE-CALL-ARRAY" title="(defun initial-memoize-call-array (n)
  (make-array n :element-type &#39;mfixnum :initial-element 0))">initial-memoize-call-array</a> <span class="number">1</span>))
      (setq *callers-array* (make-array <span class="number">0</span>))
      (<a class="sym-link system" href="axioms.html#def-gc_24" data-sym="GC$">gc$</a>)
      (setq *memoize-call-array* (<a class="sym-link local-def" href="#def-initial-memoize-call-array" data-sym="INITIAL-MEMOIZE-CALL-ARRAY" title="(defun initial-memoize-call-array (n)
  (make-array n :element-type &#39;mfixnum :initial-element 0))">initial-memoize-call-array</a> n1))
      (setq *callers-array* (make-array n2 <span class="keyword">:initial-element</span> nil))
      (setq *caller* (<a class="sym-link local-def" href="#def-outside-caller-col-base" data-sym="OUTSIDE-CALLER-COL-BASE" title="(defun outside-caller-col-base () (ma-index *initial-max-symbol-to-fixnum*))">outside-caller-col-base</a>)))))</pre>
  </div>

<div class="form-block function" id="def-memoize-call-array-grow" data-defines="MEMOIZE-CALL-ARRAY-GROW" data-references="REMEMOIZE-ALL,SYNC-MEMOIZE-CALL-ARRAY,QUOTE,OBSERVATION,*THE-LIVE-STATE*,STATE,LET,SETQ,CERROR,OUTSIDE-CALLER-COL-BASE,*CALLER*,EQL,ARRAY-DIMENSION-LIMIT,ARRAY-TOTAL-SIZE-LIMIT,<,MOST-POSITIVE-FIXNUM,MOST-POSITIVE-MFIXNUM,RETURN-FROM,CW,<=,WHEN,>,EVENP,ERROR,INTEGERP,UNLESS,WITH-GLOBAL-MEMOIZE-LOCK,*2MAX-MEMOIZE-FNS*,/,CEILING,*,2NMAX,&OPTIONAL,DEFUN" data-part-name="MEMOIZE-CALL-ARRAY-GROW" data-part-args="*2MAX-MEMOIZE-FNS*,/,CEILING,*,2NMAX,&OPTIONAL" data-part-body="REMEMOIZE-ALL,SYNC-MEMOIZE-CALL-ARRAY,QUOTE,OBSERVATION,*THE-LIVE-STATE*,STATE,LET,SETQ,CERROR,OUTSIDE-CALLER-COL-BASE,*CALLER*,EQL,ARRAY-DIMENSION-LIMIT,ARRAY-TOTAL-SIZE-LIMIT,<,MOST-POSITIVE-FIXNUM,MOST-POSITIVE-MFIXNUM,*,MEMOIZE-CALL-ARRAY-GROW,RETURN-FROM,CW,*2MAX-MEMOIZE-FNS*,<=,WHEN,>,EVENP,ERROR,2NMAX,INTEGERP,UNLESS,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-CALL-ARRAY-GROW">memoize-call-array-grow</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-call-array-grow" data-sym="MEMOIZE-CALL-ARRAY-GROW" title="(defun memoize-call-array-grow
       (&amp;optional (2nmax (* 2 (ceiling (* 3/2 (/ *2max-memoize-fns* 2))))))
  (with-global-memoize-lock
   (unless (integerp 2nmax)
     (error &quot;(memoize-call-array-grow ~s).  Arg must be an integer.&quot; 2nmax))
...">memoize-call-array-grow</a>
  (&amp;optional (2nmax (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">2</span> (ceiling (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">3/2</span> (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> *2max-memoize-fns* <span class="number">2</span>))))))
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (unless (integerp 2nmax)
      (error <span class="string">"(memoize-call-array-grow ~s).  Arg must be an integer."</span>
        2nmax))
    (unless (evenp 2nmax)
      (error <span class="string">"(memoize-call-array-grow ~s).  Arg must be even."</span>
        2nmax))
    (unless (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> 2nmax <span class="number">100</span>)
      (error <span class="string">"(memoize-call-array-grow ~s).  Arg must be &gt; 100."</span>
        2nmax))
    (when (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> 2nmax *2max-memoize-fns*)
      (<a class="sym-link system" href="axioms.html#def-cw" data-sym="CW">cw</a> <span class="string">"; memoize-call-array-grow: *memoize-call-array* already big enough.~%"</span>)
      (return-from <a class="sym-link local-def" href="#def-memoize-call-array-grow" data-sym="MEMOIZE-CALL-ARRAY-GROW" title="(defun memoize-call-array-grow
       (&amp;optional (2nmax (* 2 (ceiling (* 3/2 (/ *2max-memoize-fns* 2))))))
  (with-global-memoize-lock
   (unless (integerp 2nmax)
     (error &quot;(memoize-call-array-grow ~s).  Arg must be an integer.&quot; 2nmax))
...">memoize-call-array-grow</a>))
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> 2nmax 2nmax) most-positive-mfixnum)
      (error <span class="string">"memoize-call-array-grow:  most-positive-mfixnum exceeded.  Too ~
             many memoized functions."</span>))
    (unless (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> 2nmax 2nmax) most-positive-fixnum)
      (error <span class="string">"memoize-call-array-grow:  most-positive-fixnum exceeded.  Too ~
             many memoized functions."</span>))
    (unless (&lt; (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> 2nmax 2nmax) array-total-size-limit)
      (error <span class="string">"memoize-call-array-grow: ARRAY-TOTAL-SIZE-LIMIT exceeded.  Too ~
             many memoized functions."</span>))
    (unless (&lt; (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> 2nmax 2nmax) array-dimension-limit)
      (error <span class="string">"memoize-call-array-grow: ARRAY-DIMENSION-LIMIT exceeded.  Too ~
             many memoized functions."</span>))
    (unless (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> *caller* (<a class="sym-link local-def" href="#def-outside-caller-col-base" data-sym="OUTSIDE-CALLER-COL-BASE" title="(defun outside-caller-col-base () (ma-index *initial-max-symbol-to-fixnum*))">outside-caller-col-base</a>))
      (cerror <span class="string">"Continue at your own risk."</span>
        <span class="string">"MEMOIZE-CALL-ARRAY-GROW was called while a memoized function~%~
              was executing, so all bets are off.  Continue only at your own~%~
              risk.  That risk may be low, but at the least, memoization~%~
              reports (in particular, from memsum) will probably be~%~
              inaccurate."</span>))
    (setq *2max-memoize-fns* 2nmax)
    (let ((state *the-live-state*))
      (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> '<a class="sym-link local-def" href="#def-memoize-call-array-grow" data-sym="MEMOIZE-CALL-ARRAY-GROW" title="(defun memoize-call-array-grow
       (&amp;optional (2nmax (* 2 (ceiling (* 3/2 (/ *2max-memoize-fns* 2))))))
  (with-global-memoize-lock
   (unless (integerp 2nmax)
     (error &quot;(memoize-call-array-grow ~s).  Arg must be an integer.&quot; 2nmax))
...">memoize-call-array-grow</a>
        <span class="string">"Now reinitializing memoization structures.  This will ~
                   erase saved values and statistics."</span>))
    (<a class="sym-link local-def" href="#def-sync-memoize-call-array" data-sym="SYNC-MEMOIZE-CALL-ARRAY" title="(defun sync-memoize-call-array ()
  (with-global-memoize-lock
   (let ((n1 (ma-index *2max-memoize-fns*)) (n2 (1+ *max-symbol-to-fixnum*)))
     (declare (type (and fixnum mfixnum) n1 n2))
     (setq *memoize-call-array* (initial-memoize-call-array 1))
...">sync-memoize-call-array</a>)
    (rememoize-all))
  nil)</pre>
  </div>

<div class="form-block other" id="form-113" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output symbol-to-fixnum-create
  (s)
  (check-type s symbol)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((g (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> s *memoize-info-ht*)))
      (if g
        (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry g <span class="keyword">:num</span>)
        (let (new)
          (loop for
            i
            fixnum
            from
            (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> *initial-max-symbol-to-fixnum*)
            below
            (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (floor *2max-memoize-fns* <span class="number">2</span>))
            do
            (unless (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> i *memoize-info-ht*)
              (setq new i)
              (return)))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (new (setq *max-symbol-to-fixnum*
                (max *max-symbol-to-fixnum* new))
              new)
            (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-memoize-call-array-grow" data-sym="MEMOIZE-CALL-ARRAY-GROW" title="(defun memoize-call-array-grow
       (&amp;optional (2nmax (* 2 (ceiling (* 3/2 (/ *2max-memoize-fns* 2))))))
  (with-global-memoize-lock
   (unless (integerp 2nmax)
     (error &quot;(memoize-call-array-grow ~s).  Arg must be an integer.&quot; 2nmax))
...">memoize-call-array-grow</a>) (symbol-to-fixnum-create s))))))))</pre>
  </div>

<div class="form-block other" id="form-114" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output symbol-to-fixnum
  (s)
  (check-type s symbol)
  (let ((g (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> s *memoize-info-ht*)))
    (if g
      (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry g <span class="keyword">:num</span>)
      (error <span class="string">"(symbol-to-fixnum ~s).  Illegal symbol."</span> s))))</pre>
  </div>

<div class="form-block other" id="form-115" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output fixnum-to-symbol
  (n)
  (check-type n fixnum)
  (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> n *memoize-info-ht*)
    (error <span class="string">"(fixnum-to-symbol ~s). Illegal number."</span> n)))</pre>
  </div>

<div class="form-block other" id="form-116" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output hons-gentemp
  (root)
  (check-type root <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a>)
  (loop (<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> *hons-gentemp-counter* <span class="number">1</span> hons-gentemp)
    (let ((name (<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (format nil <span class="string">"HONS-G-~s,~s"</span> root *hons-gentemp-counter*))))
      (multiple-value-bind (sym status)
        (<a class="sym-link system" href="axioms.html#def-intern" data-sym="INTERN">intern</a> name (find-package <span class="string">"ACL2_INVISIBLE"</span>))
        (if (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> status)
          (return sym))))))</pre>
  </div>

<div class="form-block other" id="form-117" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output st-lst
  (st)
  (check-type st symbol)
  (<a class="sym-link system" href="axioms.html#def-intern" data-sym="INTERN">intern</a> (<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (format nil
        <span class="string">"HONS-S-~s,~s"</span>
        (package-name (symbol-package st))
        (symbol-name st)))
    (find-package <span class="string">"ACL2_INVISIBLE"</span>)))</pre>
  </div>

<div class="form-block other" id="form-118" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mf-dcls
  (l)
  (loop for
    dec
    in
    l
    nconc
    (let ((temp (if (consp dec)
           (loop for
             d
             in
             (cdr dec)
             nconc
             (if (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (consp d) (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car d) 'ignore))
               nil
               (cons d nil))))))
      (if temp
        (cons (cons 'declare temp) nil)))))</pre>
  </div>

<div class="form-block function" id="def-memoize-use-attachment-warning" data-defines="MEMOIZE-USE-ATTACHMENT-WARNING" data-references="SETQ,BADGE-USERFN,APPLY$-USERFN,MSG,COND,CDR,T,MV,CAR,EQ,ASSERT$,CONSP,IF,LOOKUP-P,MV-LET,TOP-LEVEL,QUOTE,WARNING$,*THE-LIVE-STATE*,STATE,LET,*MEMOIZE-USE-ATTACHMENT-WARNING-P*,WHEN,AT-FN,FN,DEFUN" data-part-name="MEMOIZE-USE-ATTACHMENT-WARNING" data-part-args="AT-FN,FN" data-part-body="SETQ,BADGE-USERFN,APPLY$-USERFN,MSG,COND,CDR,T,MV,CAR,EQ,ASSERT$,CONSP,IF,AT-FN,LOOKUP-P,MV-LET,FN,TOP-LEVEL,QUOTE,WARNING$,*THE-LIVE-STATE*,STATE,LET,*MEMOIZE-USE-ATTACHMENT-WARNING-P*,WHEN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-USE-ATTACHMENT-WARNING">memoize-use-attachment-warning</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-use-attachment-warning" data-sym="MEMOIZE-USE-ATTACHMENT-WARNING" title="(defun memoize-use-attachment-warning (fn at-fn)
  (when *memoize-use-attachment-warning-p*
    (let ((state *the-live-state*))
      (warning$ &#39;top-level &quot;Attachment&quot;
                &quot;Although the function ~x0 is memoized, a result is not being ~
...">memoize-use-attachment-warning</a>
  (fn at-fn)
  (when *memoize-use-attachment-warning-p*
    (let ((state *the-live-state*))
      (<a class="sym-link system" href="axioms.html#def-warning_24" data-sym="WARNING$">warning$</a> 'top-level
        <span class="string">"Attachment"</span>
        <span class="string">"Although the function ~x0 is memoized, a result is not being ~
                 stored because ~@1.  Warnings such as this one, about not ~
                 storing results, will remain off for all functions for the ~
                 remainder of the session unless the variable ~x2 is set to a ~
                 non-nil value in raw Lisp."</span>
        fn
        (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (lookup-p at-fn)
          (if (consp at-fn)
            (<a class="sym-link system" href="axioms.html#def-assert_24" data-sym="ASSERT$">assert$</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car at-fn) <span class="keyword">:lookup</span>) (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (cdr at-fn)))
            (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> nil at-fn))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (lookup-p (<a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"a stored result was used from a call of ~
                                     memoized function ~x0, which may have ~
                                     been computed using attachments"</span>
                at-fn))
            ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> at-fn <span class="keyword">:|{APPLY$-OR-BADGE}-USERFN|</span>) (<a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"one of the functions ~v0, which depend ~
                                     on warrants for the result, was called ~
                                     during evaluation of a call of ~x1"</span>
                '(apply$-userfn badge-userfn)
                fn))
            (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"an attachment to function ~x0 was used ~
                                     during evaluation of one of its calls"</span>
                at-fn))))
        '*memoize-use-attachment-warning-p*))
    (setq *memoize-use-attachment-warning-p* nil)))</pre>
  </div>

<div class="form-block other" id="form-120" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-fn-suffix
  (str sym)
  (check-type str <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a>)
  (check-type sym symbol)
  (let ((spkn (package-name (symbol-package sym))) (sn (symbol-name sym)))
    (format nil <span class="string">"~s,~s,~s"</span> str spkn sn)))</pre>
  </div>

<div class="form-block macro" id="def-mf-index" data-defines="MF-INDEX" data-references="COND,QUASIQUOTE,SYMBOLP,ASSERT,KNOWN-NOT-RATIONAL,&OPTIONAL,X,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-INDEX">mf-index</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-index" data-sym="MF-INDEX" title="(defmacro mf-index (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(cond ,@(unless known-not-rational `(((typep ,x &#39;fixnum) ,x)))))">mf-index</a>
  (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ,@(UNLESS KNOWN-NOT-RATIONAL `(((TYPEP ,X &#39;FIXNUM) ,X)))))</pre>
  </div>

<div class="form-block other" id="form-122" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mis-ordered-commutative-args
  (x y)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> x y) nil)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((idx (<a class="sym-link local-def" href="#def-mf-index" data-sym="MF-INDEX" title="(defmacro mf-index (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(cond ,@(unless known-not-rational `(((typep ,x &#39;fixnum) ,x)))))">mf-index</a> x)))
        (declare (type (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> <a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> fixnum) idx))
        (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (idx (let ((idy (<a class="sym-link local-def" href="#def-mf-index" data-sym="MF-INDEX" title="(defmacro mf-index (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(cond ,@(unless known-not-rational `(((typep ,x &#39;fixnum) ,x)))))">mf-index</a> y)))
              (declare (type (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> <a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> fixnum) idy))
              (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (idy (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum idy) (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum idx)))
                ((rationalp y) (&lt; y (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum idx))))))
          ((rationalp x) (let ((idy (<a class="sym-link local-def" href="#def-mf-index" data-sym="MF-INDEX" title="(defmacro mf-index (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(cond ,@(unless known-not-rational `(((typep ,x &#39;fixnum) ,x)))))">mf-index</a> y)))
              (declare (type (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> <a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> fixnum) idy))
              (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (idy (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum idy) x)) ((rationalp y) (&lt; y x)))))
          ((<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (rationalp y) (<a class="sym-link local-def" href="#def-mf-index" data-sym="MF-INDEX" title="(defmacro mf-index (x &amp;optional known-not-rational)
  (assert (symbolp x))
  `(cond ,@(unless known-not-rational `(((typep ,x &#39;fixnum) ,x)))))">mf-index</a> y <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))))))))</pre>
  </div>

<div class="form-block function" id="def-memoize-look-up-def" data-defines="MEMOIZE-LOOK-UP-DEF" data-references="MEMOIZE-LOOK-UP-DEF-RAW,T,CDR,QUOTE,CAR,ASSERT,CLTL-DEF-FROM-NAME,DEF,LET,ERROR,FBOUNDP,NOT,NULL,EQ,COND,QUIET-P,&KEY,WRLD,INLINE,CL-DEFUN,FN,DEFUN" data-used-by="MEMOIZE-FN,MEMOIZE-FN-FORMALS" data-part-name="MEMOIZE-LOOK-UP-DEF" data-part-args="QUIET-P,&KEY,WRLD,INLINE,CL-DEFUN,FN" data-part-body="QUIET-P,MEMOIZE-LOOK-UP-DEF-RAW,T,CDR,DEFUN,QUOTE,CAR,ASSERT,WRLD,CLTL-DEF-FROM-NAME,DEF,LET,ERROR,FN,FBOUNDP,NOT,INLINE,NULL,CL-DEFUN,EQ,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-LOOK-UP-DEF">memoize-look-up-def</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-look-up-def" data-sym="MEMOIZE-LOOK-UP-DEF" title="(defun memoize-look-up-def (fn cl-defun inline wrld &amp;key quiet-p)
  (cond
   ((eq cl-defun :default)
    (cond ((null inline) nil)
          ((not (fboundp fn))
...">memoize-look-up-def</a>
  (fn cl-defun inline wrld &amp;key quiet-p)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> cl-defun <span class="keyword">:default</span>) (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> inline) nil)
        ((<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (fboundp fn)) (error <span class="string">"MEMOIZE-LOOK-UP-DEF: ** ~a is undefined."</span> fn))
        ((let ((def (cltl-def-from-name fn wrld)))
           (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (def (assert (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car def) '<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a>)) (cdr def)))))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-memoize-look-up-def-raw" data-sym="MEMOIZE-LOOK-UP-DEF-RAW" title="(defun memoize-look-up-def-raw (sym quiet-p)
  (let ((temp (get sym &#39;acl2-saved-def)))
    (cond (temp (cdr temp))
          (t
           (let* ((fn (symbol-function sym))
...">memoize-look-up-def-raw</a> fn quiet-p))))
    ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (car cl-defun) '<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a>) (cdr cl-defun))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> cl-defun)))</pre>
  </div>

<div class="form-block other" id="form-124" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defg *memoize-timing-bugs* <span class="number">0</span>)</pre>
  </div>

<div class="form-block macro" id="def-fix-ticks" data-defines="FIX-TICKS" data-references="EQL,*FLOAT-TICKS/SECOND*,/,FORMAT,WHEN,*MEMOIZE-TIMING-BUGS*,INCF,T,*10-DAYS*,<,<=,AND,COND,THE-MFIXNUM,MFIXNUM,TYPE,DECLARE,LET,QUASIQUOTE,CTX,TICKS,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="FIX-TICKS">fix-ticks</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-fix-ticks" data-sym="FIX-TICKS" title="(defmacro fix-ticks (ticks ctx)
  `(let ((ticks ,ticks) (ctx ,ctx))
     (declare (type mfixnum ticks))
     (the-mfixnum
      (cond
...">fix-ticks</a>
  (ticks ctx)
  `(let ((ticks ,TICKS) (ctx ,CTX))
    (declare (type mfixnum ticks))
    (the-mfixnum (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> <span class="number">0</span> (the-mfixnum ticks))
           (&lt; (the-mfixnum ticks) (the-mfixnum *10-days*))) (the-mfixnum ticks))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (incf *memoize-timing-bugs*)
          (when (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> *memoize-timing-bugs* <span class="number">10</span>)
            (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
              <span class="string">"Ignoring time increment of ~a sec for ~a~%"</span>
              (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> ticks *float-ticks/second*)
              ctx)
            (when (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> *memoize-timing-bugs* <span class="number">10</span>)
              (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
                <span class="string">"Timing is very dubious.  Suppressing further messages.~%"</span>)))
          <span class="number">0</span>)))))</pre>
  </div>

<div class="form-block other" id="form-126" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoizedp-raw
  (fn)
  (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (symbolp fn)
    (values (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memoize-info-ht*))))</pre>
  </div>

<div class="form-block macro" id="def-mf-make-symbol" data-defines="MF-MAKE-SYMBOL" data-references="*ACL2-PACKAGE*,FORMAT,INTERN,OUR-SYNTAX,QUASIQUOTE,R,&REST,DEFMACRO" data-used-by="MEMOIZE-FN-FORMALS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-MAKE-SYMBOL">mf-make-symbol</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-mf-make-symbol" data-sym="MF-MAKE-SYMBOL" title="(defmacro mf-make-symbol (&amp;rest r)
  `(our-syntax (intern (format nil ,@r) *acl2-package*)))">mf-make-symbol</a>
  (&amp;rest r)
  `(<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (<a class="sym-link system" href="axioms.html#def-intern" data-sym="INTERN">intern</a> (format nil ,@R) *acl2-package*)))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-init" data-defines="MEMOIZE-FN-INIT" data-references="CONSTRAINEDP,GETPROPC,OLD-UNTRACE,OLD-TRACE,UNTRACE,QUASIQUOTE,TRACE,EVAL,MEMBER,UNMEMOIZE-FN,MEMOIZE,OBSERVATION,MEMOIZEDP-RAW,IF,PROGRAM-FNS-WITH-RAW-CODE,LOGIC-FNS-WITH-RAW-CODE,F-GET-GLOBAL,MEMBER-EQ,NEVER-MEMOIZE-P,COMPILER-MACRO-FUNCTION,QUOTE,AND,SPECIAL-OPERATOR-P,MACRO-FUNCTION,OR,WHEN,FBOUNDP,*MEMOIZE-INIT-DONE*,MAYBE-UNTRACE!,ERROR,SYMBOLP,UNLESS,WITH-GLOBAL-MEMOIZE-LOCK,*THE-LIVE-STATE*,STATE,&AUX,WRLD,INLINE,FN,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-INIT" data-part-args="*THE-LIVE-STATE*,STATE,&AUX,WRLD,INLINE,FN" data-part-body="WRLD,CONSTRAINEDP,GETPROPC,OLD-UNTRACE,OLD-TRACE,UNTRACE,QUASIQUOTE,TRACE,EVAL,MEMBER,UNMEMOIZE-FN,MEMOIZE,OBSERVATION,MEMOIZEDP-RAW,IF,PROGRAM-FNS-WITH-RAW-CODE,STATE,LOGIC-FNS-WITH-RAW-CODE,F-GET-GLOBAL,MEMBER-EQ,INLINE,NEVER-MEMOIZE-P,COMPILER-MACRO-FUNCTION,QUOTE,AND,SPECIAL-OPERATOR-P,MACRO-FUNCTION,OR,WHEN,FBOUNDP,*MEMOIZE-INIT-DONE*,MAYBE-UNTRACE!,ERROR,FN,SYMBOLP,UNLESS,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-INIT">memoize-fn-init</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-init" data-sym="MEMOIZE-FN-INIT" title="(defun memoize-fn-init (fn inline wrld &amp;aux (state *the-live-state*))
  (with-global-memoize-lock
   (unless (symbolp fn) (error &quot;Memoize-fn: ~s is not a symbol.&quot; fn))
   (maybe-untrace! fn)
   (unless *memoize-init-done*
...">memoize-fn-init</a>
  (fn inline wrld &amp;aux (state *the-live-state*))
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (unless (symbolp fn)
      (error <span class="string">"Memoize-fn: ~s is not a symbol."</span> fn))
    (maybe-untrace! fn)
    (unless *memoize-init-done*
      (error <span class="string">"Memoize-fn:  *MEMOIZE-INIT-DONE* is still nil."</span>))
    (unless (fboundp fn)
      (error <span class="string">"Memoize-fn: ~s is not fboundp."</span> fn))
    (when (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (macro-function fn)
        (special-operator-p fn)
        (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (fboundp 'compiler-macro-function)
          (compiler-macro-function fn)))
      (error <span class="string">"Memoize-fn: ~s is a macro or a special operator or has a ~
             compiler macro."</span>
        fn))
    (when (<a class="sym-link local-def" href="#def-never-memoize-p" data-sym="NEVER-MEMOIZE-P" title="(defun never-memoize-p (fn) (mf-gethash fn *never-memoize-ht*))">never-memoize-p</a> fn)
      (error <span class="string">"Memoize-fn: ~s must never be memoized"</span> fn))
    (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> inline
        (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> fn (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> 'logic-fns-with-raw-code state))
          (<a class="sym-link system" href="axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> fn
            (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> 'program-fns-with-raw-code state))))
      (error <span class="string">"Memoize-fn: ~s must never be memoized with :inline t,~%~
             because it belongs to the list stored in state global~%~
             variable ~s and thus runs code different~%~
             than that stored in the ACL2 logical world, as is typically~%~
             used when inserting inlined code for memoization."</span>
        fn
        (if (<a class="sym-link system" href="axioms.html#def-member-eq" data-sym="MEMBER-EQ">member-eq</a> fn (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> 'logic-fns-with-raw-code state))
          'logic-fns-with-raw-code
          'program-fns-with-raw-code)))
    (when (memoizedp-raw fn)
      (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> 'memoize
        <span class="string">"~s0 is currently memoized. We will first unmemoize it, ~
                   then memoize it again."</span>
        fn)
      (unmemoize-fn fn))
    (when (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> fn (eval '(trace)))
      (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> 'memoize
        <span class="string">"Untracing ~s before memoizing it."</span>
        fn)
      (eval `(untrace ,FN)))
    (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (fboundp 'old-trace) (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> fn (eval '(old-trace))))
      (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> 'memoize
        <span class="string">"Old-untracing ~s before memoizing it."</span>
        fn)
      (eval `(old-untrace ,FN)))
    (when (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn 'constrainedp nil wrld)
      (error <span class="string">"Memoize-fn: ~s is constrained; you may instead wish to memoize a ~
             caller or to memoize its attachment (see :DOC defattach)."</span>
        fn))))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-init-2" data-defines="MEMOIZE-FN-INIT-2" data-references="STATE,QUOTE,MEMBER,OR,LAMBDA-LIST-KEYWORDS,INTERSECTION,WHEN,ERROR,CONSTANTP,NEVER,IN,X,FOR,LOOP,NO-DUPLICATESP,SYMBOL-LISTP,AND,UNLESS,STOBJS-OUT,STOBJS-IN,CONDITION,FORMALS,FN,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-INIT-2" data-part-args="STOBJS-OUT,STOBJS-IN,CONDITION,FORMALS,FN" data-part-body="ERROR,CONSTANTP,NEVER,IN,X,FOR,LOOP,NO-DUPLICATESP,FORMALS,SYMBOL-LISTP,AND,UNLESS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-INIT-2">memoize-fn-init-2</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-init-2" data-sym="MEMOIZE-FN-INIT-2" title="(defun memoize-fn-init-2 (fn formals condition stobjs-in stobjs-out)
  (unless
      (and (symbol-listp formals) (no-duplicatesp formals)
           (loop for x in formals
                 never (constantp x)))
...">memoize-fn-init-2</a>
  (fn <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> condition <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)
  (unless (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
      (<a class="sym-link system" href="axioms.html#def-no-duplicatesp" data-sym="NO-DUPLICATESP">no-duplicatesp</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
      (loop for
        x
        in
        <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
        never
        (constantp x)))
    (error <span class="string">"Memoize-fn: FORMALS, ~a, must be a true list of distinct, ~
            nonconstant symbols."</span>
      <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>))
  (when (intersection lambda-list-keywords <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)
    (error <span class="string">"Memoize-fn: FORMALS, ~a, may not intersect LAMBDA-LIST-KEYWORDS."</span>
      <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>))
  (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> condition
      (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> 'state <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>) (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> 'state <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)))
    (error <span class="string">"Memoize-fn:  ~s uses STATE."</span> fn)))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-inner-body" data-defines="MEMOIZE-FN-INNER-BODY" data-references="COND,*RECORD-HITS*,MF-RECORD-HIT,AREF,SAFE-INCF,QUASIQUOTE,*RECORD-MHT-CALLS*,AND,MF-RECORD-MHT,LET,PROG1-FN,AOKP,COMMUTATIVE,NUMBER-OF-ARGS,STOBJS-OUT,SPECIALS,FORMALS,MEMO-TABLE-INIT-SIZE,LOCALPONSTABLENAME,PONSTABLENAME,LOCALTABLENAME,TABLENAME,FN-COL-BASE,BODY,CONDITION,FN,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-INNER-BODY" data-part-args="PROG1-FN,AOKP,COMMUTATIVE,NUMBER-OF-ARGS,STOBJS-OUT,SPECIALS,FORMALS,MEMO-TABLE-INIT-SIZE,LOCALPONSTABLENAME,PONSTABLENAME,LOCALTABLENAME,TABLENAME,FN-COL-BASE,BODY,CONDITION,FN" data-part-body="COND,CONDITION,*RECORD-HITS*,MF-RECORD-HIT,AREF,SAFE-INCF,QUASIQUOTE,*RECORD-MHT-CALLS*,AND,MF-RECORD-MHT,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-INNER-BODY">memoize-fn-inner-body</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-inner-body" data-sym="MEMOIZE-FN-INNER-BODY" title="(defun memoize-fn-inner-body
       (fn condition body fn-col-base tablename localtablename ponstablename
        localponstablename memo-table-init-size formals specials stobjs-out
        number-of-args commutative aokp prog1-fn)
  (let ((mf-record-mht
...">memoize-fn-inner-body</a>
  (fn condition
    <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>
    fn-col-base
    tablename
    localtablename
    ponstablename
    localponstablename
    memo-table-init-size
    <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
    specials
    <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>
    number-of-args
    commutative
    aokp
    prog1-fn)
  (let ((mf-record-mht (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> *record-mht-calls*
         `((<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> (aref ,*MF-MA*
              ,(MA-INDEX-FROM-COL-BASE FN-COL-BASE *MA-MHT-INDEX*))
            <span class="number">1</span>)))) (mf-record-hit (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> *record-hits*
          condition
          `((<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> (aref ,*MF-MA*
               ,(MA-INDEX-FROM-COL-BASE FN-COL-BASE *MA-HITS-INDEX*))
             <span class="number">1</span>)))))
    `(<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ,@(AND (NOT (MEMBER-EQUAL CONDITION &#39;(&#39;T T)))
       `(((NOT ,CONDITION) ,@(AND *CONDITION-NIL-AS-HIT* MF-RECORD-HIT) ,BODY)))
      ,@(AND CONDITION
       `((T
          (LET (,*MF-ANS* ,*MF-ARGS* ,*MF-ANS-P*)
            (DECLARE (IGNORABLE ,*MF-ANS* ,*MF-ARGS* ,*MF-ANS-P*))
            (WHEN (NULL ,TABLENAME)
              ,@MF-RECORD-MHT
              (SETQ ,TABLENAME
                      (MAKE-INITIAL-MEMOIZE-HASH-TABLE &#39;,FN
                                                       ,MEMO-TABLE-INIT-SIZE)))
            (SETQ ,LOCALTABLENAME ,TABLENAME)
            ,@(AND (&gt; NUMBER-OF-ARGS 1)
                   `((WHEN (NULL ,PONSTABLENAME)
                       (SETQ ,PONSTABLENAME
                               (MAKE-INITIAL-MEMOIZE-PONS-TABLE &#39;,FN
                                                                ,MEMO-TABLE-INIT-SIZE)))
                     (SETQ ,LOCALPONSTABLENAME ,PONSTABLENAME)))
            (SETQ ,*MF-ARGS*
                    ,(COND
                      (COMMUTATIVE
                       `(COND
                         ((MIS-ORDERED-COMMUTATIVE-ARGS ,(CAR FORMALS)
                                                        ,(CADR FORMALS))
                          (PIST* ,LOCALPONSTABLENAME ,(CADR FORMALS)
                                 ,(CAR FORMALS) ,@SPECIALS))
                         (T
                          (PIST* ,LOCALPONSTABLENAME ,(CAR FORMALS)
                                 ,(CADR FORMALS) ,@SPECIALS))))
                      (T `(PIST* ,LOCALPONSTABLENAME ,@FORMALS ,@SPECIALS))))
            (MULTIPLE-VALUE-SETQ (,*MF-ANS* ,*MF-ANS-P*)
              ,(LET ((GETHASH-FORM `(MF-GETHASH ,*MF-ARGS* ,LOCALTABLENAME)))
                 (COND
                  (AOKP `(COND (*AOKP* ,GETHASH-FORM) (T (VALUES NIL NIL))))
                  (T GETHASH-FORM))))
            (COND
             (,*MF-ANS-P*
              ,@(AND AOKP `((UPDATE-ATTACHED-FN-CALLED &#39;,(CONS :LOOKUP FN))))
              ,@MF-RECORD-HIT
              ,@(COND ((NULL (CDR STOBJS-OUT)) `(,*MF-ANS*))
                      (T
                       (LET ((LEN-1 (1- (LENGTH STOBJS-OUT))))
                         `(,(CONS &#39;MV
                                  (NCONC
                                   (LOOP FOR I FIXNUM BELOW LEN-1
                                         COLLECT `(POP ,*MF-ANS*))
                                   (LIST *MF-ANS*))))))))
             (T
              ,(LET* ((VARS
                       (LOOP FOR I FIXNUM BELOW (IF (CDR STOBJS-OUT)
                                                    (LENGTH STOBJS-OUT)
                                                    1)
                             COLLECT (MF-MAKE-SYMBOL &quot;O~a&quot; I))))
                 (COND
                  (AOKP
                   `(MV?-LET ,VARS ,BODY
                             (PROGN
                              (MF-SETHASH ,*MF-ARGS* (LIST* ,@VARS)
                                          ,LOCALTABLENAME)
                              (MV? ,@VARS))))
                  (T
                   `(LET (,*ATTACHED-FN-TEMP*)
                      (MV?-LET ,VARS
                               (LET ((*AOKP* (AND *AOKP* T))
                                     (SAVED-WARRANT-REQS *WARRANT-REQS*))
                                 (WHEN (CONSP SAVED-WARRANT-REQS)
                                   (SETQ *WARRANT-REQS*
                                           (AND SAVED-WARRANT-REQS T)))
                                 (,PROG1-FN ,BODY
                                  (COND
                                   ((NOT (MEMBER *AOKP* &#39;(T NIL) :TEST #&#39;EQ))
                                    (SETQ ,*ATTACHED-FN-TEMP* *AOKP*))
                                   ((CONSP *WARRANT-REQS*)
                                    (SETQ ,*ATTACHED-FN-TEMP*
                                            :{APPLY$-OR-BADGE}-USERFN)
                                    (WHEN (CONSP SAVED-WARRANT-REQS)
                                      (SETQ *WARRANT-REQS*
                                              (UNION-EQ *WARRANT-REQS*
                                                        SAVED-WARRANT-REQS))))
                                   ((EQ SAVED-WARRANT-REQS T)
                                    (SETQ *WARRANT-REQS* T)))))
                               (PROGN
                                (COND
                                 (,*ATTACHED-FN-TEMP*
                                  (MEMOIZE-USE-ATTACHMENT-WARNING &#39;,FN
                                                                  ,*ATTACHED-FN-TEMP*))
                                 (T
                                  (MF-SETHASH ,*MF-ARGS* (LIST* ,@VARS)
                                              ,LOCALTABLENAME)))
                                (WHEN ,*ATTACHED-FN-TEMP*
                                  (ASSERT
                                   (OR *AOKP*
                                       (EQ ,*ATTACHED-FN-TEMP*
                                           :{APPLY$-OR-BADGE}-USERFN)))
                                  (UPDATE-ATTACHED-FN-CALLED
                                   ,*ATTACHED-FN-TEMP*))
                                (MV? ,@VARS))))))))))))))))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-outer-body" data-defines="MEMOIZE-FN-OUTER-BODY" data-references="MFIXNUM,TYPE,IGNORABLE,DECLARE,LET,QUASIQUOTE,PROG1-FN,FORGET,START-TICKS,FN-COL-BASE,FN,INNER-BODY,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-OUTER-BODY" data-part-args="PROG1-FN,FORGET,START-TICKS,FN-COL-BASE,FN,INNER-BODY" data-part-body="MFIXNUM,TYPE,IGNORABLE,DECLARE,LET,QUASIQUOTE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-OUTER-BODY">memoize-fn-outer-body</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-outer-body" data-sym="MEMOIZE-FN-OUTER-BODY" title="(defun memoize-fn-outer-body
       (inner-body fn fn-col-base start-ticks forget prog1-fn)
  `(let (,@(and *record-bytes* `((,*mf-start-bytes* (heap-bytes-allocated))))
         ,@(and *record-pons-calls* `((,*mf-start-pons* *pons-call-counter*)))
         (,start-ticks
...">memoize-fn-outer-body</a>
  (inner-body fn fn-col-base start-ticks forget prog1-fn)
  `(let (,@(AND *RECORD-BYTES* `((,*MF-START-BYTES* (HEAP-BYTES-ALLOCATED)))) ,@(AND *RECORD-PONS-CALLS* `((,*MF-START-PONS* *PONS-CALL-COUNTER*)))
      (,START-TICKS ,(IF *RECORD-TIME*
     &#39;(INTERNAL-REAL-TICKS)
     &#39;0)))
    (declare (ignorable ,@(AND *RECORD-BYTES* `(,*MF-START-BYTES*))
        ,@(AND *RECORD-PONS-CALLS* `(,*MF-START-PONS*)))
      (type mfixnum
        ,START-TICKS
        ,@(AND *RECORD-PONS-CALLS* `(,*MF-START-PONS*))
        ,@(AND *RECORD-BYTES* `(,*MF-START-BYTES*))))
    (,(COND
  ((OR *RECORD-PONS-CALLS* *RECORD-BYTES* *RECORD-TIME* FORGET)
   (IF (F-GET-GLOBAL &#39;PROTECT-MEMOIZE-STATISTICS *THE-LIVE-STATE*)
       &#39;UNWIND-PROTECT-DISABLE-INTERRUPTS-DURING-CLEANUP
       PROG1-FN))
  (T &#39;PROGN)) ,(COND
  ((OR *RECORD-BYTES* *RECORD-CALLS* *RECORD-HITS* *RECORD-MHT-CALLS*
       *RECORD-PONS-CALLS* *RECORD-TIME*)
   `(LET ((*CALLER* ,FN-COL-BASE))
      ,INNER-BODY))
  (T INNER-BODY))
      ,@(AND *RECORD-PONS-CALLS*
       `((SAFE-INCF
          (AREF ,*MF-MA* ,(MA-INDEX-FROM-COL-BASE FN-COL-BASE *MA-PONS-INDEX*))
          (THE-MFIXNUM (- *PONS-CALL-COUNTER* ,*MF-START-PONS*)))))
      ,@(AND *RECORD-BYTES*
       `((SAFE-INCF
          (AREF ,*MF-MA*
                ,(MA-INDEX-FROM-COL-BASE FN-COL-BASE *MA-BYTES-INDEX*))
          (THE-MFIXNUM (- (HEAP-BYTES-ALLOCATED) ,*MF-START-BYTES*)))))
      ,@(AND *RECORD-TIME*
       `((SAFE-INCF
          (THE MFIXNUM (AREF ,*MF-MA* (THE-MFIXNUM (1+ ,*MF-COUNT-LOC*))))
          (THE-MFIXNUM
           (FIX-TICKS (THE-MFIXNUM (- (INTERNAL-REAL-TICKS) ,START-TICKS))
                      &#39;,FN)))))
      ,@(AND FORGET `((CLEAR-MEMOIZE-TABLE &#39;,FN))))))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-def" data-defines="MEMOIZE-FN-DEF" data-references="EQL,IF,*,SIMPLE-ARRAY,MFIXNUM,TYPE,*MEMOIZE-CALL-ARRAY*,LET*,WITH-GLOBAL-MEMOIZE-LOCK-STATIC,IGNORABLE,DECLARE,QUASIQUOTE,LOCALPONSTABLENAME,LOCALTABLENAME,START-TICKS,FNN,DCLS,SPECIALS,FORMALS,FN,OUTER-BODY,INNER-BODY,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-DEF" data-part-args="LOCALPONSTABLENAME,LOCALTABLENAME,START-TICKS,FNN,DCLS,SPECIALS,FORMALS,FN,OUTER-BODY,INNER-BODY" data-part-body="EQL,IF,*,SIMPLE-ARRAY,MFIXNUM,TYPE,*MEMOIZE-CALL-ARRAY*,LET*,WITH-GLOBAL-MEMOIZE-LOCK-STATIC,IGNORABLE,DECLARE,DEFUN,QUASIQUOTE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-DEF">memoize-fn-def</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-def" data-sym="MEMOIZE-FN-DEF" title="(defun memoize-fn-def
       (inner-body outer-body fn formals specials dcls fnn start-ticks
        localtablename localponstablename)
  `(defun ,fn ,formals
     ,@dcls
...">memoize-fn-def</a>
  (inner-body outer-body
    fn
    <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
    specials
    dcls
    fnn
    start-ticks
    localtablename
    localponstablename)
  `(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> ,FN
    ,FORMALS
    ,@DCLS
    (declare (ignorable ,@FORMALS ,@SPECIALS))
    (<a class="sym-link local-def" href="#def-with-global-memoize-lock-static" data-sym="WITH-GLOBAL-MEMOIZE-LOCK-STATIC" title="(defmacro with-global-memoize-lock-static (&amp;rest forms)
  (if *enable-multithreaded-memoization*
      `(with-lock-raw *global-memoize-lock* . ,forms)
      `(progn . ,forms)))">with-global-memoize-lock-static</a> (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((,*MF-COUNT-LOC* ,(IF (OR *RECORD-CALLS* *RECORD-TIME*)
     `(THE-MFIXNUM (+ *CALLER* ,(* 2 FNN)))
     0)) (,*MF-MA* *memoize-call-array*)
          ,LOCALTABLENAME
          ,LOCALPONSTABLENAME)
        (declare (type mfixnum ,*MF-COUNT-LOC*)
          (ignorable ,*MF-COUNT-LOC*
            ,*MF-MA*
            ,LOCALPONSTABLENAME
            ,LOCALTABLENAME)
          (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ,*MF-MA*))
        ,@(AND *RECORD-CALLS* `((SAFE-INCF (AREF ,*MF-MA* ,*MF-COUNT-LOC*) 1)))
        (if (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">-1</span> ,START-TICKS)
          ,OUTER-BODY
          ,INNER-BODY)))))</pre>
  </div>

<div class="form-block other" id="form-133" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-eval-compile
  (def old-fn)
  (declare (ignore old-fn))
  (unless (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (consp def)
      (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> '<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> (car def))
      (consp (cdr def))
      (symbolp (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> def)))
    (error <span class="string">"MEMOIZE-EVAL-COMPILE:  Bad input:~%~s."</span> def))
  (compile (eval def))
  nil)</pre>
  </div>

<div class="form-block function" id="def-memoize-fn-formals" data-defines="MEMOIZE-FN-FORMALS" data-references="MF-MAKE-SYMBOL,COLLECT,BELOW,FIXNUM,I,FOR,LOOP,MF-LEN-INPUTS,N,CADR,CONSP,MEMOIZE-LOOK-UP-DEF,EQ,IF,T,QUOTE,GETPROPC,FORMALS,LET,CL-DEFUN-P,CL-DEFUN,&KEY,INLINE,WRLD,FN,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="MEMOIZE-FN-FORMALS" data-part-args="CL-DEFUN-P,CL-DEFUN,&KEY,INLINE,WRLD,FN" data-part-body="MF-MAKE-SYMBOL,COLLECT,BELOW,FIXNUM,I,FOR,LOOP,MF-LEN-INPUTS,N,CADR,CONSP,INLINE,MEMOIZE-LOOK-UP-DEF,CL-DEFUN-P,CL-DEFUN,EQ,IF,WRLD,T,QUOTE,FN,GETPROPC,FORMALS,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN-FORMALS">memoize-fn-formals</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn-formals" data-sym="MEMOIZE-FN-FORMALS" title="(defun memoize-fn-formals (fn wrld inline &amp;key (cl-defun :default cl-defun-p))
  (let ((formals (getpropc fn &#39;formals t wrld)))
    (if (eq formals t)
        (let ((cl-defun
               (if cl-defun-p
...">memoize-fn-formals</a>
  (fn wrld inline &amp;key (cl-defun <span class="keyword">:default</span> cl-defun-p))
  (let ((<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn '<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> wrld)))
    (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
      (let ((cl-defun (if cl-defun-p
             cl-defun
             (<a class="sym-link local-def" href="#def-memoize-look-up-def" data-sym="MEMOIZE-LOOK-UP-DEF" title="(defun memoize-look-up-def (fn cl-defun inline wrld &amp;key quiet-p)
  (cond
   ((eq cl-defun :default)
    (cond ((null inline) nil)
          ((not (fboundp fn))
...">memoize-look-up-def</a> fn cl-defun inline wrld <span class="keyword">:quiet-p</span> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))))
        (if (consp cl-defun)
          (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> cl-defun)
          (let ((n (mf-len-inputs fn)))
            (if n
              (loop for
                i
                fixnum
                below
                n
                collect
                (<a class="sym-link local-def" href="#def-mf-make-symbol" data-sym="MF-MAKE-SYMBOL" title="(defmacro mf-make-symbol (&amp;rest r)
  `(our-syntax (intern (format nil ,@r) *acl2-package*)))">mf-make-symbol</a> <span class="string">"X~a"</span> i))
              <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))))
      <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)))</pre>
  </div>

<div class="form-block function" id="def-cltl-def-memoize-invoke" data-defines="CLTL-DEF-MEMOIZE-INVOKE" data-references="T,FUNCALL,IF,DEFVAR,QUASIQUOTE,EVAL,CDDR,BUTLAST,DECLS,CADR,FORMALS,CAR,FN,GENSYM,GSYM,LET,INVOKE,OLD-FN,FN-DEF,DEFUN" data-used-by="MEMOIZE-FN" data-part-name="CLTL-DEF-MEMOIZE-INVOKE" data-part-args="INVOKE,OLD-FN,FN-DEF" data-part-body="T,FUNCALL,IF,DEFVAR,QUASIQUOTE,EVAL,CDDR,BUTLAST,DECLS,CADR,FORMALS,FN-DEF,CAR,FN,GENSYM,GSYM,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLTL-DEF-MEMOIZE-INVOKE">cltl-def-memoize-invoke</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-cltl-def-memoize-invoke" data-sym="CLTL-DEF-MEMOIZE-INVOKE" title="(defun cltl-def-memoize-invoke (fn-def old-fn invoke)
  (let ((gsym (gensym))
        (fn (car fn-def))
        (formals (cadr fn-def))
        (decls (butlast (cddr fn-def) 1)))
...">cltl-def-memoize-invoke</a>
  (fn-def old-fn invoke)
  (let ((<a class="sym-link system" href="basis-b.html#def-gsym" data-sym="GSYM">gsym</a> (gensym)) (fn (car fn-def))
      (<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> fn-def))
      (decls (<a class="sym-link system" href="axioms.html#def-butlast" data-sym="BUTLAST">butlast</a> (<a class="sym-link system" href="axioms.html#def-cddr" data-sym="CDDR">cddr</a> fn-def) <span class="number">1</span>)))
    (eval `(defvar ,GSYM nil))
    `(,FN ,FORMALS
      ,@DECLS
      (if ,GSYM
        (funcall ,OLD-FN ,@FORMALS)
        (let ((,GSYM <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
          (,INVOKE ,@FORMALS))))))</pre>
  </div>

<div class="form-block function" id="def-memoize-fn" data-defines="MEMOIZE-FN" data-references="POP,REMHASH,WITHOUT-INTERRUPTS,SYMBOL,THE,SYMBOL-VALUE,PUSH,*MEMOIZE-INFO-HT*,*RECORD-TIME*,*RECORD-PONS-CALLS*,*RECORD-MHT-CALLS*,*RECORD-HITS*,*RECORD-CALLS*,*RECORD-BYTES*,EXT-ANCESTORS-ATTACHMENTS,MEMOIZE-INFO-HT-ENTRY,MAKE,MEMOIZE-EVAL-COMPILE,SETF,DO,AREF,EQL,UNLESS,*2MAX-MEMOIZE-FNS*,MA-INDEX-FROM-COL-BASE,BELOW,FROM,OF-TYPE,I,*,SIMPLE-ARRAY,DECLARE,*MEMOIZE-CALL-ARRAY*,MA,UNWIND-PROTECT,SUCCESS,MEMOIZE-FN-DEF,DEF,MEMOIZE-FN-OUTER-BODY,OUTER-BODY,MEMOIZE-FN-INNER-BODY,INNER-BODY,MULTIPLE-VALUE-PROG1,CDR,PROG1-FN,+,NUMBER-OF-ARGS,CONCRETE-STOBJ,OR,CONGRUENT-STOBJ-REP,ST-LST,STATE,ASSERT$,COLLECT,NOT,UNION,IN,ST,FOR,LOOP,REMOVE-DUPLICATES-EQ,AND,STS,LOCALPONSTABLENAME,MAKE-SYMBOL,LOCALTABLENAME,PONSTABLENAME,DEFG,TABLENAME,MFIXNUM,TYPE,DECLAIM,DEFPARAMETER,PROG1,EVAL,MEMOIZE-FN-SUFFIX,HONS-GENTEMP,V,START-TICKS,BUTLAST,CDDR,MF-DCLS,DCLS,FUNCALL,QUASIQUOTE,CONSP,LAST,CAR,ASSERT,PROGN,BODY,MA-INDEX,FN-COL-BASE,SYMBOL-TO-FIXNUM-CREATE,FNN,*NUMBER-OF-ARGUMENTS-AND-VALUES-HT*,LENGTH,CONS,MF-SETHASH,MEMOIZE-FN-INIT-2,LIST,NULL,MF-LEN-OUTPUTS,N,LEN,MAKE-LIST,QUOTE,GETPROPC,S,ERROR,MEMOIZE-FN-FORMALS,LET,EQ,COND,CLTL-DEF-MEMOIZE-INVOKE,IF,SYMBOL-FUNCTION,OLD-FN,MEMOIZE-LOOK-UP-DEF,CL-DEFUN0,LET*,MEMOIZE-FN-INIT,WITH-WARNINGS-SUPPRESSED,WITH-GLOBAL-MEMOIZE-LOCK,SETQ,*NIL*,EQUAL,WHEN,MEMOIZE-FN-SIGNATURE-ERROR,*THE-LIVE-STATE*,W,WRLD,&AUX,INVOKE,AOKP,*MHT-DEFAULT-SIZE*,MEMO-TABLE-INIT-SIZE,FORGET,STOBJS-OUT,COMMUTATIVE,SPECIALS,STOBJS-IN,FORMALS,CL-DEFUN,INLINE,T,CONDITION,&KEY,FN,DEFUN" data-used-by="SET-BAD-LISP-CONSP-MEMOIZE,ACL2H-INIT-MEMOIZATIONS,PROFILE-FN" data-part-name="MEMOIZE-FN" data-part-args="MEMOIZE-FN-SIGNATURE-ERROR,*THE-LIVE-STATE*,W,WRLD,&AUX,INVOKE,AOKP,*MHT-DEFAULT-SIZE*,MEMO-TABLE-INIT-SIZE,FORGET,STOBJS-OUT,COMMUTATIVE,SPECIALS,STOBJS-IN,FORMALS,CL-DEFUN,INLINE,T,CONDITION,&KEY,FN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZE-FN">memoize-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoize-fn" data-sym="MEMOIZE-FN" title="(defun memoize-fn
       (fn
        &amp;key (condition t) (inline t) (cl-defun :default) (formals :default)
        (stobjs-in :default) (specials nil) (commutative nil)
        (stobjs-out :default) (forget nil)
...">memoize-fn</a>
  (fn &amp;key
    (condition <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
    (inline <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
    (cl-defun <span class="keyword">:default</span>)
    (<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <span class="keyword">:default</span>)
    (<a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <span class="keyword">:default</span>)
    (specials nil)
    (commutative nil)
    (<a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> <span class="keyword">:default</span>)
    (forget nil)
    (memo-table-init-size *mht-default-size*)
    (aokp nil)
    (invoke nil)
    &amp;aux
    (wrld (<a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a> *the-live-state*))
    (memoize-fn-signature-error <span class="string">"Memoize-fn: could not determine a signature for ~a.~%~
  To assert the signature of ~:*~a, use (mf-note-arity &#39;~:*~a nargs nvals),~%~
  for example, (mf-note-arity &#39;~:*~a 3 1).)  If there are stobjs arguments~%~
  then do not use that mechanism; instead, pass suitable arguments to~%~
  memoize-fn."</span>))
  <span class="string">"The documentation for MEMOIZE-FN is very incomplete.  One may invoke
  (MEMOIZE-FN fn) on the name of a Common Lisp function FN from outside the
  ACL2 loop to get results of possible interest in terms of memoization
  activity and profiling information.  MEMOIZE-FN already has a dozen
  parameters.

  MEMOIZE-FN replaces the SYMBOL-FUNCTION for the symbol FN with &#39;enhanced&#39;
  raw Common Lisp code that, supposedly, does not affect the value returned by
  FN but may make some notes and may even obtain some return values by
  remembering them from a previous call.

  If the CONDITION parameter is not NIL or &#39;NIL, then whenever FN is called,
  and there is not as yet any value remembered for a call of FN on the given
  arguments, then if the evaluation of the CONDITION parameter (where the
  formals of FN are bound to its actuals) is not NIL or &#39;NIL, the values that
  are computed for FN on the given arguments will be saved under the given
  arguments.

  If the INLINE parameter is T, then when MEMOIZE-FN creates a new body for FN,
  we place the old body of FN within the new body, i.e., &#39;in line&#39;.  However,
  if the INLINE parameter is NIL, then we place code that calls the existing
  SYMBOL-FUNCTION for FN within the new body.  One might well argue that our
  parity for the INLINE parameter to MEMOIZE-fn is backwards, but we don&#39;t
  think so.

  One may lie to MEMOIZE-FN to force the memoization of a function that has
  ACL2&#39;s state as an explicit parameter by using fraudulent FORMALS, STOBJS-IN,
  and STOBJS-OUT parameters to MEMOIZE-FN.

  If the COMMUTATIVE parameter is not NIL, then the two arguments may be
  swapped before further processing.  We hope/presume that ACL2 will have been
  used first to prove that commutativity.

  If the CL-DEFUN parameter is not NIL, we pretend that the current body of FN
  is that parameter, and similarly for FORMALS, STOBJS-IN, and STOBJS-OUT.

  If FN is a raw Common Lisp function and not an ACL2-approved function, it may
  make reference to a variable, say S, that has a SPECIAL binding, in which
  case one needs to consider what in the world the meaning is for memoizing
  such a function at all.  If S is a member of the SPECIALS parameter, then it
  is assumed that FN does not alter but only refers to S.  MEMOIZE-FN acts as
  though FN had S as an extra argument for purposes of memoization.

  If the FORGET parameter is not NIL, the pons and memo tables of FN are
  discarded at the end of every outermost call of FN."</span>
  (when (equal condition <a class="sym-link system" href="axioms.html#def-_2Anil_2A" data-sym="*NIL*">*nil*</a>) (setq condition nil))
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (with-warnings-suppressed (<a class="sym-link local-def" href="#def-memoize-fn-init" data-sym="MEMOIZE-FN-INIT" title="(defun memoize-fn-init (fn inline wrld &amp;aux (state *the-live-state*))
  (with-global-memoize-lock
   (unless (symbolp fn) (error &quot;Memoize-fn: ~s is not a symbol.&quot; fn))
   (maybe-untrace! fn)
   (unless *memoize-init-done*
...">memoize-fn-init</a> fn inline wrld)
      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((cl-defun0 (<a class="sym-link local-def" href="#def-memoize-look-up-def" data-sym="MEMOIZE-LOOK-UP-DEF" title="(defun memoize-look-up-def (fn cl-defun inline wrld &amp;key quiet-p)
  (cond
   ((eq cl-defun :default)
    (cond ((null inline) nil)
          ((not (fboundp fn))
...">memoize-look-up-def</a> fn cl-defun inline wrld)) (old-fn (symbol-function fn))
          (cl-defun (if invoke
              (<a class="sym-link local-def" href="#def-cltl-def-memoize-invoke" data-sym="CLTL-DEF-MEMOIZE-INVOKE" title="(defun cltl-def-memoize-invoke (fn-def old-fn invoke)
  (let ((gsym (gensym))
        (fn (car fn-def))
        (formals (cadr fn-def))
        (decls (butlast (cddr fn-def) 1)))
...">cltl-def-memoize-invoke</a> cl-defun0 old-fn invoke)
              cl-defun0))
          (<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <span class="keyword">:default</span>) (let ((<a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> (<a class="sym-link local-def" href="#def-memoize-fn-formals" data-sym="MEMOIZE-FN-FORMALS" title="(defun memoize-fn-formals (fn wrld inline &amp;key (cl-defun :default cl-defun-p))
  (let ((formals (getpropc fn &#39;formals t wrld)))
    (if (eq formals t)
        (let ((cl-defun
               (if cl-defun-p
...">memoize-fn-formals</a> fn wrld inline <span class="keyword">:cl-defun</span> cl-defun)))
                  (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
                    (error memoize-fn-signature-error fn)
                    <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)))
              (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>)))
          (<a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <span class="keyword">:default</span>)
              (let ((s (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn '<a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> wrld)))
                (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> s <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
                  (<a class="sym-link system" href="axioms.html#def-make-list" data-sym="MAKE-LIST">make-list</a> (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>))
                  s))
              <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>))
          (<a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> <span class="keyword">:default</span>)
              (let ((s (<a class="sym-link system" href="axioms.html#def-getpropc" data-sym="GETPROPC">getpropc</a> fn '<a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a> <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> wrld)))
                (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> s <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
                  (let ((n (mf-len-outputs fn)))
                    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (n (<a class="sym-link system" href="axioms.html#def-make-list" data-sym="MAKE-LIST">make-list</a> n))
                      ((<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> condition) (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> nil))
                      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (error memoize-fn-signature-error fn))))
                  s))
              <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)))
        (<a class="sym-link local-def" href="#def-memoize-fn-init-2" data-sym="MEMOIZE-FN-INIT-2" title="(defun memoize-fn-init-2 (fn formals condition stobjs-in stobjs-out)
  (unless
      (and (symbol-listp formals) (no-duplicatesp formals)
           (loop for x in formals
                 never (constantp x)))
...">memoize-fn-init-2</a> fn
          <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
          condition
          <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>
          <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)
        (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn
          (cons (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>) (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>))
          *number-of-arguments-and-values-ht*)
        (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((fnn (symbol-to-fixnum-create fn)) (fn-col-base (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> fnn))
            (<a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a> (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (assert old-fn)
                (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (invoke (car (<a class="sym-link system" href="axioms.html#def-last" data-sym="LAST">last</a> cl-defun)))
                  (inline (assert (consp cl-defun)) (car (<a class="sym-link system" href="axioms.html#def-last" data-sym="LAST">last</a> cl-defun)))
                  (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> `(funcall ,OLD-FN ,@FORMALS)))))
            (dcls (mf-dcls (<a class="sym-link system" href="axioms.html#def-cddr" data-sym="CDDR">cddr</a> (<a class="sym-link system" href="axioms.html#def-butlast" data-sym="BUTLAST">butlast</a> cl-defun))))
            (start-ticks (let ((v (hons-gentemp (memoize-fn-suffix <span class="string">"START-TICKS-"</span> fn))))
                (eval `(prog1 (defparameter ,V <span class="number">-1</span>) (declaim (type mfixnum ,V))))))
            (tablename (eval `(defg ,(HONS-GENTEMP (MEMOIZE-FN-SUFFIX &quot;MEMOIZE-HT-FOR-&quot; FN))
                  nil)))
            (ponstablename (eval `(defg ,(HONS-GENTEMP (MEMOIZE-FN-SUFFIX &quot;PONS-HT-FOR-&quot; FN))
                  nil)))
            (localtablename (make-symbol <span class="string">"TABLENAME"</span>))
            (localponstablename (make-symbol <span class="string">"PONSTABLENAME"</span>))
            (sts (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> condition
                (<a class="sym-link system" href="axioms.html#def-remove-duplicates-eq" data-sym="REMOVE-DUPLICATES-EQ">remove-duplicates-eq</a> (loop for
                    st
                    in
                    (union <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a> <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)
                    when
                    (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> st (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> st <span class="keyword">:df</span>)))
                    collect
                    (<a class="sym-link system" href="axioms.html#def-assert_24" data-sym="ASSERT$">assert$</a> (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> st 'state))
                      (st-lst (<a class="sym-link system" href="basis-a.html#def-congruent-stobj-rep" data-sym="CONGRUENT-STOBJ-REP">congruent-stobj-rep</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (concrete-stobj st wrld) st) wrld)))))))
            (number-of-args (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>) (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> specials)))
            (prog1-fn (if (cdr <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>)
                'multiple-value-prog1
                'prog1))
            (inner-body (<a class="sym-link local-def" href="#def-memoize-fn-inner-body" data-sym="MEMOIZE-FN-INNER-BODY" title="(defun memoize-fn-inner-body
       (fn condition body fn-col-base tablename localtablename ponstablename
        localponstablename memo-table-init-size formals specials stobjs-out
        number-of-args commutative aokp prog1-fn)
  (let ((mf-record-mht
...">memoize-fn-inner-body</a> fn
                condition
                <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>
                fn-col-base
                tablename
                localtablename
                ponstablename
                localponstablename
                memo-table-init-size
                <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
                specials
                <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>
                number-of-args
                commutative
                aokp
                prog1-fn))
            (outer-body (<a class="sym-link local-def" href="#def-memoize-fn-outer-body" data-sym="MEMOIZE-FN-OUTER-BODY" title="(defun memoize-fn-outer-body
       (inner-body fn fn-col-base start-ticks forget prog1-fn)
  `(let (,@(and *record-bytes* `((,*mf-start-bytes* (heap-bytes-allocated))))
         ,@(and *record-pons-calls* `((,*mf-start-pons* *pons-call-counter*)))
         (,start-ticks
...">memoize-fn-outer-body</a> inner-body
                fn
                fn-col-base
                start-ticks
                forget
                prog1-fn))
            (def (<a class="sym-link local-def" href="#def-memoize-fn-def" data-sym="MEMOIZE-FN-DEF" title="(defun memoize-fn-def
       (inner-body outer-body fn formals specials dcls fnn start-ticks
        localtablename localponstablename)
  `(defun ,fn ,formals
     ,@dcls
...">memoize-fn-def</a> inner-body
                outer-body
                fn
                <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
                specials
                dcls
                fnn
                start-ticks
                localtablename
                localponstablename))
            (success nil))
          (unwind-protect (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (let ((ma *memoize-call-array*))
                (declare (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ma))
                (loop for
                  i
                  of-type
                  mfixnum
                  from
                  fn-col-base
                  below
                  (<a class="sym-link local-def" href="#def-ma-index-from-col-base" data-sym="MA-INDEX-FROM-COL-BASE" title="(defmacro ma-index-from-col-base (col-base row)
  `(the-mfixnum (+ (the-mfixnum ,col-base) (the-mfixnum ,row))))">ma-index-from-col-base</a> fn-col-base *2max-memoize-fns*)
                  unless
                  (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> (aref ma i) <span class="number">0</span>)
                  do
                  (setf (aref ma i) <span class="number">0</span>)))
              (memoize-eval-compile def old-fn)
              (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn
                (<a class="sym-link system" href="basis-a.html#def-make" data-sym="MAKE">make</a> memoize-info-ht-entry
                  <span class="keyword">:ext-anc-attachments</span> (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> aokp (ext-ancestors-attachments fn wrld))
                  <span class="keyword">:start-ticks</span> start-ticks
                  <span class="keyword">:num</span> fnn
                  <span class="keyword">:tablename</span> tablename
                  <span class="keyword">:ponstablename</span> ponstablename
                  <span class="keyword">:condition</span> condition
                  <span class="keyword">:inline</span> inline
                  <span class="keyword">:memoized-fn</span> (symbol-function fn)
                  <span class="keyword">:old-fn</span> old-fn
                  <span class="keyword">:fn</span> fn
                  <span class="keyword">:sts</span> sts
                  <span class="keyword">:cl-defun</span> cl-defun
                  <span class="keyword">:formals</span> <a class="sym-link system" href="basis-b.html#def-formals" data-sym="FORMALS">formals</a>
                  <span class="keyword">:commutative</span> commutative
                  <span class="keyword">:specials</span> specials
                  <span class="keyword">:stobjs-in</span> <a class="sym-link system" href="axioms.html#def-stobjs-in" data-sym="STOBJS-IN">stobjs-in</a>
                  <span class="keyword">:stobjs-out</span> <a class="sym-link system" href="axioms.html#def-stobjs-out" data-sym="STOBJS-OUT">stobjs-out</a>
                  <span class="keyword">:record-bytes</span> *record-bytes*
                  <span class="keyword">:record-calls</span> *record-calls*
                  <span class="keyword">:record-hits</span> *record-hits*
                  <span class="keyword">:record-mht-calls</span> *record-mht-calls*
                  <span class="keyword">:record-pons-calls</span> *record-pons-calls*
                  <span class="keyword">:record-time</span> *record-time*
                  <span class="keyword">:forget</span> forget
                  <span class="keyword">:memo-table-init-size</span> memo-table-init-size
                  <span class="keyword">:aokp</span> aokp
                  <span class="keyword">:invoke</span> invoke)
                *memoize-info-ht*)
              (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fnn fn *memoize-info-ht*)
              (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> condition
                (loop for
                  s
                  in
                  sts
                  do
                  (push tablename (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s)))))
              (setq success <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
            (unless success
              (without-interrupts (setf (symbol-function fn) old-fn)
                (remhash fn *memoize-info-ht*)
                (remhash fnn *memoize-info-ht*)
                (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> condition
                  (loop for
                    s
                    in
                    sts
                    when
                    (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> tablename (car (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s))))
                    do
                    (pop (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s)))))
                (setq fn nil)
                (error <span class="string">"Memoize-fn:  Failed to memoize ~s."</span> fn))))))))
  fn)</pre>
  </div>

<div class="form-block other" id="form-137" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output unmemoize-fn
  (fn)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (maybe-untrace! fn)
    (let ((rec (memoizedp-raw fn)))
      (unless rec (error <span class="string">"Unmemoize-fn: ~s is not memoized."</span> fn))
      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((num (the-mfixnum (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry rec <span class="keyword">:num</span>))) (tablename (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry rec <span class="keyword">:tablename</span>))
          (ponstablename (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry rec <span class="keyword">:ponstablename</span>))
          (sts (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry rec <span class="keyword">:sts</span>))
          (col-base (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> num))
          (saved-table (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol tablename)))
          (saved-ponstable (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol ponstablename)))
          (saved-fn-entry (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memoize-info-ht*))
          (saved-num-entry (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> num *memoize-info-ht*))
          (ma *memoize-call-array*)
          (success nil))
        (declare (type mfixnum num col-base)
          (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ma))
        (unwind-protect (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (format nil <span class="string">"unmemoizing ~s"</span> fn)
            (let nil
              (let ((old-fn (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry rec <span class="keyword">:old-fn</span>)))
                (assert old-fn)
                (setf (symbol-function (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol fn)) old-fn)))
            (loop for
              i
              of-type
              mfixnum
              from
              col-base
              below
              (<a class="sym-link local-def" href="#def-ma-index-from-col-base" data-sym="MA-INDEX-FROM-COL-BASE" title="(defmacro ma-index-from-col-base (col-base row)
  `(the-mfixnum (+ (the-mfixnum ,col-base) (the-mfixnum ,row))))">ma-index-from-col-base</a> col-base *2max-memoize-fns*)
              unless
              (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> (aref ma i) <span class="number">0</span>)
              do
              (setf (aref ma i) <span class="number">0</span>))
            (remhash fn *memoize-info-ht*)
            (remhash num *memoize-info-ht*)
            (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol tablename)) nil)
            (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol ponstablename)) nil)
            (loop for
              s
              in
              sts
              do
              (when (boundp s)
                (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s))
                  (<a class="sym-link system" href="axioms.html#def-remove" data-sym="REMOVE">remove</a> tablename (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s))))))
            (setq success <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
          (unless success
            (without-interrupts (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol tablename)) saved-table)
              (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol ponstablename))
                saved-ponstable)
              (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> fn saved-fn-entry *memoize-info-ht*)
              (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> num saved-num-entry *memoize-info-ht*)
              (loop for
                s
                in
                sts
                do
                (when (boundp s)
                  (push tablename (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol s)))))))))))
  fn)</pre>
  </div>

<div class="form-block other" id="form-138" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output maybe-unmemoize
  (fn)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (memoizedp-raw fn)
        (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (cdr (<a class="sym-link system" href="axioms.html#def-assoc-eq" data-sym="ASSOC-EQ">assoc-eq</a> fn
              (<a class="sym-link system" href="axioms.html#def-table-alist" data-sym="TABLE-ALIST">table-alist</a> 'memoize-table (<a class="sym-link system" href="axioms.html#def-w" data-sym="W">w</a> *the-live-state*))))))
      (unmemoize-fn fn))))</pre>
  </div>

<div class="form-block other" id="form-139" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoized-functions
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let (ans)
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (fn info)
          (declare (ignore info))
          (when (symbolp fn) (push fn ans)))
        *memoize-info-ht*)
      ans)))</pre>
  </div>

<div class="form-block other" id="form-140" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output length-memoized-functions
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (values (floor (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> *memoize-info-ht*)) <span class="number">2</span>))))</pre>
  </div>

<div class="form-block other" id="form-141" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output unmemoize-all
  nil
  (loop for
    x
    in
    (memoized-functions)
    do
    (unmemoize-fn x)))</pre>
  </div>

<div class="form-block other" id="form-142" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-info
  (k)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((v (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> k *memoize-info-ht*)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> v
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:fn</span>)
            <span class="keyword">:condition</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:condition</span>)
            <span class="keyword">:inline</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:inline</span>)
            <span class="keyword">:cl-defun</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:cl-defun</span>)
            <span class="keyword">:formals</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:formals</span>)
            <span class="keyword">:stobjs-in</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:stobjs-in</span>)
            <span class="keyword">:specials</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:specials</span>)
            <span class="keyword">:commutative</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:commutative</span>)
            <span class="keyword">:stobjs-out</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:stobjs-out</span>)
            <span class="keyword">:forget</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:forget</span>)
            <span class="keyword">:memo-table-init-size</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:memo-table-init-size</span>)
            <span class="keyword">:aokp</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:aokp</span>)
            <span class="keyword">:invoke</span> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:invoke</span>))
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-bytes</span>)
            (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-calls</span>)
            (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-hits</span>)
            (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-mht-calls</span>)
            (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-pons-calls</span>)
            (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:record-time</span>)))))))</pre>
  </div>

<div class="form-block other" id="form-143" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output rememoize-all
  (&amp;optional light)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (light (let ((new-memoize-info-ht (<a class="sym-link local-def" href="#def-initial-memoize-info-ht" data-sym="INITIAL-MEMOIZE-INFO-HT" title="(defun initial-memoize-info-ht ()
  (if *enable-multithreaded-memoization*
      (mf-mht :shared :default)
      (mf-mht)))">initial-memoize-info-ht</a>)))
          (unwind-protect (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v) (setf (gethash k new-memoize-info-ht) v))
                *memoize-info-ht*)
              (setq *memoize-info-ht* new-memoize-info-ht))
            (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> *memoize-info-ht* new-memoize-info-ht))
              (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> light <span class="keyword">:done</span>) (error <span class="string">"Fatal error in rememoize-all!~%Consider evaluating ~
                         ~s before continuing.~%"</span>
                    '(unmemoize-all)))
                (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"Error in rememoize-all; about to try again.~%"</span>)
                  (rememoize-all <span class="keyword">:done</span>)))))))
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let (lst)
          (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
              (declare (ignore v))
              (when (symbolp k) (push (memoize-info k) lst)))
            *memoize-info-ht*)
          (loop for
            x
            in
            lst
            do
            (unmemoize-fn (<a class="sym-link system" href="axioms.html#def-caar" data-sym="CAAR">caar</a> x)))
          (setq *memoize-info-ht* (<a class="sym-link local-def" href="#def-initial-memoize-info-ht" data-sym="INITIAL-MEMOIZE-INFO-HT" title="(defun initial-memoize-info-ht ()
  (if *enable-multithreaded-memoization*
      (mf-mht :shared :default)
      (mf-mht)))">initial-memoize-info-ht</a>))
          (<a class="sym-link system" href="axioms.html#def-gc_24" data-sym="GC$">gc$</a>)
          (setq *max-symbol-to-fixnum* *initial-max-symbol-to-fixnum*)
          (loop for
            x
            in
            lst
            do
            (progv '(*record-bytes* *record-calls*
                *record-hits*
                *record-mht-calls*
                *record-pons-calls*
                *record-time*)
              (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x)
              (apply '<a class="sym-link local-def" href="#def-memoize-fn" data-sym="MEMOIZE-FN" title="(defun memoize-fn
       (fn
        &amp;key (condition t) (inline t) (cl-defun :default) (formals :default)
        (stobjs-in :default) (specials nil) (commutative nil)
        (stobjs-out :default) (forget nil)
...">memoize-fn</a> (car x)))))))))</pre>
  </div>

<div class="form-block function" id="def-profile-fn" data-defines="PROFILE-FN" data-references="MEMOIZE-FN,FUNCTION,APPLY,&ALLOW-OTHER-KEYS,INLINE,CONDITION,&KEY,R,&REST,FN,DEFUN" data-part-name="PROFILE-FN" data-part-args="&ALLOW-OTHER-KEYS,INLINE,CONDITION,&KEY,R,&REST,FN" data-part-body="R,INLINE,CONDITION,FN,MEMOIZE-FN,FUNCTION,APPLY" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PROFILE-FN">profile-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-profile-fn" data-sym="PROFILE-FN" title="(defun profile-fn
       (fn &amp;rest r &amp;key (condition nil) (inline nil) &amp;allow-other-keys)
  (apply #&#39;memoize-fn fn :condition condition :inline inline r))">profile-fn</a>
  (fn &amp;rest
    r
    &amp;key
    (condition nil)
    (inline nil)
    &amp;allow-other-keys)
  (apply (function <a class="sym-link local-def" href="#def-memoize-fn" data-sym="MEMOIZE-FN" title="(defun memoize-fn
       (fn
        &amp;key (condition t) (inline t) (cl-defun :default) (formals :default)
        (stobjs-in :default) (specials nil) (commutative nil)
        (stobjs-out :default) (forget nil)
...">memoize-fn</a>)
    fn
    <span class="keyword">:condition</span> condition
    <span class="keyword">:inline</span> inline
    r))</pre>
  </div>

<div class="form-block other" id="form-145" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output profiled-functions
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let (lst)
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
          (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (symbolp k)
              (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:condition</span>))
              (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:inline</span>))
              (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:invoke</span>)))
            (push k lst)))
        *memoize-info-ht*)
      lst)))</pre>
  </div>

<div class="form-block other" id="form-146" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output unmemoize-profiled
  nil
  (loop for
    x
    in
    (profiled-functions)
    do
    (unmemoize-fn (car x))))</pre>
  </div>

<div class="form-block other" id="form-147" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output coerce-index
  (x)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((typep x 'fixnum) (assert (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-_3E_3D" data-sym="&gt;=">&gt;=</a> (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum x) <span class="number">0</span>)
          (&lt; (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum x)
            (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (ash (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> *memoize-call-array*) <span class="number">-1</span>)))))
      x)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (symbol-to-fixnum x))))</pre>
  </div>

<div class="form-block other" id="form-148" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mf-num-to-string
  (n)
  (check-type n number)
  (if (<a class="sym-link system" href="axioms.html#def-_3D" data-sym="=">=</a> n <span class="number">0</span>)
    (setq n <span class="number">0</span>))
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((typep n '(integer <span class="number">-99</span> <span class="number">999</span>)) (format nil <span class="string">"~8d"</span> n))
    ((<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (&lt; <span class="number">-1000</span> n <span class="number">-1/100</span>) (&lt; <span class="number">1/100</span> n <span class="number">1000</span>)) (format nil <span class="string">"~8,2f"</span> n))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (format nil <span class="string">"~8,2e"</span> n))))</pre>
  </div>

<div class="form-block function" id="def-mf-shorten" data-defines="MF-SHORTEN" data-references="MAX,SUBSEQ,STRING,QUOTE,CONCATENATE,MF-SETHASH,PRIN1,PRINC,S,WITH-OUTPUT-TO-STRING,STR,*PRINT-LINES*,*PRINT-LEVEL*,*PRINT-LENGTH*,*PRINT-PRETTY*,*MF-SHORTEN-HT*,MF-GETHASH,HONS-COPY,IF,LET,T,LENGTH,<=,STRINGP,AND,COND,N,X,DEFUN" data-part-name="MF-SHORTEN" data-part-args="N,X" data-part-body="MAX,SUBSEQ,STRING,QUOTE,CONCATENATE,MF-SETHASH,PRIN1,PRINC,S,WITH-OUTPUT-TO-STRING,STR,*PRINT-LINES*,*PRINT-LEVEL*,*PRINT-LENGTH*,*PRINT-PRETTY*,*MF-SHORTEN-HT*,MF-GETHASH,HONS-COPY,IF,LET,T,N,LENGTH,<=,X,STRINGP,AND,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MF-SHORTEN">mf-shorten</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-mf-shorten" data-sym="MF-SHORTEN" title="(defun mf-shorten (x n)
  (cond ((and (stringp x) (&lt;= (length x) n)) x)
        (t
         (let ((x
                (if (stringp x)
...">mf-shorten</a>
  (x n)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (stringp x) (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> x) n)) x)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((x (if (stringp x)
             (hons-copy x)
             x)))
        (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> x *mf-shorten-ht*))
          (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((*print-pretty* nil) (*print-length* <span class="number">10</span>)
                (*print-level* <span class="number">5</span>)
                (*print-lines* <span class="number">2</span>))
              (let ((str (with-output-to-string (s)
                     (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((stringp x) (princ x s)) (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (prin1 x s))))))
                (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> x
                  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> str) n) str)
                    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> (<a class="sym-link system" href="axioms.html#def-subseq" data-sym="SUBSEQ">subseq</a> str <span class="number">0</span> (max <span class="number">0</span> n)) <span class="string">"///"</span>)))
                  *mf-shorten-ht*)))))))))</pre>
  </div>

<div class="form-block other" id="form-150" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output mf-print-alist
  (alist separation)
  (check-type separation (integer <span class="number">0</span>))
  (setq alist
    (loop for
      x
      in
      alist
      collect
      (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (check-type x
          (cons (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> symbol)
            (cons (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> <a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a> (integer <span class="number">0</span>)) <a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a>)))
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link local-def" href="#def-mf-shorten" data-sym="MF-SHORTEN" title="(defun mf-shorten (x n)
  (cond ((and (stringp x) (&lt;= (length x) n)) x)
        (t
         (let ((x
                (if (stringp x)
...">mf-shorten</a> (car x) *mf-print-alist-width*)
          (if (integerp (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))
            (mf-num-to-string (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))
            (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))))))
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((max1 (loop for
         x
         in
         alist
         maximize
         (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (car x)))) (max2 (loop for
          x
          in
          alist
          maximize
          (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))))
      (width (max (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> *print-right-margin* *mf-print-right-margin*)
          (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> separation max1 max2))))
    (loop for
      x
      in
      alist
      do
      (fresh-line)
      (princ (car x))
      (loop for
        i
        below
        (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> width (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (car x)) (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))))
        do
        (write-char #\ ))
      (princ (<a class="sym-link system" href="axioms.html#def-cadr" data-sym="CADR">cadr</a> x))))
  nil)</pre>
  </div>

<div class="form-block macro" id="def-safe-incf-pons" data-defines="SAFE-INCF-PONS" data-references="SAFE-INCF,QUASIQUOTE,INC,X,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SAFE-INCF-PONS">safe-incf-pons</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> (x inc) `(<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> ,X ,INC))</pre>
  </div>

<div class="form-block other" id="form-152" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output pons-summary
  nil
  (<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (let ((sssub <span class="number">0</span>) (nponses <span class="number">0</span>) (nsubs <span class="number">0</span>) (nponstab <span class="number">0</span>))
      (declare (type mfixnum sssub nponses nsubs))
      (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"Pons-summary:~%"</span>)
      (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
            (when (symbolp k)
              (let ((tab (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:ponstablename</span>))))
                (when tab
                  (<a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> nponstab <span class="number">1</span>)
                  (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
                      (declare (ignore k))
                      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-listp" data-sym="LISTP">listp</a> v)) (<a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> sssub (<a class="sym-link local-def" href="#def-mf-hash-table-size" data-sym="MF-HASH-TABLE-SIZE" title="(defmacro mf-hash-table-size (ht) `(hash-table-size (the hash-table ,ht)))">mf-hash-table-size</a> v))
                          (<a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> nponses (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> v))
                          (<a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> nsubs <span class="number">1</span>))
                        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-safe-incf-pons" data-sym="SAFE-INCF-PONS" title="(defmacro safe-incf-pons (x inc) `(safe-incf ,x ,inc))">safe-incf-pons</a> nponses (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> v)))))
                    tab)))))
          *memoize-info-ht*))
      (mf-print-alist `((<span class="string">" Pons hits/calls"</span> ,(LET* ((C *PONS-CALL-COUNTER*) (M *PONS-MISSES-COUNTER*) (H (- C M)))
   (FORMAT NIL &quot;~,1e / ~,1e = ~,2f&quot; H C
           (IF (EQL C 0)
               0
               (/ H C))))) (<span class="string">" Number of pons tables"</span> ,(MF-NUM-TO-STRING NPONSTAB))
          (<span class="string">" Number of pons sub tables"</span> ,(MF-NUM-TO-STRING NSUBS))
          (<span class="string">" Sum of pons sub table sizes"</span> ,(MF-NUM-TO-STRING SSSUB))
          (<span class="string">" Number of ponses"</span> ,(MF-NUM-TO-STRING NPONSES)))
        <span class="number">5</span>)
      (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">")"</span>)
      (force-output *standard-output*)
      nil)))</pre>
  </div>

<div class="form-block function" id="def-memoized-values" data-defines="MEMOIZED-VALUES" data-references="*STANDARD-OUTPUT*,FORCE-OUTPUT,V,KEY,LAMBDA,MF-MAPHASH,MF-HASH-TABLE-COUNT,EQL,AND,*MEMOIZE-INFO-HT*,MF-GETHASH,MEMOIZE-INFO-HT-ENTRY,ACCESS,SYMBOL-VALUE,TB,LET,T,FORMAT,MEMOIZEDP-RAW,NOT,FUNCTION,MAPC,LISTP,COND,WITH-GLOBAL-MEMOIZE-LOCK,MEMOIZED-FUNCTIONS,FN,&OPTIONAL,DEFUN" data-used-by="MEMSTAT" data-part-name="MEMOIZED-VALUES" data-part-args="MEMOIZED-FUNCTIONS,FN,&OPTIONAL" data-part-body="V,KEY,LAMBDA,MF-MAPHASH,MF-HASH-TABLE-COUNT,EQL,AND,*MEMOIZE-INFO-HT*,MF-GETHASH,MEMOIZE-INFO-HT-ENTRY,ACCESS,SYMBOL-VALUE,TB,LET,T,FORMAT,MEMOIZEDP-RAW,NOT,MEMOIZED-VALUES,FUNCTION,MAPC,FN,LISTP,COND,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMOIZED-VALUES">memoized-values</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memoized-values" data-sym="MEMOIZED-VALUES" title="(defun memoized-values (&amp;optional (fn (memoized-functions)))
  (with-global-memoize-lock
   (cond ((listp fn) (mapc #&#39;memoized-values fn))
         ((not (memoizedp-raw fn))
          (format t &quot;~%; Memoized-values:  ~s is not memoized.&quot; fn))
...">memoized-values</a>
  (&amp;optional (fn (memoized-functions)))
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-listp" data-sym="LISTP">listp</a> fn) (mapc (function <a class="sym-link local-def" href="#def-memoized-values" data-sym="MEMOIZED-VALUES" title="(defun memoized-values (&amp;optional (fn (memoized-functions)))
  (with-global-memoize-lock
   (cond ((listp fn) (mapc #&#39;memoized-values fn))
         ((not (memoizedp-raw fn))
          (format t &quot;~%; Memoized-values:  ~s is not memoized.&quot; fn))
...">memoized-values</a>) fn))
      ((<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (memoizedp-raw fn)) (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%; Memoized-values:  ~s is not memoized."</span> fn))
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (let ((tb (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry
                 (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memoize-info-ht*)
                 <span class="keyword">:tablename</span>))))
          (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> tb (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span> (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> tb)))) (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%; Memoized values for ~s."</span> fn)
              (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (key v) (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%~s~%=&gt;~%~s"</span> key v))
                tb)))))))
  (force-output *standard-output*)
  nil)</pre>
  </div>

<div class="form-block function" id="def-print-call-stack" data-defines="PRINT-CALL-STACK" data-references="FORCE-OUTPUT,QUOTE,MF-PRINT-ALIST,*STANDARD-OUTPUT*,TERPRI,*FLOAT-TICKS/SECOND*,-,THE-MFIXNUM,/,MF-NUM-TO-STRING,CAR,LIST,COLLECT,IN,PAIR,FOR,LOOP,CDR,<,FUNCTION,SORT,SETQ,*MEMOIZE-INFO-HT*,CONS,PUSH,>,MFIXNUM,TYPE,DECLARE,MEMOIZE-INFO-HT-ENTRY,ACCESS,SYMBOL,THE,SYMBOL-VALUE,X,SYMBOLP,WHEN,V,K,LAMBDA,MF-MAPHASH,WITH-GLOBAL-MEMOIZE-LOCK,*PRINT-CASE*,INTERNAL-REAL-TICKS,TICKS,LST,LET,OUR-SYNTAX,FLOAT-TICKS/SECOND-INIT,DEFUN" data-part-name="PRINT-CALL-STACK" data-part-body="FLOAT-TICKS/SECOND-INIT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PRINT-CALL-STACK">print-call-stack</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-print-call-stack" data-sym="PRINT-CALL-STACK" title="(defun print-call-stack ()
  (float-ticks/second-init)
  (our-syntax
   (let (lst (ticks (internal-real-ticks)) (*print-case* :downcase))
     (with-global-memoize-lock
...">print-call-stack</a>
  nil
  (float-ticks/second-init)
  (<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (let (lst (ticks (<a class="sym-link local-def" href="#def-internal-real-ticks" data-sym="INTERNAL-REAL-TICKS" title="(defmacro internal-real-ticks ()
  &#39;(the-mfixnum
    (logand (the-mfixnum (get-internal-real-time)) most-positive-mfixnum)))">internal-real-ticks</a>)) (*print-case* <span class="keyword">:downcase</span>))
      (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
            (when (symbolp k)
              (let ((x (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:start-ticks</span>)))))
                (declare (type mfixnum x))
                (when (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> x <span class="number">0</span>) (push (cons k x) lst)))))
          *memoize-info-ht*))
      (setq lst (sort lst (function &lt;) <span class="keyword">:key</span> (function cdr)))
      (setq lst
        (loop for
          pair
          in
          lst
          collect
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (car pair)
            (mf-num-to-string (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (the-mfixnum (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> ticks (cdr pair))) *float-ticks/second*)))))
      (when lst
        (terpri *standard-output*)
        (mf-print-alist (cons '(<span class="string">"Stack of monitored function calls."</span> <span class="string">"Time since outermost call."</span>)
            lst)
          <span class="number">5</span>))))
  (force-output *standard-output*)
  nil)</pre>
  </div>

<div class="form-block other" id="form-155" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output pons-calls
  (x)
  (setq x (coerce-index x))
  (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> x *ma-pons-index*)))</pre>
  </div>

<div class="form-block other" id="form-156" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output bytes-allocated
  (x)
  (setq x (coerce-index x))
  (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> x *ma-bytes-index*)))</pre>
  </div>

<div class="form-block other" id="form-157" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output number-of-hits
  (x)
  (setq x (coerce-index x))
  (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> x *ma-hits-index*)))</pre>
  </div>

<div class="form-block other" id="form-158" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output number-of-memoized-entries
  (x)
  (setq x (coerce-index x))
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((h (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> x *memoize-info-ht*)))
      (unless h (error <span class="string">"~a is not memoized."</span> x))
      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((sym (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry h <span class="keyword">:tablename</span>)) (val (symbol-value sym)))
        (if (hash-table-p val)
          (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> val)
          <span class="number">0</span>)))))</pre>
  </div>

<div class="form-block other" id="form-159" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output number-of-mht-calls
  (x)
  (setq x (coerce-index x))
  (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> x *ma-mht-index*)))</pre>
  </div>

<div class="form-block other" id="form-160" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output total-time
  (x)
  (setq x (coerce-index x))
  (float-ticks/second-init)
  (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index-ticks" data-sym="MA-INDEX-TICKS" title="(defmacro ma-index-ticks
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child+1 `(the-mfixnum (1+ (the-mfixnum (* 2 (the-mfixnum ,child)))))))
    (if (eql parent 0)
        2child+1">ma-index-ticks</a> x))
    *float-ticks/second*))</pre>
  </div>

<div class="form-block other" id="form-161" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output number-of-calls
  (x)
  (setq x (coerce-index x))
  (aref *memoize-call-array* (<a class="sym-link local-def" href="#def-ma-index-calls" data-sym="MA-INDEX-CALLS" title="(defmacro ma-index-calls
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child `(the-mfixnum (* 2 (the-mfixnum ,child)))))
    (if (eql parent 0)
        2child">ma-index-calls</a> x)))</pre>
  </div>

<div class="form-block other" id="form-162" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output time-for-non-hits/call
  (x)
  (setq x (coerce-index x))
  (let ((n (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> (number-of-calls x) (number-of-hits x))))
    (if (zerop n)
      <span class="number">0</span>
      (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (total-time x) n))))</pre>
  </div>

<div class="form-block other" id="form-163" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output time/call
  (x)
  (setq x (coerce-index x))
  (let ((n (number-of-calls x)))
    (if (zerop n)
      <span class="number">0</span>
      (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (total-time x) n))))</pre>
  </div>

<div class="form-block other" id="form-164" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output hits/calls
  (x)
  (setq x (coerce-index x))
  (let ((n (number-of-calls x)))
    (if (zerop n)
      <span class="number">0</span>
      (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (number-of-hits x) (float n)))))</pre>
  </div>

<div class="form-block other" id="form-165" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output bytes-allocated/call
  (x)
  (setq x (coerce-index x))
  (let ((n (number-of-calls x)))
    (if (zerop n)
      <span class="number">0</span>
      (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (bytes-allocated x) n))))</pre>
  </div>

<div class="form-block function" id="def-char-list-fraction" data-defines="CHAR-LIST-FRACTION" data-references="CDR,/,CAR,CHAR-CODE,+,ATOM,IF,L,DEFUN" data-used-by="SYMBOL-NAME-ORDER" data-part-name="CHAR-LIST-FRACTION" data-part-args="L" data-part-body="CDR,CHAR-LIST-FRACTION,/,CAR,CHAR-CODE,+,L,ATOM,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CHAR-LIST-FRACTION">char-list-fraction</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-char-list-fraction" data-sym="CHAR-LIST-FRACTION" title="(defun char-list-fraction (l)
  (if (atom l)
      0
      (+ (char-code (car l)) (/ (char-list-fraction (cdr l)) 256))))">char-list-fraction</a>
  (l)
  (if (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> l)
    <span class="number">0</span>
    (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (char-code (car l)) (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (<a class="sym-link local-def" href="#def-char-list-fraction" data-sym="CHAR-LIST-FRACTION" title="(defun char-list-fraction (l)
  (if (atom l)
      0
      (+ (char-code (car l)) (/ (char-list-fraction (cdr l)) 256))))">char-list-fraction</a> (cdr l)) <span class="number">256</span>))))</pre>
  </div>

<div class="form-block function" id="def-symbol-name-order" data-defines="SYMBOL-NAME-ORDER" data-references="LIST,QUOTE,SYMBOL-NAME,COERCE,CHAR-LIST-FRACTION,-,FIXNUM-TO-SYMBOL,SETQ,SYMBOLP,UNLESS,S,DEFUN" data-part-name="SYMBOL-NAME-ORDER" data-part-args="S" data-part-body="FIXNUM-TO-SYMBOL,SETQ,S,SYMBOLP,UNLESS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SYMBOL-NAME-ORDER">symbol-name-order</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-symbol-name-order" data-sym="SYMBOL-NAME-ORDER" title="(defun symbol-name-order (s)
  (unless (symbolp s) (setq s (fixnum-to-symbol s)))
  (- (char-list-fraction (coerce (symbol-name s) &#39;list))))">symbol-name-order</a>
  (s)
  (unless (symbolp s) (setq s (fixnum-to-symbol s)))
  (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> (<a class="sym-link local-def" href="#def-char-list-fraction" data-sym="CHAR-LIST-FRACTION" title="(defun char-list-fraction (l)
  (if (atom l)
      0
      (+ (char-code (car l)) (/ (char-list-fraction (cdr l)) 256))))">char-list-fraction</a> (coerce (symbol-name s) '<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a>))))</pre>
  </div>

<div class="form-block other" id="form-168" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output execution-order
  (s)
  (unless (symbolp s) (setq s (fixnum-to-symbol s)))
  (the-mfixnum (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol
        (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry
          (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> s *memoize-info-ht*)
          <span class="keyword">:start-ticks</span>)))))</pre>
  </div>

<div class="form-block function" id="def-compute-calls-and-times" data-defines="COMPUTE-CALLS-AND-TIMES" data-references="PUSH,SAFE-INCF,TICKS-ROW,TICKS,TICKS-INDEX,>,WHEN,THE-MFIXNUM,CALLS,MA-INDEX-FROM-COL-BASE,INDEX,CALLS-ROW,LET*,J,MA-INDEX,COL-BASE,TO,*INITIAL-MAX-SYMBOL-TO-FIXNUM*,FROM,MA-INDEX-CALLS,MAKE-ARRAY,SETQ,AREF,SETF,DO,BELOW,I,FOR,LOOP,LENGTH,EQL,COND,T,*,MFIXNUM,SIMPLE-ARRAY,TYPE,DECLARE,*MAX-SYMBOL-TO-FIXNUM*,1+,FIXNUM,THE,N,*CALLERS-ARRAY*,CA,*2MAX-MEMOIZE-FNS*,2M,*MEMOIZE-CALL-ARRAY*,MA,LET,WITH-GLOBAL-MEMOIZE-LOCK,DEFUN" data-part-name="COMPUTE-CALLS-AND-TIMES" data-part-body="PUSH,COMPUTE-CALLS-AND-TIMES,SAFE-INCF,TICKS-ROW,TICKS,TICKS-INDEX,>,WHEN,THE-MFIXNUM,CALLS,MA-INDEX-FROM-COL-BASE,INDEX,CALLS-ROW,LET*,J,MA-INDEX,COL-BASE,TO,*INITIAL-MAX-SYMBOL-TO-FIXNUM*,FROM,MA-INDEX-CALLS,MAKE-ARRAY,SETQ,AREF,SETF,DO,BELOW,I,FOR,LOOP,LENGTH,EQL,COND,T,*,MFIXNUM,SIMPLE-ARRAY,TYPE,DECLARE,*MAX-SYMBOL-TO-FIXNUM*,1+,FIXNUM,THE,N,*CALLERS-ARRAY*,CA,*2MAX-MEMOIZE-FNS*,2M,*MEMOIZE-CALL-ARRAY*,MA,LET,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="COMPUTE-CALLS-AND-TIMES">compute-calls-and-times</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-compute-calls-and-times" data-sym="COMPUTE-CALLS-AND-TIMES" title="(defun compute-calls-and-times ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*)
         (|2M| *2max-memoize-fns*)
         (ca *callers-array*)
...">compute-calls-and-times</a>
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((ma *memoize-call-array*) (2m *2max-memoize-fns*)
        (ca *callers-array*)
        (n (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> fixnum (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> *max-symbol-to-fixnum*))))
      (declare (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ma)
        (type (simple-array <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ca)
        (type fixnum 2m n))
      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> ca) n) (loop for
            i
            fixnum
            below
            n
            do
            (setf (aref ca i) nil)))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (setq *callers-array* (make-array n <span class="keyword">:initial-element</span> nil))
          (setq ca *callers-array*)))
      (loop for
        i
        fixnum
        below
        (<a class="sym-link local-def" href="#def-ma-index-calls" data-sym="MA-INDEX-CALLS" title="(defmacro ma-index-calls
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child `(the-mfixnum (* 2 (the-mfixnum ,child)))))
    (if (eql parent 0)
        2child">ma-index-calls</a> n <span class="number">0</span> 2m)
        do
        (setf (aref ma i) <span class="number">0</span>))
      (loop for
        i
        fixnum
        from
        *initial-max-symbol-to-fixnum*
        to
        *max-symbol-to-fixnum*
        do
        (let ((col-base (<a class="sym-link local-def" href="#def-ma-index" data-sym="MA-INDEX" title="(defmacro ma-index (col &amp;optional (row 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((col-base `(* ,2mmf (the-mfixnum ,col))))
    (if (eql row 0)
        `(the-mfixnum ,col-base)
        `(ma-index-from-col-base ,col-base ,row))))">ma-index</a> i <span class="number">0</span> 2m)))
          (declare (type mfixnum col-base))
          (loop for
            j
            fixnum
            from
            *initial-max-symbol-to-fixnum*
            to
            *max-symbol-to-fixnum*
            do
            (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((calls-row (<a class="sym-link local-def" href="#def-ma-index-calls" data-sym="MA-INDEX-CALLS" title="(defmacro ma-index-calls
          (child &amp;optional (parent 0) (2mmf &#39;*2max-memoize-fns*))
  (let ((2child `(the-mfixnum (* 2 (the-mfixnum ,child)))))
    (if (eql parent 0)
        2child">ma-index-calls</a> j)) (index (<a class="sym-link local-def" href="#def-ma-index-from-col-base" data-sym="MA-INDEX-FROM-COL-BASE" title="(defmacro ma-index-from-col-base (col-base row)
  `(the-mfixnum (+ (the-mfixnum ,col-base) (the-mfixnum ,row))))">ma-index-from-col-base</a> col-base calls-row))
                (calls (the-mfixnum (aref ma index))))
              (declare (type mfixnum calls-row index calls))
              (when (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> calls <span class="number">0</span>)
                (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((ticks-index (the-mfixnum (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> index))) (ticks (aref ma ticks-index))
                    (ticks-row (the-mfixnum (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> calls-row))))
                  (declare (type mfixnum ticks-index ticks ticks-row))
                  (<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> (aref ma calls-row)
                    calls
                    <a class="sym-link local-def" href="#def-compute-calls-and-times" data-sym="COMPUTE-CALLS-AND-TIMES" title="(defun compute-calls-and-times ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*)
         (|2M| *2max-memoize-fns*)
         (ca *callers-array*)
...">compute-calls-and-times</a>)
                  (<a class="sym-link local-def" href="#def-safe-incf" data-sym="SAFE-INCF" title="(defmacro safe-incf (x inc &amp;optional where)
  (cond
   ((integerp inc)
    (if (&lt;= inc 0)
        nil
...">safe-incf</a> (aref ma ticks-row)
                    ticks
                    <a class="sym-link local-def" href="#def-compute-calls-and-times" data-sym="COMPUTE-CALLS-AND-TIMES" title="(defun compute-calls-and-times ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*)
         (|2M| *2max-memoize-fns*)
         (ca *callers-array*)
...">compute-calls-and-times</a>)
                  (push i (aref ca j)))))))))))</pre>
  </div>

<div class="form-block other" id="form-170" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output print-not-called
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-compute-calls-and-times" data-sym="COMPUTE-CALLS-AND-TIMES" title="(defun compute-calls-and-times ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*)
         (|2M| *2max-memoize-fns*)
         (ca *callers-array*)
...">compute-calls-and-times</a>)
    (let ((ans nil))
      (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k v)
          (declare (ignore v))
          (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (symbolp k) (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span> (number-of-calls k)))
            (push k ans)))
        *memoize-info-ht*)
      (loop for
        x
        in
        (sort ans '<a class="sym-link system" href="axioms.html#def-alphorder" data-sym="ALPHORDER">alphorder</a>)
        do
        (print x)))))</pre>
  </div>

<div class="form-block other" id="form-171" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-summary-sort
  nil
  (labels ((lex-&gt; (l1 l2)
       (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> l1) (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> l2)) nil)
         ((<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> (car l1) (car l2)) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
         ((&lt; (car l1) (car l2)) nil)
         (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (lex-&gt; (cdr l1) (cdr l2))))))
    (let (pairs)
      (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (fn v)
            (when (symbolp fn)
              (let ((num (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry v <span class="keyword">:num</span>)))
                (declare (type mfixnum num))
                (when (&lt; <span class="number">0</span> (number-of-calls num))
                  (push (cons fn
                      (loop for
                        order
                        in
                        *memoize-summary-order-list*
                        collect
                        (funcall order fn)))
                    pairs)))))
          *memoize-info-ht*)
        (sort pairs
          (if *memoize-summary-order-reversed*
            (lambda (x y) (lex-&gt; y x))
            (function lex-&gt;))
          <span class="keyword">:key</span> (function cdr))))))</pre>
  </div>

<div class="form-block other" id="form-172" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output outside-caller-p
  (x)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> x *initial-max-symbol-to-fixnum*)
      (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> x *memoize-info-ht*)))))</pre>
  </div>

<div class="form-block other" id="form-173" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-condition
  (fn)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((x (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memoize-info-ht*)))
      (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> x (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry x <span class="keyword">:condition</span>)))))</pre>
  </div>

<div class="form-block other" id="form-174" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-summary-after-compute-calls-and-times
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (float-ticks/second-init)
    (<a class="sym-link local-def" href="#def-our-syntax" data-sym="OUR-SYNTAX" title="(defmacro our-syntax (&amp;rest args)
  `(our-with-standard-io-syntax
    (let ((*package*
           (find-package-fast
            (f-get-global &#39;current-package *the-live-state*)))
...">our-syntax</a> (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((fn-pairs (memoize-summary-sort)) (ma *memoize-call-array*)
          (len-orig-fn-pairs (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> fn-pairs))
          (len-fn-pairs <span class="number">0</span>)
          (global-bytes-allocated <span class="number">0</span>)
          (global-pons-calls <span class="number">0</span>))
        (declare (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ma)
          (type fixnum len-orig-fn-pairs len-fn-pairs))
        (when (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> *memoize-summary-limit*
            (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> len-orig-fn-pairs *memoize-summary-limit*))
          (setq fn-pairs (<a class="sym-link system" href="axioms.html#def-take" data-sym="TAKE">take</a> *memoize-summary-limit* fn-pairs)))
        (setq len-fn-pairs (<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> fn-pairs))
        (when (<a class="sym-link system" href="axioms.html#def-_3E" data-sym="&gt;">&gt;</a> len-fn-pairs <span class="number">0</span>)
          (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
            <span class="string">"~%Sorted by *memoize-summary-order-list* = ~s."</span>
            *memoize-summary-order-list*)
          (when (&lt; len-fn-pairs len-orig-fn-pairs)
            (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
              <span class="string">"~%Reporting on ~:d of ~:d functions because ~
                   *memoize-summary-limit* = ~a."</span>
              len-fn-pairs
              len-orig-fn-pairs
              *memoize-summary-limit*)))
        (setq global-bytes-allocated
          (loop for
            pair
            in
            fn-pairs
            sum
            (bytes-allocated (car pair))))
        (setq global-pons-calls
          (loop for
            pair
            in
            fn-pairs
            sum
            (pons-calls (car pair))))
        (when (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> fn-pairs)
          (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%(memoize-summary) has nothing to report.~%"</span>))
        (loop for
          pair
          in
          fn-pairs
          do
          (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((fn (car pair)) (entry (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> fn *memoize-info-ht*))
              (tablename (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:tablename</span>)))
              (ponstablename (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:ponstablename</span>)))
              (start-ticks (the-mfixnum (symbol-value (<a class="sym-link system" href="axioms.html#def-the" data-sym="THE">the</a> symbol
                      (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:start-ticks</span>)))))
              (num (the-mfixnum (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:num</span>)))
              (nhits (the-mfixnum (number-of-hits num)))
              (nmht (the-mfixnum (number-of-mht-calls num)))
              (ncalls (the-mfixnum (number-of-calls num)))
              (pons-calls (the-mfixnum (pons-calls num)))
              (no-hits (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> *report-hits*) (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (memoize-condition fn))))
              (bytes-allocated (bytes-allocated num))
              (tt (max <span class="number">1.0e-6</span> (total-time num)))
              (t/c (time/call num))
              (in-progress-str (if (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> start-ticks <span class="number">-1</span>)
                  <span class="string">""</span>
                  <span class="string">" (running)"</span>))
              (selftime tt))
            (declare (type integer start-ticks)
              (type mfixnum
                num
                nhits
                nmht
                ncalls
                pons-calls
                bytes-allocated))
            (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">"~%(~s~%"</span> fn)
            (mf-print-alist `(,@(WHEN (OR *REPORT-CALLS* *REPORT-HITS*)
    `((,(FORMAT NIL &quot; ~a~a&quot;
                (IF NO-HITS
                    &quot;Calls&quot;
                    &quot;Hits/calls&quot;)
                IN-PROGRESS-STR)
       ,(COND (NO-HITS (FORMAT NIL &quot;~a&quot; (MF-NUM-TO-STRING NCALLS)))
              ((ZEROP NCALLS) (FORMAT NIL &quot;~8,2e/~8,2e = ????%&quot; NHITS 0))
              (T
               (FORMAT NIL &quot;~8,2e/~8,2e = ~4,1f%&quot; NHITS NCALLS
                       (* 100 (/ NHITS (FLOAT NCALLS))))))))) ,@(WHEN (AND *REPORT-MHT-CALLS* (&gt;= NMHT 2))
    `((&quot; Number of calls to mht&quot; ,(MF-NUM-TO-STRING NMHT))))
                ,@(WHEN *REPORT-TIME*
    `((&quot; Time of all outermost calls&quot; ,(FORMAT NIL &quot;~a&quot; (MF-NUM-TO-STRING TT)))
      (&quot; Time per call&quot; ,(MF-NUM-TO-STRING T/C))))
                ,@(WHEN (AND (&gt; BYTES-ALLOCATED 0) *REPORT-BYTES*)
    (ASSERT (&gt; GLOBAL-BYTES-ALLOCATED 0))
    `((&quot; Heap bytes allocated&quot;
       ,(FORMAT NIL &quot;~a; ~4,1f%&quot; (MF-NUM-TO-STRING BYTES-ALLOCATED)
                (* 100 (/ BYTES-ALLOCATED GLOBAL-BYTES-ALLOCATED))))
      (&quot; Heap bytes allocated per call&quot;
       ,(MF-NUM-TO-STRING (/ BYTES-ALLOCATED NCALLS)))))
                ,@(WHEN (AND (&gt; PONS-CALLS 0) *REPORT-PONS-CALLS*)
    (ASSERT (&gt; GLOBAL-PONS-CALLS 0))
    `((&quot; Pons calls&quot;
       ,(FORMAT NIL &quot;~a; ~4,1f%&quot; (MF-NUM-TO-STRING PONS-CALLS)
                (* 100 (/ PONS-CALLS GLOBAL-PONS-CALLS))))))
                ,@(WHEN (AND *REPORT-HITS* *REPORT-TIME* (NOT (EQL 0 NHITS)))
    `((&quot; Time per missed call&quot;
       ,(MF-NUM-TO-STRING (TIME-FOR-NON-HITS/CALL NUM)))))
                ,@(WHEN *REPORT-CALLS-TO*
    (LET ((LST NIL) (OUTSIDE-FN-TIME 0) (OUTSIDE-FN-COUNT 0))
      (DECLARE (TYPE MFIXNUM OUTSIDE-FN-COUNT))
      (LOOP FOR CALLERN IN (LOOP FOR I BELOW (LENGTH *CALLERS-ARRAY*)
                                 WHEN (MEMBER NUM (AREF *CALLERS-ARRAY* I))
                                 COLLECT I)
            DO (LET* ((CALL-LOC (MA-INDEX-CALLS CALLERN NUM))
                      (CALLS (AREF MA CALL-LOC))
                      (TICKS-LOC (THE-MFIXNUM (1+ CALL-LOC)))
                      (TICKS (AREF MA TICKS-LOC))
                      (LOCAL-TT (/ TICKS *FLOAT-TICKS/SECOND*)))
                 (DECLARE (TYPE MFIXNUM CALL-LOC CALLS TICKS-LOC TICKS))
                 (DECF SELFTIME LOCAL-TT)
                 (COND
                  ((OR (OUTSIDE-CALLER-P CALLERN) (&lt; (* 100 LOCAL-TT) TT))
                   (INCF OUTSIDE-FN-TIME LOCAL-TT)
                   (SAFE-INCF OUTSIDE-FN-COUNT CALLS
                              MEMOIZE-SUMMARY-AFTER-COMPUTE-CALLS-AND-TIMES))
                  (T
                   (PUSH
                    `((,(FORMAT NIL &quot; To ~s&quot; (FIXNUM-TO-SYMBOL CALLERN))
                       ,(FORMAT NIL &quot;~8,2e calls took~8,2e; ~a%&quot; CALLS LOCAL-TT
                                (COND
                                 ((&gt; (* 10000 LOCAL-TT) TT) (ASSERT (&lt; 0 TT))
                                  (FORMAT NIL &quot;~4,1f&quot; (* 100 (/ LOCAL-TT TT))))
                                 (T &quot;&lt;0.01&quot;))))
                      . ,(IF *SORT-TO-FROM-BY-CALLS*
                             CALLS
                             LOCAL-TT))
                    LST)))))
      (WHEN (&gt; OUTSIDE-FN-TIME 0)
        (ASSERT (&lt; 0 TT))
        (PUSH
         `((,(FORMAT NIL &quot; To other functions&quot;)
            ,(FORMAT NIL &quot;~8,2e calls took~8,2e; ~a%&quot; OUTSIDE-FN-COUNT
                     OUTSIDE-FN-TIME
                     (IF (&gt; (* 10000 OUTSIDE-FN-TIME) TT)
                         (FORMAT NIL &quot;~4,1f&quot; (* 100 (/ OUTSIDE-FN-TIME TT)))
                         &quot;&lt;0.01&quot;)))
           . ,(IF *SORT-TO-FROM-BY-CALLS*
                  OUTSIDE-FN-COUNT
                  OUTSIDE-FN-TIME))
         LST))
      (WHEN (AND (&gt; SELFTIME 0) (NOT (= SELFTIME TT)))
        (ASSERT (&lt; 0 TT))
        (PUSH
         `((&quot; To self/unprofiled functions&quot;
            ,(FORMAT NIL &quot;~8,2e; ~a%&quot; SELFTIME
                     (IF (&gt; (* 10000 SELFTIME) TT)
                         (FORMAT NIL &quot;~4,1f&quot; (* 100 (/ SELFTIME TT)))
                         &quot;&lt;0.01&quot;)))
           . ,(IF *SORT-TO-FROM-BY-CALLS*
                  0
                  SELFTIME))
         LST))
      (SETQ LST (SORT LST #&#39;&gt; :KEY #&#39;CDR))
      (STRIP-CARS LST)))
                ,@(WHEN *REPORT-CALLS-FROM*
    (LET ((LST NIL) (OUTSIDE-CALLER-TIME 0) (OUTSIDE-CALLER-COUNT 0))
      (LOOP FOR CALLERN IN (AREF *CALLERS-ARRAY* NUM)
            DO (LET* ((CALL-LOC (MA-INDEX-CALLS NUM CALLERN))
                      (CALLS (AREF MA CALL-LOC))
                      (TICKS-LOC (THE-MFIXNUM (1+ CALL-LOC)))
                      (TICKS (AREF MA TICKS-LOC))
                      (LOCAL-TT (/ TICKS *FLOAT-TICKS/SECOND*)))
                 (DECLARE (TYPE MFIXNUM CALL-LOC CALLS TICKS-LOC TICKS))
                 (COND
                  ((OR (OUTSIDE-CALLER-P CALLERN) (&lt; (* 100 LOCAL-TT) TT))
                   (INCF OUTSIDE-CALLER-TIME LOCAL-TT)
                   (INCF OUTSIDE-CALLER-COUNT CALLS))
                  (T
                   (PUSH
                    `((,(FORMAT NIL &quot; From ~s&quot; (FIXNUM-TO-SYMBOL CALLERN))
                       ,(FORMAT NIL &quot;~8,2e calls took~8,2e; ~a%&quot; CALLS LOCAL-TT
                                (IF (AND (&lt;= 0.001 LOCAL-TT) (&lt;= LOCAL-TT TT))
                                    (FORMAT NIL &quot;~4,1f&quot;
                                            (* 100 (/ LOCAL-TT TT)))
                                    &quot;?&quot;)))
                      . ,(IF *SORT-TO-FROM-BY-CALLS*
                             CALLS
                             LOCAL-TT))
                    LST)))))
      (WHEN (&gt; OUTSIDE-CALLER-TIME 0)
        (PUSH
         `((,(FORMAT NIL &quot; From other functions&quot;)
            ,(FORMAT NIL &quot;~8,2e calls took~8,2e; ~a%&quot; OUTSIDE-CALLER-COUNT
                     OUTSIDE-CALLER-TIME
                     (IF (AND (&lt;= 0.001 OUTSIDE-CALLER-TIME)
                              (&lt;= OUTSIDE-CALLER-TIME TT))
                         (FORMAT NIL &quot;~4,1f&quot;
                                 (* 100 (/ OUTSIDE-CALLER-TIME TT)))
                         &quot;?&quot;)))
           . ,(IF *SORT-TO-FROM-BY-CALLS*
                  OUTSIDE-CALLER-COUNT
                  OUTSIDE-CALLER-TIME))
         LST))
      (SETQ LST (SORT LST #&#39;&gt; :KEY #&#39;CDR))
      (STRIP-CARS LST)))
                ,@(WHEN (OR *REPORT-ON-MEMO-TABLES* *REPORT-ON-PONS-TABLES*)
    (LET ((SUM-PONS-SUB-SIZES 0) (NPONSES 0) (NPONSSUBS 0))
      (DECLARE (TYPE MFIXNUM SUM-PONS-SUB-SIZES NPONSES NPONSSUBS))
      (AND PONSTABLENAME *REPORT-ON-PONS-TABLES*
           (MF-MAPHASH
            (LAMBDA (KEY VALUE)
              (DECLARE (IGNORE KEY))
              (COND
               ((NOT (LISTP VALUE))
                (SAFE-INCF-PONS SUM-PONS-SUB-SIZES (MF-HASH-TABLE-SIZE VALUE))
                (SAFE-INCF-PONS NPONSES (MF-HASH-TABLE-COUNT VALUE))
                (SAFE-INCF-PONS NPONSSUBS 1))
               (T (SAFE-INCF-PONS NPONSES (LENGTH VALUE)))))
            PONSTABLENAME))
      `(,@(AND TABLENAME *REPORT-ON-MEMO-TABLES*
               (LET ((COUNT (MF-HASH-TABLE-COUNT TABLENAME))
                     (SIZE (MF-HASH-TABLE-SIZE TABLENAME)))
                 `((,(FORMAT NIL &quot; Memoize table count/size&quot;)
                    ,(FORMAT NIL &quot;~8,2e/~8,2e = ~4,1f%&quot; COUNT SIZE
                             (* 100 (/ COUNT SIZE)))))))
        ,@(AND PONSTABLENAME *REPORT-ON-PONS-TABLES*
               (LET ((COUNT (MF-HASH-TABLE-COUNT PONSTABLENAME))
                     (SIZE (MF-HASH-TABLE-SIZE PONSTABLENAME)))
                 `((&quot; (Pons table count/size&quot;
                    ,(FORMAT NIL &quot;~:d/~:d = ~4,1f%)&quot; COUNT SIZE
                             (* 100 (/ COUNT SIZE))))
                   (&quot; (Number of pons sub tables&quot;
                    ,(FORMAT NIL &quot;~a)&quot; (MF-NUM-TO-STRING NPONSSUBS)))
                   (&quot; (Sum of pons sub table sizes&quot;
                    ,(FORMAT NIL &quot;~a)&quot; (MF-NUM-TO-STRING SUM-PONS-SUB-SIZES)))
                   (&quot; (Number of ponses&quot;
                    ,(FORMAT NIL &quot;~a)&quot; (MF-NUM-TO-STRING NPONSES))))))))))
              <span class="number">5</span>))
          (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> <span class="string">")"</span>))))
    (terpri *standard-output*)
    (force-output *standard-output*))
  nil)</pre>
  </div>

<div class="form-block other" id="form-175" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-summary
  nil
  (<a class="sym-link local-def" href="#def-compute-calls-and-times" data-sym="COMPUTE-CALLS-AND-TIMES" title="(defun compute-calls-and-times ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*)
         (|2M| *2max-memoize-fns*)
         (ca *callers-array*)
...">compute-calls-and-times</a>)
  (memoize-summary-after-compute-calls-and-times)
  nil)</pre>
  </div>

<div class="form-block function" id="def-clear-one-memo-and-pons-hash" data-defines="CLEAR-ONE-MEMO-AND-PONS-HASH" data-references="UPDATE-MEMO-MAX-SIZES,PONS-TABLE-DESIRED-SIZE,PT-TARGET-SIZE,SETF,CLRHASH,EQL,UNLESS,<,EQ,OR,IF,MEMOIZE-TABLE-DESIRED-SIZE,MT-TARGET-SIZE,WHEN,PT-COUNT,MF-HASH-TABLE-COUNT,AND,MT-COUNT,PT,SYMBOL-VALUE,MT,MEMOIZE-INFO-HT-ENTRY,ACCESS,FN,LET*,WITH-GLOBAL-MEMOIZE-LOCK,STRATEGY,L,DEFUN" data-used-by="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS" data-part-name="CLEAR-ONE-MEMO-AND-PONS-HASH" data-part-args="STRATEGY,L" data-part-body="UPDATE-MEMO-MAX-SIZES,PONS-TABLE-DESIRED-SIZE,PT-TARGET-SIZE,SETF,CLRHASH,EQL,UNLESS,<,STRATEGY,EQ,OR,IF,MEMOIZE-TABLE-DESIRED-SIZE,MT-TARGET-SIZE,WHEN,PT-COUNT,MF-HASH-TABLE-COUNT,AND,MT-COUNT,PT,SYMBOL-VALUE,MT,L,MEMOIZE-INFO-HT-ENTRY,ACCESS,FN,LET*,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLEAR-ONE-MEMO-AND-PONS-HASH">clear-one-memo-and-pons-hash</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-clear-one-memo-and-pons-hash" data-sym="CLEAR-ONE-MEMO-AND-PONS-HASH" title="(defun clear-one-memo-and-pons-hash (l strategy)
  (with-global-memoize-lock
   (let* ((fn (access memoize-info-ht-entry l :fn))
          (mt (symbol-value (access memoize-info-ht-entry l :tablename)))
          (pt (symbol-value (access memoize-info-ht-entry l :ponstablename)))
...">clear-one-memo-and-pons-hash</a>
  (l strategy)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((fn (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry l <span class="keyword">:fn</span>)) (mt (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry l <span class="keyword">:tablename</span>)))
        (pt (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry l <span class="keyword">:ponstablename</span>)))
        (mt-count (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> mt (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> mt)))
        (pt-count (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> pt (<a class="sym-link local-def" href="#def-mf-hash-table-count" data-sym="MF-HASH-TABLE-COUNT" title="(defmacro mf-hash-table-count (ht) `(hash-table-count (the hash-table ,ht)))">mf-hash-table-count</a> pt))))
      (when mt
        (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((mt-target-size (<a class="sym-link local-def" href="#def-memoize-table-desired-size" data-sym="MEMOIZE-TABLE-DESIRED-SIZE" title="(defun memoize-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        min-size
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">memoize-table-desired-size</a> fn <span class="number">0</span>)))
          (if (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> strategy <span class="keyword">:clear</span>)
              (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> strategy <span class="keyword">:auto</span>) (&lt; mt-count mt-target-size)))
            (unless (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span> mt-count) (clrhash mt))
            (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry l <span class="keyword">:tablename</span>))
              nil))))
      (when pt
        (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((pt-target-size (<a class="sym-link local-def" href="#def-pons-table-desired-size" data-sym="PONS-TABLE-DESIRED-SIZE" title="(defun pons-table-desired-size (fn min-size)
  (let* ((max-sizes (mf-gethash fn *memo-max-sizes*)))
    (if (not max-sizes)
        *mht-default-size*
        (let* ((nclears (access memo-max-sizes-entry max-sizes :num-clears))
...">pons-table-desired-size</a> fn <span class="number">0</span>)))
          (if (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> strategy <span class="keyword">:clear</span>)
              (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> strategy <span class="keyword">:auto</span>) (&lt; pt-count pt-target-size)))
            (unless (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> <span class="number">0</span> pt-count) (clrhash pt))
            (setf (symbol-value (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry l <span class="keyword">:ponstablename</span>))
              nil))))
      (when (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> mt-count pt-count)
        (<a class="sym-link local-def" href="#def-update-memo-max-sizes" data-sym="UPDATE-MEMO-MAX-SIZES" title="(defun update-memo-max-sizes (fn pt-size mt-size)
  (when (or (&lt; 0 mt-size) (&lt; 0 pt-size))
    (with-global-memoize-lock
     (let ((old (mf-gethash fn *memo-max-sizes*)))
       (if (not old)
...">update-memo-max-sizes</a> fn (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> pt-count <span class="number">1</span>) (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> mt-count <span class="number">1</span>)))))
  nil)</pre>
  </div>

<div class="form-block other" id="form-177" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output clear-memoize-table
  (k)
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (when (symbolp k)
      (let ((l (<a class="sym-link local-def" href="#def-mf-gethash" data-sym="MF-GETHASH" title="(defmacro mf-gethash (key ht) `(gethash ,key (the hash-table ,ht)))">mf-gethash</a> k *memoize-info-ht*)))
        (when l (<a class="sym-link local-def" href="#def-clear-one-memo-and-pons-hash" data-sym="CLEAR-ONE-MEMO-AND-PONS-HASH" title="(defun clear-one-memo-and-pons-hash (l strategy)
  (with-global-memoize-lock
   (let* ((fn (access memoize-info-ht-entry l :fn))
          (mt (symbol-value (access memoize-info-ht-entry l :tablename)))
          (pt (symbol-value (access memoize-info-ht-entry l :ponstablename)))
...">clear-one-memo-and-pons-hash</a> l <span class="keyword">:auto</span>)))))
  k)</pre>
  </div>

<div class="form-block other" id="form-178" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output clear-memoize-tables
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let (success)
      (unwind-protect (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k l)
              (when (symbolp k) (<a class="sym-link local-def" href="#def-clear-one-memo-and-pons-hash" data-sym="CLEAR-ONE-MEMO-AND-PONS-HASH" title="(defun clear-one-memo-and-pons-hash (l strategy)
  (with-global-memoize-lock
   (let* ((fn (access memoize-info-ht-entry l :fn))
          (mt (symbol-value (access memoize-info-ht-entry l :tablename)))
          (pt (symbol-value (access memoize-info-ht-entry l :ponstablename)))
...">clear-one-memo-and-pons-hash</a> l <span class="keyword">:null</span>)))
            *memoize-info-ht*)
          (setq success <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
        (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> success (error <span class="string">"clear-memoize-tables failed."</span>))))
    (setq *pons-call-counter* <span class="number">0</span>)
    (setq *pons-misses-counter* <span class="number">0</span>))
  nil)</pre>
  </div>

<div class="form-block function" id="def-clear-memoize-call-array" data-defines="CLEAR-MEMOIZE-CALL-ARRAY" data-references="INTEGER,OF-TYPE,T,AREF,SETF,DO,BELOW,I,FOR,LOOP,FIXNUM,QUOTE,TYPEP,COND,LENGTH,LEN,*,MFIXNUM,SIMPLE-ARRAY,TYPE,DECLARE,*MEMOIZE-CALL-ARRAY*,MA,LET,WITH-GLOBAL-MEMOIZE-LOCK,DEFUN" data-used-by="CLEAR-MEMOIZE-STATISTICS" data-part-name="CLEAR-MEMOIZE-CALL-ARRAY" data-part-body="INTEGER,OF-TYPE,T,AREF,SETF,DO,BELOW,I,FOR,LOOP,FIXNUM,QUOTE,TYPEP,COND,LENGTH,LEN,*,MFIXNUM,SIMPLE-ARRAY,TYPE,DECLARE,*MEMOIZE-CALL-ARRAY*,MA,LET,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLEAR-MEMOIZE-CALL-ARRAY">clear-memoize-call-array</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-clear-memoize-call-array" data-sym="CLEAR-MEMOIZE-CALL-ARRAY" title="(defun clear-memoize-call-array ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*))
     (declare (type (simple-array mfixnum (*)) ma))
     (let ((len (length ma)))
...">clear-memoize-call-array</a>
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (let ((ma *memoize-call-array*))
      (declare (type (simple-array mfixnum (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a>)) ma))
      (let ((<a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> ma)))
        (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((typep <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a> 'fixnum) (loop for
              i
              fixnum
              below
              <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>
              do
              (setf (aref ma i) <span class="number">0</span>)))
          (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (loop for
              i
              of-type
              integer
              below
              <a class="sym-link system" href="axioms.html#def-len" data-sym="LEN">len</a>
              do
              (setf (aref ma i) <span class="number">0</span>))))))))</pre>
  </div>

<div class="form-block function" id="def-clear-memoize-statistics" data-defines="CLEAR-MEMOIZE-STATISTICS" data-references="CLEAR-MEMOIZE-CALL-ARRAY,*PONS-MISSES-COUNTER*,*PONS-CALL-COUNTER*,SETQ,WITH-GLOBAL-MEMOIZE-LOCK,DEFUN" data-part-name="CLEAR-MEMOIZE-STATISTICS" data-part-body="CLEAR-MEMOIZE-CALL-ARRAY,*PONS-MISSES-COUNTER*,*PONS-CALL-COUNTER*,SETQ,WITH-GLOBAL-MEMOIZE-LOCK" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLEAR-MEMOIZE-STATISTICS">clear-memoize-statistics</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-clear-memoize-statistics" data-sym="CLEAR-MEMOIZE-STATISTICS" title="(defun clear-memoize-statistics ()
  (with-global-memoize-lock (setq *pons-call-counter* 0)
                            (setq *pons-misses-counter* 0)
                            (clear-memoize-call-array))
  nil)">clear-memoize-statistics</a>
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (setq *pons-call-counter* <span class="number">0</span>)
    (setq *pons-misses-counter* <span class="number">0</span>)
    (<a class="sym-link local-def" href="#def-clear-memoize-call-array" data-sym="CLEAR-MEMOIZE-CALL-ARRAY" title="(defun clear-memoize-call-array ()
  (with-global-memoize-lock
   (let ((ma *memoize-call-array*))
     (declare (type (simple-array mfixnum (*)) ma))
     (let ((len (length ma)))
...">clear-memoize-call-array</a>))
  nil)</pre>
  </div>

<div class="form-block other" id="form-181" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output memoize-init
  nil
  (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (when *memoize-init-done* (return-from memoize-init nil))
    (unless (<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> *caller* (the-mfixnum (<a class="sym-link local-def" href="#def-outside-caller-col-base" data-sym="OUTSIDE-CALLER-COL-BASE" title="(defun outside-caller-col-base () (ma-index *initial-max-symbol-to-fixnum*))">outside-caller-col-base</a>)))
      (error <span class="string">"memoize-init:  A memoized function is running."</span>))
    (let (success)
      (unwind-protect (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (setq *pons-call-counter* <span class="number">0</span>)
          (setq *pons-misses-counter* <span class="number">0</span>)
          (setq *memoize-info-ht* (<a class="sym-link local-def" href="#def-initial-memoize-info-ht" data-sym="INITIAL-MEMOIZE-INFO-HT" title="(defun initial-memoize-info-ht ()
  (if *enable-multithreaded-memoization*
      (mf-mht :shared :default)
      (mf-mht)))">initial-memoize-info-ht</a>))
          (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> *initial-max-symbol-to-fixnum*
            <span class="string">"outside-caller"</span>
            *memoize-info-ht*)
          (setq *max-symbol-to-fixnum* *initial-max-symbol-to-fixnum*)
          (setq *2max-memoize-fns* *initial-2max-memoize-fns*)
          (<a class="sym-link local-def" href="#def-sync-memoize-call-array" data-sym="SYNC-MEMOIZE-CALL-ARRAY" title="(defun sync-memoize-call-array ()
  (with-global-memoize-lock
   (let ((n1 (ma-index *2max-memoize-fns*)) (n2 (1+ *max-symbol-to-fixnum*)))
     (declare (type (and fixnum mfixnum) n1 n2))
     (setq *memoize-call-array* (initial-memoize-call-array 1))
...">sync-memoize-call-array</a>)
          (setq *memo-max-sizes* (<a class="sym-link local-def" href="#def-mf-mht" data-sym="MF-MHT" title="(defmacro mf-mht (&amp;rest args)
  (if (assoc-keyword :shared args)
      `(hl-mht ,@args)
      `(if *enable-multithreaded-memoization*
           (hl-mht :shared :default ,@args)">mf-mht</a> <span class="keyword">:shared</span> <span class="keyword">:default</span>))
          (setq success <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
        (if success
          (setq *memoize-init-done* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
          (error <span class="string">"memoize-init failed."</span>)))))
  nil)</pre>
  </div>

<div class="form-block macro" id="def-with-lower-overhead" data-defines="WITH-LOWER-OVERHEAD" data-references="*RECORD-TIME*,*RECORD-PONS-CALLS*,*RECORD-MHT-CALLS*,*RECORD-HITS*,*RECORD-CALLS*,*RECORD-BYTES*,LET,QUASIQUOTE,R,&REST,DEFMACRO" data-used-by="SET-BAD-LISP-CONSP-MEMOIZE,ACL2H-INIT-MEMOIZATIONS,WITH-OVERHEAD" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="WITH-LOWER-OVERHEAD">with-lower-overhead</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-with-lower-overhead" data-sym="WITH-LOWER-OVERHEAD" title="(defmacro with-lower-overhead (&amp;rest r)
  `(let ((*record-bytes* nil)
         (*record-calls* nil)
         (*record-hits* nil)
         (*record-mht-calls* nil)
...">with-lower-overhead</a>
  (&amp;rest r)
  `(let ((*record-bytes* nil) (*record-calls* nil)
      (*record-hits* nil)
      (*record-mht-calls* nil)
      (*record-pons-calls* nil)
      (*record-time* nil))
    ,@R))</pre>
  </div>

<div class="form-block macro" id="def-with-higher-overhead" data-defines="WITH-HIGHER-OVERHEAD" data-references="*RECORD-TIME*,*RECORD-PONS-CALLS*,*RECORD-MHT-CALLS*,*RECORD-HITS*,*RECORD-CALLS*,T,*RECORD-BYTES*,LET,QUASIQUOTE,R,&REST,DEFMACRO" data-used-by="WITH-OVERHEAD" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="WITH-HIGHER-OVERHEAD">with-higher-overhead</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-with-higher-overhead" data-sym="WITH-HIGHER-OVERHEAD" title="(defmacro with-higher-overhead (&amp;rest r)
  `(let ((*record-bytes* t)
         (*record-calls* t)
         (*record-hits* t)
         (*record-mht-calls* t)
...">with-higher-overhead</a>
  (&amp;rest r)
  `(let ((*record-bytes* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) (*record-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
      (*record-hits* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
      (*record-mht-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
      (*record-pons-calls* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)
      (*record-time* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
    ,@R))</pre>
  </div>

<div class="form-block macro" id="def-with-overhead" data-defines="WITH-OVERHEAD" data-references="WITH-HIGHER-OVERHEAD,T,WITH-LOWER-OVERHEAD,NULL,EQ,COND,QUASIQUOTE,GENSYM,V,LET,FORM,VAL,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="WITH-OVERHEAD">with-overhead</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-with-overhead" data-sym="WITH-OVERHEAD" title="(defmacro with-overhead (val form)
  (let ((v (gensym)))
    `(let ((,v ,val))
       (cond ((eq ,v :default) ,form) ((null ,v) (with-lower-overhead ,form))
             (t (with-higher-overhead ,form))))))">with-overhead</a>
  (val form)
  (let ((v (gensym)))
    `(let ((,V ,VAL))
      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> ,V <span class="keyword">:default</span>) ,FORM)
        ((<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> ,V) (<a class="sym-link local-def" href="#def-with-lower-overhead" data-sym="WITH-LOWER-OVERHEAD" title="(defmacro with-lower-overhead (&amp;rest r)
  `(let ((*record-bytes* nil)
         (*record-calls* nil)
         (*record-hits* nil)
         (*record-mht-calls* nil)
...">with-lower-overhead</a> ,FORM))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-with-higher-overhead" data-sym="WITH-HIGHER-OVERHEAD" title="(defmacro with-higher-overhead (&amp;rest r)
  `(let ((*record-bytes* t)
         (*record-calls* t)
         (*record-hits* t)
         (*record-mht-calls* t)
...">with-higher-overhead</a> ,FORM))))))</pre>
  </div>

<div class="form-block function" id="def-acl2h-init-memoizations" data-defines="ACL2H-INIT-MEMOIZATIONS" data-references="MEMOIZE-FN,QUOTE,APPLY,WITH-LOWER-OVERHEAD,DO,CAR,MEMOIZEDP-RAW,NOT,WHEN,*THREAD-UNSAFE-BUILTIN-MEMOIZATIONS*,IN,ENTRY,FOR,LOOP,DEFUN" data-part-name="ACL2H-INIT-MEMOIZATIONS" data-part-body="MEMOIZE-FN,QUOTE,APPLY,WITH-LOWER-OVERHEAD,DO,CAR,MEMOIZEDP-RAW,NOT,WHEN,*THREAD-UNSAFE-BUILTIN-MEMOIZATIONS*,IN,ENTRY,FOR,LOOP" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="ACL2H-INIT-MEMOIZATIONS">acl2h-init-memoizations</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-acl2h-init-memoizations" data-sym="ACL2H-INIT-MEMOIZATIONS" title="(defun acl2h-init-memoizations ()
  (loop for entry in *thread-unsafe-builtin-memoizations*
        when (not (memoizedp-raw (car entry)))
        do (with-lower-overhead (apply &#39;memoize-fn entry))))">acl2h-init-memoizations</a>
  nil
  (loop for
    entry
    in
    *thread-unsafe-builtin-memoizations*
    when
    (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (memoizedp-raw (car entry)))
    do
    (<a class="sym-link local-def" href="#def-with-lower-overhead" data-sym="WITH-LOWER-OVERHEAD" title="(defmacro with-lower-overhead (&amp;rest r)
  `(let ((*record-bytes* nil)
         (*record-calls* nil)
         (*record-hits* nil)
         (*record-mht-calls* nil)
...">with-lower-overhead</a> (apply '<a class="sym-link local-def" href="#def-memoize-fn" data-sym="MEMOIZE-FN" title="(defun memoize-fn
       (fn
        &amp;key (condition t) (inline t) (cl-defun :default) (formals :default)
        (stobjs-in :default) (specials nil) (commutative nil)
        (stobjs-out :default) (forget nil)
...">memoize-fn</a> entry))))</pre>
  </div>

<div class="form-block function" id="def-set-bad-lisp-consp-memoize" data-defines="SET-BAD-LISP-CONSP-MEMOIZE" data-references="UNMEMOIZE-FN,T,*BAD-LISP-CONSP-MEMOIZATION*,MEMOIZE-FN,APPLY,WITH-LOWER-OVERHEAD,BAD-LISP-CONSP,QUOTE,MEMOIZEDP-RAW,NOT,WHEN,COND,ARG,DEFUN" data-part-name="SET-BAD-LISP-CONSP-MEMOIZE" data-part-args="ARG" data-part-body="UNMEMOIZE-FN,T,*BAD-LISP-CONSP-MEMOIZATION*,MEMOIZE-FN,APPLY,WITH-LOWER-OVERHEAD,BAD-LISP-CONSP,QUOTE,MEMOIZEDP-RAW,NOT,WHEN,ARG,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SET-BAD-LISP-CONSP-MEMOIZE">set-bad-lisp-consp-memoize</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-set-bad-lisp-consp-memoize" data-sym="SET-BAD-LISP-CONSP-MEMOIZE" title="(defun set-bad-lisp-consp-memoize (arg)
  (cond
   (arg
    (when (not (memoizedp-raw &#39;bad-lisp-consp))
      (with-lower-overhead (apply &#39;memoize-fn *bad-lisp-consp-memoization*))))">set-bad-lisp-consp-memoize</a>
  (arg)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (arg (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (memoizedp-raw 'bad-lisp-consp))
        (<a class="sym-link local-def" href="#def-with-lower-overhead" data-sym="WITH-LOWER-OVERHEAD" title="(defmacro with-lower-overhead (&amp;rest r)
  `(let ((*record-bytes* nil)
         (*record-calls* nil)
         (*record-hits* nil)
         (*record-mht-calls* nil)
...">with-lower-overhead</a> (apply '<a class="sym-link local-def" href="#def-memoize-fn" data-sym="MEMOIZE-FN" title="(defun memoize-fn
       (fn
        &amp;key (condition t) (inline t) (cl-defun :default) (formals :default)
        (stobjs-in :default) (specials nil) (commutative nil)
        (stobjs-out :default) (forget nil)
...">memoize-fn</a> *bad-lisp-consp-memoization*))))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (when (memoizedp-raw 'bad-lisp-consp)
        (unmemoize-fn 'bad-lisp-consp)))))</pre>
  </div>

<div class="form-block other" id="form-187" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defun-one-output acl2h-init nil nil)</pre>
  </div>

<div class="form-block function" id="def-memstat" data-defines="MEMSTAT" data-references="MEMOIZED-VALUES,FUNCTION,APPLY,R,&REST,DEFUN" data-part-name="MEMSTAT" data-part-args="R,&REST" data-part-body="R,MEMOIZED-VALUES,FUNCTION,APPLY" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MEMSTAT">memstat</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-memstat" data-sym="MEMSTAT" title="(defun memstat (&amp;rest r) (apply #&#39;memoized-values r))">memstat</a> (&amp;rest r) (apply (function <a class="sym-link local-def" href="#def-memoized-values" data-sym="MEMOIZED-VALUES" title="(defun memoized-values (&amp;optional (fn (memoized-functions)))
  (with-global-memoize-lock
   (cond ((listp fn) (mapc #&#39;memoized-values fn))
         ((not (memoizedp-raw fn))
          (format t &quot;~%; Memoized-values:  ~s is not memoized.&quot; fn))
...">memoized-values</a>) r))</pre>
  </div>

<div class="form-block function" id="def-clear-memo-tables" data-defines="CLEAR-MEMO-TABLES" data-references="CLEAR-MEMOIZE-TABLES,DEFUN" data-part-name="CLEAR-MEMO-TABLES" data-part-body="CLEAR-MEMOIZE-TABLES" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLEAR-MEMO-TABLES">clear-memo-tables</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-clear-memo-tables" data-sym="CLEAR-MEMO-TABLES" title="(defun clear-memo-tables () (clear-memoize-tables))">clear-memo-tables</a> nil (clear-memoize-tables))</pre>
  </div>

<div class="form-block function" id="def-lower-overhead" data-defines="LOWER-OVERHEAD" data-references="*RECORD-TIME*,*RECORD-PONS-CALLS*,*RECORD-MHT-CALLS*,*RECORD-HITS*,*RECORD-CALLS*,*RECORD-BYTES*,SETQ,DEFUN" data-part-name="LOWER-OVERHEAD" data-part-body="*RECORD-BYTES*,SETQ" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="LOWER-OVERHEAD">lower-overhead</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-lower-overhead" data-sym="LOWER-OVERHEAD" title="(defun lower-overhead ()
  (setq *record-bytes* nil)
  (setq *record-calls* nil)
  (setq *record-hits* nil)
  (setq *record-mht-calls* nil)
...">lower-overhead</a>
  nil
  (setq *record-bytes* nil)
  (setq *record-calls* nil)
  (setq *record-hits* nil)
  (setq *record-mht-calls* nil)
  (setq *record-pons-calls* nil)
  (setq *record-time* nil))</pre>
  </div>

<div class="form-block function" id="def-update-memo-entry-for-attachments" data-defines="UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS" data-references="EXT-ANCESTORS-ATTACHMENTS,CHANGE,MV,COND,T,EXT-ANC-ATTACHMENTS-VALID-P,NULL,OR,EQ,IF,VALID-P,MEMOIZE-INFO-HT-ENTRY,ACCESS,EXT-ANC-ATTACHMENTS,LET*,WRLD,SPECIAL-NAME,ENTRY,FNS,DEFUN" data-used-by="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS" data-part-name="UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS" data-part-args="WRLD,SPECIAL-NAME,ENTRY,FNS" data-part-body="EXT-ANCESTORS-ATTACHMENTS,CHANGE,MV,COND,T,WRLD,SPECIAL-NAME,EXT-ANC-ATTACHMENTS-VALID-P,NULL,OR,FNS,EQ,IF,VALID-P,ENTRY,MEMOIZE-INFO-HT-ENTRY,ACCESS,EXT-ANC-ATTACHMENTS,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS">update-memo-entry-for-attachments</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-update-memo-entry-for-attachments" data-sym="UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS" title="(defun update-memo-entry-for-attachments (fns entry special-name wrld)
  (let* ((ext-anc-attachments
          (access memoize-info-ht-entry entry :ext-anc-attachments))
         (valid-p
          (if (eq fns :clear)
...">update-memo-entry-for-attachments</a>
  (fns entry special-name wrld)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((ext-anc-attachments (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:ext-anc-attachments</span>)) (valid-p (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> fns <span class="keyword">:clear</span>)
          <span class="keyword">:clear</span> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> ext-anc-attachments)
            (ext-anc-attachments-valid-p fns
              ext-anc-attachments
              special-name
              wrld
              <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)))))
    (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> valid-p <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> nil entry))
      (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> valid-p nil)
            <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>
            valid-p)
          (<a class="sym-link system" href="basis-a.html#def-change" data-sym="CHANGE">change</a> memoize-info-ht-entry
            entry
            <span class="keyword">:ext-anc-attachments</span> (ext-ancestors-attachments (<a class="sym-link system" href="axioms.html#def-access" data-sym="ACCESS">access</a> memoize-info-ht-entry entry <span class="keyword">:fn</span>)
              wrld)))))))</pre>
  </div>

<div class="form-block function" id="def-update-memo-entries-for-attachments" data-defines="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS" data-references="CANONICAL-ANCESTORS-TR-PATH,CANONICAL-ANCESTORS-PATH,IMMEDIATE-CANONICAL-ANCESTORS-TR,CANONICAL-ANCESTORS-TR-REC,IMMEDIATE-CANONICAL-ANCESTORS,CANONICAL-ANCESTORS-REC,CLEAR-MEMOIZE-TABLE,*MEMOIZE-INFO-HT*,MF-SETHASH,CLEAR-ONE-MEMO-AND-PONS-HASH,MSG,T,OR,NOT,UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS,NEW-ENTRY,CHANGEDP,MV-LET,SYMBOLP,ENTRY,K,LAMBDA,MF-MAPHASH,WITH-GLOBAL-MEMOIZE-LOCK,OBSERVATION,WHEN,*SPECIAL-CLTL-CMD-ATTACHMENT-MARK-NAME*,SPECIAL-NAME,CANONICAL-SIBLING,COLLECT,IN,FN,FOR,LOOP,STRICT-MERGE-SORT-SYMBOL<,EQ,IF,TOP-LEVEL,QUOTE,CTX,LET,STATE,WRLD,FNS,DEFUN" data-part-name="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS" data-part-args="STATE,WRLD,FNS" data-part-body="*MEMOIZE-INFO-HT*,MF-SETHASH,CLEAR-ONE-MEMO-AND-PONS-HASH,MSG,T,OR,NOT,UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS,NEW-ENTRY,CHANGEDP,MV-LET,SYMBOLP,ENTRY,K,LAMBDA,MF-MAPHASH,WITH-GLOBAL-MEMOIZE-LOCK,OBSERVATION,WHEN,*SPECIAL-CLTL-CMD-ATTACHMENT-MARK-NAME*,SPECIAL-NAME,WRLD,CANONICAL-SIBLING,COLLECT,IN,FN,FOR,LOOP,STRICT-MERGE-SORT-SYMBOL<,EQ,IF,FNS,TOP-LEVEL,QUOTE,CTX,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS">update-memo-entries-for-attachments</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-update-memo-entries-for-attachments" data-sym="UPDATE-MEMO-ENTRIES-FOR-ATTACHMENTS" title="(defun update-memo-entries-for-attachments (fns wrld state)
  (let ((ctx &#39;top-level)
        (fns
         (if (eq fns :clear)
             :clear
...">update-memo-entries-for-attachments</a>
  (fns wrld state)
  (let ((ctx 'top-level) (fns (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> fns <span class="keyword">:clear</span>)
          <span class="keyword">:clear</span> (strict-merge-sort-symbol&lt; (loop for
              fn
              in
              fns
              collect
              (<a class="sym-link system" href="defthm.html#def-canonical-sibling" data-sym="CANONICAL-SIBLING">canonical-sibling</a> fn wrld)))))
      (special-name *special-cltl-cmd-attachment-mark-name*))
    (when (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> fns <span class="keyword">:clear</span>)
      (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> ctx
        <span class="string">"Memoization tables for functions memoized with :AOKP T ~
                    are being cleared."</span>))
    (when fns
      (<a class="sym-link local-def" href="#def-with-global-memoize-lock" data-sym="WITH-GLOBAL-MEMOIZE-LOCK" title="(defmacro with-global-memoize-lock (&amp;rest forms)
  `(if *enable-multithreaded-memoization*
       (with-lock-raw *global-memoize-lock* ,@forms)
       (progn ,@forms)))">with-global-memoize-lock</a> (<a class="sym-link local-def" href="#def-mf-maphash" data-sym="MF-MAPHASH" title="(defmacro mf-maphash (lam ht) `(maphash ,lam (the hash-table ,ht)))">mf-maphash</a> (lambda (k entry)
            (when (symbolp k)
              (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (changedp new-entry)
                (<a class="sym-link local-def" href="#def-update-memo-entry-for-attachments" data-sym="UPDATE-MEMO-ENTRY-FOR-ATTACHMENTS" title="(defun update-memo-entry-for-attachments (fns entry special-name wrld)
  (let* ((ext-anc-attachments
          (access memoize-info-ht-entry entry :ext-anc-attachments))
         (valid-p
          (if (eq fns :clear)
...">update-memo-entry-for-attachments</a> fns
                  entry
                  special-name
                  wrld)
                (when changedp
                  (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> changedp <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> fns <span class="keyword">:clear</span>)))
                    (<a class="sym-link system" href="basis-a.html#def-observation" data-sym="OBSERVATION">observation</a> ctx
                      <span class="string">"Memoization table for function ~x0 is ~
                                      being cleared because ~@1."</span>
                      k
                      (if (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> changedp special-name)
                        <span class="string">"it depends on apply$-userfn or ~
                                          badge-userfn and at least one badge ~
                                          has changed"</span>
                        (<a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> <span class="string">"the attachment to function ~x0 ~
                                             has changed"</span>
                          changedp)))
                    (<a class="sym-link local-def" href="#def-clear-one-memo-and-pons-hash" data-sym="CLEAR-ONE-MEMO-AND-PONS-HASH" title="(defun clear-one-memo-and-pons-hash (l strategy)
  (with-global-memoize-lock
   (let* ((fn (access memoize-info-ht-entry l :fn))
          (mt (symbol-value (access memoize-info-ht-entry l :tablename)))
          (pt (symbol-value (access memoize-info-ht-entry l :ponstablename)))
...">clear-one-memo-and-pons-hash</a> entry <span class="keyword">:auto</span>))
                  (<a class="sym-link local-def" href="#def-mf-sethash" data-sym="MF-SETHASH" title="(defmacro mf-sethash (key val ht)
  `(setf (gethash ,key (the hash-table ,ht)) ,val))">mf-sethash</a> k new-entry *memoize-info-ht*)))))
          *memoize-info-ht*))))
  (clear-memoize-table '<a class="sym-link system" href="defthm.html#def-canonical-ancestors-rec" data-sym="CANONICAL-ANCESTORS-REC">canonical-ancestors-rec</a>)
  (clear-memoize-table '<a class="sym-link system" href="defthm.html#def-immediate-canonical-ancestors" data-sym="IMMEDIATE-CANONICAL-ANCESTORS">immediate-canonical-ancestors</a>)
  (clear-memoize-table '<a class="sym-link system" href="defthm.html#def-canonical-ancestors-tr-rec" data-sym="CANONICAL-ANCESTORS-TR-REC">canonical-ancestors-tr-rec</a>)
  (clear-memoize-table '<a class="sym-link system" href="defthm.html#def-immediate-canonical-ancestors-tr" data-sym="IMMEDIATE-CANONICAL-ANCESTORS-TR">immediate-canonical-ancestors-tr</a>)
  (clear-memoize-table 'canonical-ancestors-path)
  (clear-memoize-table 'canonical-ancestors-tr-path))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>