<!DOCTYPE html>
<html lang="en" vocab="http://schema.org/" typeof="SoftwareSourceCode">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>parallel-raw - ACL2 Book</title>
  <meta property="name" content="parallel-raw">
  <meta property="programmingLanguage" content="ACL2">
  
<style>
/* ACL2 Book HTML Documentation Styles */
/* Generated by cert2 - build2 system */

/* Dark theme (default) */
:root {
  --bg: #1e1e2e;
  --fg: #cdd6f4;
  --comment: #6c7086;
  --keyword: #cba6f7;
  --string: #a6e3a1;
  --function: #89b4fa;
  --type: #f9e2af;
  --link: #89dceb;
  --link-hover: #f5c2e7;
  --highlight: rgba(137, 180, 250, 0.2);
  --border: #313244;
  --block-bg: rgba(49, 50, 68, 0.5);
  --btn-bg: #313244;
  --btn-hover: rgba(137, 180, 250, 0.2);
}

/* Light theme */
[data-theme="light"] {
  --bg: #eff1f5;
  --fg: #4c4f69;
  --comment: #6c6f85;
  --keyword: #8839ef;
  --string: #40a02b;
  --function: #1e66f5;
  --type: #df8e1d;
  --link: #04a5e5;
  --link-hover: #ea76cb;
  --highlight: rgba(30, 102, 245, 0.15);
  --border: #ccd0da;
  --block-bg: rgba(204, 208, 218, 0.3);
  --btn-bg: #ccd0da;
  --btn-hover: rgba(30, 102, 245, 0.15);
}

body {
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  background: var(--bg);
  color: var(--fg);
  margin: 0;
  padding: 20px;
  line-height: 1.6;
  font-size: 14px;
  transition: background 0.1s, color 0.1s;
}

/* Controls toolbar */
.controls-left {
  position: fixed;
  top: 10px;
  left: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
  transition: transform 0.1s ease;
}

.controls-right {
  position: fixed;
  top: 10px;
  right: 20px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 200;
}

.control-btn {
  padding: 6px 12px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.1s;
}

.control-btn:hover {
  background: var(--btn-hover);
  border-color: var(--link);
}

.name-filter {
  padding: 6px 10px;
  background: var(--btn-bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  color: var(--fg);
  font-family: inherit;
  font-size: 13px;
  width: 150px;
  transition: all 0.1s;
}

.name-filter:focus {
  outline: none;
  border-color: var(--link);
  width: 200px;
}

.name-filter::placeholder {
  color: var(--comment);
}

.regex-label {
  display: flex;
  align-items: center;
  gap: 4px;
  color: var(--comment);
  font-size: 12px;
  cursor: pointer;
}

.regex-label input {
  cursor: pointer;
}

.book-header {
  border-bottom: 2px solid var(--border);
  padding-bottom: 20px;
  margin-bottom: 20px;
}

.book-header h1 {
  color: var(--keyword);
  margin: 0;
}

.book-header .path {
  color: var(--comment);
  font-size: 0.9em;
}

.book-header .path .source-link {
  color: var(--comment);
  text-decoration: none;
}

.book-header .path .source-link:hover {
  color: var(--link);
  text-decoration: underline;
}

.form-block {
  margin: 10px 0;
  padding: 15px;
  background: var(--block-bg);
  border-radius: 8px;
  border-left: 3px solid var(--border);
}

.form-block.theorem { border-left-color: var(--keyword); }
.form-block.function { border-left-color: var(--function); }
.form-block.macro { border-left-color: var(--type); }
.form-block.include-book { border-left-color: var(--string); }

.form-block.hidden { display: none; }
.form-block.dimmed { opacity: 0.3; }

.form-block.highlight {
  animation: highlight-pulse 0.4s ease-out;
}

@keyframes highlight-pulse {
  0% { background: var(--highlight); box-shadow: 0 0 20px var(--link); }
  100% { background: rgba(49, 50, 68, 0.5); box-shadow: none; }
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.form-name {
  color: var(--function);
  font-weight: bold;
  cursor: pointer;
}

.form-name:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

.form-type {
  color: var(--comment);
  font-size: 0.85em;
}

pre.code {
  margin: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.sym-ref {
  color: var(--link);
  cursor: pointer;
  border-radius: 2px;
}

.sym-ref:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.sym-ref.local-def { color: var(--function); font-weight: bold; }
.sym-ref.external { color: var(--type); }

/* Symbol links (clickable hyperlinks) */
.sym-link {
  color: var(--link);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.sym-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

.sym-link.local-def {
  color: var(--function);
  font-weight: bold;
}

.sym-link.external {
  color: var(--type);
}

/* Tooltips using title attribute with custom styling */
.sym-link[title] {
  /* Browser will show title on hover */
}

/* Syntax highlighting in code blocks */
.keyword {
  color: var(--keyword);
}

.string {
  color: var(--string);
}

.number {
  color: #f77524; /* orange */
}

/* Include-book path links */
.include-path {
  color: var(--string);
  text-decoration: none;
  border-radius: 2px;
  cursor: pointer;
}

.include-path:hover {
  background: var(--highlight);
  color: var(--link-hover);
  text-decoration: underline;
}

/* Part buttons for defthm */
.part-buttons {
  display: flex;
  gap: 5px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.part-btn {
  padding: 4px 10px;
  background: var(--border);
  border: 1px solid var(--comment);
  border-radius: 4px;
  color: var(--fg);
  cursor: pointer;
  font-size: 0.85em;
  font-family: inherit;
}

.part-btn:hover {
  background: var(--highlight);
  border-color: var(--link);
}

.part-btn.active {
  background: var(--link);
  color: var(--bg);
  border-color: var(--link);
}

/* References panel */
.refs-panel {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 4px;
  display: none;
}

.refs-panel.visible { display: block; }

.refs-panel h4 {
  margin: 0 0 5px 0;
  color: var(--comment);
  font-size: 0.9em;
}

.refs-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}

/* Included books section */
.includes-section {
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(49, 50, 68, 0.3);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.includes-section h2 {
  margin: 0 0 10px 0;
  color: var(--comment);
  font-size: 1em;
  font-weight: normal;
}

.includes-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.include-link {
  padding: 6px 12px;
  background: var(--border);
  border-radius: 4px;
  color: var(--link);
  text-decoration: none;
  font-size: 0.9em;
  transition: all 0.1s;
}

.include-link:hover {
  background: var(--highlight);
  color: var(--link-hover);
}

.include-link.local {
  border-left: 2px solid var(--comment);
}

/* Filter status */
.filter-status {
  position: fixed;
  top: 10px;
  left: 20px;
  background: var(--bg);
  padding: 6px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  z-index: 201;
  display: none;
  align-items: center;
  gap: 10px;
}

.filter-status.active {
  display: flex;
  align-items: center;
  gap: 10px;
}

.clear-filter {
  padding: 5px 15px;
  background: var(--keyword);
  color: var(--bg);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

/* RDFa vocab indicator */
[vocab] { /* semantic web annotations present */ }

</style>

</head>
<body>
  <div class="controls-left">
    <input type="text" id="name-filter" class="name-filter" placeholder="Filter by name..." title="Filter definitions by name">
    <label class="regex-label"><input type="checkbox" id="regex-toggle"> regex</label>
  </div>

  <div class="controls-right">
    <button class="control-btn" id="theme-toggle" title="Toggle light/dark theme">☀️</button>
    <button class="control-btn" id="font-smaller" title="Decrease font size">A-</button>
    <button class="control-btn" id="font-larger" title="Increase font size">A+</button>
  </div>

  <div class="filter-status">
    <span class="filter-text">Filtering...</span>
    <button class="clear-filter">Clear Filter</button>
  </div>
  
  <div class="book-header">
    <h1 property="name">parallel-raw</h1>
    <div class="path"><a href="parallel-raw.lisp" class="source-link">parallel-raw</a></div>
  </div>
  
  <main property="text">
<div class="form-block other" id="form-0" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-in-package" data-sym="IN-PACKAGE">in-package</a> <span class="string">"ACL2"</span>)</pre>
  </div>

<div class="form-block other" id="form-1" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defstruct parallelism-piece
  (thread-array nil)
  (result-array nil)
  (array-index <span class="number">-1</span>)
  (semaphore-to-signal-as-last-act nil)
  (<a class="sym-link system" href="axioms.html#def-closure" data-sym="CLOSURE">closure</a> nil)
  (throw-siblings-when-function nil))</pre>
  </div>

<div class="form-block other" id="form-2" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (define-atomically-modifiable-counter *idle-thread-count* <span class="number">0</span>)
  (define-atomically-modifiable-counter *idle-core-count* <span class="number">0</span>)
  (define-atomically-modifiable-counter *unassigned-and-active-work-count*
    <span class="number">0</span>)
  (define-atomically-modifiable-counter *total-work-count* <span class="number">0</span>)
  (defvar *work-queue*)
  (<a class="sym-link system" href="axioms.html#def-deflock" data-sym="DEFLOCK">deflock</a> *work-queue-lock*)
  (defvar *check-work-and-core-availability*)
  (defvar *check-core-availability-for-resuming*)
  (defvar *total-parallelism-piece-historical-count*))</pre>
  </div>

<div class="form-block other" id="form-3" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *reset-parallelism-variables* nil)</pre>
  </div>

<div class="form-block other" id="form-4" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defparameter *reset-core-count-too* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block function" id="def-reset-parallelism-variables" data-defines="RESET-PARALLELISM-VARIABLES" data-references="T,*RESET-PARALLELISM-VARIABLES*,*TOTAL-PARALLELISM-PIECE-HISTORICAL-COUNT*,*THROWABLE-WORKER-THREAD*,*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,MAKE-SEMAPHORE,*CHECK-WORK-AND-CORE-AVAILABILITY*,*WORK-QUEUE-LOCK*,RESET-LOCK,*WORK-QUEUE*,*TOTAL-WORK-COUNT*,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,1-,*IDLE-CORE-COUNT*,MAKE-ATOMICALLY-MODIFIABLE-COUNTER,*IDLE-THREAD-COUNT*,*,*UNASSIGNED-AND-ACTIVE-WORK-COUNT-LIMIT*,CORE-COUNT-RAW,*CORE-COUNT*,SETF,*RESET-CORE-COUNT-TOO*,WHEN,SEND-DIE-TO-WORKER-THREADS,DEFUN" data-part-name="RESET-PARALLELISM-VARIABLES" data-part-body="SEND-DIE-TO-WORKER-THREADS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="RESET-PARALLELISM-VARIABLES">reset-parallelism-variables</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-reset-parallelism-variables" data-sym="RESET-PARALLELISM-VARIABLES" title="(defun reset-parallelism-variables ()
  (send-die-to-worker-threads)
  (when *reset-core-count-too*
    (setf *core-count* (core-count-raw))
    (setf *unassigned-and-active-work-count-limit* (* 4 *core-count*)))
...">reset-parallelism-variables</a>
  nil
  (send-die-to-worker-threads)
  (when *reset-core-count-too*
    (setf *core-count* (core-count-raw))
    (setf *unassigned-and-active-work-count-limit*
      (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">4</span> *core-count*)))
  (setf *idle-thread-count*
    (make-atomically-modifiable-counter <span class="number">0</span>))
  (setf *idle-core-count*
    (make-atomically-modifiable-counter (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> *core-count*)))
  (setf *unassigned-and-active-work-count*
    (make-atomically-modifiable-counter <span class="number">1</span>))
  (setf *total-work-count*
    (make-atomically-modifiable-counter <span class="number">1</span>))
  (setf *work-queue* nil)
  (reset-lock *work-queue-lock*)
  (setf *check-work-and-core-availability* (make-semaphore))
  (setf *check-core-availability-for-resuming*
    (make-semaphore))
  (setf *throwable-worker-thread* nil)
  (setf *total-parallelism-piece-historical-count* <span class="number">0</span>)
  (setf *reset-parallelism-variables* nil)
  <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>)</pre>
  </div>

<div class="form-block function" id="def-eval-and-save-result" data-defines="EVAL-AND-SAVE-RESULT" data-references="FUNCALL,T,CONS,AREF,SETF,PARALLELISM-PIECE-CLOSURE,CLOSURE,PARALLELISM-PIECE-ARRAY-INDEX,ARRAY-INDEX,PARALLELISM-PIECE-RESULT-ARRAY,RESULT-ARRAY,LET,ASSERT,WORK,DEFUN" data-used-by="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" data-part-name="EVAL-AND-SAVE-RESULT" data-part-args="WORK" data-part-body="WORK,ASSERT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="EVAL-AND-SAVE-RESULT">eval-and-save-result</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-eval-and-save-result" data-sym="EVAL-AND-SAVE-RESULT" title="(defun eval-and-save-result (work)
  (assert work)
  (let ((result-array (parallelism-piece-result-array work))
        (array-index (parallelism-piece-array-index work))
        (closure (parallelism-piece-closure work)))">eval-and-save-result</a>
  (work)
  (assert work)
  (let ((result-array (parallelism-piece-result-array work)) (array-index (parallelism-piece-array-index work))
      (<a class="sym-link system" href="axioms.html#def-closure" data-sym="CLOSURE">closure</a> (parallelism-piece-closure work)))
    (setf (aref result-array array-index)
      (cons <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (funcall <a class="sym-link system" href="axioms.html#def-closure" data-sym="CLOSURE">closure</a>)))))</pre>
  </div>

<div class="form-block function" id="def-pop-work-and-set-thread" data-defines="POP-WORK-AND-SET-THREAD" data-references="PARALLELISM-PIECE-ARRAY-INDEX,AREF,SETF,PARALLELISM-PIECE-THREAD-ARRAY,ASSERT,CURRENT-THREAD,THREAD,POP,*WORK-QUEUE*,CONSP,WHEN,*WORK-QUEUE-LOCK*,WITH-LOCK,WORK,LET,DEFUN" data-used-by="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" data-part-name="POP-WORK-AND-SET-THREAD" data-part-body="PARALLELISM-PIECE-ARRAY-INDEX,AREF,SETF,PARALLELISM-PIECE-THREAD-ARRAY,ASSERT,CURRENT-THREAD,THREAD,POP,*WORK-QUEUE*,CONSP,WHEN,*WORK-QUEUE-LOCK*,WITH-LOCK,WORK,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="POP-WORK-AND-SET-THREAD">pop-work-and-set-thread</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-pop-work-and-set-thread" data-sym="POP-WORK-AND-SET-THREAD" title="(defun pop-work-and-set-thread ()
  (let ((work
         (with-lock *work-queue-lock*
                    (when (consp *work-queue*) (pop *work-queue*))))
        (thread (current-thread)))
...">pop-work-and-set-thread</a>
  nil
  (let ((work (<a class="sym-link system" href="axioms.html#def-with-lock" data-sym="WITH-LOCK">with-lock</a> *work-queue-lock*
         (when (consp *work-queue*) (pop *work-queue*)))) (thread (current-thread)))
    (when work
      (assert thread)
      (assert (parallelism-piece-thread-array work))
      (setf (aref (parallelism-piece-thread-array work)
          (parallelism-piece-array-index work))
        thread))
    work))</pre>
  </div>

<div class="form-block function" id="def-consume-work-on-work-queue-when-there" data-defines="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" data-references="*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,SIGNAL-SEMAPHORE,SEMAPHOREP,ASSERT,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-INCF,*TOTAL-PARALLELISM-PIECE-HISTORICAL-COUNT*,INCF,PARALLELISM-PIECE-SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,FUNCALL,AREF,SETF,PARALLELISM-PIECE-THROW-SIBLINGS-WHEN-FUNCTION,THROW-SIBLINGS-WHEN-FUNCTION,PARALLELISM-PIECE-ARRAY-INDEX,ARRAY-INDEX,PARALLELISM-PIECE-RESULT-ARRAY,RESULT-ARRAY,PARALLELISM-PIECE-THREAD-ARRAY,THREAD-ARRAY,LET*,EVAL-AND-SAVE-RESULT,*IDLE-THREAD-COUNT*,POP-WORK-AND-SET-THREAD,SETQ,WITHOUT-INTERRUPTS,PROGN,WORK,ATOMIC-DECF,<=,UNWIND-PROTECT-DISABLE-INTERRUPTS-DURING-CLEANUP,THROW,*CHECK-WORK-AND-CORE-AVAILABILITY*,WAIT-ON-SEMAPHORE,WHEN,DO,*IDLE-CORE-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,*WORK-QUEUE*,AND,NOT,WHILE,LOOP,SPECIAL,DECLARE,*DEFAULT-HS*,T,*THROWABLE-WORKER-THREAD*,LET,CATCH,DEFUN" data-used-by="SPAWN-WORKER-THREADS-IF-NEEDED" data-part-name="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" data-part-body="*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,SIGNAL-SEMAPHORE,SEMAPHOREP,ASSERT,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-INCF,*TOTAL-PARALLELISM-PIECE-HISTORICAL-COUNT*,INCF,PARALLELISM-PIECE-SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,FUNCALL,AREF,SETF,PARALLELISM-PIECE-THROW-SIBLINGS-WHEN-FUNCTION,THROW-SIBLINGS-WHEN-FUNCTION,PARALLELISM-PIECE-ARRAY-INDEX,ARRAY-INDEX,PARALLELISM-PIECE-RESULT-ARRAY,RESULT-ARRAY,PARALLELISM-PIECE-THREAD-ARRAY,THREAD-ARRAY,LET*,EVAL-AND-SAVE-RESULT,*IDLE-THREAD-COUNT*,POP-WORK-AND-SET-THREAD,SETQ,WITHOUT-INTERRUPTS,PROGN,WORK,ATOMIC-DECF,<=,UNWIND-PROTECT-DISABLE-INTERRUPTS-DURING-CLEANUP,THROW,*CHECK-WORK-AND-CORE-AVAILABILITY*,WAIT-ON-SEMAPHORE,WHEN,DO,*IDLE-CORE-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,*WORK-QUEUE*,AND,NOT,WHILE,LOOP,SPECIAL,DECLARE,*DEFAULT-HS*,T,*THROWABLE-WORKER-THREAD*,LET,CATCH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE">consume-work-on-work-queue-when-there</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-consume-work-on-work-queue-when-there" data-sym="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" title="(defun consume-work-on-work-queue-when-there ()
  (catch :worker-thread-no-longer-needed
    (let ((*throwable-worker-thread* t) (*default-hs* nil))
      (declare (special *default-hs*))
      (loop
...">consume-work-on-work-queue-when-there</a>
  nil
  (catch <span class="keyword">:worker-thread-no-longer-needed</span> (let ((*throwable-worker-thread* <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>) (*default-hs* nil))
      (declare (special *default-hs*))
      (loop (loop while
          (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> *work-queue*
              (&lt; <span class="number">0</span> (atomically-modifiable-counter-read *idle-core-count*))))
          do
          (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (wait-on-semaphore *check-work-and-core-availability*
                <span class="keyword">:timeout</span> <span class="number">15</span>))
            (throw <span class="keyword">:worker-thread-no-longer-needed</span> nil)))
        (unwind-protect-disable-interrupts-during-cleanup (when (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> <span class="number">0</span> (atomic-decf *idle-core-count*))
            (catch <span class="keyword">:result-no-longer-needed</span> (let ((work nil))
                (unwind-protect-disable-interrupts-during-cleanup (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (without-interrupts (setq work (<a class="sym-link local-def" href="#def-pop-work-and-set-thread" data-sym="POP-WORK-AND-SET-THREAD" title="(defun pop-work-and-set-thread ()
  (let ((work
         (with-lock *work-queue-lock*
                    (when (consp *work-queue*) (pop *work-queue*))))
        (thread (current-thread)))
...">pop-work-and-set-thread</a>))
                      (when work (atomic-decf *idle-thread-count*)))
                    (when work
                      (<a class="sym-link local-def" href="#def-eval-and-save-result" data-sym="EVAL-AND-SAVE-RESULT" title="(defun eval-and-save-result (work)
  (assert work)
  (let ((result-array (parallelism-piece-result-array work))
        (array-index (parallelism-piece-array-index work))
        (closure (parallelism-piece-closure work)))">eval-and-save-result</a> work)
                      (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((thread-array (parallelism-piece-thread-array work)) (result-array (parallelism-piece-result-array work))
                          (array-index (parallelism-piece-array-index work))
                          (throw-siblings-when-function (parallelism-piece-throw-siblings-when-function work)))
                        (setf (aref thread-array array-index) nil)
                        (when throw-siblings-when-function
                          (funcall throw-siblings-when-function
                            (aref result-array array-index))))))
                  (when work
                    (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((semaphore-to-signal-as-last-act (parallelism-piece-semaphore-to-signal-as-last-act work)) (thread-array (parallelism-piece-thread-array work))
                        (array-index (parallelism-piece-array-index work)))
                      (incf *total-parallelism-piece-historical-count*)
                      (setf (aref thread-array array-index) nil)
                      (atomic-incf *idle-thread-count*)
                      (atomic-decf *total-work-count*)
                      (atomic-decf *unassigned-and-active-work-count*)
                      (assert (semaphorep semaphore-to-signal-as-last-act))
                      (signal-semaphore semaphore-to-signal-as-last-act)))))))
          (atomic-incf *idle-core-count*)
          (signal-semaphore *check-work-and-core-availability*)
          (signal-semaphore *check-core-availability-for-resuming*)))))
  (atomic-decf *idle-thread-count*))</pre>
  </div>

<div class="form-block function" id="def-spawn-worker-threads-if-needed" data-defines="SPAWN-WORKER-THREADS-IF-NEEDED" data-references="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE,QUOTE,RUN-THREAD,ATOMIC-INCF,PROGN,DO,*MAX-IDLE-THREAD-COUNT*,*IDLE-THREAD-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,WHILE,LOOP,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="SPAWN-WORKER-THREADS-IF-NEEDED" data-part-body="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE,QUOTE,RUN-THREAD,ATOMIC-INCF,PROGN,DO,*MAX-IDLE-THREAD-COUNT*,*IDLE-THREAD-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,WHILE,LOOP" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SPAWN-WORKER-THREADS-IF-NEEDED">spawn-worker-threads-if-needed</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-spawn-worker-threads-if-needed" data-sym="SPAWN-WORKER-THREADS-IF-NEEDED" title="(defun spawn-worker-threads-if-needed ()
  (loop while (&lt; (atomically-modifiable-counter-read *idle-thread-count*)
                 *max-idle-thread-count*)
        do (progn
            (atomic-incf *idle-thread-count*)
...">spawn-worker-threads-if-needed</a>
  nil
  (loop while
    (&lt; (atomically-modifiable-counter-read *idle-thread-count*)
      *max-idle-thread-count*)
    do
    (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (atomic-incf *idle-thread-count*)
      (run-thread <span class="string">"Worker thread"</span>
        '<a class="sym-link local-def" href="#def-consume-work-on-work-queue-when-there" data-sym="CONSUME-WORK-ON-WORK-QUEUE-WHEN-THERE" title="(defun consume-work-on-work-queue-when-there ()
  (catch :worker-thread-no-longer-needed
    (let ((*throwable-worker-thread* t) (*default-hs* nil))
      (declare (special *default-hs*))
      (loop
...">consume-work-on-work-queue-when-there</a>))))</pre>
  </div>

<div class="form-block function" id="def-add-work-list-to-queue" data-defines="ADD-WORK-LIST-TO-QUEUE" data-references="*CHECK-WORK-AND-CORE-AVAILABILITY*,SIGNAL-SEMAPHORE,I,DOTIMES,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-INCF-MULTIPLE,NCONC,*WORK-QUEUE*,SETF,*WORK-QUEUE-LOCK*,WITH-LOCK,LENGTH,WORK-LIST-LENGTH,LET,WORK-LIST,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="ADD-WORK-LIST-TO-QUEUE" data-part-args="WORK-LIST" data-part-body="*CHECK-WORK-AND-CORE-AVAILABILITY*,SIGNAL-SEMAPHORE,I,DOTIMES,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-INCF-MULTIPLE,NCONC,*WORK-QUEUE*,SETF,*WORK-QUEUE-LOCK*,WITH-LOCK,WORK-LIST,LENGTH,WORK-LIST-LENGTH,LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="ADD-WORK-LIST-TO-QUEUE">add-work-list-to-queue</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-add-work-list-to-queue" data-sym="ADD-WORK-LIST-TO-QUEUE" title="(defun add-work-list-to-queue (work-list)
  (let ((work-list-length (length work-list)))
    (with-lock *work-queue-lock*
               (setf *work-queue* (nconc *work-queue* work-list)))
    (atomic-incf-multiple *total-work-count* work-list-length)
...">add-work-list-to-queue</a>
  (work-list)
  (let ((work-list-length (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> work-list)))
    (<a class="sym-link system" href="axioms.html#def-with-lock" data-sym="WITH-LOCK">with-lock</a> *work-queue-lock*
      (setf *work-queue* (nconc *work-queue* work-list)))
    (atomic-incf-multiple *total-work-count* work-list-length)
    (atomic-incf-multiple *unassigned-and-active-work-count*
      work-list-length)
    (dotimes (i work-list-length)
      (signal-semaphore *check-work-and-core-availability*))))</pre>
  </div>

<div class="form-block function" id="def-combine-array-results-into-list" data-defines="COMBINE-ARRAY-RESULTS-INTO-LIST" data-references="AREF,CDR,CONS,1-,<,IF,ACC,CURRENT-POSITION,RESULT-ARRAY,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="COMBINE-ARRAY-RESULTS-INTO-LIST" data-part-args="ACC,CURRENT-POSITION,RESULT-ARRAY" data-part-body="AREF,CDR,CONS,1-,RESULT-ARRAY,COMBINE-ARRAY-RESULTS-INTO-LIST,ACC,CURRENT-POSITION,<,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="COMBINE-ARRAY-RESULTS-INTO-LIST">combine-array-results-into-list</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-combine-array-results-into-list" data-sym="COMBINE-ARRAY-RESULTS-INTO-LIST" title="(defun combine-array-results-into-list (result-array current-position acc)
  (if (&lt; current-position 0)
      acc
      (combine-array-results-into-list result-array (1- current-position)
       (cons (cdr (aref result-array current-position)) acc))))">combine-array-results-into-list</a>
  (result-array current-position acc)
  (if (&lt; current-position <span class="number">0</span>)
    acc
    (<a class="sym-link local-def" href="#def-combine-array-results-into-list" data-sym="COMBINE-ARRAY-RESULTS-INTO-LIST" title="(defun combine-array-results-into-list (result-array current-position acc)
  (if (&lt; current-position 0)
      acc
      (combine-array-results-into-list result-array (1- current-position)
       (cons (cdr (aref result-array current-position)) acc))))">combine-array-results-into-list</a> result-array
      (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> current-position)
      (cons (cdr (aref result-array current-position)) acc))))</pre>
  </div>

<div class="form-block function" id="def-remove-thread-array-from-work-queue-rec" data-defines="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" data-references="CONS,T,1-,CDR,SIGNAL-SEMAPHORE,PARALLELISM-PIECE-SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,SEMAPHOREP,ASSERT,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-DECF,PROGN,CAR,PARALLELISM-PIECE-THREAD-ARRAY,EQ,ATOM,EQL,COND,ARRAY-POSITIONS-LEFT,THREAD-ARRAY,WORK-QUEUE,DEFUN" data-used-by="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" data-part-name="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" data-part-args="ARRAY-POSITIONS-LEFT,THREAD-ARRAY,WORK-QUEUE" data-part-body="CONS,T,1-,CDR,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC,SIGNAL-SEMAPHORE,PARALLELISM-PIECE-SEMAPHORE-TO-SIGNAL-AS-LAST-ACT,SEMAPHOREP,ASSERT,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,*TOTAL-WORK-COUNT*,ATOMIC-DECF,PROGN,CAR,PARALLELISM-PIECE-THREAD-ARRAY,THREAD-ARRAY,EQ,ATOM,WORK-QUEUE,ARRAY-POSITIONS-LEFT,EQL,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC">remove-thread-array-from-work-queue-rec</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue-rec" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" title="(defun remove-thread-array-from-work-queue-rec
       (work-queue thread-array array-positions-left)
  (cond ((eql array-positions-left 0) work-queue) ((atom work-queue) nil)
        ((eq thread-array (parallelism-piece-thread-array (car work-queue)))
         (progn
...">remove-thread-array-from-work-queue-rec</a>
  (work-queue thread-array array-positions-left)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-eql" data-sym="EQL">eql</a> array-positions-left <span class="number">0</span>) work-queue)
    ((<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> work-queue) nil)
    ((<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> thread-array
       (parallelism-piece-thread-array (car work-queue))) (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (atomic-decf *total-work-count*)
        (atomic-decf *unassigned-and-active-work-count*)
        (assert (semaphorep (parallelism-piece-semaphore-to-signal-as-last-act (car work-queue))))
        (signal-semaphore (parallelism-piece-semaphore-to-signal-as-last-act (car work-queue)))
        (<a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue-rec" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" title="(defun remove-thread-array-from-work-queue-rec
       (work-queue thread-array array-positions-left)
  (cond ((eql array-positions-left 0) work-queue) ((atom work-queue) nil)
        ((eq thread-array (parallelism-piece-thread-array (car work-queue)))
         (progn
...">remove-thread-array-from-work-queue-rec</a> (cdr work-queue)
          thread-array
          (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> array-positions-left))))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (cons (car work-queue)
        (<a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue-rec" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" title="(defun remove-thread-array-from-work-queue-rec
       (work-queue thread-array array-positions-left)
  (cond ((eql array-positions-left 0) work-queue) ((atom work-queue) nil)
        ((eq thread-array (parallelism-piece-thread-array (car work-queue)))
         (progn
...">remove-thread-array-from-work-queue-rec</a> (cdr work-queue)
          thread-array
          (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> array-positions-left))))))</pre>
  </div>

<div class="form-block function" id="def-remove-thread-array-from-work-queue" data-defines="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" data-references="LENGTH,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC,*WORK-QUEUE*,SETF,*WORK-QUEUE-LOCK*,WITH-LOCK,WITHOUT-INTERRUPTS,THREAD-ARRAY,DEFUN" data-used-by="EARLY-TERMINATE-CHILDREN-AND-REWAIT,TERMINATE-SIBLINGS" data-part-name="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" data-part-args="THREAD-ARRAY" data-part-body="LENGTH,THREAD-ARRAY,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC,*WORK-QUEUE*,SETF,*WORK-QUEUE-LOCK*,WITH-LOCK,WITHOUT-INTERRUPTS" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE">remove-thread-array-from-work-queue</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" title="(defun remove-thread-array-from-work-queue (thread-array)
  (without-interrupts
   (with-lock *work-queue-lock*
              (setf *work-queue*
                      (remove-thread-array-from-work-queue-rec *work-queue*">remove-thread-array-from-work-queue</a>
  (thread-array)
  (without-interrupts (<a class="sym-link system" href="axioms.html#def-with-lock" data-sym="WITH-LOCK">with-lock</a> *work-queue-lock*
      (setf *work-queue*
        (<a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue-rec" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE-REC" title="(defun remove-thread-array-from-work-queue-rec
       (work-queue thread-array array-positions-left)
  (cond ((eql array-positions-left 0) work-queue) ((atom work-queue) nil)
        ((eq thread-array (parallelism-piece-thread-array (car work-queue)))
         (progn
...">remove-thread-array-from-work-queue-rec</a> *work-queue*
          thread-array
          (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> thread-array))))))</pre>
  </div>

<div class="form-block function" id="def-terminate-siblings" data-defines="TERMINATE-SIBLINGS" data-references="LENGTH,1-,THROW-THREADS-IN-ARRAY,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE,THREAD-ARRAY,DEFUN" data-used-by="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" data-part-name="TERMINATE-SIBLINGS" data-part-args="THREAD-ARRAY" data-part-body="THREAD-ARRAY,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="TERMINATE-SIBLINGS">terminate-siblings</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-terminate-siblings" data-sym="TERMINATE-SIBLINGS" title="(defun terminate-siblings (thread-array)
  (remove-thread-array-from-work-queue thread-array)
  (throw-threads-in-array thread-array (1- (length thread-array))))">terminate-siblings</a>
  (thread-array)
  (<a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" title="(defun remove-thread-array-from-work-queue (thread-array)
  (without-interrupts
   (with-lock *work-queue-lock*
              (setf *work-queue*
                      (remove-thread-array-from-work-queue-rec *work-queue*">remove-thread-array-from-work-queue</a> thread-array)
  (<a class="sym-link local-def" href="#def-throw-threads-in-array" data-sym="THROW-THREADS-IN-ARRAY" title="(defun throw-threads-in-array (thread-array current-position)
  (assert thread-array)
  (when (&lt;= 0 current-position)
    (let ((current-thread (aref thread-array current-position)))
      (when current-thread
...">throw-threads-in-array</a> thread-array
    (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> thread-array))))</pre>
  </div>

<div class="form-block function" id="def-generate-work-list-from-closure-list-rec" data-defines="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC" data-references="1+,CDR,CAR,MAKE-PARALLELISM-PIECE,CONS,LENGTH,EQUAL,ASSERT,ATOM,IF,THROW-SIBLINGS-WHEN-FUNCTION,&OPTIONAL,CURRENT-POSITION,CLOSURE-LIST,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,THREAD-ARRAY,DEFUN" data-used-by="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" data-part-name="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC" data-part-args="THROW-SIBLINGS-WHEN-FUNCTION,&OPTIONAL,CURRENT-POSITION,CLOSURE-LIST,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,THREAD-ARRAY" data-part-body="1+,CDR,GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC,THROW-SIBLINGS-WHEN-FUNCTION,CAR,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,MAKE-PARALLELISM-PIECE,CONS,THREAD-ARRAY,LENGTH,CURRENT-POSITION,EQUAL,ASSERT,CLOSURE-LIST,ATOM,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC">generate-work-list-from-closure-list-rec</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-generate-work-list-from-closure-list-rec" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC" title="(defun generate-work-list-from-closure-list-rec
       (thread-array result-array children-done-semaphore closure-list
        current-position
        &amp;optional throw-siblings-when-function)
  (if (atom closure-list)
...">generate-work-list-from-closure-list-rec</a>
  (thread-array result-array
    children-done-semaphore
    closure-list
    current-position
    &amp;optional
    throw-siblings-when-function)
  (if (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> closure-list)
    (assert (equal current-position (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> thread-array)))
    (cons (make-parallelism-piece <span class="keyword">:thread-array</span> thread-array
        <span class="keyword">:result-array</span> result-array
        <span class="keyword">:array-index</span> current-position
        <span class="keyword">:semaphore-to-signal-as-last-act</span> children-done-semaphore
        <span class="keyword">:closure</span> (car closure-list)
        <span class="keyword">:throw-siblings-when-function</span> throw-siblings-when-function)
      (<a class="sym-link local-def" href="#def-generate-work-list-from-closure-list-rec" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC" title="(defun generate-work-list-from-closure-list-rec
       (thread-array result-array children-done-semaphore closure-list
        current-position
        &amp;optional throw-siblings-when-function)
  (if (atom closure-list)
...">generate-work-list-from-closure-list-rec</a> thread-array
        result-array
        children-done-semaphore
        (cdr closure-list)
        (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> current-position)
        throw-siblings-when-function))))</pre>
  </div>

<div class="form-block function" id="def-generate-work-list-from-closure-list" data-defines="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" data-references="TERMINATE-SIBLINGS,CDR,FUNCALL,WHEN,X,LAMBDA,IF,GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC,MV,SEMAPHOREP,ASSERT,PROGN,MAKE-SEMAPHORE,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,MAKE-ARRAY,THREAD-ARRAY,LENGTH,CLOSURE-COUNT,LET*,TERMINATE-EARLY-FUNCTION,&OPTIONAL,CLOSURE-LIST,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" data-part-args="TERMINATE-EARLY-FUNCTION,&OPTIONAL,CLOSURE-LIST" data-part-body="TERMINATE-SIBLINGS,CDR,FUNCALL,WHEN,X,LAMBDA,TERMINATE-EARLY-FUNCTION,IF,GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC,MV,SEMAPHOREP,ASSERT,PROGN,MAKE-SEMAPHORE,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,MAKE-ARRAY,THREAD-ARRAY,CLOSURE-LIST,LENGTH,CLOSURE-COUNT,LET*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST">generate-work-list-from-closure-list</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-generate-work-list-from-closure-list" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" title="(defun generate-work-list-from-closure-list
       (closure-list &amp;optional terminate-early-function)
  (let* ((closure-count (length closure-list))
         (thread-array (make-array closure-count :initial-element nil))
         (result-array (make-array closure-count :initial-element nil))
...">generate-work-list-from-closure-list</a>
  (closure-list &amp;optional terminate-early-function)
  (<a class="sym-link system" href="axioms.html#def-let_2A" data-sym="LET*">let*</a> ((closure-count (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> closure-list)) (thread-array (make-array closure-count <span class="keyword">:initial-element</span> nil))
      (result-array (make-array closure-count <span class="keyword">:initial-element</span> nil))
      (children-done-semaphore (make-semaphore)))
    (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (assert (semaphorep children-done-semaphore))
      (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link local-def" href="#def-generate-work-list-from-closure-list-rec" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST-REC" title="(defun generate-work-list-from-closure-list-rec
       (thread-array result-array children-done-semaphore closure-list
        current-position
        &amp;optional throw-siblings-when-function)
  (if (atom closure-list)
...">generate-work-list-from-closure-list-rec</a> thread-array
          result-array
          children-done-semaphore
          closure-list
          <span class="number">0</span>
          (if terminate-early-function
            (lambda (x)
              (when (funcall terminate-early-function (cdr x))
                (<a class="sym-link local-def" href="#def-terminate-siblings" data-sym="TERMINATE-SIBLINGS" title="(defun terminate-siblings (thread-array)
  (remove-thread-array-from-work-queue thread-array)
  (throw-threads-in-array thread-array (1- (length thread-array))))">terminate-siblings</a> thread-array)))
            nil))
        thread-array
        result-array
        children-done-semaphore))))</pre>
  </div>

<div class="form-block function" id="def-pargs-parallelism-buffer-has-space-available" data-defines="PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE" data-references="*UNASSIGNED-AND-ACTIVE-WORK-COUNT-LIMIT*,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,DEFUN" data-used-by="PARALLELISM-RESOURCES-AVAILABLE" data-part-name="PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE" data-part-body="*UNASSIGNED-AND-ACTIVE-WORK-COUNT-LIMIT*,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE">pargs-parallelism-buffer-has-space-available</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-pargs-parallelism-buffer-has-space-available" data-sym="PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE" title="(defun pargs-parallelism-buffer-has-space-available ()
  (&lt; (atomically-modifiable-counter-read *unassigned-and-active-work-count*)
     *unassigned-and-active-work-count-limit*))">pargs-parallelism-buffer-has-space-available</a>
  nil
  (&lt; (atomically-modifiable-counter-read *unassigned-and-active-work-count*)
    *unassigned-and-active-work-count-limit*))</pre>
  </div>

<div class="form-block function" id="def-not-too-many-pieces-of-parallelism-work-already-in-existence" data-defines="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE" data-references="*THE-LIVE-STATE*,TOTAL-PARALLELISM-WORK-LIMIT,QUOTE,F-GET-GLOBAL,*TOTAL-WORK-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<,DEFUN" data-used-by="PARALLELISM-RESOURCES-AVAILABLE" data-part-name="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE" data-part-body="*THE-LIVE-STATE*,TOTAL-PARALLELISM-WORK-LIMIT,QUOTE,F-GET-GLOBAL,*TOTAL-WORK-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE">not-too-many-pieces-of-parallelism-work-already-in-existence</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-not-too-many-pieces-of-parallelism-work-already-in-existence" data-sym="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE" title="(defun not-too-many-pieces-of-parallelism-work-already-in-existence ()
  (&lt; (atomically-modifiable-counter-read *total-work-count*)
     (f-get-global &#39;total-parallelism-work-limit *the-live-state*)))">not-too-many-pieces-of-parallelism-work-already-in-existence</a>
  nil
  (&lt; (atomically-modifiable-counter-read *total-work-count*)
    (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> 'total-parallelism-work-limit
      *the-live-state*)))</pre>
  </div>

<div class="form-block function" id="def-parallelism-resources-available" data-defines="PARALLELISM-RESOURCES-AVAILABLE" data-references="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE,PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE,*THE-LIVE-STATE*,PARALLEL-EXECUTION-ENABLED,QUOTE,F-GET-GLOBAL,AND,DEFUN" data-used-by="PARALLELISM-CONDITION" data-part-name="PARALLELISM-RESOURCES-AVAILABLE" data-part-body="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE,PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE,*THE-LIVE-STATE*,PARALLEL-EXECUTION-ENABLED,QUOTE,F-GET-GLOBAL,AND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARALLELISM-RESOURCES-AVAILABLE">parallelism-resources-available</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-parallelism-resources-available" data-sym="PARALLELISM-RESOURCES-AVAILABLE" title="(defun parallelism-resources-available ()
  (and (f-get-global &#39;parallel-execution-enabled *the-live-state*)
       (pargs-parallelism-buffer-has-space-available)
       (not-too-many-pieces-of-parallelism-work-already-in-existence)))">parallelism-resources-available</a>
  nil
  (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link system" href="axioms.html#def-f-get-global" data-sym="F-GET-GLOBAL">f-get-global</a> 'parallel-execution-enabled *the-live-state*)
    (<a class="sym-link local-def" href="#def-pargs-parallelism-buffer-has-space-available" data-sym="PARGS-PARALLELISM-BUFFER-HAS-SPACE-AVAILABLE" title="(defun pargs-parallelism-buffer-has-space-available ()
  (&lt; (atomically-modifiable-counter-read *unassigned-and-active-work-count*)
     *unassigned-and-active-work-count-limit*))">pargs-parallelism-buffer-has-space-available</a>)
    (<a class="sym-link local-def" href="#def-not-too-many-pieces-of-parallelism-work-already-in-existence" data-sym="NOT-TOO-MANY-PIECES-OF-PARALLELISM-WORK-ALREADY-IN-EXISTENCE" title="(defun not-too-many-pieces-of-parallelism-work-already-in-existence ()
  (&lt; (atomically-modifiable-counter-read *total-work-count*)
     (f-get-global &#39;total-parallelism-work-limit *the-live-state*)))">not-too-many-pieces-of-parallelism-work-already-in-existence</a>)))</pre>
  </div>

<div class="form-block function" id="def-throw-threads-in-array" data-defines="THROW-THREADS-IN-ARRAY" data-references="1-,THROW,LAMBDA,INTERRUPT-THREAD,AREF,CURRENT-THREAD,LET,<=,WHEN,ASSERT,CURRENT-POSITION,THREAD-ARRAY,DEFUN" data-used-by="EARLY-TERMINATE-CHILDREN-AND-REWAIT,TERMINATE-SIBLINGS" data-part-name="THROW-THREADS-IN-ARRAY" data-part-args="CURRENT-POSITION,THREAD-ARRAY" data-part-body="THREAD-ARRAY,ASSERT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="THROW-THREADS-IN-ARRAY">throw-threads-in-array</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-throw-threads-in-array" data-sym="THROW-THREADS-IN-ARRAY" title="(defun throw-threads-in-array (thread-array current-position)
  (assert thread-array)
  (when (&lt;= 0 current-position)
    (let ((current-thread (aref thread-array current-position)))
      (when current-thread
...">throw-threads-in-array</a>
  (thread-array current-position)
  (assert thread-array)
  (when (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> <span class="number">0</span> current-position)
    (let ((current-thread (aref thread-array current-position)))
      (when current-thread
        (interrupt-thread current-thread
          (lambda nil
            (when (aref thread-array current-position)
              (throw <span class="keyword">:result-no-longer-needed</span> nil))))))
    (<a class="sym-link local-def" href="#def-throw-threads-in-array" data-sym="THROW-THREADS-IN-ARRAY" title="(defun throw-threads-in-array (thread-array current-position)
  (assert thread-array)
  (when (&lt;= 0 current-position)
    (let ((current-thread (aref thread-array current-position)))
      (when current-thread
...">throw-threads-in-array</a> thread-array (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> current-position))))</pre>
  </div>

<div class="form-block function" id="def-decrement-children-left" data-defines="DECREMENT-CHILDREN-LEFT" data-references="CLEAR-SEMAPHORE-NOTIFICATION-STATUS,AREF,DECF,SEMAPHORE-NOTIFICATION-STATUS,WHEN,SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR,DEFUN" data-used-by="WAIT-FOR-CHILDREN-TO-FINISH" data-part-name="DECREMENT-CHILDREN-LEFT" data-part-args="SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR" data-part-body="CLEAR-SEMAPHORE-NOTIFICATION-STATUS,CHILDREN-LEFT-PTR,AREF,DECF,SEMAPHORE-NOTIFICATION-OBJ,SEMAPHORE-NOTIFICATION-STATUS,WHEN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="DECREMENT-CHILDREN-LEFT">decrement-children-left</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-decrement-children-left" data-sym="DECREMENT-CHILDREN-LEFT" title="(defun decrement-children-left (children-left-ptr semaphore-notification-obj)
  (when (semaphore-notification-status semaphore-notification-obj)
    (decf (aref children-left-ptr 0))
    (clear-semaphore-notification-status semaphore-notification-obj)))">decrement-children-left</a>
  (children-left-ptr semaphore-notification-obj)
  (when (semaphore-notification-status semaphore-notification-obj)
    (decf (aref children-left-ptr <span class="number">0</span>))
    (clear-semaphore-notification-status semaphore-notification-obj)))</pre>
  </div>

<div class="form-block function" id="def-wait-for-children-to-finish" data-defines="WAIT-FOR-CHILDREN-TO-FINISH" data-references="DECREMENT-CHILDREN-LEFT,WAIT-ON-SEMAPHORE,UNWIND-PROTECT-DISABLE-INTERRUPTS-DURING-CLEANUP,SEMAPHORE-NOTIFICATION-STATUS,NOT,AREF,<=,WHEN,ASSERT,SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR,SEMAPHORE,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST,EARLY-TERMINATE-CHILDREN-AND-REWAIT" data-part-name="WAIT-FOR-CHILDREN-TO-FINISH" data-part-args="SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR,SEMAPHORE" data-part-body="CHILDREN-LEFT-PTR,ASSERT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="WAIT-FOR-CHILDREN-TO-FINISH">wait-for-children-to-finish</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-wait-for-children-to-finish" data-sym="WAIT-FOR-CHILDREN-TO-FINISH" title="(defun wait-for-children-to-finish
       (semaphore children-left-ptr semaphore-notification-obj)
  (assert children-left-ptr)
  (when (&lt;= 1 (aref children-left-ptr 0))
    (assert (not (semaphore-notification-status semaphore-notification-obj)))
...">wait-for-children-to-finish</a>
  (semaphore children-left-ptr semaphore-notification-obj)
  (assert children-left-ptr)
  (when (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> <span class="number">1</span> (aref children-left-ptr <span class="number">0</span>))
    (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (semaphore-notification-status semaphore-notification-obj)))
    (unwind-protect-disable-interrupts-during-cleanup (wait-on-semaphore semaphore
        <span class="keyword">:notification</span> semaphore-notification-obj)
      (<a class="sym-link local-def" href="#def-decrement-children-left" data-sym="DECREMENT-CHILDREN-LEFT" title="(defun decrement-children-left (children-left-ptr semaphore-notification-obj)
  (when (semaphore-notification-status semaphore-notification-obj)
    (decf (aref children-left-ptr 0))
    (clear-semaphore-notification-status semaphore-notification-obj)))">decrement-children-left</a> children-left-ptr
        semaphore-notification-obj))
    (<a class="sym-link local-def" href="#def-wait-for-children-to-finish" data-sym="WAIT-FOR-CHILDREN-TO-FINISH" title="(defun wait-for-children-to-finish
       (semaphore children-left-ptr semaphore-notification-obj)
  (assert children-left-ptr)
  (when (&lt;= 1 (aref children-left-ptr 0))
    (assert (not (semaphore-notification-status semaphore-notification-obj)))
...">wait-for-children-to-finish</a> semaphore
      children-left-ptr
      semaphore-notification-obj)))</pre>
  </div>

<div class="form-block function" id="def-wait-for-resumptive-parallelism-resources" data-defines="WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES" data-references="ATOMIC-DECF,*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,ATOMIC-INCF,*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,WAIT-ON-SEMAPHORE,DO,*CORE-COUNT*,-,*IDLE-CORE-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<=,WHILE,LOOP,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES" data-part-body="*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,WAIT-ON-SEMAPHORE,DO,*CORE-COUNT*,-,*IDLE-CORE-COUNT*,ATOMICALLY-MODIFIABLE-COUNTER-READ,<=,WHILE,LOOP" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES">wait-for-resumptive-parallelism-resources</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-wait-for-resumptive-parallelism-resources" data-sym="WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES" title="(defun wait-for-resumptive-parallelism-resources ()
  (loop while (&lt;= (atomically-modifiable-counter-read *idle-core-count*)
                  (- *core-count*))
        do (wait-on-semaphore *check-core-availability-for-resuming*))
  (atomic-incf *unassigned-and-active-work-count*)">wait-for-resumptive-parallelism-resources</a>
  nil
  (loop while
    (<a class="sym-link system" href="axioms.html#def-_3C_3D" data-sym="&lt;=">&lt;=</a> (atomically-modifiable-counter-read *idle-core-count*)
      (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> *core-count*))
    do
    (wait-on-semaphore *check-core-availability-for-resuming*))
  (atomic-incf *unassigned-and-active-work-count*)
  (atomic-decf *idle-core-count*))</pre>
  </div>

<div class="form-block function" id="def-early-terminate-children-and-rewait" data-defines="EARLY-TERMINATE-CHILDREN-AND-REWAIT" data-references="WAIT-FOR-CHILDREN-TO-FINISH,LENGTH,1-,THROW-THREADS-IN-ARRAY,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE,AREF,<,WHEN,THREAD-ARRAY,SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR,CHILDREN-DONE-SEMAPHORE,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="EARLY-TERMINATE-CHILDREN-AND-REWAIT" data-part-args="THREAD-ARRAY,SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-LEFT-PTR,CHILDREN-DONE-SEMAPHORE" data-part-body="SEMAPHORE-NOTIFICATION-OBJ,CHILDREN-DONE-SEMAPHORE,WAIT-FOR-CHILDREN-TO-FINISH,LENGTH,1-,THROW-THREADS-IN-ARRAY,THREAD-ARRAY,REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE,CHILDREN-LEFT-PTR,AREF,<,WHEN" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="EARLY-TERMINATE-CHILDREN-AND-REWAIT">early-terminate-children-and-rewait</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-early-terminate-children-and-rewait" data-sym="EARLY-TERMINATE-CHILDREN-AND-REWAIT" title="(defun early-terminate-children-and-rewait
       (children-done-semaphore children-left-ptr semaphore-notification-obj
        thread-array)
  (when (&lt; 0 (aref children-left-ptr 0))
    (remove-thread-array-from-work-queue thread-array)
...">early-terminate-children-and-rewait</a>
  (children-done-semaphore children-left-ptr
    semaphore-notification-obj
    thread-array)
  (when (&lt; <span class="number">0</span> (aref children-left-ptr <span class="number">0</span>))
    (<a class="sym-link local-def" href="#def-remove-thread-array-from-work-queue" data-sym="REMOVE-THREAD-ARRAY-FROM-WORK-QUEUE" title="(defun remove-thread-array-from-work-queue (thread-array)
  (without-interrupts
   (with-lock *work-queue-lock*
              (setf *work-queue*
                      (remove-thread-array-from-work-queue-rec *work-queue*">remove-thread-array-from-work-queue</a> thread-array)
    (<a class="sym-link local-def" href="#def-throw-threads-in-array" data-sym="THROW-THREADS-IN-ARRAY" title="(defun throw-threads-in-array (thread-array current-position)
  (assert thread-array)
  (when (&lt;= 0 current-position)
    (let ((current-thread (aref thread-array current-position)))
      (when current-thread
...">throw-threads-in-array</a> thread-array
      (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> thread-array)))
    (<a class="sym-link local-def" href="#def-wait-for-children-to-finish" data-sym="WAIT-FOR-CHILDREN-TO-FINISH" title="(defun wait-for-children-to-finish
       (semaphore children-left-ptr semaphore-notification-obj)
  (assert children-left-ptr)
  (when (&lt;= 1 (aref children-left-ptr 0))
    (assert (not (semaphore-notification-status semaphore-notification-obj)))
...">wait-for-children-to-finish</a> children-done-semaphore
      children-left-ptr
      semaphore-notification-obj)))</pre>
  </div>

<div class="form-block function" id="def-prepare-to-wait-for-children" data-defines="PREPARE-TO-WAIT-FOR-CHILDREN" data-references="*UNASSIGNED-AND-ACTIVE-WORK-COUNT*,ATOMIC-DECF,*CHECK-CORE-AVAILABILITY-FOR-RESUMING*,*CHECK-WORK-AND-CORE-AVAILABILITY*,SIGNAL-SEMAPHORE,*IDLE-CORE-COUNT*,ATOMIC-INCF,DEFUN" data-used-by="PARALLELIZE-CLOSURE-LIST" data-part-name="PREPARE-TO-WAIT-FOR-CHILDREN" data-part-body="*IDLE-CORE-COUNT*,ATOMIC-INCF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PREPARE-TO-WAIT-FOR-CHILDREN">prepare-to-wait-for-children</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-prepare-to-wait-for-children" data-sym="PREPARE-TO-WAIT-FOR-CHILDREN" title="(defun prepare-to-wait-for-children ()
  (atomic-incf *idle-core-count*)
  (signal-semaphore *check-work-and-core-availability*)
  (signal-semaphore *check-core-availability-for-resuming*)
  (atomic-decf *unassigned-and-active-work-count*))">prepare-to-wait-for-children</a>
  nil
  (atomic-incf *idle-core-count*)
  (signal-semaphore *check-work-and-core-availability*)
  (signal-semaphore *check-core-availability-for-resuming*)
  (atomic-decf *unassigned-and-active-work-count*))</pre>
  </div>

<div class="form-block function" id="def-parallelize-closure-list" data-defines="PARALLELIZE-CLOSURE-LIST" data-references="1-,COMBINE-ARRAY-RESULTS-INTO-LIST,AREF,EQ,WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES,EARLY-TERMINATE-CHILDREN-AND-REWAIT,WHEN,WAIT-FOR-CHILDREN-TO-FINISH,PREPARE-TO-WAIT-FOR-CHILDREN,T,ADD-WORK-LIST-TO-QUEUE,SETQ,SPAWN-WORKER-THREADS-IF-NEEDED,WITHOUT-INTERRUPTS,PROGN,UNWIND-PROTECT-DISABLE-INTERRUPTS-DURING-CLEANUP,SEMAPHOREP,GENERATE-WORK-LIST-FROM-CLOSURE-LIST,CHILDREN-DONE-SEMAPHORE,RESULT-ARRAY,THREAD-ARRAY,WORK-LIST,MV-LET,LENGTH,MAKE-ARRAY,CHILDREN-LEFT-PTR,MAKE-SEMAPHORE-NOTIFICATION,SEMAPHORE-NOTIFICATION-OBJ,WORK-LIST-SETUP-P,LET,CDR,CONSP,AND,ASSERT,TERMINATE-EARLY-FUNCTION,&OPTIONAL,CLOSURE-LIST,DEFUN" data-used-by="PARALLELIZE-FN" data-part-name="PARALLELIZE-CLOSURE-LIST" data-part-args="TERMINATE-EARLY-FUNCTION,&OPTIONAL,CLOSURE-LIST" data-part-body="CDR,CLOSURE-LIST,CONSP,AND,ASSERT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARALLELIZE-CLOSURE-LIST">parallelize-closure-list</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-parallelize-closure-list" data-sym="PARALLELIZE-CLOSURE-LIST" title="(defun parallelize-closure-list
       (closure-list &amp;optional terminate-early-function)
  (assert (and (consp closure-list) (cdr closure-list)))
  (let ((work-list-setup-p nil)
        (semaphore-notification-obj (make-semaphore-notification))
...">parallelize-closure-list</a>
  (closure-list &amp;optional terminate-early-function)
  (assert (<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (consp closure-list) (cdr closure-list)))
  (let ((work-list-setup-p nil) (semaphore-notification-obj (make-semaphore-notification))
      (children-left-ptr (make-array <span class="number">1</span> <span class="keyword">:initial-element</span> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> closure-list))))
    (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (work-list thread-array
        result-array
        children-done-semaphore)
      (<a class="sym-link local-def" href="#def-generate-work-list-from-closure-list" data-sym="GENERATE-WORK-LIST-FROM-CLOSURE-LIST" title="(defun generate-work-list-from-closure-list
       (closure-list &amp;optional terminate-early-function)
  (let* ((closure-count (length closure-list))
         (thread-array (make-array closure-count :initial-element nil))
         (result-array (make-array closure-count :initial-element nil))
...">generate-work-list-from-closure-list</a> closure-list
        terminate-early-function)
      (assert (semaphorep children-done-semaphore))
      (unwind-protect-disable-interrupts-during-cleanup (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (without-interrupts (<a class="sym-link local-def" href="#def-spawn-worker-threads-if-needed" data-sym="SPAWN-WORKER-THREADS-IF-NEEDED" title="(defun spawn-worker-threads-if-needed ()
  (loop while (&lt; (atomically-modifiable-counter-read *idle-thread-count*)
                 *max-idle-thread-count*)
        do (progn
            (atomic-incf *idle-thread-count*)
...">spawn-worker-threads-if-needed</a>)
            (setq work-list-setup-p
              (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (<a class="sym-link local-def" href="#def-add-work-list-to-queue" data-sym="ADD-WORK-LIST-TO-QUEUE" title="(defun add-work-list-to-queue (work-list)
  (let ((work-list-length (length work-list)))
    (with-lock *work-queue-lock*
               (setf *work-queue* (nconc *work-queue* work-list)))
    (atomic-incf-multiple *total-work-count* work-list-length)
...">add-work-list-to-queue</a> work-list) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a>))
            (<a class="sym-link local-def" href="#def-prepare-to-wait-for-children" data-sym="PREPARE-TO-WAIT-FOR-CHILDREN" title="(defun prepare-to-wait-for-children ()
  (atomic-incf *idle-core-count*)
  (signal-semaphore *check-work-and-core-availability*)
  (signal-semaphore *check-core-availability-for-resuming*)
  (atomic-decf *unassigned-and-active-work-count*))">prepare-to-wait-for-children</a>))
          (<a class="sym-link local-def" href="#def-wait-for-children-to-finish" data-sym="WAIT-FOR-CHILDREN-TO-FINISH" title="(defun wait-for-children-to-finish
       (semaphore children-left-ptr semaphore-notification-obj)
  (assert children-left-ptr)
  (when (&lt;= 1 (aref children-left-ptr 0))
    (assert (not (semaphore-notification-status semaphore-notification-obj)))
...">wait-for-children-to-finish</a> children-done-semaphore
            children-left-ptr
            semaphore-notification-obj))
        (<a class="sym-link system" href="axioms.html#def-progn" data-sym="PROGN">progn</a> (when work-list-setup-p
            (<a class="sym-link local-def" href="#def-early-terminate-children-and-rewait" data-sym="EARLY-TERMINATE-CHILDREN-AND-REWAIT" title="(defun early-terminate-children-and-rewait
       (children-done-semaphore children-left-ptr semaphore-notification-obj
        thread-array)
  (when (&lt; 0 (aref children-left-ptr 0))
    (remove-thread-array-from-work-queue thread-array)
...">early-terminate-children-and-rewait</a> children-done-semaphore
              children-left-ptr
              semaphore-notification-obj
              thread-array)
            (<a class="sym-link local-def" href="#def-wait-for-resumptive-parallelism-resources" data-sym="WAIT-FOR-RESUMPTIVE-PARALLELISM-RESOURCES" title="(defun wait-for-resumptive-parallelism-resources ()
  (loop while (&lt;= (atomically-modifiable-counter-read *idle-core-count*)
                  (- *core-count*))
        do (wait-on-semaphore *check-core-availability-for-resuming*))
  (atomic-incf *unassigned-and-active-work-count*)">wait-for-resumptive-parallelism-resources</a>)
            (assert (<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a> (aref children-left-ptr <span class="number">0</span>) <span class="number">0</span>)))))
      (<a class="sym-link local-def" href="#def-combine-array-results-into-list" data-sym="COMBINE-ARRAY-RESULTS-INTO-LIST" title="(defun combine-array-results-into-list (result-array current-position acc)
  (if (&lt; current-position 0)
      acc
      (combine-array-results-into-list result-array (1- current-position)
       (cons (cdr (aref result-array current-position)) acc))))">combine-array-results-into-list</a> result-array
        (<a class="sym-link system" href="axioms.html#def-1-" data-sym="1-">1-</a> (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> result-array))
        nil))))</pre>
  </div>

<div class="form-block function" id="def-parallelize-fn" data-defines="PARALLELIZE-FN" data-references="APPLY,FUNCALL,OR-LIST,AND-LIST,QUOTE,EQUAL,OR,IF,PARALLELIZE-CLOSURE-LIST,PARALLELIZE-CLOSURES-RES,LET,CDR,ASSERT,TERMINATE-EARLY-FUNCTION,&OPTIONAL,ARG-CLOSURES,PARENT-FUN-NAME,DEFUN" data-used-by="POR,PAND,PLET,PARGS" data-part-name="PARALLELIZE-FN" data-part-args="TERMINATE-EARLY-FUNCTION,&OPTIONAL,ARG-CLOSURES,PARENT-FUN-NAME" data-part-body="ARG-CLOSURES,CDR,ASSERT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARALLELIZE-FN">parallelize-fn</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-parallelize-fn" data-sym="PARALLELIZE-FN" title="(defun parallelize-fn
       (parent-fun-name arg-closures &amp;optional terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res
         (parallelize-closure-list arg-closures terminate-early-function)))
...">parallelize-fn</a>
  (parent-fun-name arg-closures
    &amp;optional
    terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res (<a class="sym-link local-def" href="#def-parallelize-closure-list" data-sym="PARALLELIZE-CLOSURE-LIST" title="(defun parallelize-closure-list
       (closure-list &amp;optional terminate-early-function)
  (assert (and (consp closure-list) (cdr closure-list)))
  (let ((work-list-setup-p nil)
        (semaphore-notification-obj (make-semaphore-notification))
...">parallelize-closure-list</a> arg-closures
         terminate-early-function)))
    (if (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (equal parent-fun-name 'and-list)
        (equal parent-fun-name 'or-list))
      (funcall parent-fun-name parallelize-closures-res)
      (apply parent-fun-name parallelize-closures-res))))</pre>
  </div>

<div class="form-block macro" id="def-closure-for-expression" data-defines="CLOSURE-FOR-EXPRESSION" data-references="MAKE-CLOSURE-EXPR-WITH-ACL2-BINDINGS,X,DEFMACRO" data-used-by="CLOSURE-LIST-FOR-EXPRESSION-LIST" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLOSURE-FOR-EXPRESSION">closure-for-expression</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-closure-for-expression" data-sym="CLOSURE-FOR-EXPRESSION" title="(defmacro closure-for-expression (x) (make-closure-expr-with-acl2-bindings x))">closure-for-expression</a>
  (x)
  (make-closure-expr-with-acl2-bindings x))</pre>
  </div>

<div class="form-block macro" id="def-closure-list-for-expression-list" data-defines="CLOSURE-LIST-FOR-EXPRESSION-LIST" data-references="CLOSURE-FOR-EXPRESSION,CONS,QUASIQUOTE,ATOM,IF,X,DEFMACRO" data-used-by="POR,PAND,PARGS" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST">closure-list-for-expression-list</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-closure-list-for-expression-list" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST" title="(defmacro closure-list-for-expression-list (x)
  (if (atom x)
      nil
      `(cons (closure-for-expression ,(car x))
             (closure-list-for-expression-list ,(cdr x)))))">closure-list-for-expression-list</a>
  (x)
  (if (<a class="sym-link system" href="axioms.html#def-atom" data-sym="ATOM">atom</a> x)
    nil
    `(cons (<a class="sym-link local-def" href="#def-closure-for-expression" data-sym="CLOSURE-FOR-EXPRESSION" title="(defmacro closure-for-expression (x) (make-closure-expr-with-acl2-bindings x))">closure-for-expression</a> ,(CAR X))
      (<a class="sym-link local-def" href="#def-closure-list-for-expression-list" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST" title="(defmacro closure-list-for-expression-list (x)
  (if (atom x)
      nil
      `(cons (closure-for-expression ,(car x))
             (closure-list-for-expression-list ,(cdr x)))))">closure-list-for-expression-list</a> ,(CDR X)))))</pre>
  </div>

<div class="form-block function" id="def-parallelism-condition" data-defines="PARALLELISM-CONDITION" data-references="QUOTE,PARALLELISM-RESOURCES-AVAILABLE,AND,QUASIQUOTE,IF,GRAN-FORM,GRAN-FORM-EXISTS,DEFUN" data-used-by="POR,PAND,PLET,PARGS" data-part-name="PARALLELISM-CONDITION" data-part-args="GRAN-FORM,GRAN-FORM-EXISTS" data-part-body="QUOTE,PARALLELISM-RESOURCES-AVAILABLE,AND,QUASIQUOTE,GRAN-FORM-EXISTS,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARALLELISM-CONDITION">parallelism-condition</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-parallelism-condition" data-sym="PARALLELISM-CONDITION" title="(defun parallelism-condition (gran-form-exists gran-form)
  (if gran-form-exists
      `(and (parallelism-resources-available) ,gran-form)
      &#39;(parallelism-resources-available)))">parallelism-condition</a>
  (gran-form-exists gran-form)
  (if gran-form-exists
    `(<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> (<a class="sym-link local-def" href="#def-parallelism-resources-available" data-sym="PARALLELISM-RESOURCES-AVAILABLE" title="(defun parallelism-resources-available ()
  (and (f-get-global &#39;parallel-execution-enabled *the-live-state*)
       (pargs-parallelism-buffer-has-space-available)
       (not-too-many-pieces-of-parallelism-work-already-in-existence)))">parallelism-resources-available</a>) ,GRAN-FORM)
    '(<a class="sym-link local-def" href="#def-parallelism-resources-available" data-sym="PARALLELISM-RESOURCES-AVAILABLE" title="(defun parallelism-resources-available ()
  (and (f-get-global &#39;parallel-execution-enabled *the-live-state*)
       (pargs-parallelism-buffer-has-space-available)
       (not-too-many-pieces-of-parallelism-work-already-in-existence)))">parallelism-resources-available</a>)))</pre>
  </div>

<div class="form-block macro" id="def-pargs" data-defines="PARGS" data-references="CDR,CLOSURE-LIST-FOR-EXPRESSION-LIST,PARALLELIZE-FN,PARALLELISM-CONDITION,QUOTE,LIST,CDDR,NULL,IF,CAR,FUNCTION-CALL,LET,NOT,ASSERT,IGNORE,DECLARE,CHECK-AND-PARSE-FOR-GRANULARITY-FORM,REMAINDER-FORMS,GRAN-FORM,GRAN-FORM-EXISTS,MSG,ERP,MV-LET,FORMS,&REST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARGS">pargs</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-pargs" data-sym="PARGS" title="(defmacro pargs (&amp;rest forms)
  (mv-let (erp msg gran-form-exists gran-form remainder-forms)
          (check-and-parse-for-granularity-form forms) (declare (ignore msg))
          (assert (not erp))
          (let ((function-call (car remainder-forms)))
...">pargs</a>
  (&amp;rest forms)
  (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (erp <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> gran-form-exists gran-form remainder-forms)
    (check-and-parse-for-granularity-form forms)
    (declare (ignore <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a>))
    (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> erp))
    (let ((function-call (car remainder-forms)))
      (if (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (<a class="sym-link system" href="axioms.html#def-cddr" data-sym="CDDR">cddr</a> function-call))
        function-call
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if
          (<a class="sym-link local-def" href="#def-parallelism-condition" data-sym="PARALLELISM-CONDITION" title="(defun parallelism-condition (gran-form-exists gran-form)
  (if gran-form-exists
      `(and (parallelism-resources-available) ,gran-form)
      &#39;(parallelism-resources-available)))">parallelism-condition</a> gran-form-exists gran-form)
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-parallelize-fn" data-sym="PARALLELIZE-FN" title="(defun parallelize-fn
       (parent-fun-name arg-closures &amp;optional terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res
         (parallelize-closure-list arg-closures terminate-early-function)))
...">parallelize-fn</a>
            (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'quote (car function-call))
            (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-closure-list-for-expression-list" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST" title="(defmacro closure-list-for-expression-list (x)
  (if (atom x)
      nil
      `(cons (closure-for-expression ,(car x))
             (closure-list-for-expression-list ,(cdr x)))))">closure-list-for-expression-list</a> (cdr function-call)))
          function-call)))))</pre>
  </div>

<div class="form-block function" id="def-plet-doublets" data-defines="PLET-DOUBLETS" data-references="1+,CDR,NTH,QUOTE,CAAR,LIST,CONS,T,ENDP,COND,N,BSYM,BINDINGS,DEFUN" data-part-name="PLET-DOUBLETS" data-part-args="N,BSYM,BINDINGS" data-part-body="1+,CDR,PLET-DOUBLETS,BSYM,N,NTH,QUOTE,CAAR,LIST,CONS,T,BINDINGS,ENDP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PLET-DOUBLETS">plet-doublets</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-plet-doublets" data-sym="PLET-DOUBLETS" title="(defun plet-doublets (bindings bsym n)
  (cond ((endp bindings) nil)
        (t
         (cons (list (caar bindings) (list &#39;nth n bsym))
               (plet-doublets (cdr bindings) bsym (1+ n))))))">plet-doublets</a>
  (bindings bsym n)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-endp" data-sym="ENDP">endp</a> bindings) nil)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (cons (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> (<a class="sym-link system" href="axioms.html#def-caar" data-sym="CAAR">caar</a> bindings) (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link system" href="axioms.html#def-nth" data-sym="NTH">nth</a> n bsym))
        (<a class="sym-link local-def" href="#def-plet-doublets" data-sym="PLET-DOUBLETS" title="(defun plet-doublets (bindings bsym n)
  (cond ((endp bindings) nil)
        (t
         (cons (list (caar bindings) (list &#39;nth n bsym))
               (plet-doublets (cdr bindings) bsym (1+ n))))))">plet-doublets</a> (cdr bindings) bsym (<a class="sym-link system" href="axioms.html#def-1_2B" data-sym="1+">1+</a> n))))))</pre>
  </div>

<div class="form-block function" id="def-make-closures" data-defines="MAKE-CLOSURES" data-references="CDR,LAMBDA,FUNCTION,QUASIQUOTE,CONS,ENDP,IF,BINDINGS,DEFUN" data-part-name="MAKE-CLOSURES" data-part-args="BINDINGS" data-part-body="CDR,MAKE-CLOSURES,LAMBDA,FUNCTION,QUASIQUOTE,CONS,BINDINGS,ENDP,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MAKE-CLOSURES">make-closures</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-make-closures" data-sym="MAKE-CLOSURES" title="(defun make-closures (bindings)
  (if (endp bindings)
      nil
      (cons `#&#39;(lambda () ,(cadar bindings)) (make-closures (cdr bindings)))))">make-closures</a>
  (bindings)
  (if (<a class="sym-link system" href="axioms.html#def-endp" data-sym="ENDP">endp</a> bindings)
    nil
    (cons `(function (lambda nil ,(CADAR BINDINGS)))
      (<a class="sym-link local-def" href="#def-make-closures" data-sym="MAKE-CLOSURES" title="(defun make-closures (bindings)
  (if (endp bindings)
      nil
      (cons `#&#39;(lambda () ,(cadar bindings)) (make-closures (cdr bindings)))))">make-closures</a> (cdr bindings)))))</pre>
  </div>

<div class="form-block function" id="def-identity-list" data-defines="IDENTITY-LIST" data-references="RST,&REST,DEFUN" data-used-by="PLET" data-part-name="IDENTITY-LIST" data-part-args="RST,&REST" data-part-body="RST" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="IDENTITY-LIST">identity-list</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-identity-list" data-sym="IDENTITY-LIST" title="(defun identity-list (&amp;rest rst) rst)">identity-list</a> (&amp;rest rst) rst)</pre>
  </div>

<div class="form-block function" id="def-make-list-until-non-declare" data-defines="MAKE-LIST-UNTIL-NON-DECLARE" data-references="CAR,CONS,CDR,REVERSE,MV,CAAR-IS-DECLAREP,NOT,IF,ACC,REMAINING-LIST,DEFUN" data-used-by="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET" data-part-name="MAKE-LIST-UNTIL-NON-DECLARE" data-part-args="ACC,REMAINING-LIST" data-part-body="CAR,CONS,CDR,MAKE-LIST-UNTIL-NON-DECLARE,ACC,REVERSE,MV,REMAINING-LIST,CAAR-IS-DECLAREP,NOT,IF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="MAKE-LIST-UNTIL-NON-DECLARE">make-list-until-non-declare</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-make-list-until-non-declare" data-sym="MAKE-LIST-UNTIL-NON-DECLARE" title="(defun make-list-until-non-declare (remaining-list acc)
  (if (not (caar-is-declarep remaining-list))
      (mv (reverse acc) remaining-list)
      (make-list-until-non-declare (cdr remaining-list)
       (cons (car remaining-list) acc))))">make-list-until-non-declare</a>
  (remaining-list acc)
  (if (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (caar-is-declarep remaining-list))
    (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> (<a class="sym-link system" href="axioms.html#def-reverse" data-sym="REVERSE">reverse</a> acc) remaining-list)
    (<a class="sym-link local-def" href="#def-make-list-until-non-declare" data-sym="MAKE-LIST-UNTIL-NON-DECLARE" title="(defun make-list-until-non-declare (remaining-list acc)
  (if (not (caar-is-declarep remaining-list))
      (mv (reverse acc) remaining-list)
      (make-list-until-non-declare (cdr remaining-list)
       (cons (car remaining-list) acc))))">make-list-until-non-declare</a> (cdr remaining-list)
      (cons (car remaining-list) acc))))</pre>
  </div>

<div class="form-block function" id="def-parse-additional-declare-forms-for-let" data-defines="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET" data-references="CAR,MV,CDR,MAKE-LIST-UNTIL-NON-DECLARE,BODY,DECLARE-FORMS,MV-LET,X,DEFUN" data-used-by="PLET" data-part-name="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET" data-part-args="X" data-part-body="CAR,MV,X,CDR,MAKE-LIST-UNTIL-NON-DECLARE,BODY,DECLARE-FORMS,MV-LET" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET">parse-additional-declare-forms-for-let</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-parse-additional-declare-forms-for-let" data-sym="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET" title="(defun parse-additional-declare-forms-for-let (x)
  (mv-let (declare-forms body) (make-list-until-non-declare (cdr x) nil)
          (mv (car x) declare-forms body)))">parse-additional-declare-forms-for-let</a>
  (x)
  (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (declare-forms <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>)
    (<a class="sym-link local-def" href="#def-make-list-until-non-declare" data-sym="MAKE-LIST-UNTIL-NON-DECLARE" title="(defun make-list-until-non-declare (remaining-list acc)
  (if (not (caar-is-declarep remaining-list))
      (mv (reverse acc) remaining-list)
      (make-list-until-non-declare (cdr remaining-list)
       (cons (car remaining-list) acc))))">make-list-until-non-declare</a> (cdr x) nil)
    (<a class="sym-link system" href="axioms.html#def-mv" data-sym="MV">mv</a> (car x) declare-forms <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>)))</pre>
  </div>

<div class="form-block macro" id="def-plet" data-defines="PLET" data-references="IDENTITY-LIST,PARALLELIZE-FN,ACL2-GENTEMP,BSYM,PARALLELISM-CONDITION,IF,QUOTE,LIST,T,LET,QUASIQUOTE,CDR,NULL,COND,PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET,BODY,DECLARE-FORMS,BINDINGS,NOT,ASSERT,IGNORE,DECLARE,CHECK-AND-PARSE-FOR-GRANULARITY-FORM,REMAINDER-FORMS,GRAN-FORM,GRAN-FORM-EXISTS,MSG,ERP,MV-LET,FORMS,&REST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="PLET">plet</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-plet" data-sym="PLET" title="(defmacro plet (&amp;rest forms)
  (mv-let (erp msg gran-form-exists gran-form remainder-forms)
          (check-and-parse-for-granularity-form forms) (declare (ignore msg))
          (assert (not erp))
          (mv-let (bindings declare-forms body)
...">plet</a>
  (&amp;rest forms)
  (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (erp <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> gran-form-exists gran-form remainder-forms)
    (check-and-parse-for-granularity-form forms)
    (declare (ignore <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a>))
    (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> erp))
    (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (bindings declare-forms <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>)
      (<a class="sym-link local-def" href="#def-parse-additional-declare-forms-for-let" data-sym="PARSE-ADDITIONAL-DECLARE-FORMS-FOR-LET" title="(defun parse-additional-declare-forms-for-let (x)
  (mv-let (declare-forms body) (make-list-until-non-declare (cdr x) nil)
          (mv (car x) declare-forms body)))">parse-additional-declare-forms-for-let</a> remainder-forms)
      (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (cdr bindings)) `(let ,BINDINGS
            ,@DECLARE-FORMS
            ,@BODY))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if
            (<a class="sym-link local-def" href="#def-parallelism-condition" data-sym="PARALLELISM-CONDITION" title="(defun parallelism-condition (gran-form-exists gran-form)
  (if gran-form-exists
      `(and (parallelism-resources-available) ,gran-form)
      &#39;(parallelism-resources-available)))">parallelism-condition</a> gran-form-exists gran-form)
            (let ((bsym (acl2-gentemp <span class="string">"plet"</span>)))
              `(let ((,BSYM (<a class="sym-link local-def" href="#def-parallelize-fn" data-sym="PARALLELIZE-FN" title="(defun parallelize-fn
       (parent-fun-name arg-closures &amp;optional terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res
         (parallelize-closure-list arg-closures terminate-early-function)))
...">parallelize-fn</a> '<a class="sym-link local-def" href="#def-identity-list" data-sym="IDENTITY-LIST" title="(defun identity-list (&amp;rest rst) rst)">identity-list</a>
                     (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> ,@(MAKE-CLOSURES BINDINGS)))))
                (let ,(PLET-DOUBLETS BINDINGS BSYM 0)
                  ,@DECLARE-FORMS
                  ,@BODY)))
            `(let ,BINDINGS
              ,@DECLARE-FORMS
              ,@BODY)))))))</pre>
  </div>

<div class="form-block macro" id="def-pand" data-defines="PAND" data-references="AND,CONS,CLOSURE-LIST-FOR-EXPRESSION-LIST,AND-LIST,PARALLELIZE-FN,PARALLELISM-CONDITION,X,LAMBDA,AND-EARLY-TERMINATION-FUNCTION,LET,T,CAR,QUOTE,LIST,CDR,NULL,IF,NOT,ASSERT,IGNORE,DECLARE,CHECK-AND-PARSE-FOR-GRANULARITY-FORM,REMAINDER-FORMS,GRAN-FORM,GRAN-FORM-EXISTS,MSG,ERP,MV-LET,FORMS,&REST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="PAND">pand</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-pand" data-sym="PAND" title="(defmacro pand (&amp;rest forms)
  (mv-let (erp msg gran-form-exists gran-form remainder-forms)
          (check-and-parse-for-granularity-form forms) (declare (ignore msg))
          (assert (not erp))
          (if (null (cdr remainder-forms))
...">pand</a>
  (&amp;rest forms)
  (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (erp <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> gran-form-exists gran-form remainder-forms)
    (check-and-parse-for-granularity-form forms)
    (declare (ignore <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a>))
    (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> erp))
    (if (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (cdr remainder-forms))
      (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if (car remainder-forms) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> nil)
      (let ((and-early-termination-function '(lambda (x) (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> x))))
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if
          (<a class="sym-link local-def" href="#def-parallelism-condition" data-sym="PARALLELISM-CONDITION" title="(defun parallelism-condition (gran-form-exists gran-form)
  (if gran-form-exists
      `(and (parallelism-resources-available) ,gran-form)
      &#39;(parallelism-resources-available)))">parallelism-condition</a> gran-form-exists gran-form)
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-parallelize-fn" data-sym="PARALLELIZE-FN" title="(defun parallelize-fn
       (parent-fun-name arg-closures &amp;optional terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res
         (parallelize-closure-list arg-closures terminate-early-function)))
...">parallelize-fn</a>
            ''and-list
            (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-closure-list-for-expression-list" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST" title="(defmacro closure-list-for-expression-list (x)
  (if (atom x)
      nil
      `(cons (closure-for-expression ,(car x))
             (closure-list-for-expression-list ,(cdr x)))))">closure-list-for-expression-list</a> remainder-forms)
            and-early-termination-function)
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if (cons '<a class="sym-link system" href="axioms.html#def-and" data-sym="AND">and</a> remainder-forms) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> nil))))))</pre>
  </div>

<div class="form-block macro" id="def-por" data-defines="POR" data-references="OR,CONS,CLOSURE-LIST-FOR-EXPRESSION-LIST,OR-LIST,PARALLELIZE-FN,PARALLELISM-CONDITION,X,LAMBDA,OR-EARLY-TERMINATION-FUNCTION,LET,T,CAR,QUOTE,LIST,CDR,NULL,IF,NOT,ASSERT,IGNORE,DECLARE,CHECK-AND-PARSE-FOR-GRANULARITY-FORM,REMAINDER-FORMS,GRAN-FORM,GRAN-FORM-EXISTS,MSG,ERP,MV-LET,FORMS,&REST,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="POR">por</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-por" data-sym="POR" title="(defmacro por (&amp;rest forms)
  (mv-let (erp msg gran-form-exists gran-form remainder-forms)
          (check-and-parse-for-granularity-form forms) (declare (ignore msg))
          (assert (not erp))
          (if (null (cdr remainder-forms))
...">por</a>
  (&amp;rest forms)
  (<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> (erp <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a> gran-form-exists gran-form remainder-forms)
    (check-and-parse-for-granularity-form forms)
    (declare (ignore <a class="sym-link system" href="axioms.html#def-msg" data-sym="MSG">msg</a>))
    (assert (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> erp))
    (if (<a class="sym-link system" href="axioms.html#def-null" data-sym="NULL">null</a> (cdr remainder-forms))
      (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if (car remainder-forms) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> nil)
      (let ((or-early-termination-function '(lambda (x) x)))
        (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if
          (<a class="sym-link local-def" href="#def-parallelism-condition" data-sym="PARALLELISM-CONDITION" title="(defun parallelism-condition (gran-form-exists gran-form)
  (if gran-form-exists
      `(and (parallelism-resources-available) ,gran-form)
      &#39;(parallelism-resources-available)))">parallelism-condition</a> gran-form-exists gran-form)
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-parallelize-fn" data-sym="PARALLELIZE-FN" title="(defun parallelize-fn
       (parent-fun-name arg-closures &amp;optional terminate-early-function)
  (assert (cdr arg-closures))
  (let ((parallelize-closures-res
         (parallelize-closure-list arg-closures terminate-early-function)))
...">parallelize-fn</a>
            ''or-list
            (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> '<a class="sym-link local-def" href="#def-closure-list-for-expression-list" data-sym="CLOSURE-LIST-FOR-EXPRESSION-LIST" title="(defmacro closure-list-for-expression-list (x)
  (if (atom x)
      nil
      `(cons (closure-for-expression ,(car x))
             (closure-list-for-expression-list ,(cdr x)))))">closure-list-for-expression-list</a> remainder-forms)
            or-early-termination-function)
          (<a class="sym-link system" href="axioms.html#def-list" data-sym="LIST">list</a> 'if (cons '<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> remainder-forms) <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> nil))))))</pre>
  </div>

<div class="form-block function" id="def-signal-semaphores" data-defines="SIGNAL-SEMAPHORES" data-references="CDR,CAR,SIGNAL-SEMAPHORE,T,ENDP,COND,SEMS,DEFUN" data-part-name="SIGNAL-SEMAPHORES" data-part-args="SEMS" data-part-body="CDR,SIGNAL-SEMAPHORES,CAR,SIGNAL-SEMAPHORE,T,SEMS,ENDP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="SIGNAL-SEMAPHORES">signal-semaphores</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-signal-semaphores" data-sym="SIGNAL-SEMAPHORES" title="(defun signal-semaphores (sems)
  (cond ((endp sems) nil)
        (t (signal-semaphore (car sems)) (signal-semaphores (cdr sems)))))">signal-semaphores</a>
  (sems)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-endp" data-sym="ENDP">endp</a> sems) nil)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (signal-semaphore (car sems))
      (<a class="sym-link local-def" href="#def-signal-semaphores" data-sym="SIGNAL-SEMAPHORES" title="(defun signal-semaphores (sems)
  (cond ((endp sems) nil)
        (t (signal-semaphore (car sems)) (signal-semaphores (cdr sems)))))">signal-semaphores</a> (cdr sems)))))</pre>
  </div>

<div class="form-block macro" id="def-spec-mv-let" data-defines="SPEC-MV-LET" data-references="&,FUTURE-ABORT,FUTURE-READ,FUTURE,THE-VERY-OBSCURE-FEATURE,LET,QUASIQUOTE,T,INTERSECTP,SYMBOL-LISTP,OR,HARD!,ER,EQ,MV-LET@PAR,MV?-LET,MV-LET,MEMBER,NOT,COND,FALSE-BRANCH,TRUE-BRANCH,TEST,IF,QUOTE,INNER-BODY,INNER-VARS,INNER-LET,CASE-MATCH,BODY,COMPUTATION,OUTER-VARS,SPEC-MV-LET-FORM,&WHOLE,DEFMACRO" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="SPEC-MV-LET">spec-mv-let</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-spec-mv-let" data-sym="SPEC-MV-LET" title="(defmacro spec-mv-let (&amp;whole spec-mv-let-form outer-vars computation body)
  (case-match body
              ((inner-let inner-vars inner-body
                (&#39;if test true-branch false-branch))
               (cond
...">spec-mv-let</a>
  (&amp;whole spec-mv-let-form outer-vars computation <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>)
  (<a class="sym-link system" href="basis-a.html#def-case-match" data-sym="CASE-MATCH">case-match</a> <a class="sym-link system" href="basis-b.html#def-body" data-sym="BODY">body</a>
    ((inner-let inner-vars
       inner-body
       ('if test true-branch false-branch)) (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-member" data-sym="MEMBER">member</a> inner-let '(<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> <a class="sym-link system" href="axioms.html#def-mv_3F-let" data-sym="MV?-LET">mv?-let</a> mv-let@par) <span class="keyword">:test</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>)) (<a class="sym-link system" href="axioms.html#def-er" data-sym="ER">er</a> hard!
            '<a class="sym-link local-def" href="#def-spec-mv-let" data-sym="SPEC-MV-LET" title="(defmacro spec-mv-let (&amp;whole spec-mv-let-form outer-vars computation body)
  (case-match body
              ((inner-let inner-vars inner-body
                (&#39;if test true-branch false-branch))
               (cond
...">spec-mv-let</a>
            <span class="string">"Illegal form (expected inner let to bind with one of ~v0): ~x1. ~ ~
            See :doc spec-mv-let."</span>
            '(<a class="sym-link system" href="axioms.html#def-mv-let" data-sym="MV-LET">mv-let</a> <a class="sym-link system" href="axioms.html#def-mv_3F-let" data-sym="MV?-LET">mv?-let</a> mv-let@par)
            spec-mv-let-form))
        ((<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> outer-vars))
           (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-symbol-listp" data-sym="SYMBOL-LISTP">symbol-listp</a> inner-vars))
           (<a class="sym-link system" href="axioms.html#def-intersectp" data-sym="INTERSECTP">intersectp</a> inner-vars outer-vars <span class="keyword">:test</span> '<a class="sym-link system" href="axioms.html#def-eq" data-sym="EQ">eq</a>)) (<a class="sym-link system" href="axioms.html#def-er" data-sym="ER">er</a> hard!
            '<a class="sym-link local-def" href="#def-spec-mv-let" data-sym="SPEC-MV-LET" title="(defmacro spec-mv-let (&amp;whole spec-mv-let-form outer-vars computation body)
  (case-match body
              ((inner-let inner-vars inner-body
                (&#39;if test true-branch false-branch))
               (cond
...">spec-mv-let</a>
            <span class="string">"Illegal spec-mv-let form: ~x0.  The two bound variable lists ~
            must be disjoint true lists of variables, unlike ~x1 and ~x2.  ~
            See :doc spec-mv-let."</span>
            spec-mv-let-form
            inner-vars
            outer-vars))
        (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> `(let ((the-very-obscure-feature (future ,COMPUTATION)))
            (,INNER-LET ,INNER-VARS
              ,INNER-BODY
              (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> (,TEST (<a class="sym-link system" href="axioms.html#def-mv_3F-let" data-sym="MV?-LET">mv?-let</a> ,OUTER-VARS
                    (future-read the-very-obscure-feature)
                    ,TRUE-BRANCH))
                (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (future-abort the-very-obscure-feature) ,FALSE-BRANCH)))))))
    (&amp; (<a class="sym-link system" href="axioms.html#def-er" data-sym="ER">er</a> hard!
        '<a class="sym-link local-def" href="#def-spec-mv-let" data-sym="SPEC-MV-LET" title="(defmacro spec-mv-let (&amp;whole spec-mv-let-form outer-vars computation body)
  (case-match body
              ((inner-let inner-vars inner-body
                (&#39;if test true-branch false-branch))
               (cond
...">spec-mv-let</a>
        <span class="string">"Illegal form, ~x0.  See :doc spec-mv-let."</span>
        spec-mv-let-form))))</pre>
  </div>

<div class="form-block function" id="def-number-of-active-threads-aux" data-defines="NUMBER-OF-ACTIVE-THREADS-AUX" data-references="IGNORE,DECLARE,ACC,THREADS,DEFUN" data-used-by="NUMBER-OF-ACTIVE-THREADS" data-part-name="NUMBER-OF-ACTIVE-THREADS-AUX" data-part-args="ACC,THREADS" data-part-declare="ACC,THREADS,IGNORE,DECLARE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NUMBER-OF-ACTIVE-THREADS-AUX">number-of-active-threads-aux</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-number-of-active-threads-aux" data-sym="NUMBER-OF-ACTIVE-THREADS-AUX" title="(defun number-of-active-threads-aux (threads acc)
  (declare (ignore threads acc))
  0)">number-of-active-threads-aux</a>
  (threads acc)
  (declare (ignore threads acc))
  <span class="number">0</span>)</pre>
  </div>

<div class="form-block function" id="def-number-of-active-threads" data-defines="NUMBER-OF-ACTIVE-THREADS" data-references="ALL-THREADS,NUMBER-OF-ACTIVE-THREADS-AUX,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-name="NUMBER-OF-ACTIVE-THREADS" data-part-body="ALL-THREADS,NUMBER-OF-ACTIVE-THREADS-AUX" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NUMBER-OF-ACTIVE-THREADS">number-of-active-threads</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-number-of-active-threads" data-sym="NUMBER-OF-ACTIVE-THREADS" title="(defun number-of-active-threads ()
  (number-of-active-threads-aux (all-threads) 0))">number-of-active-threads</a>
  nil
  (<a class="sym-link local-def" href="#def-number-of-active-threads-aux" data-sym="NUMBER-OF-ACTIVE-THREADS-AUX" title="(defun number-of-active-threads-aux (threads acc)
  (declare (ignore threads acc))
  0)">number-of-active-threads-aux</a> (all-threads) <span class="number">0</span>))</pre>
  </div>

<div class="form-block function" id="def-number-of-threads-waiting-on-a-child-aux" data-defines="NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX" data-references="IGNORE,DECLARE,ACC,THREADS,DEFUN" data-used-by="NUMBER-OF-THREADS-WAITING-ON-A-CHILD" data-part-name="NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX" data-part-args="ACC,THREADS" data-part-declare="ACC,THREADS,IGNORE,DECLARE" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX">number-of-threads-waiting-on-a-child-aux</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-number-of-threads-waiting-on-a-child-aux" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX" title="(defun number-of-threads-waiting-on-a-child-aux (threads acc)
  (declare (ignore threads acc))
  0)">number-of-threads-waiting-on-a-child-aux</a>
  (threads acc)
  (declare (ignore threads acc))
  <span class="number">0</span>)</pre>
  </div>

<div class="form-block function" id="def-number-of-threads-waiting-on-a-child" data-defines="NUMBER-OF-THREADS-WAITING-ON-A-CHILD" data-references="ALL-THREADS,NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-name="NUMBER-OF-THREADS-WAITING-ON-A-CHILD" data-part-body="ALL-THREADS,NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD">number-of-threads-waiting-on-a-child</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-number-of-threads-waiting-on-a-child" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD" title="(defun number-of-threads-waiting-on-a-child ()
  (number-of-threads-waiting-on-a-child-aux (all-threads) 0))">number-of-threads-waiting-on-a-child</a>
  nil
  (<a class="sym-link local-def" href="#def-number-of-threads-waiting-on-a-child-aux" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD-AUX" title="(defun number-of-threads-waiting-on-a-child-aux (threads acc)
  (declare (ignore threads acc))
  0)">number-of-threads-waiting-on-a-child-aux</a> (all-threads) <span class="number">0</span>))</pre>
  </div>

<div class="form-block function" id="def-future-queue-length" data-defines="FUTURE-QUEUE-LENGTH" data-references="*THREADS-WAITING-FOR-STARTING-CORE*,*LAST-SLOT-TAKEN*,*LAST-SLOT-SAVED*,-,+,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-name="FUTURE-QUEUE-LENGTH" data-part-body="*THREADS-WAITING-FOR-STARTING-CORE*,*LAST-SLOT-TAKEN*,*LAST-SLOT-SAVED*,-,+" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="FUTURE-QUEUE-LENGTH">future-queue-length</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-future-queue-length" data-sym="FUTURE-QUEUE-LENGTH" title="(defun future-queue-length ()
  (+ (- *last-slot-saved* *last-slot-taken*)
     *threads-waiting-for-starting-core*))">future-queue-length</a>
  nil
  (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (<a class="sym-link system" href="axioms.html#def--" data-sym="-">-</a> *last-slot-saved* *last-slot-taken*)
    *threads-waiting-for-starting-core*))</pre>
  </div>

<div class="form-block function" id="def-total-number-of-threads" data-defines="TOTAL-NUMBER-OF-THREADS" data-references="ALL-THREADS,LENGTH,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-name="TOTAL-NUMBER-OF-THREADS" data-part-body="ALL-THREADS,LENGTH" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="TOTAL-NUMBER-OF-THREADS">total-number-of-threads</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-total-number-of-threads" data-sym="TOTAL-NUMBER-OF-THREADS" title="(defun total-number-of-threads () (length (all-threads)))">total-number-of-threads</a> nil (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> (all-threads)))</pre>
  </div>

<div class="form-block other" id="form-48" typeof="Code">
    <div class="form-header"><span class="form-type">other</span></div>
    <pre class="code" property="text">(defvar *refresh-rate-indicator* <span class="number">0</span>)</pre>
  </div>

<div class="form-block macro" id="def-value-of-symbol" data-defines="VALUE-OF-SYMBOL" data-references="T,*THE-LIVE-STATE*,BOUNDP-GLOBAL,FORMAT,QUASIQUOTE,CONSTANTP,COND,ERROR,SYMBOLP,FBOUNDP,OR,NOT,WHEN,VAR,DEFMACRO" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" typeof="Code">
    <div class="form-header"><span class="form-name" property="name" data-sym="VALUE-OF-SYMBOL">value-of-symbol</span><span class="form-type">macro</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defmacro" data-sym="DEFMACRO">defmacro</a> <a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a>
  (var)
  (when (<a class="sym-link system" href="axioms.html#def-not" data-sym="NOT">not</a> (<a class="sym-link system" href="axioms.html#def-or" data-sym="OR">or</a> (fboundp var) (symbolp var)))
    (error <span class="string">"value-of-symbol requires a symbol or function name as its argument"</span>))
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((constantp var) `(format nil <span class="string">" Constant ~s is ~s~% "</span> ,(SYMBOL-NAME VAR) ,VAR))
    ((fboundp var) `(format nil
        <span class="string">" Stat     ~s is ~s~% "</span>
        ,(SYMBOL-NAME VAR)
        (,VAR)))
    ((<a class="sym-link system" href="axioms.html#def-boundp-global" data-sym="BOUNDP-GLOBAL">boundp-global</a> var *the-live-state*) `(format nil
        <span class="string">" Stat     ~s is ~s~% "</span>
        ,(SYMBOL-NAME VAR)
        ,(F-GET-GLOBAL VAR *THE-LIVE-STATE*)))
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> `(format nil <span class="string">" Variable ~s is ~s~% "</span> ,(SYMBOL-NAME VAR) ,VAR))))</pre>
  </div>

<div class="form-block function" id="def-acl2p-sum-list1" data-defines="ACL2P-SUM-LIST1" data-references="CAR,+,CDR,T,ENDP,COND,ACC,LST,DEFUN" data-used-by="ACL2P-SUM-LIST" data-part-name="ACL2P-SUM-LIST1" data-part-args="ACC,LST" data-part-body="CAR,+,CDR,ACL2P-SUM-LIST1,T,ACC,LST,ENDP,COND" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="ACL2P-SUM-LIST1">acl2p-sum-list1</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-acl2p-sum-list1" data-sym="ACL2P-SUM-LIST1" title="(defun acl2p-sum-list1 (lst acc)
  (cond ((endp lst) acc) (t (acl2p-sum-list1 (cdr lst) (+ (car lst) acc)))))">acl2p-sum-list1</a>
  (lst acc)
  (<a class="sym-link system" href="axioms.html#def-cond" data-sym="COND">cond</a> ((<a class="sym-link system" href="axioms.html#def-endp" data-sym="ENDP">endp</a> lst) acc)
    (<a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-acl2p-sum-list1" data-sym="ACL2P-SUM-LIST1" title="(defun acl2p-sum-list1 (lst acc)
  (cond ((endp lst) acc) (t (acl2p-sum-list1 (cdr lst) (+ (car lst) acc)))))">acl2p-sum-list1</a> (cdr lst) (<a class="sym-link system" href="axioms.html#def-_2B" data-sym="+">+</a> (car lst) acc)))))</pre>
  </div>

<div class="form-block function" id="def-acl2p-sum-list" data-defines="ACL2P-SUM-LIST" data-references="ACL2P-SUM-LIST1,LST,DEFUN" data-used-by="AVERAGE-FUTURE-QUEUE-SIZE" data-part-name="ACL2P-SUM-LIST" data-part-args="LST" data-part-body="LST,ACL2P-SUM-LIST1" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="ACL2P-SUM-LIST">acl2p-sum-list</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-acl2p-sum-list" data-sym="ACL2P-SUM-LIST" title="(defun acl2p-sum-list (lst) (acl2p-sum-list1 lst 0))">acl2p-sum-list</a> (lst) (<a class="sym-link local-def" href="#def-acl2p-sum-list1" data-sym="ACL2P-SUM-LIST1" title="(defun acl2p-sum-list1 (lst acc)
  (cond ((endp lst) acc) (t (acl2p-sum-list1 (cdr lst) (+ (car lst) acc)))))">acl2p-sum-list1</a> lst <span class="number">0</span>))</pre>
  </div>

<div class="form-block function" id="def-average-future-queue-size" data-defines="AVERAGE-FUTURE-QUEUE-SIZE" data-references="LENGTH,*FUTURE-QUEUE-LENGTH-HISTORY*,ACL2P-SUM-LIST,/,*,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-name="AVERAGE-FUTURE-QUEUE-SIZE" data-part-body="LENGTH,*FUTURE-QUEUE-LENGTH-HISTORY*,ACL2P-SUM-LIST,/,*" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="AVERAGE-FUTURE-QUEUE-SIZE">average-future-queue-size</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-average-future-queue-size" data-sym="AVERAGE-FUTURE-QUEUE-SIZE" title="(defun average-future-queue-size ()
  (* 1.0
     (/ (acl2p-sum-list *future-queue-length-history*)
        (length *future-queue-length-history*))))">average-future-queue-size</a>
  nil
  (<a class="sym-link system" href="axioms.html#def-_2A" data-sym="*">*</a> <span class="number">1.0</span>
    (<a class="sym-link system" href="axioms.html#def-_2F" data-sym="/">/</a> (<a class="sym-link local-def" href="#def-acl2p-sum-list" data-sym="ACL2P-SUM-LIST" title="(defun acl2p-sum-list (lst) (acl2p-sum-list1 lst 0))">acl2p-sum-list</a> *future-queue-length-history*)
      (<a class="sym-link system" href="axioms.html#def-length" data-sym="LENGTH">length</a> *future-queue-length-history*))))</pre>
  </div>

<div class="form-block function" id="def-print-interesting-parallelism-variables-str" data-defines="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-references="*ALMOST-ABORTED-FUTURE-COUNT*,*ABORTED-FUTURES-VIA-FLAG*,*ABORTED-FUTURES-VIA-THROW*,*ABORTED-FUTURES-TOTAL*,*FUTURES-RESOURCES-UNAVAILABLE-COUNT*,*FUTURES-RESOURCES-AVAILABLE-COUNT*,*RESOURCE-AND-TIMING-BASED-SERIALIZATIONS*,*RESOURCE-AND-TIMING-BASED-PARALLELIZATIONS*,*RESOURCE-BASED-SERIALIZATIONS*,*RESOURCE-BASED-PARALLELIZATIONS*,AVERAGE-FUTURE-QUEUE-SIZE,*LAST-SLOT-SAVED*,*LAST-SLOT-TAKEN*,NUMBER-OF-THREADS-WAITING-ON-A-CHILD,NUMBER-OF-ACTIVE-THREADS,TOTAL-PARALLELISM-WORK-LIMIT,*TOTAL-FUTURE-COUNT*,*UNASSIGNED-AND-ACTIVE-WORK-COUNT-LIMIT*,*UNASSIGNED-AND-ACTIVE-FUTURE-COUNT*,TOTAL-NUMBER-OF-THREADS,NUMBER-OF-IDLE-THREADS-AND-THREADS-WAITING-FOR-A-STARTING-CORE,*THREADS-WAITING-FOR-STARTING-CORE*,*IDLE-FUTURE-THREAD-COUNT*,*IDLE-FUTURE-RESUMPTIVE-CORE-COUNT*,*IDLE-FUTURE-CORE-COUNT*,VALUE-OF-SYMBOL,FORMAT,STRING,QUOTE,CONCATENATE,FUTURE-QUEUE-LENGTH,CONS,*FUTURE-QUEUE-LENGTH-HISTORY*,SETF,*REFRESH-RATE-INDICATOR*,INCF,DEFUN" data-used-by="PRINT-INTERESTING-PARALLELISM-VARIABLES" data-part-name="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" data-part-body="*REFRESH-RATE-INDICATOR*,INCF" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR">print-interesting-parallelism-variables-str</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-print-interesting-parallelism-variables-str" data-sym="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" title="(defun print-interesting-parallelism-variables-str ()
  (incf *refresh-rate-indicator*)
  (setf *future-queue-length-history*
          (cons (future-queue-length) *future-queue-length-history*))
  (concatenate &#39;string
...">print-interesting-parallelism-variables-str</a>
  nil
  (incf *refresh-rate-indicator*)
  (setf *future-queue-length-history*
    (cons (<a class="sym-link local-def" href="#def-future-queue-length" data-sym="FUTURE-QUEUE-LENGTH" title="(defun future-queue-length ()
  (+ (- *last-slot-saved* *last-slot-taken*)
     *threads-waiting-for-starting-core*))">future-queue-length</a>) *future-queue-length-history*))
  (<a class="sym-link system" href="axioms.html#def-concatenate" data-sym="CONCATENATE">concatenate</a> '<a class="sym-link system" href="axioms.html#def-string" data-sym="STRING">string</a>
    (format nil
      <span class="string">"  Printing stats related to executing proofs in parallel.~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *idle-future-core-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *idle-future-resumptive-core-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *idle-future-thread-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *threads-waiting-for-starting-core*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> number-of-idle-threads-and-threads-waiting-for-a-starting-core)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> <a class="sym-link local-def" href="#def-total-number-of-threads" data-sym="TOTAL-NUMBER-OF-THREADS" title="(defun total-number-of-threads () (length (all-threads)))">total-number-of-threads</a>)
    (format nil <span class="string">"~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *unassigned-and-active-future-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *unassigned-and-active-work-count-limit*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *total-future-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> total-parallelism-work-limit)
    (format nil <span class="string">"~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> <a class="sym-link local-def" href="#def-number-of-active-threads" data-sym="NUMBER-OF-ACTIVE-THREADS" title="(defun number-of-active-threads ()
  (number-of-active-threads-aux (all-threads) 0))">number-of-active-threads</a>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> <a class="sym-link local-def" href="#def-number-of-threads-waiting-on-a-child" data-sym="NUMBER-OF-THREADS-WAITING-ON-A-CHILD" title="(defun number-of-threads-waiting-on-a-child ()
  (number-of-threads-waiting-on-a-child-aux (all-threads) 0))">number-of-threads-waiting-on-a-child</a>)
    (format nil <span class="string">"~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *last-slot-taken*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *last-slot-saved*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> <a class="sym-link local-def" href="#def-future-queue-length" data-sym="FUTURE-QUEUE-LENGTH" title="(defun future-queue-length ()
  (+ (- *last-slot-saved* *last-slot-taken*)
     *threads-waiting-for-starting-core*))">future-queue-length</a>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> <a class="sym-link local-def" href="#def-average-future-queue-size" data-sym="AVERAGE-FUTURE-QUEUE-SIZE" title="(defun average-future-queue-size ()
  (* 1.0
     (/ (acl2p-sum-list *future-queue-length-history*)
        (length *future-queue-length-history*))))">average-future-queue-size</a>)
    (format nil <span class="string">"~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *resource-based-parallelizations*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *resource-based-serializations*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *resource-and-timing-based-parallelizations*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *resource-and-timing-based-serializations*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *futures-resources-available-count*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *futures-resources-unavailable-count*)
    (format nil <span class="string">"~% "</span>)
    (format nil
      <span class="string">" Printing stats related to aborting futures.~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *aborted-futures-total*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *aborted-futures-via-throw*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *aborted-futures-via-flag*)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *almost-aborted-future-count*)
    (format nil <span class="string">"~% "</span>)
    (<a class="sym-link local-def" href="#def-value-of-symbol" data-sym="VALUE-OF-SYMBOL" title="(defmacro value-of-symbol (var)
  (when (not (or (fboundp var) (symbolp var)))
    (error
     &quot;value-of-symbol requires a symbol or function name as its argument&quot;))
  (cond
...">value-of-symbol</a> *refresh-rate-indicator*)))</pre>
  </div>

<div class="form-block function" id="def-print-interesting-parallelism-variables" data-defines="PRINT-INTERESTING-PARALLELISM-VARIABLES" data-references="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR,T,FORMAT,DEFUN" data-part-name="PRINT-INTERESTING-PARALLELISM-VARIABLES" data-part-body="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR,T,FORMAT" typeof="SoftwareSourceCode">
    <div class="form-header"><span class="form-name" property="name" data-sym="PRINT-INTERESTING-PARALLELISM-VARIABLES">print-interesting-parallelism-variables</span><span class="form-type">function</span></div>
    <pre class="code" property="text">(<a class="sym-link system" href="axioms.html#def-defun" data-sym="DEFUN">defun</a> <a class="sym-link local-def" href="#def-print-interesting-parallelism-variables" data-sym="PRINT-INTERESTING-PARALLELISM-VARIABLES" title="(defun print-interesting-parallelism-variables ()
  (format t (print-interesting-parallelism-variables-str)))">print-interesting-parallelism-variables</a>
  nil
  (format <a class="sym-link system" href="axioms.html#def-t" data-sym="T">t</a> (<a class="sym-link local-def" href="#def-print-interesting-parallelism-variables-str" data-sym="PRINT-INTERESTING-PARALLELISM-VARIABLES-STR" title="(defun print-interesting-parallelism-variables-str ()
  (incf *refresh-rate-indicator*)
  (setf *future-queue-length-history*
          (cons (future-queue-length) *future-queue-length-history*))
  (concatenate &#39;string
...">print-interesting-parallelism-variables-str</a>)))</pre>
  </div>


  </main>
  
<script>
// ACL2 Book HTML Documentation - Interactive Features
// Generated by cert2 - build2 system

// State
let activeFilter = null;
let activePartFilter = null;
let activeNameFilter = null;
let currentFontSize = 14;

// Theme management
function getStoredTheme() {
  return localStorage.getItem('acl2-theme') || 'dark';
}

function setTheme(theme) {
  if (theme === 'light') {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('theme-toggle').textContent = '🌙';
  } else {
    document.documentElement.removeAttribute('data-theme');
    document.getElementById('theme-toggle').textContent = '☀️';
  }
  localStorage.setItem('acl2-theme', theme);
}

function toggleTheme() {
  const current = getStoredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Font size management
function getStoredFontSize() {
  return parseInt(localStorage.getItem('acl2-fontsize') || '14', 10);
}

function setFontSize(size) {
  size = Math.max(10, Math.min(24, size)); // Clamp between 10-24
  currentFontSize = size;
  document.body.style.fontSize = size + 'px';
  localStorage.setItem('acl2-fontsize', size.toString());
}

function increaseFontSize() {
  setFontSize(currentFontSize + 2);
}

function decreaseFontSize() {
  setFontSize(currentFontSize - 2);
}

// Get all form blocks
function getFormBlocks() {
  return document.querySelectorAll('.form-block');
}

// Clear all filters
function clearFilter() {
  activeFilter = null;
  activePartFilter = null;
  activeNameFilter = null;
  getFormBlocks().forEach(b => {
    b.classList.remove('hidden', 'dimmed');
  });
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  const status = document.querySelector('.filter-status');
  status.classList.remove('active');
  // Slide name filter back to original position
  document.querySelector('.controls-left').style.transform = '';
  // Clear the name filter input
  const nameInput = document.getElementById('name-filter');
  if (nameInput) nameInput.value = '';
}

// Show filter status and slide name filter right
function showFilterStatus(text) {
  const status = document.querySelector('.filter-status');
  status.classList.add('active');
  status.querySelector('.filter-text').textContent = text;
  // Slide name filter to the right to make room
  setTimeout(() => {
    const statusWidth = status.offsetWidth;
    document.querySelector('.controls-left').style.transform = `translateX(${statusWidth + 15}px)`;
  }, 10);
}

// Filter to show only forms that define or reference a symbol
function filterBySymbol(symName, showUsedBy) {
  clearFilter();
  activeFilter = symName;
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines;
    const references = (block.dataset.references || '').split(',');
    const usedBy = (block.dataset.usedBy || '').split(',');
    
    let show = false;
    if (showUsedBy) {
      // Show forms that USE this symbol
      show = references.includes(symName) || definesName === symName;
    } else {
      // Show forms that this symbol USES
      show = usedBy.includes(symName) || definesName === symName;
    }
    
    if (show) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering by: ${symName} (${visibleCount} items)`);
}

// Filter by defthm part (term, hints, rule-classes, etc.)
function filterByPart(formId, partName) {
  clearFilter();
  activePartFilter = { formId, partName };
  
  // Get the part's referenced symbols
  // data-part-term becomes dataset.partTerm, data-part-hints becomes dataset.partHints, etc.
  const block = document.getElementById(formId);
  const datasetKey = 'part' + partName.charAt(0).toUpperCase() + partName.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase());
  const partData = block.dataset[datasetKey];
  if (!partData) return;
  
  const partSyms = partData.split(',').filter(s => s);
  
  // Highlight the button
  block.querySelector(`.part-btn[data-part="${partName}"]`).classList.add('active');
  
  // Hide forms not referenced by this part
  getFormBlocks().forEach(b => {
    const definesName = b.dataset.defines;
    if (b.id === formId || partSyms.includes(definesName)) {
      b.classList.remove('hidden');
    } else {
      b.classList.add('hidden');
    }
  });
  
  // Update status
  showFilterStatus(`Filtering ${formId} :${partName} (${partSyms.length} references)`);
}

// Filter by name (substring or regex)
function filterByName(pattern, useRegex) {
  // Clear other filters but keep the input value
  activeFilter = null;
  activePartFilter = null;
  document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
  
  if (!pattern || pattern.trim() === '') {
    // Empty pattern - show all
    activeNameFilter = null;
    getFormBlocks().forEach(b => b.classList.remove('hidden'));
    const status = document.querySelector('.filter-status');
    status.classList.remove('active');
    document.querySelector('.controls-left').style.transform = '';
    return;
  }
  
  activeNameFilter = pattern;
  
  let matcher;
  let isValidRegex = true;
  
  if (useRegex) {
    try {
      matcher = new RegExp(pattern, 'i');
    } catch (e) {
      // Invalid regex - show error in status and don't filter
      showFilterStatus(`Invalid regex: ${e.message}`);
      return;
    }
  } else {
    // Plain substring match (case-insensitive)
    const lowerPattern = pattern.toLowerCase();
    matcher = { test: (s) => s.toLowerCase().includes(lowerPattern) };
  }
  
  const blocks = getFormBlocks();
  let visibleCount = 0;
  
  blocks.forEach(block => {
    const definesName = block.dataset.defines || '';
    if (matcher.test(definesName)) {
      block.classList.remove('hidden');
      visibleCount++;
    } else {
      block.classList.add('hidden');
    }
  });
  
  // Update status
  const modeText = useRegex ? 'regex' : 'name';
  showFilterStatus(`Filtering by ${modeText}: "${pattern}" (${visibleCount} matches)`);
}

// Click on a name to show what references it
function handleNameClick(symName) {
  if (activeFilter === symName) {
    clearFilter();
  } else {
    filterBySymbol(symName, true);
  }
}

// Navigate to a definition (same file or different)
function navigateTo(symName, file) {
  if (file) {
    // External file - navigate
    window.location.href = file + '.html#def-' + symName.toLowerCase();
  } else {
    // Same file - scroll
    const target = document.getElementById('def-' + symName.toLowerCase());
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      target.classList.add('highlight');
      setTimeout(() => target.classList.remove('highlight'), 400);
    }
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Part buttons
  document.querySelectorAll('.part-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const formId = btn.closest('.form-block').id;
      const partName = btn.dataset.part;
      if (activePartFilter && activePartFilter.formId === formId && 
          activePartFilter.partName === partName) {
        clearFilter();
      } else {
        filterByPart(formId, partName);
      }
    });
  });
  
  // Clear filter button
  document.querySelector('.clear-filter').addEventListener('click', clearFilter);
  
  // Name filter input
  const nameFilter = document.getElementById('name-filter');
  const regexToggle = document.getElementById('regex-toggle');
  
  let filterTimeout = null;
  nameFilter.addEventListener('input', () => {
    // Debounce the filter to avoid excessive updates while typing
    clearTimeout(filterTimeout);
    filterTimeout = setTimeout(() => {
      filterByName(nameFilter.value, regexToggle.checked);
    }, 150);
  });
  
  // Re-filter when regex toggle changes
  regexToggle.addEventListener('change', () => {
    if (nameFilter.value) {
      filterByName(nameFilter.value, regexToggle.checked);
    }
  });
  
  // Allow Escape key to clear filter when in input
  nameFilter.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      clearFilter();
      nameFilter.blur();
    }
  });
  
  // Symbol references (old span-based refs)
  document.querySelectorAll('.sym-ref').forEach(ref => {
    ref.addEventListener('click', (e) => {
      e.stopPropagation();
      const sym = ref.dataset.sym;
      const file = ref.dataset.file;
      if (file) {
        navigateTo(sym, file);
      } else {
        handleNameClick(sym);
      }
    });
  });
  
  // Symbol links (new anchor-based links)
  // These use standard <a> tags so navigation happens automatically
  // But we need to clear filters if target would be hidden
  document.querySelectorAll('.sym-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      if (href && href.startsWith('#')) {
        // Local link - check if target is hidden by filter
        const targetId = href.substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          // If target is hidden, clear the filter first
          if (target.classList.contains('hidden')) {
            clearFilter();
          }
          // Add highlight effect after a short delay
          setTimeout(() => {
            target.classList.add('highlight');
            setTimeout(() => target.classList.remove('highlight'), 400);
          }, 100);
        }
      }
      // For external links, default behavior handles navigation
    });
  });
  
  // Form names (show what uses them)
  document.querySelectorAll('.form-name').forEach(name => {
    name.addEventListener('click', (e) => {
      handleNameClick(name.dataset.sym);
    });
  });
  
  // Handle hash navigation (when arriving at page with #anchor)
  if (window.location.hash) {
    const target = document.querySelector(window.location.hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        target.classList.add('highlight');
        setTimeout(() => target.classList.remove('highlight'), 400);
      }, 200);
    }
  }
  
  // Initialize theme from storage
  setTheme(getStoredTheme());
  
  // Initialize font size from storage
  currentFontSize = getStoredFontSize();
  setFontSize(currentFontSize);
  
  // Theme toggle button
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  // Font size buttons
  document.getElementById('font-larger').addEventListener('click', increaseFontSize);
  document.getElementById('font-smaller').addEventListener('click', decreaseFontSize);
});

</script>

</body>
</html>